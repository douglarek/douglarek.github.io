<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>ä¸ºä»€ä¹ˆ Go ä¼šæœ‰ nil channels</title>
      <link href="/post/why-are-there-nil-channels-in-go.html"/>
      <url>/post/why-are-there-nil-channels-in-go.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ª<a href="https://medium.com/justforfunc/why-are-there-nil-channels-in-go-9877cc0b2308" target="_blank" rel="noopener">Why are there nil channels in Go</a>ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰.</p><p>æ¯ä¸ªå†™è¿‡ Go çš„äººéƒ½çŸ¥é“ channels. æˆ‘ä»¬å¤§å¤šæ•°äººä¹ŸçŸ¥é“ channels çš„é»˜è®¤å€¼æ˜¯ nil. ä½†æ˜¯æˆ‘ä»¬å¾ˆå¤šäººéƒ½ä¸çŸ¥é“è¿™ä¸ª nil å€¼æ˜¯æœ‰ç”¨çš„. (è¯‘æ³¨: è€å®è¯´è¯»åˆ°è¿™ç¯‡æ–‡ç« ä¹‹å‰æˆ‘ä¹Ÿè®¤ä¸º nil channels æ²¡ä»€ä¹ˆç”¨, ä¸ä»…æ²¡ç”¨, æˆ‘è¿˜è§‰å¾—å¯¹ nil channels çš„å†™å…¥æ“ä½œåº”è¯¥ panic æ‰å¯¹, å°±åƒå¯¹ nil map çš„å†™å…¥æ˜¯ panic ä¸€æ ·, ç”šè‡³è®¤ä¸ºè¿™æ˜¯ Go çš„è®¾è®¡ä¸ä¸€è‡´é—®é¢˜)</p><p>æˆ‘ä»ä¸€ä¸ªå­¦ä¹  Go çš„å¼€å‘è€…çš„ twitter ä¸Šå¾—åˆ°äº†åŒæ ·çš„é—®é¢˜, ä»–æƒ³çŸ¥é“æ˜¯å¦ Go nil channels çš„å­˜åœ¨ä»…ä»…æ˜¯ä¸ºäº†å®Œæ•´æ€§.</p><p>æƒ³çŸ¥é“æ˜¯å¦æœ‰ç”¨æ˜¯æœ‰æ„ä¹‰çš„, å› ä¸ºå®ƒä»¬çš„è¡Œä¸ºè¡¨ç°çš„æˆªç„¶ç›¸å.</p><p>ç»™å®šä¸€ä¸ª nil channel c:</p><ul><li>&lt;-c      ä» c æ¥æ”¶å°†æ°¸è¿œ block</li><li>c &lt;- v   å‘é€å€¼åˆ° c ä¼šæ°¸è¿œ block</li><li>close(c) å…³é—­ c å¼•å‘ panic</li></ul><p>ä½†æˆ‘ä»ç„¶åšæŒä»–ä»¬æ˜¯æœ‰ç”¨çš„. è®©æˆ‘å…ˆä»‹ç»ä¸€ä¸ªé—®é¢˜, å…¶è§£å†³æ–¹æ¡ˆèµ·åˆçœ‹èµ·æ¥å¾ˆæ˜æ˜¾, ä½†å®é™…ä¸Šå¹¶ä¸åƒäººä»¬æƒ³è±¡çš„é‚£ä¹ˆå®¹æ˜“, å®é™…ä¸Šå´ä» nil channels ä¸­å—ç›Š.</p><h3 id="åˆå¹¶-channels"><a href="#åˆå¹¶-channels" class="headerlink" title="åˆå¹¶ channels"></a>åˆå¹¶ channels</h3><p>å¦‚æœä½ é€‰æ‹©æ¥å—å®ƒ, ä½ çš„ä»»åŠ¡æ˜¯ç¼–å†™ä¸€ä¸ªå‡½æ•°, ç»™å®šä¸¤ä¸ª channels a å’Œ b è¿”å›ä¸€ä¸ªç›¸åŒç±»å‹çš„ channel c. a æˆ– b ä¸­æ”¶åˆ°çš„æ¯ä¸ªå…ƒç´ éƒ½å°†å‘é€ç»™ c, å¹¶ä¸”ä¸€æ—¦ a å’Œb éƒ½å…³é—­, cä¹Ÿå°†è¢«å…³é—­.</p><p><img src="/static/images/0_aKHj7JJ0UCDEYu23.png" width="700px" height="371px"></p><h3 id="ä¸€ä¸ªè¾…åŠ©å‡½æ•°"><a href="#ä¸€ä¸ªè¾…åŠ©å‡½æ•°" class="headerlink" title="ä¸€ä¸ªè¾…åŠ©å‡½æ•°"></a>ä¸€ä¸ªè¾…åŠ©å‡½æ•°</h3><p>åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰, è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥å¸®åŠ©æˆ‘ä»¬æµ‹è¯•æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆ. æ­¤å‡½æ•°è¿”å›ä¸€ä¸ª channel , è¯¥ channel æœ€ç»ˆå°†éšæœºæ¥æ”¶æ‰€æœ‰ç»™å®šçš„å€¼å¹¶é€šè¿‡å…³é—­å®Œæˆ.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">asChan</span><span class="params">(vs ...<span class="keyword">int</span>)</span> &lt;-<span class="title">chan</span> <span class="title">int</span></span> &#123;</span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> vs &#123;</span><br><span class="line">c &lt;- v</span><br><span class="line">time.Sleep(time.Duration(rand.Intn(<span class="number">1000</span>)) * time.Millisecond)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">close</span>(c)</span><br><span class="line">&#125;()</span><br><span class="line"><span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤å‡½æ•°åˆ›å»ºä¸€ä¸ª channel c, å¯åŠ¨ä¸€ä¸ªæ–°çš„ goroutine, å°†å€¼å‘é€åˆ°åˆ›å»ºçš„ channel c, æœ€åè¿”å› channel c.</p><p>åœ¨å¤„ç† channels æ—¶è¿™æ˜¯å¾ˆå¸¸è§çš„æ¨¡å¼, å› æ­¤åœ¨ç»§ç»­é˜…è¯»ä¹‹å‰, è¯·ç¡®ä¿ä½ äº†è§£å®ƒçš„å·¥ä½œåŸç†.</p><h3 id="è®©æˆ‘ä»¬å¼€å§‹å§"><a href="#è®©æˆ‘ä»¬å¼€å§‹å§" class="headerlink" title="è®©æˆ‘ä»¬å¼€å§‹å§"></a>è®©æˆ‘ä»¬å¼€å§‹å§</h3><p>ç”±äºæˆ‘ä»¬æ²¡æœ‰å¯¹ a æˆ– b çš„åå¥½, æ‰€ä»¥æˆ‘ä»¬å°†é¿å…é€šè¿‡é€‰æ‹©æˆ‘ä»¬åº”è¯¥é¦–å…ˆé€‰æ‹©(range)å“ªä¸ª channel æ¥åˆ›å»ºåå¥½.</p><p>ç›¸åæˆ‘ä»¬ä¼šä¿æŒè¿™ç§å¯¹ç§°æ€§, å¹¶ä¸”ä½¿ç”¨ä¸€ä¸ªæ— é™å¾ªç¯æ¥ select è¿™ä¸¤ä¸ª channels.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">merge</span><span class="params">(a, b &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)</span> &lt;-<span class="title">chan</span> <span class="title">int</span></span> &#123;</span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> v := &lt;-a:</span><br><span class="line">c &lt;- v</span><br><span class="line"><span class="keyword">case</span> v := &lt;-b:</span><br><span class="line">c &lt;- v</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line"><span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™çœ‹èµ·æ¥ä¸é”™, è®©æˆ‘ä»¬å†™ä¸€ä¸ªå¿«é€Ÿæµ‹è¯•å¹¶è¿è¡Œå®ƒ.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">a := asChan(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>)</span><br><span class="line">b := asChan(<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>)</span><br><span class="line">c := merge(a, b)</span><br><span class="line"><span class="keyword">for</span> v := <span class="keyword">range</span> c &#123;</span><br><span class="line">fmt.Println(v)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™åº”è¯¥ä»¥æŸç§é¡ºåºæ‰“å° 1 åˆ° 8 å¹¶æˆåŠŸç»“æŸ. è®©æˆ‘ä»¬çœ‹çœ‹å‘ç”Ÿäº†ä»€ä¹ˆ.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; go run main.go</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">ğŸ˜±</span><br></pre></td></tr></table></figure><p>å¥½å§, å¾ˆæ˜æ˜¾è¿™ä¸å¥½, å› ä¸ºè¯¥ç¨‹åºæ²¡æœ‰ç»“æŸ. ä¸€æ—¦å®ƒæ‰“å°å‡ºä» 1 åˆ° 8 çš„å€¼, å®ƒå°†å¼€å§‹æ°¸è¿œæ‰“å° 0.</p><h3 id="å¤„ç†å…³é—­çš„-channels"><a href="#å¤„ç†å…³é—­çš„-channels" class="headerlink" title="å¤„ç†å…³é—­çš„ channels"></a>å¤„ç†å…³é—­çš„ channels</h3><p>å¦‚æœæˆ‘ä»¬ä»ä¸€ä¸ªå…³é—­çš„ channel æ¥æ”¶ä¼šå‘ç”Ÿä»€ä¹ˆ ? æˆ‘ä»¬ä¼šå¾—åˆ° channel ç±»å‹çš„é»˜è®¤å€¼. åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­, ç±»å‹æ˜¯ int, æ‰€ä»¥å€¼æ˜¯ 0.</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸ 0 æ¯”è¾ƒæ¥æ£€æŸ¥æ˜¯å¦ channel å·²ç»å…³é—­, ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ¥æ”¶åˆ°çš„å…¶ä¸­ä¸€ä¸ªå€¼æ˜¯ 0, ä¼šæ€ä¹ˆæ · ? ç›¸å, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ â€œv, okâ€ è¯­æ³•:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">v, ok := &lt;- c</span><br></pre></td></tr></table></figure><p>å½“ä½¿ç”¨è¿™ä¸ªè¯­æ³•æ—¶, ok æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼, åªè¦ channel æ˜¯å¼€ç€çš„, å®ƒå°±æ˜¯ true. çŸ¥é“è¿™ä¸€ç‚¹, æˆ‘ä»¬å¯ä»¥é¿å…å°†å¤šä½™çš„ 0 å‘é€ç»™ c .</p><p>åœ¨æŸä¸€ç‚¹ä¸Šæˆ‘ä»¬ä¹Ÿåº”è¯¥åœæ­¢è¿­ä»£, æ‰€ä»¥è®©æˆ‘ä»¬ä¹Ÿè·Ÿè¸ªä¸¤ä¸ª channels ä½•æ—¶å…³é—­.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">merge</span><span class="params">(a, b &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)</span> &lt;-<span class="title">chan</span> <span class="title">int</span></span> &#123;</span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">adone, bdone := <span class="literal">false</span>, <span class="literal">false</span></span><br><span class="line"><span class="keyword">for</span> !adone || !bdone &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> v, ok := &lt;-a:</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line">adone = <span class="literal">true</span></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">c &lt;- v</span><br><span class="line"><span class="keyword">case</span> v, ok := &lt;-b:</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line">bdone = <span class="literal">true</span></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">c &lt;- v</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line"><span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™çœ‹èµ·æ¥å¯èƒ½æœ‰ç”¨ ! è®©æˆ‘ä»¬æ¥è¿è¡Œå®ƒ.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; go run main.go</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">fatal error: all goroutines are asleep - deadlock!</span><br><span class="line">goroutine 1 [chan receive]:</span><br><span class="line">main.main()</span><br><span class="line">        /Users/francesc/src/github.com/campoy/campoy.cat/site/static/code/nilchans/main.go:13 +0x186</span><br><span class="line">exit status 2</span><br></pre></td></tr></table></figure><p>å“å‘€, æˆ‘ä»¬å¿˜äº†ä¸€äº›äº‹æƒ…. æ˜¯ä»€ä¹ˆå‘¢ ? æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åªæœ‰ä¸€ä¸ª goroutine åœ¨è¿è¡Œ, å¹¶ä¸”å®ƒé˜»å¡åœ¨ç¬¬ 13 è¡Œ (case v, ok := &lt;-b:). é‚£ä¸€è¡Œæ˜¯:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> v := <span class="keyword">range</span> c &#123;</span><br></pre></td></tr></table></figure><p>ä½ èƒ½çœ‹å‡ºé—®é¢˜æ˜¯ä»€ä¹ˆå— ? range è¯­å¥è¿­ä»£ channel ä¸­çš„æ‰€æœ‰å€¼ç›´åˆ° channel å…³é—­. ä½†æ˜¯è°å…³é—­äº†è¿™ä¸ª channel ?</p><p>æˆ‘ä»¬å¿˜äº† ! è®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„ goroutine ä¸­æ·»åŠ  defer è¯­å¥, ä»¥ç¡®ä¿è¯¥ channel æœ€ç»ˆå…³é—­.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">merge</span><span class="params">(a, b &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)</span> &lt;-<span class="title">chan</span> <span class="title">int</span></span> &#123;</span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> <span class="built_in">close</span>(c)</span><br><span class="line">adone, bdone := <span class="literal">false</span>, <span class="literal">false</span></span><br><span class="line"><span class="keyword">for</span> !adone || !bdone &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> v, ok := &lt;-a:</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line">adone = <span class="literal">true</span></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">c &lt;- v</span><br><span class="line"><span class="keyword">case</span> v, ok := &lt;-b:</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line">bdone = <span class="literal">true</span></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">c &lt;- v</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line"><span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„, defer è¯­å¥ä½äºæ–°çš„ goroutine ä¸­è°ƒç”¨çš„åŒ¿åå‡½æ•°ä¸­, è€Œä¸æ˜¯åœ¨ merge ä¸­. å¦åˆ™, åªè¦æˆ‘ä»¬é€€å‡º merage, c å°±ä¼šè¢«å…³é—­, é‚£ä¹ˆå‘é€ä¸€ä¸ªå€¼ç»™å®ƒå°†å¼•å‘ panic.</p><p>è®©æˆ‘ä»¬è¿è¡Œå®ƒ, çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; go run main.go</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td></tr></table></figure><p>è¿™çœ‹èµ·æ¥å¾ˆæ£’ â€¦ ä½†æ˜¯æ˜¯è¿™æ ·å— ?</p><h3 id="ç¹å¿™çš„å¾ªç¯"><a href="#ç¹å¿™çš„å¾ªç¯" class="headerlink" title="ç¹å¿™çš„å¾ªç¯"></a>ç¹å¿™çš„å¾ªç¯</h3><p>æˆ‘ä»¬è¿„ä»Šä¸ºæ­¢ç¼–å†™çš„ä»£ç éå¸¸å¥½. å®ƒåœ¨åŠŸèƒ½ä¸Šæ˜¯æ­£ç¡®çš„, ä½†æ˜¯å¦‚æœä½ åœ¨ç”Ÿäº§ä¸­éƒ¨ç½²äº†å®ƒ, ä½ æœ€ç»ˆå¯èƒ½ä¼šé‡åˆ°æ€§èƒ½é—®é¢˜.</p><p>ä¸ºäº†å‘ä½ æ˜¾ç¤ºé—®é¢˜æ‰€åœ¨, è®©æˆ‘ä»¬æ·»åŠ ä¸€äº›æ—¥å¿—è®°å½•.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">merge</span><span class="params">(a, b &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)</span> &lt;-<span class="title">chan</span> <span class="title">int</span></span> &#123;</span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> <span class="built_in">close</span>(c)</span><br><span class="line">adone, bdone := <span class="literal">false</span>, <span class="literal">false</span></span><br><span class="line"><span class="keyword">for</span> !adone || !bdone &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> v, ok := &lt;-a:</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line">                    log.Println(<span class="string">"a is done"</span>)</span><br><span class="line">adone = <span class="literal">true</span></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">c &lt;- v</span><br><span class="line"><span class="keyword">case</span> v, ok := &lt;-b:</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line">                    log.Println(<span class="string">"b is done"</span>)</span><br><span class="line">bdone = <span class="literal">true</span></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">c &lt;- v</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line"><span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬è¿è¡Œå®ƒ, çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; go run main.go</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">a is done</span><br><span class="line">2018/01/14 20:47:22 b is done</span><br><span class="line">... ğŸ˜±</span><br><span class="line">2018/01/14 20:47:23 b is done</span><br><span class="line">2018/01/14 20:47:23 a is done</span><br></pre></td></tr></table></figure><p>å‘ƒå“¦ ! ä¼¼ä¹ä¸€æ—¦ä¸€ä¸ª channel å®Œæˆ, æˆ‘ä»¬å°±ä¸åœåœ°è¿­ä»£ !</p><p>æ¯•ç«Ÿå®ƒç¡®å®æœ‰æ„ä¹‰. æ­£å¦‚æˆ‘ä»¬åœ¨å¼€å§‹æ—¶çœ‹åˆ°çš„, ä»ä¸€ä¸ªå…³é—­çš„ channel è¯»å–ä»ä¸é˜»å¡.</p><p>å› æ­¤, åªè¦ä¸¤ä¸ª channels éƒ½å¤„äºæ‰“å¼€çŠ¶æ€, select è¯­å¥å°†ä¼šé˜»å¡, ç›´åˆ°æ–°å…ƒç´ å‡†å¤‡å°±ç»ª, ä½†æ˜¯ä¸€æ—¦å…¶ä¸­ä¸€ä¸ªå…³é—­, æˆ‘ä»¬å°†è¿­ä»£å¹¶æµªè´¹ CPU. è¿™ä¹Ÿè¢«ç§°ä¸ºç¹å¿™çš„å¾ªç¯, å¹¶ä¸å¥½.</p><h3 id="åœ¨-select-è¯­å¥ä¸­ç¦ç”¨ä¸€ä¸ª-case"><a href="#åœ¨-select-è¯­å¥ä¸­ç¦ç”¨ä¸€ä¸ª-case" class="headerlink" title="åœ¨ select è¯­å¥ä¸­ç¦ç”¨ä¸€ä¸ª case"></a>åœ¨ select è¯­å¥ä¸­ç¦ç”¨ä¸€ä¸ª case</h3><p>ä¸ºäº†é¿å…ä¹‹å‰æè¿°çš„ç¹å¿™å¾ªç¯, æˆ‘ä»¬å¸Œæœ›ç¦ç”¨ select è¯­å¥çš„ä¸€éƒ¨åˆ†. å…·ä½“æ¥è¯´, å½“ a å…³é—­çš„æ—¶å€™æˆ‘ä»¬æƒ³ç§»é™¤ (case v, ok := &lt;- a), b ä¹Ÿä¸€æ ·. ä½†æ˜¯æ€ä¹ˆåšå‘¢ ?</p><p>æ­£å¦‚æˆ‘ä»¬åœ¨å¼€å¤´æåˆ°çš„é‚£æ ·, ä» nil channels æ¥æ”¶æ•°æ®ä¼šæ°¸è¿œé˜»å¡. æ‰€ä»¥ä¸ºäº†ç¦ç”¨ä¸€ä¸ªä» channel æ¥æ”¶æ•°æ®çš„ case, æˆ‘ä»¬å¯ä»¥ç®€å•å°† channel è®¾ç½®ä¸º nil !</p><p>ç„¶å, æˆ‘ä»¬å¯ä»¥åœæ­¢ä½¿ç”¨ adone å’Œ bdone, è€Œæ˜¯æ£€æŸ¥ a å’Œ b æ˜¯å¦ä¸º nil .</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">merge</span><span class="params">(a, b &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)</span> &lt;-<span class="title">chan</span> <span class="title">int</span></span> &#123;</span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> <span class="built_in">close</span>(c)</span><br><span class="line"><span class="keyword">for</span> a != <span class="literal">nil</span> || b != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> v, ok := &lt;-a:</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line">fmt.Println(<span class="string">"a is done"</span>)</span><br><span class="line">a = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">c &lt;- v</span><br><span class="line"><span class="keyword">case</span> v, ok := &lt;-b:</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line">fmt.Println(<span class="string">"b is done"</span>)</span><br><span class="line">b = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">c &lt;- v</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line"><span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½, å¸Œæœ›è¿™å¯ä»¥é¿å…ä¸å¿…è¦çš„å¾ªç¯. æˆ‘ä»¬æ¥è¯•è¯•å§.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; go run main.go</span><br><span class="line">2</span><br><span class="line">1</span><br><span class="line">4</span><br><span class="line">3</span><br><span class="line">6</span><br><span class="line">5</span><br><span class="line">8</span><br><span class="line">7</span><br><span class="line">b is done</span><br><span class="line">a is done</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆè§£å†³æ–¹æ¡ˆçš„ä»£ç åœ¨ <a href="https://github.com/campoy/justforfunc/blob/master/26-nil-chans/main.go" target="_blank" rel="noopener">GitHub</a> ä¸Š.</p>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Go ä¸­çš„ nil</title>
      <link href="/post/go-nils.html"/>
      <url>/post/go-nils.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ª<a href="https://go101.org/article/nil.html" target="_blank" rel="noopener">nils In Go</a>ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰.</p><p>nil æ˜¯ Go ä¸­ä¸€ä¸ªç†Ÿæ‚‰è€Œé‡è¦çš„é¢„å®šä¹‰æ ‡è¯†ç¬¦. å®ƒæ˜¯å¾ˆå¤šç±»å‹é›¶å€¼(zero values)çš„å­—é¢é‡è¡¨ç¤º. å¾ˆå¤šæœ‰ä¸€äº›å…¶ä»–æµè¡Œè¯­è¨€ç»éªŒçš„ Go ç¨‹åºå‘˜æ–°æ‰‹è§† nil ä¸ºå…¶ä»–è¯­è¨€ null(æˆ–è€… NULL)çš„å‰¯æœ¬. è¿™æ˜¯éƒ¨åˆ†æ­£ç¡®çš„, ä½†æ˜¯ Go ä¸­çš„ nil å’Œå…¶ä»–è¯­è¨€çš„ null(æˆ–è€… NULL)æœ‰å¾ˆå¤šä¸åŒä¹‹å¤„.</p><p>æœ¬æ–‡çš„å‰©ä½™éƒ¨åˆ†å°†åˆ—å‡ºä¸ nil æœ‰å…³çš„å„ç§äº‹å®å’Œç»†èŠ‚.</p><h3 id="Go-ä¸­çš„-nil-æ˜¯ä¸€ä¸ªé¢„å®šä¹‰æ ‡è¯†ç¬¦"><a href="#Go-ä¸­çš„-nil-æ˜¯ä¸€ä¸ªé¢„å®šä¹‰æ ‡è¯†ç¬¦" class="headerlink" title="Go ä¸­çš„ nil æ˜¯ä¸€ä¸ªé¢„å®šä¹‰æ ‡è¯†ç¬¦"></a>Go ä¸­çš„ nil æ˜¯ä¸€ä¸ªé¢„å®šä¹‰æ ‡è¯†ç¬¦</h3><p>ä½ å¯ä»¥ä½¿ç”¨ nil è€Œä¸ç”¨å£°æ˜å®ƒ.</p><h3 id="nil-å¯ä»¥è¡¨ç¤ºå¾ˆå¤šç±»å‹çš„é›¶å€¼"><a href="#nil-å¯ä»¥è¡¨ç¤ºå¾ˆå¤šç±»å‹çš„é›¶å€¼" class="headerlink" title="nil å¯ä»¥è¡¨ç¤ºå¾ˆå¤šç±»å‹çš„é›¶å€¼"></a>nil å¯ä»¥è¡¨ç¤ºå¾ˆå¤šç±»å‹çš„é›¶å€¼</h3><p>åœ¨ Go ä¸­, nil å¯ä»¥è¡¨ç¤ºä»¥ä¸‹ç±»å‹çš„é›¶å€¼:</p><ul><li>pointer (åŒ…æ‹¬ç±»å‹ä¸å®‰å…¨çš„)</li><li>map</li><li>slice</li><li>function</li><li>channel</li><li>interface</li></ul><p>æ¢å¥è¯è¯´, åœ¨ Go ä¸­, nil å¯èƒ½æ˜¯è®¸å¤šä¸åŒç±»å‹çš„å€¼.</p><h3 id="nil-ä¸æ˜¯é»˜è®¤ç±»å‹"><a href="#nil-ä¸æ˜¯é»˜è®¤ç±»å‹" class="headerlink" title="nil ä¸æ˜¯é»˜è®¤ç±»å‹"></a>nil ä¸æ˜¯é»˜è®¤ç±»å‹</h3><p>Go ä¸­çš„æ¯ä¸ªå…¶ä»–é¢„å®šä¹‰æ ‡è¯†ç¬¦éƒ½æœ‰ä¸€ä¸ªé»˜è®¤ç±»å‹. æ¯”å¦‚,</p><ul><li>true å’Œ false çš„é»˜è®¤ç±»å‹éƒ½æ˜¯ bool ç±»å‹.</li><li>iota çš„é»˜è®¤ç±»å‹æ˜¯ int.</li></ul><p>ä½†æ˜¯ nil æ²¡æœ‰é»˜è®¤ç±»å‹, å°½ç®¡å®ƒæœ‰å¾ˆå¤šå¯èƒ½çš„ç±»å‹. ç¼–è¯‘å™¨å¿…é¡»æœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ¥ä»ä¸Šä¸‹æ–‡ä¸­æ¨å¯¼å‡º nil çš„ç±»å‹.</p><p>ä¾‹å¦‚:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// ä»¥ä¸‹ä»£ç è¡Œä¸èƒ½ç¼–è¯‘.</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">v := nil</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¯‘å™¨å¿…é¡»æœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ‰å¯ä»¥æ¨æ–­ nil çš„ç±»å‹.</span></span><br><span class="line">_ = (*<span class="keyword">struct</span>&#123;&#125;)(<span class="literal">nil</span>)</span><br><span class="line">_ = []<span class="keyword">int</span>(<span class="literal">nil</span>)</span><br><span class="line">_ = <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">bool</span>(<span class="literal">nil</span>)</span><br><span class="line">_ = <span class="keyword">chan</span> <span class="keyword">string</span>(<span class="literal">nil</span>)</span><br><span class="line">_ = (<span class="function"><span class="keyword">func</span><span class="params">()</span>)<span class="params">(<span class="literal">nil</span>)</span></span></span><br><span class="line"><span class="function">_ = <span class="title">interface</span></span>&#123;&#125;(<span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™äº›ä»£ç è¡Œå’Œä¸Šé¢çš„ä»£ç è¡Œç­‰ä»·.</span></span><br><span class="line"><span class="keyword">var</span> _ *<span class="keyword">struct</span>&#123;&#125; = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">var</span> _ []<span class="keyword">int</span> = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">var</span> _ <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">bool</span> = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">var</span> _ <span class="keyword">chan</span> <span class="keyword">string</span> = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">var</span> _ <span class="function"><span class="keyword">func</span><span class="params">()</span> = <span class="title">nil</span></span></span><br><span class="line"><span class="function"><span class="title">var</span> _ <span class="title">interface</span></span>&#123;&#125; = <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Go-ä¸­çš„-nil-ä¸æ˜¯ä¸€ä¸ªå…³é”®å­—"><a href="#Go-ä¸­çš„-nil-ä¸æ˜¯ä¸€ä¸ªå…³é”®å­—" class="headerlink" title="Go ä¸­çš„ nil ä¸æ˜¯ä¸€ä¸ªå…³é”®å­—"></a>Go ä¸­çš„ nil ä¸æ˜¯ä¸€ä¸ªå…³é”®å­—</h3><p>é¢„å®šä¹‰çš„ nil å¯ä»¥è¢«è¦†ç›–(shadowed).</p><p>ä¾‹å¦‚:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="literal">nil</span> := <span class="number">123</span></span><br><span class="line">fmt.Println(<span class="literal">nil</span>) <span class="comment">// 123</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚ä¸‹ä»£ç è¡Œä¼šäº§ç”Ÿç¼–è¯‘é”™è¯¯, å› ä¸ºå½“å‰ä½œç”¨åŸŸ nil ä»£è¡¨ä¸€ä¸ª nil å€¼.</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">var _ map[string]int = nil</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(é¡ºä¾¿è¯´ä¸€å¥, åœ¨è®¸å¤šå…¶ä»–è¯­è¨€ä¸­çš„ null å’Œ NULL ä¹Ÿä¸æ˜¯å…³é”®å­—.)</p><h3 id="ä¸åŒç±»å‹çš„-nil-å€¼çš„å¤§å°-Size-å¯èƒ½ä¸ä¸€æ ·"><a href="#ä¸åŒç±»å‹çš„-nil-å€¼çš„å¤§å°-Size-å¯èƒ½ä¸ä¸€æ ·" class="headerlink" title="ä¸åŒç±»å‹çš„ nil å€¼çš„å¤§å°(Size)å¯èƒ½ä¸ä¸€æ ·"></a>ä¸åŒç±»å‹çš„ nil å€¼çš„å¤§å°(Size)å¯èƒ½ä¸ä¸€æ ·</h3><p>ä¸€ç§ç±»å‹çš„æ‰€æœ‰å€¼çš„å†…å­˜å¸ƒå±€æ€»æ˜¯ç›¸åŒçš„. è¯¥ç±»å‹çš„ nil å€¼ä¹Ÿä¸ä¾‹å¤–. nil çš„å¤§å°æ€»æ˜¯ä¸ç›¸åŒç±»å‹çš„é nil çš„å¤§å°ç›¸åŒ. å› æ­¤, è¡¨ç¤ºä¸åŒç±»å‹çš„ä¸åŒé›¶å€¼çš„ nil æ ‡è¯†ç¬¦å¯èƒ½å…·æœ‰ä¸åŒçš„å¤§å°.</p><p>ä¾‹å¦‚:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"unsafe"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> p *<span class="keyword">struct</span>&#123;&#125; = <span class="literal">nil</span></span><br><span class="line">fmt.Println(unsafe.Sizeof(p)) <span class="comment">// 8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s []<span class="keyword">int</span> = <span class="literal">nil</span></span><br><span class="line">fmt.Println(unsafe.Sizeof(s)) <span class="comment">// 24, è¯‘æ³¨: slice çš„å®ç°åŒ…å«ä¸€ä¸ª array(unsafe.Pointer ç±»å‹), ä¸€ä¸ª len (int ç±»å‹) ä»¥åŠä¸€ä¸ª cap (int ç±»å‹), æ‰€ä»¥ size ä¸º 24, å‚è§: https://golang.org/src/runtime/slice.go#L11</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">bool</span> = <span class="literal">nil</span></span><br><span class="line">fmt.Println(unsafe.Sizeof(m)) <span class="comment">// 8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c <span class="keyword">chan</span> <span class="keyword">string</span> = <span class="literal">nil</span></span><br><span class="line">fmt.Println(unsafe.Sizeof(c)) <span class="comment">// 8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f <span class="function"><span class="keyword">func</span><span class="params">()</span> = <span class="title">nil</span></span></span><br><span class="line"><span class="function"><span class="title">fmt</span>.<span class="title">Println</span><span class="params">(unsafe.Sizeof(f)</span>) // 8</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">var</span> <span class="title">i</span> <span class="title">interface</span></span>&#123;&#125; = <span class="literal">nil</span></span><br><span class="line">fmt.Println(unsafe.Sizeof(i)) <span class="comment">// 16, è¯‘æ³¨: interface&#123;&#125; çš„å†…éƒ¨å®ç°æ˜¯ä¸€ä¸ª eface ç±»å‹, åŒ…å«ä¸€ä¸ª _type æŒ‡é’ˆç±»å‹ ä»¥åŠä¸€ä¸ª data unsafe.Pointer ç±»å‹, æ‰€ä»¥ size ä¸º 16, å‚è§: https://golang.org/src/runtime/runtime2.go#L148</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§å°æ˜¯ç¼–è¯‘å™¨å’Œæ¶æ„ç›¸å…³çš„. ä¸Šè¿°æ‰“å°ç»“æœé€‚ç”¨äº 64 ä½æ¶æ„å’Œæ ‡å‡† Go ç¼–è¯‘å™¨. å¯¹äº 32 ä½æ¶æ„, æ‰“å°å¤§å°å°†å‡åŠ. å¯¹äºæ ‡å‡†çš„ Go ç¼–è¯‘å™¨, ä¸åŒç§ç±»çš„ç›¸åŒç±»å‹çš„ä¸¤ä¸ª nil å€¼çš„å¤§å°æ€»æ˜¯ç›¸åŒçš„. ä¾‹å¦‚, ä¸¤ä¸ªä¸åŒ slice ç±»å‹ []int å’Œ []string çš„ä¸¤ä¸ª nil å€¼çš„å¤§å°æ˜¯ç›¸åŒçš„.</p><h3 id="ä¸¤ç§ä¸åŒç±»å‹çš„ä¸¤ä¸ª-nil-å€¼å¯èƒ½ä¸å¯æ¯”è¾ƒ"><a href="#ä¸¤ç§ä¸åŒç±»å‹çš„ä¸¤ä¸ª-nil-å€¼å¯èƒ½ä¸å¯æ¯”è¾ƒ" class="headerlink" title="ä¸¤ç§ä¸åŒç±»å‹çš„ä¸¤ä¸ª nil å€¼å¯èƒ½ä¸å¯æ¯”è¾ƒ"></a>ä¸¤ç§ä¸åŒç±»å‹çš„ä¸¤ä¸ª nil å€¼å¯èƒ½ä¸å¯æ¯”è¾ƒ</h3><p>ä¾‹å¦‚:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¦‚ä¸‹ä»£ç æ— æ³•ç¼–è¯‘.</span></span><br><span class="line"><span class="keyword">var</span> _ = (*<span class="keyword">int</span>)(<span class="literal">nil</span>) == (*<span class="keyword">bool</span>)(<span class="literal">nil</span>)         <span class="comment">// error: mismatched types.</span></span><br><span class="line"><span class="keyword">var</span> _ = (<span class="keyword">chan</span> <span class="keyword">int</span>)(<span class="literal">nil</span>) == (<span class="keyword">chan</span> <span class="keyword">bool</span>)(<span class="literal">nil</span>) <span class="comment">// error: mismatched types.</span></span><br></pre></td></tr></table></figure><p>åœ¨ Go ä¸­, ä¸¤ç§ä¸åŒå¯æ¯”è¾ƒç±»å‹çš„ä¸¤ä¸ªå€¼ä»…å½“å…¶ä¸­ä¸€ä¸ªéšå¼çš„è½¬åŒ–ä¸ºå¦ä¸€ä¸ªç±»å‹çš„æ—¶å€™æ‰å¯ä»¥æ¯”è¾ƒ. å…·ä½“è€Œè¨€, æœ‰ä¸‰ç§æƒ…å†µä¸åŒå¯æ¯”è¾ƒçš„ä¸¤ä¸ªå€¼æ‰å¯ä»¥æ¯”è¾ƒ:</p><ol><li>ä¸¤ä¸ªå€¼ä¸­çš„ä¸€ä¸ªçš„ç±»å‹æ˜¯å¦ä¸€ä¸ªçš„åº•å±‚ç±»å‹.</li><li>ä¸¤ä¸ªå€¼ä¹‹ä¸€çš„ç±»å‹å®ç°å¦ä¸€ä¸ªå€¼çš„ç±»å‹(å¿…é¡»æ˜¯æ¥å£ç±»å‹).</li><li>ä¸¤ä¸ªå€¼ä¸­çš„ä¸€ä¸ªçš„ç±»å‹æ˜¯å®šå‘ channel ç±»å‹, å¦ä¸€ä¸ªæ˜¯åŒå‘ channel ç±»å‹, ä¸¤ç§ç±»å‹å…·æœ‰ç›¸åŒçš„å…ƒç´ ç±»å‹ï¼Œå¹¶ä¸”ä¸¤ç§ç±»å‹ä¸­çš„ä¸€ç§ä¸æ˜¯å®šä¹‰çš„ç±»å‹.</li></ol><p>nil å€¼ä¹Ÿä¸ä¾‹å¤–.</p><p>ä¸‹é¢ä¾‹å­ä¸­çš„ä»£ç è¡Œéƒ½å¯ä»¥ç¼–è¯‘.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> IntPtr *<span class="keyword">int</span></span><br><span class="line"><span class="comment">// IntPtr çš„åº•å±‚ç±»å‹æ˜¯ *int.</span></span><br><span class="line"><span class="keyword">var</span> _ = IntPtr(<span class="literal">nil</span>) == (*<span class="keyword">int</span>)(<span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Go ä¸­æ¯ä¸€ä¸ªç±»å‹éƒ½å®ç°äº†ç©º interface&#123;&#125; ç±»å‹.</span></span><br><span class="line"><span class="keyword">var</span> _ = (<span class="keyword">interface</span>&#123;&#125;)(<span class="literal">nil</span>) == (*<span class="keyword">int</span>)(<span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šå‘ channel ç±»å‹çš„å€¼å¯ä»¥è½¬ä¸ºä¸€ä¸ªå…·æœ‰ç›¸åŒå…ƒç´ ç±»å‹çš„åŒå‘ channel ç±»å‹.</span></span><br><span class="line"><span class="keyword">var</span> _ = (<span class="keyword">chan</span> <span class="keyword">int</span>)(<span class="literal">nil</span>) == (<span class="keyword">chan</span>&lt;- <span class="keyword">int</span>)(<span class="literal">nil</span>)</span><br><span class="line"><span class="keyword">var</span> _ = (<span class="keyword">chan</span> <span class="keyword">int</span>)(<span class="literal">nil</span>) == (&lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)(<span class="literal">nil</span>)</span><br></pre></td></tr></table></figure><h3 id="ç›¸åŒç±»å‹çš„ä¸¤ä¸ª-nil-å€¼å¯èƒ½ä¹Ÿä¸å¯æ¯”è¾ƒ"><a href="#ç›¸åŒç±»å‹çš„ä¸¤ä¸ª-nil-å€¼å¯èƒ½ä¹Ÿä¸å¯æ¯”è¾ƒ" class="headerlink" title="ç›¸åŒç±»å‹çš„ä¸¤ä¸ª nil å€¼å¯èƒ½ä¹Ÿä¸å¯æ¯”è¾ƒ"></a>ç›¸åŒç±»å‹çš„ä¸¤ä¸ª nil å€¼å¯èƒ½ä¹Ÿä¸å¯æ¯”è¾ƒ</h3><p>åœ¨ Go ä¸­, map, slice, function ç±»å‹ä¸æ”¯æŒæ¯”è¾ƒ. æ‰€ä»¥æ¯”è¾ƒä¸¤ä¸ªä¸å¯æ¯”è¾ƒç±»å‹çš„ä¸¤ä¸ª nil æ˜¯éæ³•çš„.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»¥ä¸‹ä»£ç è¡Œæ— æ³•é€šè¿‡ç¼–è¯‘.</span></span><br><span class="line"><span class="keyword">var</span> _ = ([]<span class="keyword">int</span>)(<span class="literal">nil</span>) == ([]<span class="keyword">int</span>)(<span class="literal">nil</span>)</span><br><span class="line"><span class="keyword">var</span> _ = (<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)(<span class="literal">nil</span>) == (<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)(<span class="literal">nil</span>)</span><br><span class="line"><span class="keyword">var</span> _ = (<span class="function"><span class="keyword">func</span><span class="params">()</span>)<span class="params">(<span class="literal">nil</span>)</span> == <span class="params">(<span class="keyword">func</span>()</span>)<span class="params">(<span class="literal">nil</span>)</span></span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯, ä¸Šè¿°æ— æ³•æ¯”è¾ƒçš„ç±»å‹çš„ä»»ä½•å€¼éƒ½å¯ä»¥ä¸è£¸ nil æ ‡è¯†ç¬¦è¿›è¡Œæ¯”è¾ƒ. (<em>è¯‘æ³¨</em>: è¿™ä¸ªåœ°æ–¹æœ‰ç‚¹éš¾ç†è§£, è½¬åŒ–åçš„ nil æœ¬è´¨ä¸Šå·²ç»å…·æœ‰ç±»å‹äº†, æ‰€ä»¥ç›¸å½“äºä¸¤ç§å…·æœ‰ç›¸åŒç±»å‹çš„ nil åœ¨æ¯”è¾ƒ, åœ¨è¿™é‡Œä¸å¯æ¯”è¾ƒ, ç¼–è¯‘æŠ¥é”™, è€Œä¸€ä¸ªé›¶å€¼ç±»å‹ä¸ nil çš„æ¯”è¾ƒæ˜¯å•çº¯çš„å€¼æ¯”è¾ƒ)</p><h3 id="ä¸¤ä¸ª-nil-å€¼å¯èƒ½ä¸ç›¸ç­‰"><a href="#ä¸¤ä¸ª-nil-å€¼å¯èƒ½ä¸ç›¸ç­‰" class="headerlink" title="ä¸¤ä¸ª nil å€¼å¯èƒ½ä¸ç›¸ç­‰"></a>ä¸¤ä¸ª nil å€¼å¯èƒ½ä¸ç›¸ç­‰</h3><p>å¦‚æœä¸¤ä¸ªè¦æ¯”è¾ƒçš„ nil å€¼ä¹‹ä¸€æ˜¯ä¸€ä¸ªæ¥å£å€¼, å¦ä¸€ä¸ªä¸æ˜¯, å‡è®¾å®ƒä»¬æ˜¯å¯æ¯”è¾ƒçš„, é‚£ä¹ˆæ¯”è¾ƒç»“æœæ€»æ˜¯ false çš„. åŸå› æ˜¯è¿›è¡Œæ¯”è¾ƒä¹‹å‰, éæ¥å£å€¼å°†è¢«è½¬æ¢ä¸ºæ¥å£å€¼çš„ç±»å‹. è½¬æ¢çš„æ¥å£å€¼å…·æœ‰ä¸€ä¸ªå…·ä½“çš„åŠ¨æ€ç±»å‹, ä½†å…¶ä»–æ¥å£å€¼æ²¡æœ‰. è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¯”è¾ƒç»“æœæ€»æ˜¯ false çš„åŸå› . (<em>è¯‘æ³¨</em>: è¿™ä¸ªå…¶å®è¯´çš„æ˜¯æ¯”è¾ƒçš„æ—¶å€™ (*int)(nil) ä¼šè½¬åŒ–ä¸ºä¸€ä¸ª interface {} ç±»å‹, è¿™æ ·è¿™ä¸ªæ¥å£å°±å…·æœ‰äº†æ˜ç¡®çš„ç±»å‹å’Œå€¼ nil, æˆ‘ä»¬çŸ¥é“ go çš„æ¥å£å®ç°æ˜¯ç±»å‹å’Œå€¼ä¸¤ä¸ªéƒ¨åˆ†, (interface{})(nil) è¿™ä¸ªçš„ç±»å‹å’Œå€¼éƒ½æ˜¯ nil, æ‰€ä»¥æ¯”è¾ƒæ€»æ˜¯ false)</p><p>ä¾‹å¦‚:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">fmt.Println((<span class="keyword">interface</span>&#123;&#125;)(<span class="literal">nil</span>) == (*<span class="keyword">int</span>)(<span class="literal">nil</span>)) <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h3 id="ä»-nil-map-æ£€ç´¢å…ƒç´ ä¸ä¼š-panic"><a href="#ä»-nil-map-æ£€ç´¢å…ƒç´ ä¸ä¼š-panic" class="headerlink" title="ä» nil map æ£€ç´¢å…ƒç´ ä¸ä¼š panic"></a>ä» nil map æ£€ç´¢å…ƒç´ ä¸ä¼š panic</h3><p>ä» nil map æ£€ç´¢å…ƒç´ æ€»æ˜¯ä¼šè¿”å›å…ƒç´ ç±»å‹çš„é›¶å€¼. (<em>è¯‘æ³¨</em>: map æ˜¯å¼•ç”¨ç±»å‹, nil map ä¸æŒ‡å‘ä¸€ä¸ªåˆå§‹åŒ–çš„ map, æ‰€ä»¥å†…å­˜è¯»ä¼šæ˜¯é›¶å€¼, å†™å…¥ä¸€ä¸ª nil map ä¼š panic)</p><p>ä¾‹å¦‚:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">fmt.Println((<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)(<span class="literal">nil</span>)[<span class="string">"key"</span>]) <span class="comment">// 0</span></span><br><span class="line">fmt.Println((<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">bool</span>)(<span class="literal">nil</span>)[<span class="number">123</span>])     <span class="comment">// false</span></span><br><span class="line">fmt.Println((<span class="keyword">map</span>[<span class="keyword">int</span>]*<span class="keyword">int64</span>)(<span class="literal">nil</span>)[<span class="number">123</span>])   <span class="comment">// &lt;nil&gt;</span></span><br></pre></td></tr></table></figure><h3 id="éå†-nil-channel-map-slice-å’Œ-array-æŒ‡é’ˆæ˜¯åˆæ³•çš„"><a href="#éå†-nil-channel-map-slice-å’Œ-array-æŒ‡é’ˆæ˜¯åˆæ³•çš„" class="headerlink" title="éå† nil channel, map, slice å’Œ array æŒ‡é’ˆæ˜¯åˆæ³•çš„"></a>éå† nil channel, map, slice å’Œ array æŒ‡é’ˆæ˜¯åˆæ³•çš„</h3><p>éå† nil map å’Œ slice çš„å¾ªç¯æ¬¡æ•°æ˜¯ 0.</p><p>éå†ä¸€ä¸ª nil array æŒ‡é’ˆçš„å¾ªç¯æ¬¡æ•°æ˜¯å®ƒå¯¹åº”æ•°ç»„ç±»å‹çš„é•¿åº¦. (ä½†æ˜¯, å¦‚æœç›¸åº”æ•°ç»„ç±»å‹çš„é•¿åº¦ä¸ä¸º 0, å¹¶ä¸”è¿­ä»£çš„ç¬¬äºŒä¸ªå˜é‡æ—¢ä¸å¿½ç•¥ä¹Ÿä¸çœç•¥, é‚£ä¹ˆè¿­ä»£åœ¨è¿è¡Œæ—¶å°†ä¼š panic. <em>è¯‘æ³¨</em>: è¿™ä¸ªå¯ä»¥çœ‹ä¸‹é¢çš„å¢åŠ æ³¨è§£ä»£ç è¿›è¡Œç†è§£)</p><p>éå†ä¸€ä¸ª nil channel å°†æ°¸ä¹… block.</p><p>ä¾‹å¦‚, ä»¥ä¸‹çš„ä»£ç å°†æ‰“å°å‡º 0, 1, 2, 3, å’Œ 4, ç„¶åå°†æ°¸è¿œ block. Hello, word å’Œ Bye ä¸ä¼šæ‰“å°å‡ºæ¥.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="keyword">range</span> []<span class="keyword">int</span>(<span class="literal">nil</span>) &#123;</span><br><span class="line">fmt.Println(<span class="string">"Hello"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">range</span> <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>(<span class="literal">nil</span>) &#123;</span><br><span class="line">fmt.Println(<span class="string">"world"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i,_ := <span class="keyword">range</span> (*[<span class="number">5</span>]<span class="keyword">int</span>)(<span class="literal">nil</span>) &#123;</span><br><span class="line">fmt.Println(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯‘åŠ : ä»¥ä¸‹ä»£ç å°† panic</span></span><br><span class="line"><span class="comment">// for i, v := range (*[5]int)(nil) &#123;</span></span><br><span class="line"><span class="comment">// fmt.Println(i, v)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">range</span> <span class="keyword">chan</span> <span class="keyword">bool</span>(<span class="literal">nil</span>) &#123; <span class="comment">// è¿™é‡Œ block</span></span><br><span class="line">fmt.Println(<span class="string">"Bye"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é€šè¿‡éæ¥å£-nil-å‚æ•°è°ƒç”¨æ–¹æ³•å°†ä¸ä¼š-panic"><a href="#é€šè¿‡éæ¥å£-nil-å‚æ•°è°ƒç”¨æ–¹æ³•å°†ä¸ä¼š-panic" class="headerlink" title="é€šè¿‡éæ¥å£ nil å‚æ•°è°ƒç”¨æ–¹æ³•å°†ä¸ä¼š panic"></a>é€šè¿‡éæ¥å£ nil å‚æ•°è°ƒç”¨æ–¹æ³•å°†ä¸ä¼š panic</h3><p>ä¾‹å¦‚:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Slice []<span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Slice)</span> <span class="title">Length</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Slice)</span> <span class="title">Modify</span><span class="params">(i <span class="keyword">int</span>, x <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">s[i] = x <span class="comment">// panic if s is nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Slice)</span> <span class="title">DoNothing</span><span class="params">()</span></span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Slice)</span> <span class="title">Append</span><span class="params">(x <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">*p = <span class="built_in">append</span>(*p, x) <span class="comment">// panic if p is nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// å¦‚ä¸‹é€‰æ‹©å™¨å°†ä¸ä¼š panic.</span></span><br><span class="line">_ = ((Slice)(<span class="literal">nil</span>)).Length</span><br><span class="line">_ = ((Slice)(<span class="literal">nil</span>)).Modify</span><br><span class="line">_ = ((*Slice)(<span class="literal">nil</span>)).DoNothing</span><br><span class="line">_ = ((*Slice)(<span class="literal">nil</span>)).Append</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥ä¸‹ä¸¤è¡Œå°†ä¸ä¼š panic.</span></span><br><span class="line">_ = ((Slice)(<span class="literal">nil</span>)).Length()</span><br><span class="line">((*Slice)(<span class="literal">nil</span>)).DoNothing()</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚ä¸‹ä¸¤è¡Œå°†ä¼š panic. ä½†æ˜¯ panics åœ¨è°ƒç”¨æ–¹æ³•æ—¶ä¸ä¼šè§¦å‘. å°†åœ¨æ–¹æ³•ä½“å†…è§¦å‘.</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">((Slice)(nil)).Modify(0, true)</span></span><br><span class="line"><span class="comment">((*Slice)(nil)).Append(true)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¦‚æœç±»å‹-T-çš„é›¶å€¼å¯ä»¥è¡¨ç¤ºä¸º-nil-é‚£ä¹ˆ-new-T-å’Œ-nil-ç›¸ç­‰"><a href="#å¦‚æœç±»å‹-T-çš„é›¶å€¼å¯ä»¥è¡¨ç¤ºä¸º-nil-é‚£ä¹ˆ-new-T-å’Œ-nil-ç›¸ç­‰" class="headerlink" title="å¦‚æœç±»å‹ T çš„é›¶å€¼å¯ä»¥è¡¨ç¤ºä¸º nil, é‚£ä¹ˆ *new(T) å’Œ nil ç›¸ç­‰"></a>å¦‚æœç±»å‹ T çš„é›¶å€¼å¯ä»¥è¡¨ç¤ºä¸º nil, é‚£ä¹ˆ *new(T) å’Œ nil ç›¸ç­‰</h3><p>ä¾‹å¦‚:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(*<span class="built_in">new</span>(*<span class="keyword">int</span>) == <span class="literal">nil</span>)         <span class="comment">// true</span></span><br><span class="line">fmt.Println(*<span class="built_in">new</span>([]<span class="keyword">int</span>) == <span class="literal">nil</span>)        <span class="comment">// true</span></span><br><span class="line">fmt.Println(*<span class="built_in">new</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">bool</span>) == <span class="literal">nil</span>) <span class="comment">// true</span></span><br><span class="line">fmt.Println(*<span class="built_in">new</span>(<span class="keyword">chan</span> <span class="keyword">string</span>) == <span class="literal">nil</span>)  <span class="comment">// true</span></span><br><span class="line">fmt.Println(*<span class="built_in">new</span>(<span class="function"><span class="keyword">func</span><span class="params">()</span>) == <span class="title">nil</span>)       // <span class="title">true</span></span></span><br><span class="line"><span class="function"><span class="title">fmt</span>.<span class="title">Println</span><span class="params">(*<span class="built_in">new</span>(<span class="keyword">interface</span>&#123;&#125;)</span> == <span class="title">nil</span>)  // <span class="title">true</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> go </tag>
            
            <tag> go101 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Go errors å †æ ˆ</title>
      <link href="/post/go-errors-stack-traces.html"/>
      <url>/post/go-errors-stack-traces.html</url>
      <content type="html"><![CDATA[<p>ç›¸å¯¹äº C è¯­è¨€æ¥è¯´, Go åœ¨å¤„ç†ä¼ ç»Ÿçš„é€»è¾‘é”™è¯¯ä¸Šç¡®å®ç•¥é«˜ä¸€ç­¹. è‡³å°‘ä¸€ä¸ª func è¿”å› error, æˆ‘ä»¬çŸ¥é“éœ€è¦å¤„ç†å¹¶ä¸”å¶å°”ä¼šè¿›è¡Œä¼ é€’, è€Œä¸æ˜¯å¹²å·´å·´ç­‰ç€è¿è¡Œæ—¶å´©æºƒ.</p><h3 id="Errors-ä¹Ÿæ˜¯å€¼"><a href="#Errors-ä¹Ÿæ˜¯å€¼" class="headerlink" title="Errors ä¹Ÿæ˜¯å€¼"></a>Errors ä¹Ÿæ˜¯å€¼</h3><p>æˆ‘ä»¬æ¯ä¸ªäººåœ¨å­¦ä¹  Go çš„æ—¶å€™éƒ½è¢«è¿™æ ·è¯´æœ: <a href="https://blog.golang.org/errors-are-values" target="_blank" rel="noopener">Errors are values</a>, é”™è¯¯ä¹Ÿæ˜¯ä¸€ç§å€¼, å°±åƒå…¶ä»–ä»»ä½•ç±»å‹çš„å€¼ä¸€æ ·.</p><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://play.golang.org/p/VFVX0fRKBnS</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"strconv"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> _, err := strconv.ParseInt(<span class="string">"abcd"</span>, <span class="number">10</span>, <span class="number">64</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">// strconv.ParseInt: parsing "abcd": invalid syntax</span></span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥å¥½åƒè¿˜ä¸é”™, èµ·ç æˆ‘ä»¬çŸ¥é“ 3 ä¸ªå†…å®¹:</p><ul><li>é”™è¯¯å‘ç”Ÿçš„ func: strconv.ParseInt</li><li>å‘ç”Ÿé”™è¯¯ func çš„å‚æ•°: abcd</li><li>é”™è¯¯çš„åŸå› : invalid syntax</li></ul><p>å¦‚æœæŸ¥çœ‹ <a href="https://golang.org/src/strconv/atoi.go?s=4086:4153#L146" target="_blank" rel="noopener">strconv.ParseInt</a> çš„æºç ä½ ä¼šå‘ç°, ä»£ç å¦‚æ ‡å‡†åº“è€…ä¾ç„¶æ²¡æœ‰ä½¿ç”¨æœ€åŸå§‹çš„ error è¿”å›. å®ƒä¹‹æ‰€ä»¥æ‰“å°å‡ºä¸Šé¢çš„ 3 ä¸ªå†…å®¹, æ˜¯å› ä¸ºä½¿ç”¨äº†è‡ªå®šä¹‰çš„ NumError :</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// A NumError records a failed conversion.</span></span><br><span class="line"><span class="keyword">type</span> NumError <span class="keyword">struct</span> &#123;</span><br><span class="line">Func <span class="keyword">string</span> <span class="comment">// the failing function (ParseBool, ParseInt, ParseUint, ParseFloat)</span></span><br><span class="line">Num  <span class="keyword">string</span> <span class="comment">// the input</span></span><br><span class="line">Err  error  <span class="comment">// the reason the conversion failed (e.g. ErrRange, ErrSyntax, etc.)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *NumError)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"strconv."</span> + e.Func + <span class="string">": "</span> + <span class="string">"parsing "</span> + Quote(e.Num) + <span class="string">": "</span> + e.Err.Error()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬é¢†ä¼šäº† Errors are values çš„ç²¾ç¥, åŸºæœ¬ä¸Šèƒ½å†™å‡ºè¿™æ ·çš„é”™è¯¯å¤„ç†å·²ç»å¾ˆç¬¦åˆ <a href="https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully" target="_blank" rel="noopener">ä¸è¦ä»…ä»…æ£€æŸ¥ errors, ä¼˜é›…çš„å¤„ç†å®ƒä»¬</a> çš„å®—æ—¨äº†. æœ¬æ–‡åœ¨è¿™é‡Œä¹Ÿå¯èƒ½å°±ç»“æŸäº†, ç„¶åå°†æ ‡é¢˜æ”¹ä¸º: Go errors æŒ‡å— \ (â€¢â—¡â€¢) /.</p><h3 id="Errors-å †æ ˆè·Ÿè¸ª"><a href="#Errors-å †æ ˆè·Ÿè¸ª" class="headerlink" title="Errors å †æ ˆè·Ÿè¸ª"></a>Errors å †æ ˆè·Ÿè¸ª</h3><p>ä¸, è¿™ä¸å¤Ÿå•Š, å¯¹äºæ ‡å‡†åº“å¯èƒ½æ¯ä¸ªé”™è¯¯éƒ½åƒé‚£æ ·æ¨¡ç‰ˆå¼æä¸ªèŠ±å¼è‡ªå®šä¹‰ error . å¦‚æœæˆ‘ä»¬ç”¨è¿‡ Python æˆ–è€… Java çš„ try, ä¸ä¼šä¸çŸ¥é“å¼‚å¸¸(å¯èƒ½æœ‰äººåœ¨è¿™é‡Œè·Ÿæˆ‘æ° Go é‡Œé¢ errors ä¸æ˜¯å¼‚å¸¸)å‘ç”Ÿçš„æ—¶å€™, æ‰“å°è¡Œå·ç­‰å…³é”®ä¿¡æ¯æœ‰å¤šé‡è¦å§.</p><p>ä¸Šé¢çš„ ParseInt ä¾‹å­åªæ˜¯ä¸ªç®€å•çš„ä¸èƒ½å†ç®€å•çš„ä¾‹å­, å¦‚æœæˆ‘ä»¬çš„å·¥ç¨‹å’Œä»£ç å¤æ‚åº¦éƒ½ä¸Šä¸€ä¸ªå±‚æ¬¡, ä¸€ä¸ª func é‡Œé¢å¯èƒ½éœ€è¦å¤„ç†å¤šä¸ªç¬¬ä¸‰æ–¹ func è¿”å›çš„ errors. ä¸€ä¸ªç®€å•çš„ errors ä¿¡æ¯å¯¹äºç¨‹åºçš„è°ƒè¯•å¹¶ä¸å‹å¥½. å½“ç„¶ä½ å¦‚æœç¡®ä¿äº†åƒæ ‡å‡†åº“é‚£æ ·ç»™å‡ºäº†é‚£æ ·ç¿”å®çš„ errors å†…å®¹, å€’ä¹Ÿä¸é”™. å³ä¾¿æ˜¯è¿™æ ·, æˆ‘è§‰å¾—ä¾ç„¶æ²¡æœ‰å‘ç”Ÿ errors æ—¶ç»™å‡ºæ–‡ä»¶å’Œè¡Œå·æ¥å¾—å®ç”¨ä¸€äº›.</p><p>å®ç°è¿™ä¸ªåŠŸèƒ½éœ€è¦ç”¨åˆ° Go å¼ºå¤§çš„ runtime åŒ…, æˆ‘ä»¬å°è¯•è‡ªå·±å®ç°ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰ errors å †æ ˆè·Ÿè¸ª:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://play.golang.org/p/-tesfXuy9fc</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"runtime"</span></span><br><span class="line"><span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">callers</span><span class="params">()</span> []<span class="title">uintptr</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> pcs [<span class="number">32</span>]<span class="keyword">uintptr</span></span><br><span class="line">n := runtime.Callers(<span class="number">3</span>, pcs[:])</span><br><span class="line">st := pcs[<span class="number">0</span>:n]</span><br><span class="line"><span class="keyword">return</span> st</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> trace <span class="keyword">struct</span> &#123;</span><br><span class="line">m <span class="keyword">string</span></span><br><span class="line">s []<span class="keyword">uintptr</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *trace)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> b strings.Builder</span><br><span class="line">b.WriteString(e.m)</span><br><span class="line">b.WriteString(<span class="string">"\n\n"</span>)</span><br><span class="line">b.WriteString(<span class="string">"Traceback:"</span>)</span><br><span class="line"><span class="keyword">for</span> _, pc := <span class="keyword">range</span> e.s &#123;</span><br><span class="line">fn := runtime.FuncForPC(pc)</span><br><span class="line">b.WriteString(<span class="string">"\n"</span>)</span><br><span class="line">f, n := fn.FileLine(pc)</span><br><span class="line">b.WriteString(fmt.Sprintf(<span class="string">"%s:%d"</span>, f, n))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> b.String()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewTrace creates a simple traceable error.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewTrace</span><span class="params">(message <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;trace&#123;m: message, s: callers()&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> NewTrace(<span class="string">"ooops"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(f())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// goplay è¾“å‡º</span></span><br><span class="line"><span class="comment">// ooops</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Traceback:</span></span><br><span class="line"><span class="comment">// /tmp/sandbox315155193/main.go:41</span></span><br><span class="line"><span class="comment">// /tmp/sandbox315155193/main.go:45</span></span><br><span class="line"><span class="comment">// /usr/local/go/src/runtime/proc.go:207</span></span><br><span class="line"><span class="comment">// /usr/local/go/src/runtime/asm_amd64p32.s:968</span></span><br></pre></td></tr></table></figure><p>è™½ç„¶ç®€å•ç²—ç³™äº†ä¸€äº›, ä½†ç¡®å®å®ç°äº†æˆ‘ä»¬è¦çš„ç®€å• errors å †æ ˆè·Ÿè¸ª.</p><h3 id="ç¤¾åŒºå®ç°-pkg-errors"><a href="#ç¤¾åŒºå®ç°-pkg-errors" class="headerlink" title="ç¤¾åŒºå®ç°(pkg/errors)"></a>ç¤¾åŒºå®ç°(pkg/errors)</h3><p>æˆ‘ä»¬å½“ç„¶ä¸æ‰“ç®—åœ¨å¹³å¸¸çš„ä»£ç ä¸­ä½¿ç”¨è¿™æ ·ä¸€ä¸ªç®€å•çš„å®ç°, æˆ‘ä»¬è¿™é‡Œä»‹ç»ä¸€ä¸‹ç¤¾åŒºå·²ç»å­˜åœ¨çš„ <a href="https://github.com/pkg/errors" target="_blank" rel="noopener">pkg/errors</a> åº“.</p><p>å¯¹äºæ ‡å‡†åº“æˆ–è€…ç¬¬ä¸‰æ–¹åº“çš„ errors è¿”å›æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç®€å•çš„ wrap, ä»¥ä¾¿åœ¨åŒæ ·ä½¿ç”¨ pkg/errors çš„åœ°æ–¹å¯ä»¥è·å–ä¸€è‡´çš„ errors ä½“éªŒ:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">_, err := ioutil.ReadAll(r)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> errors.Wrap(err, <span class="string">"read failed"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹çœ‹æ€æ ·ä½¿ç”¨ pkg/errors å¾—åˆ°çš„ errors:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"os"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"github.com/pkg/errors"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">parseArgs</span><span class="params">(args []<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(args) &lt; <span class="number">3</span> &#123;</span><br><span class="line"><span class="keyword">return</span> errors.Errorf(<span class="string">"not enough arguments, expected at least 3, got %d"</span>, <span class="built_in">len</span>(args))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">err := parseArgs(os.Args[<span class="number">1</span>:])</span><br><span class="line">fmt.Printf(<span class="string">"%v\n"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">// not enough arguments, expected at least 3, got 0</span></span><br></pre></td></tr></table></figure><p>ä»€ä¹ˆ ? æ²¡æœ‰å †æ ˆä¿¡æ¯æ‰“å° ? pkg/errors é»˜è®¤çš„ flag æ˜¯ä¸æ‰“å°å †æ ˆä¿¡æ¯çš„(è™½ç„¶ä¸€ç›´åŒ…å«). æˆ‘ä»¬æ–½å±•ä¸€ä¸‹ Go Formatter çš„é­”æ³•:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">err := parseArgs(os.Args[<span class="number">1</span>:])</span><br><span class="line">fmt.Printf(<span class="string">"%+v\n"</span>, err) <span class="comment">// æ²¡é”™, åŠ ä¸ª `+` flag</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">// not enough arguments, expected at least 3, got 0</span></span><br><span class="line"><span class="comment">// main.parseArgs</span></span><br><span class="line"><span class="comment">// /Users/xxx/.go/src/github.com/gorocks/snippets/go/cmd/gosnippets/main.go:12</span></span><br><span class="line"><span class="comment">// main.main</span></span><br><span class="line"><span class="comment">// /Users/xxx/.go/src/github.com/gorocks/snippets/go/cmd/gosnippets/main.go:18</span></span><br><span class="line"><span class="comment">// runtime.main</span></span><br><span class="line"><span class="comment">// /usr/local/Cellar/go/1.10.1/libexec/src/runtime/proc.go:198</span></span><br><span class="line"><span class="comment">// runtime.goexit</span></span><br><span class="line"><span class="comment">// /usr/local/Cellar/go/1.10.1/libexec/src/runtime/asm_amd64.s:2361</span></span><br></pre></td></tr></table></figure><p>ä¹‹æ‰€ä»¥ä¼šæœ‰è¿™ä¸ªæ•ˆæœæ˜¯å› ä¸º pkg/errors å®ç°äº† <a href="https://golang.org/pkg/fmt/#Formatter" target="_blank" rel="noopener">Formatter</a> æ¥å£:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *fundamental)</span> <span class="title">Format</span><span class="params">(s fmt.State, verb <span class="keyword">rune</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">switch</span> verb &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'v'</span>:</span><br><span class="line"><span class="keyword">if</span> s.Flag(<span class="string">'+'</span>) &#123;</span><br><span class="line">io.WriteString(s, f.msg)</span><br><span class="line">f.stack.Format(s, verb)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fallthrough</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">'s'</span>:</span><br><span class="line">io.WriteString(s, f.msg)</span><br><span class="line"><span class="keyword">case</span> <span class="string">'q'</span>:</span><br><span class="line">fmt.Fprintf(s, <span class="string">"%q"</span>, f.msg)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç° Formatter çš„ä¸€ä¸ªå¥½å¤„æ˜¯, æˆ‘ä»¬å¯ä»¥å¦‚ä½¿ç”¨æ ‡å‡†åº“èˆ¬å§‹ç»ˆå¦‚ä¸€, æ²¡æœ‰å¤šä½™çš„ä»»ä½• func è°ƒç”¨.</p><h3 id="Benchmark"><a href="#Benchmark" class="headerlink" title="Benchmark"></a>Benchmark</h3><p>pkg/errors å †æ ˆè·Ÿè¸ªä¸æ˜¯æ²¡æœ‰è¿è¡Œæ—¶å¼€é”€çš„, <a href="https://github.com/pkg/errors/issues/72" target="_blank" rel="noopener">å®˜æ–¹</a>ç»™å‡ºçš„æŒ‡æ ‡æ˜¯æ¯ä¸ªæ“ä½œå¤§çº¦ 1000-3000 ns.</p><p>ä¸€èˆ¬æ¥è¯´è¿™ä¸ä¼šæ„æˆæ€§èƒ½å¿§è™‘. å¦‚æœè¶…è¿‡äº†ä½ çš„æ€§èƒ½é¢„æœŸ, å¯ä»¥å®šåˆ¶æˆè°ƒè¯•æ¨¡å¼å¯ç”¨.</p><h4 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4><ul><li><a href="https://blog.golang.org/errors-are-values" target="_blank" rel="noopener">Errors are values</a></li><li><a href="https://dave.cheney.net/2016/06/12/stack-traces-and-the-errors-package" target="_blank" rel="noopener">Stack traces and the errors package</a></li><li><a href="https://github.com/pkg/errors" target="_blank" rel="noopener">pkg/errors</a></li></ul>]]></content>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>SICP å‡†å¤‡</title>
      <link href="/post/sicp-quickstart.html"/>
      <url>/post/sicp-quickstart.html</url>
      <content type="html"><![CDATA[<p>ä¹°äº†å¾ˆä¹…çš„ SICP (è‹±æ–‡: <a href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book.html" target="_blank" rel="noopener">Structure and Interpretation of Computer Programs</a>, ä¸­æ–‡è¯‘ä½œ: è®¡ç®—æœºç¨‹åºçš„æ„é€ å’Œè§£é‡Š)ä¸€ç›´åœ¨åƒç°, è¶ç€å‡æœŸæ¡èµ·æ¥.</p><h3 id="ä¸€ç§-Scheme-å®ç°"><a href="#ä¸€ç§-Scheme-å®ç°" class="headerlink" title="ä¸€ç§ Scheme å®ç°"></a>ä¸€ç§ Scheme å®ç°</h3><p>åˆ· SICP ä¸å±€é™äºç‰¹å®šçš„ Scheme å®ç°, è™½ç„¶ MIT-Scheme æ˜¯ MIT å‡ºçš„. ç„¶è€Œ MIT è‡ªå·±éƒ½åºŸæ‰äº†å®ƒè€ŒæŒ‡å®š DrScheme ä¸ºé»˜è®¤è¯¾ç¨‹æ”¯æŒç‰ˆæœ¬. æœ¬æ–‡åŸºäºçš„ Scheme å®ç°æ˜¯ <a href="http://www.call-cc.org/" target="_blank" rel="noopener">Chicken</a>.</p><p>macOS ä¸‹å®‰è£…å¾ˆç®€å•:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ brew install chicken</span><br></pre></td></tr></table></figure><h3 id="ä¸€ä¸ªç¼–è¾‘å™¨"><a href="#ä¸€ä¸ªç¼–è¾‘å™¨" class="headerlink" title="ä¸€ä¸ªç¼–è¾‘å™¨"></a>ä¸€ä¸ªç¼–è¾‘å™¨</h3><p>å¯¹äºSchemeæ¥è¯´, ææ€•æ”¯æŒæœ€å¥½çš„å°±æ˜¯ Emacs äº†. åŒæ ·æœ¬æ–‡åŸºäº Emacs çš„å®šåˆ¶é…ç½®ç‰ˆæœ¬ <a href="https://github.com/syl20bnr/spacemacs" target="_blank" rel="noopener">Spacemacs</a>.</p><p>Spacemacs æœ¬èº«å°±æœ‰ä¸€ä¸ª Scheme çš„ Layer å¯ä¾›ä½¿ç”¨, æˆ‘ä½¿ç”¨äº†ä¸€ä¸ªåŸºäºå®ƒ, è‡ªå·±å®šåˆ¶çš„ Layer(<a href="https://github.com/douglarek/.spacemacs.d/tree/master/layers/x-scheme" target="_blank" rel="noopener">x-scheme</a>).</p><p>x-scheme ä¾èµ–äº <a href="https://github.com/jaor/geiser" target="_blank" rel="noopener">Geiser</a> æä¾› REPL ç­‰å„ç§ä¾¿åˆ©çš„åŠŸèƒ½, å®ƒä½¿ç”¨äº† Chicken çš„æŸäº›æ‰©å±•, å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ chicken-install chicken-doc apropos sicp <span class="comment"># åŒ…å« sicp æ”¯æŒ</span></span><br><span class="line">$ <span class="built_in">cd</span> `csi -p <span class="string">'(chicken-home)'</span>`</span><br><span class="line">$ curl http://3e8.org/pub/chicken-doc/chicken-doc-repo.tgz | tar zx</span><br></pre></td></tr></table></figure><h3 id="ä¸€ä¸ªä¾‹å­"><a href="#ä¸€ä¸ªä¾‹å­" class="headerlink" title="ä¸€ä¸ªä¾‹å­"></a>ä¸€ä¸ªä¾‹å­</h3><p>Chicken é€šè¿‡ sicp æ‰©å±•å¯¹ SICP æä¾›æŸäº›ä¾¿åˆ©çš„æ”¯æŒ, æ¯”å¦‚ä¸€äº› SICP é»˜è®¤å·²ç»æœ‰äº†çš„è¿‡ç¨‹(average ç­‰). ä¾‹å¦‚ SICP ç»ƒä¹ ç¬¬ä¸€ç« 1.7:</p><figure class="highlight scheme"><table><tr><td class="code"><pre><span class="line">(<span class="name">use</span> sicp) <span class="comment">;; sicp æ‰©å±•</span></span><br><span class="line"></span><br><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name"><span class="builtin-name">sqrt</span></span> x)</span><br><span class="line">  (<span class="name"><span class="builtin-name">define</span></span> (<span class="name">improve</span> guess x)</span><br><span class="line">    (<span class="name">average</span> guess (<span class="name"><span class="builtin-name">/</span></span> x guess)))</span><br><span class="line">  (<span class="name"><span class="builtin-name">define</span></span> (<span class="name">good-enough?</span> guess last-guess)</span><br><span class="line">    (<span class="name"><span class="builtin-name">&lt;</span></span> (<span class="name"><span class="builtin-name">/</span></span> (<span class="name"><span class="builtin-name">abs</span></span> (<span class="name"><span class="builtin-name">-</span></span> guess last-guess)) guess) <span class="number">0.001</span>))</span><br><span class="line">  (<span class="name"><span class="builtin-name">define</span></span> (<span class="name">sqrt-iter</span> guess last-guess x)</span><br><span class="line">    (<span class="name"><span class="builtin-name">if</span></span> (<span class="name">good-enough?</span> guess last-guess)</span><br><span class="line">        last-guess</span><br><span class="line">        (<span class="name">sqrt-iter</span> last-guess (<span class="name">improve</span> last-guess x)</span><br><span class="line">                   x)))</span><br><span class="line">  (<span class="name">sqrt-iter</span> <span class="number">1.0</span> x x))</span><br></pre></td></tr></table></figure><h3 id="SICP-å®ç”¨æ€§"><a href="#SICP-å®ç”¨æ€§" class="headerlink" title="SICP å®ç”¨æ€§"></a>SICP å®ç”¨æ€§</h3><p>æˆ‘ä»¬åšä¸€ä»¶äº‹æƒ…çš„æ—¶å€™æœ‰æ—¶å¾ˆå–œæ¬¢è€ƒè™‘è¿™ä¸ªä¸œè¥¿å®ç”¨ä¸å®ç”¨, åšäº†æœ‰ä»€ä¹ˆæ”¶ç›Š. è¿™æ²¡ä»€ä¹ˆé—®é¢˜, ç‰¹åˆ«æ˜¯åˆ«äººé—®ä½ åˆ· SICP æœ‰ä»€ä¹ˆç”¨çš„æ—¶å€™, å¾ˆéš¾å›ç­”. å› ä¸ºä½ å·¥ä½œæˆ–ç”Ÿæ´»ä¸­ç¡®å®æ²¡æœ‰ç”¨å®ƒçš„åœºæ™¯, ç”šè‡³æ˜¯äº§å“. SICP ä¸­æ–‡ç‰ˆåºå‰æœ‰æ®µè¯æŒºå¥½çš„, åœ¨è¿™é‡Œåˆ†äº«ä¸€ä¸‹:</p><blockquote><p>æˆ‘è®¤ä¸º, åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ä¿æŒè®¡ç®—ä¸­çš„è¶£å‘³æ€§æ˜¯ç‰¹åˆ«é‡è¦çš„äº‹æƒ…. è¿™ä¸€å­¦ç§‘åœ¨èµ·æ­¥æ—¶é¥±å«ç€è¶£å‘³æ€§. å½“ç„¶, é‚£äº›ä»˜é’±çš„å®¢æˆ·ä»¬æ—¶å¸¸è§‰å¾—å—äº†éª—. ä¸€æ®µæ—¶é—´ä¹‹å, æˆ‘ä»¬å¼€å§‹ä¸¥è‚ƒåœ°çœ‹å¾…ä»–ä»¬çš„æŠ±æ€¨. æˆ‘ä»¬å¼€å§‹æ„Ÿè§‰åˆ°, è‡ªå·±çœŸçš„åƒæ˜¯è¦è´Ÿèµ·æˆåŠŸåœ°ã€æ— å·®é”™åœ°ã€å®Œç¾åœ°ä½¿ç”¨è¿™äº›æœºå™¨çš„è´£ä»». æˆ‘ä¸è®¤ä¸ºæˆ‘ä»¬å¯ä»¥åšåˆ°è¿™äº›. æˆ‘è®¤ä¸ºæˆ‘ä»¬çš„è´£ä»»æ˜¯å»æ‹“å±•è¿™ä¸€é¢†åŸŸ, å°†å…¶å‘å±•åˆ°æ–°çš„æ–¹å‘, å¹¶åœ¨è‡ªå·±çš„å®¶é‡Œä¿æŒè¶£å‘³æ€§. æˆ‘å¸Œæœ›è®¡ç®—æœºç§‘å­¦çš„é¢†åŸŸç»ä¸è¦ä¸§å¤±å…¶è¶£å‘³æ„è¯†. æœ€é‡è¦çš„æ˜¯, æˆ‘å¸Œæœ›æˆ‘ä»¬ä¸è¦å˜æˆä¼ é“å£«, ä¸è¦è®¤ä¸ºä½ æ˜¯å…œå”®åœ£ç»çš„äºº, ä¸–ç•Œä¸Šè¿™ç§äººå·²ç»å¤ªå¤šäº†. ä½ æ‰€çŸ¥é“çš„æœ‰å…³è®¡ç®—çš„ä¸œè¥¿, å…¶ä»–äººä¹Ÿéƒ½èƒ½å­¦åˆ°. ç»ä¸è¦è®¤ä¸ºä¼¼ä¹æˆåŠŸè®¡ç®—çš„é’¥åŒ™å°±æŒæ¡åœ¨ä½ çš„æ‰‹é‡Œ. ä½ æ‰€æŒæ¡çš„, ä¹Ÿæ˜¯æˆ‘è®¤ä¸ºå¹¶å¸Œæœ›çš„, ä¹Ÿå°±æ˜¯æ™ºæ…§: é‚£ç§çœ‹åˆ°è¿™ä¸€æœºå™¨æ¯”ä½ ç¬¬ä¸€æ¬¡ç«™åœ¨å®ƒé¢å‰æ—¶èƒ½åšå¾—æ›´å¤šçš„èƒ½åŠ›, è¿™æ ·ä½ æ‰èƒ½å°†å®ƒå‘å‰æ¨è¿›. Alan J. Perlis</p></blockquote>]]></content>
      
      
        <tags>
            
            <tag> sicp </tag>
            
            <tag> scheme </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Go ä¸­çš„å†…å­˜æ³„æ¼</title>
      <link href="/post/memory-leaking.html"/>
      <url>/post/memory-leaking.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ª(<a href="https://go101.org/article/memory-leaking.html" target="_blank" rel="noopener">Memory Leaking</a>)ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰.</p><p>å½“ä½¿ç”¨å¸¦æœ‰åƒåœ¾å›æ”¶å™¨(GC)çš„è¯­è¨€ç¼–ç¨‹æ—¶, é€šå¸¸æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒå†…å­˜æ³„æ¼é—®é¢˜, å› ä¸ºè¯­è¨€è¿è¡Œæ—¶(runtime)ä¼šå®šæœŸæ”¶é›†æœªä½¿ç”¨çš„å†…å­˜. ä½†æ˜¯, æˆ‘ä»¬ç¡®å®éœ€è¦äº†è§£ä¸€äº›å¯èƒ½å¯¼è‡´è½»å¾®çš„æˆ–è€…çœŸæ­£çš„å†…å­˜æ³„æ¼çš„ç‰¹æ®Šåœºæ™¯. æœ¬æ–‡å‰©ä¸‹çš„éƒ¨åˆ†å°†åˆ—å‡ºå‡ ä¸ªè¿™æ ·çš„æƒ…å†µ.</p><h3 id="æ±‚å­å­—ç¬¦ä¸²-Substrings-å¯¼è‡´çš„è½»å¾®å†…å­˜æ³„éœ²"><a href="#æ±‚å­å­—ç¬¦ä¸²-Substrings-å¯¼è‡´çš„è½»å¾®å†…å­˜æ³„éœ²" class="headerlink" title="æ±‚å­å­—ç¬¦ä¸²(Substrings)å¯¼è‡´çš„è½»å¾®å†…å­˜æ³„éœ²"></a>æ±‚å­å­—ç¬¦ä¸²(Substrings)å¯¼è‡´çš„è½»å¾®å†…å­˜æ³„éœ²</h3><p>Go è§„èŒƒæ²¡æœ‰æŒ‡å®šåœ¨å­å­—ç¬¦ä¸²è¡¨è¾¾å¼ä¸­æ¶‰åŠçš„ç»“æœå­—ç¬¦ä¸²å’ŒåŸºæœ¬å­—ç¬¦ä¸²æ˜¯å¦åº”å…±äº«ç›¸åŒçš„åº•å±‚å†…å­˜å—ï¼Œè¯¥å†…å­˜å—æ‰˜ç®¡ä¸¤ä¸ªå­—ç¬¦ä¸²çš„åº•å±‚å­—èŠ‚åºåˆ—. Go æ ‡å‡†ç¼–è¯‘å™¨/è¿è¡Œæ—¶ç¡®å®ä¼šè®©å®ƒä»¬å…±äº«ç›¸åŒçš„åº•å±‚å†…å­˜å—. è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è®¾è®¡, è¿™æ—¢æ˜¯å†…å­˜ä¹Ÿæ˜¯ CPU æ¶ˆè€—çš„æ˜æ™ºä¹‹ä¸¾. ä½†å®ƒå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼.</p><p>ä¾‹å¦‚, è°ƒç”¨ä¸‹é¢çš„å‡½æ•° f å, å°†æœ‰ 1M å­—èŠ‚çš„å†…å­˜æ³„æ¼(è½»å¾®), ç›´åˆ°å…¶ä»–åœ°æ–¹ä¿®æ”¹äº†åŒ…çº§(package-level)å˜é‡ s0.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s0 <span class="keyword">string</span> <span class="comment">// package level variable</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(s1 <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// å‡è®¾ s1 æ˜¯ä¸€ä¸ªé•¿åº¦å¤§äº 50 çš„å­—ç¬¦ä¸².</span></span><br><span class="line">    s0 = s1[:<span class="number">50</span>]</span><br><span class="line">    <span class="comment">// ç°åœ¨, s0 å’Œ s1 å…±äº«ç›¸åŒçš„åº•å±‚å†…å­˜å—.</span></span><br><span class="line">    <span class="comment">// s1 ç°åœ¨ä¸å­˜æ´»äº†, ä½†æ˜¯ s0 ä¾ç„¶å­˜æ´».</span></span><br><span class="line">    <span class="comment">// å°½ç®¡ä»…æœ‰ 50 ä¸ªå­—èŠ‚åœ¨å†…å­˜å—ä¸­,</span></span><br><span class="line">    <span class="comment">// s0 ä»æ—§å­˜æ´»çš„äº‹å®é˜»æ­¢äº†è¿™ 1M å­—èŠ‚çš„å†…å­˜å—è¢«å›æ”¶.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†é¿å…è¿™ç§è½»å¾®çš„å†…å­˜æ³„æ¼, æˆ‘ä»¬å¯ä»¥å°†å­å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ª []byte å€¼, ç„¶åå°† []byte å€¼è½¬æ¢å› string.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(s1 <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">s0 = <span class="keyword">string</span>([]<span class="keyword">byte</span>(s1[:<span class="number">50</span>]))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°é¿å…è¿™ç§è½»å¾®å†…å­˜æ³„æ¼æ–¹æ³•çš„ç¼ºç‚¹æ˜¯åœ¨è½¬æ¢è¿‡ç¨‹ä¸­å‘ç”Ÿäº† 50 å­—èŠ‚çš„å¤åˆ¶, å…¶ä¸­ä¸€ä¸ªæ˜¯ä¸å¿…è¦çš„.</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Go æ ‡å‡†ç¼–è¯‘å™¨è¿›è¡Œçš„<a href="https://go101.org/article/string.html#conversion-optimizations" target="_blank" rel="noopener">ä¸€ç§ä¼˜åŒ–</a>æ¥é¿å…ä¸€æ¬¡å¤åˆ¶, å¹¶ä¸”ä¼´éšç€æµªè´¹ä¸€ä¸ªå­—èŠ‚çš„å°çš„é¢å¤–æˆæœ¬.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(s1 <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">s0 = (<span class="string">" "</span> + s1[:<span class="number">50</span>])[<span class="number">1</span>:]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ç¼–è¯‘å™¨ä¼˜åŒ–å¯èƒ½ä¼šåœ¨ä»¥åå¤±æ•ˆï¼Œå¹¶ä¸”ä¼˜åŒ–å¯èƒ½ä¸é€‚ç”¨äºå…¶ä»–ç¼–è¯‘å™¨.</p><p>é¿å…ç±»å‹å†…å­˜æ³„æ¼çš„ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯ä½¿ç”¨ç›´åˆ° Go 1.10 æ‰å¼€å§‹æ”¯æŒçš„ strings.Builder .</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"strings"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(s1 <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> b strings.Builder</span><br><span class="line">b.Grow(<span class="number">50</span>)</span><br><span class="line">b.WriteString(s1[:<span class="number">50</span>])</span><br><span class="line">s0 = b.String()</span><br><span class="line"><span class="comment">// b.Reset() // å¦‚æœ b åœ¨å…¶ä»–åœ°æ–¹ä¼šç”¨åˆ°, é‚£ä¹ˆå®ƒå¿…é¡»åœ¨è¿™é‡Œé‡ç½®æ‰.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯æœ‰ç‚¹å†—é•¿(é€šè¿‡æ¯”è¾ƒå‰ä¸¤ç§æ–¹å¼).</p><h3 id="æ±‚å­åˆ‡ç‰‡-Subslices-å¯¼è‡´çš„è½»å¾®å†…å­˜æ³„éœ²"><a href="#æ±‚å­åˆ‡ç‰‡-Subslices-å¯¼è‡´çš„è½»å¾®å†…å­˜æ³„éœ²" class="headerlink" title="æ±‚å­åˆ‡ç‰‡(Subslices)å¯¼è‡´çš„è½»å¾®å†…å­˜æ³„éœ²"></a>æ±‚å­åˆ‡ç‰‡(Subslices)å¯¼è‡´çš„è½»å¾®å†…å­˜æ³„éœ²</h3><p>ä¸æ±‚å­ä¸²ç±»ä¼¼, æ±‚å­åˆ‡ç‰‡ä¹Ÿå¯èƒ½å¯¼è‡´è½»å¾®çš„å†…å­˜æ³„æ¼. åœ¨ä¸‹é¢çš„ä»£ç ä¸­, è°ƒç”¨ g å‡½æ•°å, æ‰¿è½½ s1 å…ƒç´ çš„å†…å­˜å—å ç”¨çš„å¤§éƒ¨åˆ†å†…å­˜å°†ä¼šä¸¢å¤±(å¦‚æœæ²¡æœ‰æ›´å¤šå€¼å¼•ç”¨å†…å­˜å—).</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s0 []<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">g</span><span class="params">(s1 []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="comment">// å‡è®¾ s1 çš„é•¿åº¦è¿œè¿œå¤§äº 30.</span></span><br><span class="line">s0 = s1[<span class="built_in">len</span>(s1)<span class="number">-30</span>:]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æƒ³é¿å…è¿™ç§è½»å¾®çš„å†…å­˜æ³„æ¼, æˆ‘ä»¬å¿…é¡»å¤åˆ¶ s0 çš„ 30 ä¸ªå…ƒç´ , ä»¥ä¾¿ s0 çš„å­˜æ´»ä¸ä¼šé˜»æ­¢ s1 å…ƒç´ çš„å†…å­˜å—è¢«å›æ”¶.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">g</span><span class="params">(s1 []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">s0 = <span class="built_in">append</span>([]<span class="keyword">int</span>(<span class="literal">nil</span>), s1[<span class="built_in">len</span>(s1)<span class="number">-30</span>:]...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸å­˜æ´»åˆ‡ç‰‡å…ƒç´ æœªé‡ç½®æŒ‡é’ˆå¯¼è‡´çš„è½»å¾®å†…å­˜æ³„éœ²"><a href="#ä¸å­˜æ´»åˆ‡ç‰‡å…ƒç´ æœªé‡ç½®æŒ‡é’ˆå¯¼è‡´çš„è½»å¾®å†…å­˜æ³„éœ²" class="headerlink" title="ä¸å­˜æ´»åˆ‡ç‰‡å…ƒç´ æœªé‡ç½®æŒ‡é’ˆå¯¼è‡´çš„è½»å¾®å†…å­˜æ³„éœ²"></a>ä¸å­˜æ´»åˆ‡ç‰‡å…ƒç´ æœªé‡ç½®æŒ‡é’ˆå¯¼è‡´çš„è½»å¾®å†…å­˜æ³„éœ²</h3><p>åœ¨ä¸‹é¢çš„ä»£ç ä¸­, è°ƒç”¨ g å‡½æ•°ä¹‹å, åˆ†é…ç»™åˆ‡ç‰‡ s çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„å†…å­˜å—ä¼šä¸¢å¤±. å¦‚æœæœ€åä¸€ä¸ªå…ƒç´ ä»¥åä»æœªç”¨ä½œä»»ä½•åˆ‡ç‰‡çš„å…ƒç´ , åˆ™ä¸ºæœ€åä¸€ä¸ªå…ƒç´ åˆ†é…çš„å†…å­˜å—ä¹Ÿä¼šä¸¢å¤±.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">g</span><span class="params">()</span> []*<span class="title">int</span></span> &#123;</span><br><span class="line">s := []*<span class="keyword">int</span>&#123;<span class="built_in">new</span>(<span class="keyword">int</span>), <span class="built_in">new</span>(<span class="keyword">int</span>), <span class="built_in">new</span>(<span class="keyword">int</span>), <span class="built_in">new</span>(<span class="keyword">int</span>)&#125;</span><br><span class="line"><span class="keyword">return</span> s[<span class="number">1</span>:<span class="number">3</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿”å›çš„åˆ‡ç‰‡ä»ç„¶å­˜æ´», é‚£ä¹ˆå®ƒå°†é˜»æ­¢æ”¶é›† s çš„å…ƒç´ çš„åº•å±‚å†…å­˜å—, ä»è€Œé˜²æ­¢ä» s çš„ç¬¬ä¸€ä¸ªå…ƒç´ åˆ°æœ€åä¸€ä¸ªå…ƒç´ åˆ†é…çš„ä¸¤ä¸ªå†…å­˜å—è¢«æ”¶é›†, å°½ç®¡ä¸¤ä¸ªå…ƒç´ å·²ç»ä¸å­˜æ´»äº†.</p><p>å¦‚æœæˆ‘ä»¬æƒ³é¿å…è¿™ç§è½»å¾®å†…å­˜æ³„æ¼, æˆ‘ä»¬å¿…é¡»é‡ç½®ä¸å­˜æ´»å…ƒç´ ä¸­çš„æŒ‡é’ˆ(è¿™é‡Œ, åœ¨å‡½æ•° h è¢«è°ƒç”¨å, ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå…ƒç´ è¢«è§†ä¸ºä¸å­˜æ´»å…ƒç´ ).</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">h</span><span class="params">()</span> []*<span class="title">int</span></span> &#123;</span><br><span class="line">s := []*<span class="keyword">int</span>&#123;<span class="built_in">new</span>(<span class="keyword">int</span>), <span class="built_in">new</span>(<span class="keyword">int</span>), <span class="built_in">new</span>(<span class="keyword">int</span>), <span class="built_in">new</span>(<span class="keyword">int</span>)&#125;</span><br><span class="line">s1 := s[<span class="number">1</span>:<span class="number">3</span>]</span><br><span class="line">s[<span class="number">0</span>] = <span class="literal">nil</span>; s[<span class="built_in">len</span>(s)<span class="number">-1</span>] = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">return</span> s1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç»å¸¸éœ€è¦é‡ç½®<a href="https://go101.org/article/container.html#slice-manipulations" target="_blank" rel="noopener">åˆ‡ç‰‡å…ƒç´ åˆ é™¤æ“ä½œ</a>ä¸­ä¸å­˜æ´»å…ƒç´ çš„æŒ‡é’ˆ.</p><h3 id="è¿·å¤±çš„-Goroutines-å¯¼è‡´çš„å†…å­˜æ³„éœ²"><a href="#è¿·å¤±çš„-Goroutines-å¯¼è‡´çš„å†…å­˜æ³„éœ²" class="headerlink" title="è¿·å¤±çš„ Goroutines å¯¼è‡´çš„å†…å­˜æ³„éœ²"></a>è¿·å¤±çš„ Goroutines å¯¼è‡´çš„å†…å­˜æ³„éœ²</h3><p>æœ‰æ—¶, å¯¹äºä»£ç è®¾è®¡ä¸­çš„ä¸€äº›é€»è¾‘å¤±è¯¯, ä¸€ä¸ªæˆ–å¤šä¸ª goroutine ä¼šæ°¸è¿œå¤„äºé˜»å¡çŠ¶æ€, è¿™å°†å¯¼è‡´è¿™äº› goroutine ä¸­ä½¿ç”¨çš„è®¸å¤šä»£ç å—æ°¸è¿œæ— æ³•è¿›è¡Œåƒåœ¾æ”¶é›†. è¿™æ˜¯çœŸæ­£çš„å†…å­˜æ³„æ¼.</p><p>ä¾‹å¦‚, å¦‚æœå°†ä»¥ä¸‹å‡½æ•°ä½œä¸º goroutine çš„å¯åŠ¨å‡½æ•°å¹¶å°†ä¸€ä¸ª nil channel å‚æ•°ä¼ é€’ç»™å®ƒ, åˆ™ goroutine å°†æ°¸è¿œé˜»å¡. Go è¿è¡Œæ—¶è®¤ä¸º goroutine ä»ç„¶å­˜æ´», æ‰€ä»¥ä¸º s åˆ†é…çš„å†…å­˜å—å°†æ°¸è¿œä¸ä¼šè¢«æ”¶é›†.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">k</span><span class="params">(c &lt;-<span class="keyword">chan</span> <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">s := <span class="built_in">make</span>([]<span class="keyword">int64</span>, <span class="number">1e6</span>)</span><br><span class="line"><span class="keyword">if</span> &lt;-c &#123; <span class="comment">// å¦‚æœ c ä¸º nil, è¿™é‡Œå°†æ°¸è¿œé˜»å¡</span></span><br><span class="line">_ = s</span><br><span class="line"><span class="comment">// ä½¿ç”¨ s, ...</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åº”è¯¥é¿å…è¿™ç§é€»è¾‘å¤±è¯¯.</p><h3 id="ç»ˆç»“å™¨-Finalizers"><a href="#ç»ˆç»“å™¨-Finalizers" class="headerlink" title="ç»ˆç»“å™¨(Finalizers)"></a>ç»ˆç»“å™¨(Finalizers)</h3><p>ä¸ºå¾ªç¯å¼•ç”¨ç»„å†…çš„æˆå‘˜è®¾ç½® finalizer <a href="https://golang.org/pkg/runtime/#SetFinalizer" target="_blank" rel="noopener">å¯èƒ½ä¼šé˜»æ­¢ä¸ºè¿™ä¸ªå¾ªç¯å¼•ç”¨ç»„åˆ†é…çš„æ‰€æœ‰å†…å­˜å—è¢«æ”¶é›†</a>. è¿™ä¸æ˜¯è½»å¾®è€Œæ˜¯çœŸæ­£çš„å†…å­˜æ³„éœ².</p><p>åœ¨ä¸‹åˆ—å‡½æ•°è¢«è°ƒç”¨å¹¶é€€å‡ºä¹‹å, ä¸º x å’Œ y åˆ†é…çš„å†…å­˜å—ä¸ä¿è¯åœ¨æœªæ¥ä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">memoryLeaking</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">struct</span> &#123;</span><br><span class="line">v [<span class="number">1</span>&lt;&lt;<span class="number">20</span>]<span class="keyword">int</span></span><br><span class="line">t *T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> finalizer = <span class="function"><span class="keyword">func</span><span class="params">(t *T)</span></span> &#123;</span><br><span class="line"> fmt.Println(<span class="string">"finalizer called"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x, y T</span><br><span class="line"></span><br><span class="line"><span class="comment">// SetFinalizer ä¼šä½¿ x é€ƒé€¸åˆ°å †ä¸Š.</span></span><br><span class="line">runtime.SetFinalizer(&amp;x, finalizer)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥ä¸‹è¯­å¥å°†å¯¼è‡´ x å’Œ y å˜å¾—æ— æ³•æ”¶é›†.</span></span><br><span class="line">x.t, y.t = &amp;y, &amp;x <span class="comment">// y ä¹Ÿé€ƒé€¸åˆ°äº† å †ä¸Š.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥, è¯·é¿å…ä¸ºå¾ªç¯å¼•ç”¨ç»„ä¸­çš„å€¼è®¾ç½®ç»ˆç»“å™¨(finalizers).</p>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> go </tag>
            
            <tag> go101 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Go ä¸­çš„åŒæ­¥é˜Ÿåˆ—</title>
      <link href="/post/synchronization-queues-in-golang.html"/>
      <url>/post/synchronization-queues-in-golang.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ª <a href="https://medium.com/golangspec/synchronization-queues-in-golang-554f8e3a31a4" target="_blank" rel="noopener">Synchronization queues in Golang</a> ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰.<br><a id="more"></a></p><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨è¿ä½œä¸€å®¶é›‡ä½£ç¨‹åºå‘˜å’Œæµ‹è¯•äººå‘˜çš„ IT å…¬å¸. ä¸ºäº†è®©äººä»¬æœ‰æœºä¼šè®¤è¯†å¯¹æ–¹å¹¶æ”¾æ¾ä¸€ä¸‹, æˆ‘ä»¬ä¹°äº†ä¸€å¼ ä¹’ä¹“æ¡Œ, å¹¶åˆ¶å®šäº†ä»¥ä¸‹è§„åˆ™:</p><ul><li>æ­£å¥½ä¸¤ä¸ªäººå¯ä»¥åŒæ—¶ç©,</li><li>ä¸‹ä¸€å¯¹åªèƒ½åœ¨å‰ä¸€ä¸ªå®Œæˆæ—¶æ‰èƒ½å¼€å§‹ä»–ä»¬çš„æ¯”èµ›, æ‰€ä»¥ä¸å…è®¸åˆ‡æ¢ä¸€ä¸ªçƒå‘˜,</li><li>æµ‹è¯•äººå‘˜åªèƒ½ä¸ç¨‹åºå‘˜ä¸€èµ·å·¥ä½œ, åä¹‹äº¦ç„¶(ä¸èƒ½ä¸¤ä¸ªæµ‹è¯•äººå‘˜æˆ–ä¸¤ä¸ªç¨‹åºå‘˜ä¸€èµ·). å¦‚æœç¨‹åºå‘˜æˆ–æµ‹è¯•äººå‘˜æƒ³ç©æ¸¸æˆ, é‚£ä¹ˆéœ€è¦åˆ†åˆ«ç­‰å¾…æµ‹è¯•äººå‘˜æˆ–ç¨‹åºå‘˜å»ºç«‹æœ‰æ•ˆçš„é…å¯¹.</li></ul><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">go</span> programmer()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">go</span> tester()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">select</span> &#123;&#125; <span class="comment">// long day at work...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">programmer</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        code()</span><br><span class="line">        pingPong()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">tester</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        test()</span><br><span class="line">        pingPong()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†é€šè¿‡ time.Sleep æ¨¡æ‹Ÿæµ‹è¯•, ç¼–ç , ä»¥åŠæ‰“ä¹’ä¹“çƒ.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">    work()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">code</span><span class="params">()</span></span> &#123;</span><br><span class="line">    work()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">work</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// Sleep up to 10 seconds.</span></span><br><span class="line">    time.Sleep(time.Duration(rand.Intn(<span class="number">10000</span>)) * time.Millisecond)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pingPong</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// Sleep up to 2 seconds.</span></span><br><span class="line">    time.Sleep(time.Duration(rand.Intn(<span class="number">2000</span>)) * time.Millisecond)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">programmer</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        code()</span><br><span class="line">        fmt.Println(<span class="string">"Programmer starts"</span>)</span><br><span class="line">        pingPong()</span><br><span class="line">        fmt.Println(<span class="string">"Programmer ends"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">tester</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        test()</span><br><span class="line">        fmt.Println(<span class="string">"Tester starts"</span>)</span><br><span class="line">        pingPong()</span><br><span class="line">        fmt.Println(<span class="string">"Tester ends"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„ç¨‹åºå‘å‡ºå¦‚ä¸‹æ¶ˆæ¯æµ:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; go run pingpong.go</span><br><span class="line">Tester starts</span><br><span class="line">Programmer starts</span><br><span class="line">Programmer starts</span><br><span class="line">Tester ends</span><br><span class="line">Programmer ends</span><br><span class="line">Programmer starts</span><br><span class="line">Programmer ends</span><br><span class="line">Programmer ends</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æŒ‰ç…§è§„åˆ™æ‰“ä¹’ä¹“çƒ, æˆ‘ä»¬çš„ä¿¡æ¯æµå¯ä»¥åªåŒ…å«è¿™æ ·çš„ 4 è¡Œé•¿çš„åºåˆ—(ä»¥ä»»ä½•é¡ºåºå’Œé‡å¤çš„ä»»æ„æ¬¡æ•°):</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Tester starts</span><br><span class="line">Programmer starts</span><br><span class="line">Tester ends</span><br><span class="line">Programmer ends</span><br><span class="line">Tester starts</span><br><span class="line">Programmer starts</span><br><span class="line">Programmer ends</span><br><span class="line">Tester ends</span><br><span class="line">Programmer starts</span><br><span class="line">Tester starts</span><br><span class="line">Tester ends</span><br><span class="line">Programmer ends</span><br><span class="line">Programmer starts</span><br><span class="line">Tester starts</span><br><span class="line">Programmer ends</span><br><span class="line">Tester ends</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥, æ— è®ºæ˜¯æµ‹è¯•äººå‘˜è¿˜æ˜¯ç¨‹åºå‘˜éƒ½è¦æ¥è¿‘æ¡Œå­. ä¹‹ååˆä½œä¼™ä¼´åŠ å…¥(ç›¸åº”çš„ç¨‹åºå‘˜æˆ–æµ‹è¯•äººå‘˜). åœ¨ç¦»å¼€æ¸¸æˆæ—¶, ä»–ä»¬å¯ä»¥ä»¥ä»»ä½•é¡ºåºè¿›è¡Œ. è¿™å°±æ˜¯æˆ‘ä»¬æœ‰ 4 ä¸ªæœ‰æ•ˆåºåˆ—çš„åŸå› .</p><p>ä»¥ä¸‹æ˜¯ä¸¤ç§è§£å†³æ–¹æ¡ˆ. ä¸€ä¸ªæ˜¯åŸºäºäº’æ–¥é‡çš„, ç¬¬äºŒä¸ªæ˜¯ä½¿ç”¨ç‹¬ç«‹çš„ worker åè°ƒæ•´ä¸ªè¿‡ç¨‹, ç¡®ä¿æ‰€æœ‰äº‹æƒ…éƒ½æŒ‰ç…§æ”¿ç­–è¿›è¡Œ.</p><h3 id="æ–¹æ¡ˆ-1"><a href="#æ–¹æ¡ˆ-1" class="headerlink" title="æ–¹æ¡ˆ #1"></a>æ–¹æ¡ˆ #1</h3><p>ä¸¤ç§æ–¹æ¡ˆéƒ½ä½¿ç”¨åœ¨æ¥è¿‘æ¡Œå­ä¹‹å‰æ’é˜Ÿçš„æ•°æ®ç»“æ„. å½“è‡³å°‘æœ‰ä¸€ä¸ªæœ‰æ•ˆå¯¹(Dev + QA)æ—¶, å…è®¸è¯¥å¯¹ç©ä¹’ä¹“çƒ.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">tester</span><span class="params">(q *queue.Queue)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        test()</span><br><span class="line">        q.StartT()</span><br><span class="line">        fmt.Println(<span class="string">"Tester starts"</span>)</span><br><span class="line">        pingPong()</span><br><span class="line">        fmt.Println(<span class="string">"Tester ends"</span>)</span><br><span class="line">        q.EndT()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">programmer</span><span class="params">(q *queue.Queue)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        code()</span><br><span class="line">        q.StartP()</span><br><span class="line">        fmt.Println(<span class="string">"Programmer starts"</span>)</span><br><span class="line">        pingPong()</span><br><span class="line">        fmt.Println(<span class="string">"Programmer ends"</span>)</span><br><span class="line">        q.EndP()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    q := queue.New()</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">go</span> programmer(q)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">go</span> tester(q)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">select</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>queue åŒ…å®šä¹‰å¦‚ä¸‹:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> queue</span><br><span class="line"><span class="keyword">import</span> <span class="string">"sync"</span></span><br><span class="line"><span class="keyword">type</span> Queue <span class="keyword">struct</span> &#123;</span><br><span class="line">    mut                   sync.Mutex</span><br><span class="line">    numP, numT            <span class="keyword">int</span></span><br><span class="line">    queueP, queueT, doneP <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">()</span> *<span class="title">Queue</span></span> &#123;</span><br><span class="line">    q := Queue&#123;</span><br><span class="line">        queueP: <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>),</span><br><span class="line">        queueT: <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>),</span><br><span class="line">        doneP:  <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>),</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &amp;q</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span> <span class="title">StartT</span><span class="params">()</span></span> &#123;</span><br><span class="line">    q.mut.Lock()</span><br><span class="line">    <span class="keyword">if</span> q.numP &gt; <span class="number">0</span> &#123;</span><br><span class="line">        q.numP -= <span class="number">1</span></span><br><span class="line">        q.queueP &lt;- <span class="number">1</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        q.numT += <span class="number">1</span></span><br><span class="line">        q.mut.Unlock()</span><br><span class="line">        &lt;-q.queueT</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span> <span class="title">EndT</span><span class="params">()</span></span> &#123;</span><br><span class="line">    &lt;-q.doneP</span><br><span class="line">    q.mut.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span> <span class="title">StartP</span><span class="params">()</span></span> &#123;</span><br><span class="line">    q.mut.Lock()</span><br><span class="line">    <span class="keyword">if</span> q.numT &gt; <span class="number">0</span> &#123;</span><br><span class="line">        q.numT -= <span class="number">1</span></span><br><span class="line">        q.queueT &lt;- <span class="number">1</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        q.numP += <span class="number">1</span></span><br><span class="line">        q.mut.Unlock()</span><br><span class="line">        &lt;-q.queueP</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span> <span class="title">EndP</span><span class="params">()</span></span> &#123;</span><br><span class="line">    q.doneP &lt;- <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Queue åŒ…å«äº’æ–¥é‡ mut æœ‰ä¸¤ä¸ªç›®çš„:</p><ul><li>åŒæ­¥å¯¹å…±äº«è®¡æ•°å™¨(numT å’Œ numP)çš„è®¿é—®</li><li>æ‰®æ¼”æ¸¸æˆä¸­çš„é›‡å‘˜é˜»æ­¢å…¶ä»–äººåŠ å…¥ä¹’ä¹“æ¡Œçš„ä»¤ç‰Œ</li></ul><p>ç¨‹åºå‘˜å’Œæµ‹è¯•äººå‘˜æ­£åœ¨ä½¿ç”¨æ— ç¼“å†² channels æ¥ç­‰å¾…ä»–ä»¬çš„ä¹’ä¹“ä¼™ä¼´.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">&lt;-q.queueP</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">&lt;-q.queueT</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰ä¼™ä¼´å¯ç”¨, ä»è¿™äº› channels è¯»å–å°†ä¼šé˜»å¡ goroutine. </p><p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ç”±æµ‹è¯•äººå‘˜æ‰§è¡Œçš„ StartT :</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span> <span class="title">StartT</span><span class="params">()</span></span> &#123;</span><br><span class="line">    q.mut.Lock()</span><br><span class="line">    <span class="keyword">if</span> q.numP &gt; <span class="number">0</span> &#123;</span><br><span class="line">        q.numP -= <span class="number">1</span></span><br><span class="line">        q.queueP &lt;- <span class="number">1</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        q.numT += <span class="number">1</span></span><br><span class="line">        q.mut.Unlock()</span><br><span class="line">        &lt;-q.queueT</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ numP å¤§äº 0 (è‡³å°‘æœ‰ä¸€ä¸ªç¨‹åºå‘˜åœ¨ç­‰å¾…æ¸¸æˆ), é‚£ä¹ˆç­‰å¾…çš„ç¨‹åºå‘˜çš„æ•°é‡å‡å°‘ä¸€ä¸ª, ç­‰å¾…çš„ç¨‹åºå‘˜ä¸­çš„ä¸€ä¸ªå°†è¢«å…è®¸åŠ å…¥è¯¥ä¹’ä¹“æ¡Œ(q.queueP &lt;-1). æœ‰è¶£çš„æ˜¯, åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­, äº’æ–¥é‡ä¸ä¼šè¢«é‡Šæ”¾, æ‰€ä»¥å®ƒå°†ä½œä¸ºä¸€ä¸ªä»¤ç‰Œç‹¬å è®¿é—®ä¹’ä¹“çƒæ¡Œ.</p><p>å¦‚æœæ²¡æœ‰ç­‰å¾…çš„ç¨‹åºå‘˜, åˆ™ numT (ç­‰å¾…æµ‹è¯•è€…çš„æ•°é‡)å¢åŠ å¹¶ä¸” goroutine åœ¨ &lt;-q.queueT ä¸Šé˜»å¡.</p><p>StartP åŸºæœ¬ä¸Šæ˜¯ç›¸åŒçš„, ä½†ç”±ç¨‹åºå‘˜æ‰§è¡Œ.</p><p>åœ¨æ¸¸æˆè¿‡ç¨‹ä¸­, äº’æ–¥é‡å°†è¢«é”å®š, å› æ­¤éœ€è¦ç”±ç¨‹åºå‘˜æˆ–æµ‹è¯•äººå‘˜é‡Šæ”¾. åªæœ‰å½“åŒæ–¹å®Œæˆæ¸¸æˆæ—¶æ‰é‡Šæ”¾äº’æ–¥é‡, åˆ™ä¼šä½¿ç”¨å±éšœ doneP:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span> <span class="title">EndT</span><span class="params">()</span></span> &#123;</span><br><span class="line">    &lt;-q.doneP</span><br><span class="line">    q.mut.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span> <span class="title">EndP</span><span class="params">()</span></span> &#123;</span><br><span class="line">    q.doneP &lt;- <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœç¨‹åºå‘˜ä»åœ¨ç©å¹¶ä¸”æµ‹è¯•äººå‘˜å·²å®Œæˆ, é‚£ä¹ˆæµ‹è¯•äººå‘˜å°†é˜»å¡åœ¨ &lt;-q.doneP. ä¸€æ—¦ç¨‹åºå‘˜åˆ°è¾¾ q.doneP &lt;- 1, å±éšœå°†æ‰“å¼€, äº’æ–¥é‡å°†è¢«é‡Šæ”¾, ä»¥å…è®¸è¿™äº›å‘˜å·¥é‡æ–°å¼€å§‹å·¥ä½œ.</p><p>å¦‚æœæµ‹è¯•è€…ä»åœ¨æ¸¸æˆ, é‚£ä¹ˆç¨‹åºå‘˜å°†åœ¨ q.doneP &lt;- 1 ä¸Šé˜»å¡. å½“æµ‹è¯•è€…å®Œæˆæ—¶, å®ƒä»å±éšœ &lt;-q.doneP ä¸­è¯»å–, è¿™å°†è§£é™¤å¯¹ç¨‹åºå‘˜çš„é˜»å¡, å¹¶ä¸”å°†é‡Šæ”¾äº’æ–¥é‡ä»¥é‡Šæ”¾è¯¥ä¹’ä¹“æ¡Œ.</p><p>è¿™é‡Œæœ‰è¶£çš„æ˜¯, ä¸ç®¡æµ‹è¯•äººå‘˜è¿˜æ˜¯ç¨‹åºå‘˜éƒ½å¯èƒ½é”å®šäº’æ–¥é‡, æµ‹è¯•äººå‘˜æ€»æ˜¯ä¼šé‡Šæ”¾äº’æ–¥é‡. è¿™ä¹Ÿæ˜¯è¯¥è§£å†³æ–¹æ¡ˆåˆçœ‹èµ·æ¥å¯èƒ½ä¸é‚£ä¹ˆæ˜æ˜¾çš„åŸå› ä¹‹ä¸€.</p><h3 id="æ–¹æ¡ˆ-2"><a href="#æ–¹æ¡ˆ-2" class="headerlink" title="æ–¹æ¡ˆ #2"></a>æ–¹æ¡ˆ #2</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> queue</span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    msgPStart = <span class="literal">iota</span></span><br><span class="line">    msgTStart</span><br><span class="line">    msgPEnd</span><br><span class="line">    msgTEnd</span><br><span class="line">)</span><br><span class="line"><span class="keyword">type</span> Queue <span class="keyword">struct</span> &#123;</span><br><span class="line">    waitP, waitT   <span class="keyword">int</span></span><br><span class="line">    playP, playT   <span class="keyword">bool</span></span><br><span class="line">    queueP, queueT <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line">    msg            <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">()</span> *<span class="title">Queue</span></span> &#123;</span><br><span class="line">    q := Queue&#123;</span><br><span class="line">        msg:    <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>),</span><br><span class="line">        queueP: <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>),</span><br><span class="line">        queueT: <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>),</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> &#123;</span><br><span class="line">            <span class="keyword">select</span> &#123;</span><br><span class="line">            <span class="keyword">case</span> n := &lt;-q.msg:</span><br><span class="line">                <span class="keyword">switch</span> n &#123;</span><br><span class="line">                <span class="keyword">case</span> msgPStart:</span><br><span class="line">                    q.waitP++</span><br><span class="line">                <span class="keyword">case</span> msgPEnd:</span><br><span class="line">                    q.playP = <span class="literal">false</span></span><br><span class="line">                <span class="keyword">case</span> msgTStart:</span><br><span class="line">                    q.waitT++</span><br><span class="line">                <span class="keyword">case</span> msgTEnd:</span><br><span class="line">                    q.playT = <span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> q.waitP &gt; <span class="number">0</span> &amp;&amp; q.waitT &gt; <span class="number">0</span> &amp;&amp; !q.playP &amp;&amp; !q.playT &#123;</span><br><span class="line">                    q.playP = <span class="literal">true</span></span><br><span class="line">                    q.playT = <span class="literal">true</span></span><br><span class="line">                    q.waitT--</span><br><span class="line">                    q.waitP--</span><br><span class="line">                    q.queueP &lt;- <span class="number">1</span></span><br><span class="line">                    q.queueT &lt;- <span class="number">1</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">return</span> &amp;q</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span> <span class="title">StartT</span><span class="params">()</span></span> &#123;</span><br><span class="line">    q.msg &lt;- msgTStart</span><br><span class="line">    &lt;-q.queueT</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span> <span class="title">EndT</span><span class="params">()</span></span> &#123;</span><br><span class="line">    q.msg &lt;- msgTEnd</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span> <span class="title">StartP</span><span class="params">()</span></span> &#123;</span><br><span class="line">    q.msg &lt;- msgPStart</span><br><span class="line">    &lt;-q.queueP</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span> <span class="title">EndP</span><span class="params">()</span></span> &#123;</span><br><span class="line">    q.msg &lt;- msgPEnd</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸­å¤®åè°ƒå‘˜åœ¨ç‹¬ç«‹çš„ goroutine å†…éƒ¨è¿è¡Œ, å®ƒåè°ƒæ•´ä¸ªè¿‡ç¨‹. è°ƒåº¦å™¨è·å–æƒ³è¦æ”¾æ¾çš„æ–°å‘˜å·¥çš„ä¿¡æ¯, æˆ–è€…æ˜¯å¦æœ‰äººé€šè¿‡ msg channel æ‰“ä¹’ä¹“çƒ. æ¥æ”¶è°ƒåº¦å™¨çš„ä»»ä½•æ¶ˆæ¯çŠ¶æ€æ—¶éƒ½ä¼šæ›´æ–°:</p><ul><li>ç­‰å¾…çš„ Devs æˆ– QAs çš„æ•°é‡ä¼šå¢åŠ </li><li>å…³äºæ¸¸æˆå‘˜å·¥çš„ä¿¡æ¯ä¼šæ›´æ–°</li></ul><p>åœ¨æ¥æ”¶åˆ°ä»»ä½•å·²å®šä¹‰çš„æ¶ˆæ¯ä¹‹å, è°ƒåº¦å™¨å°†æ£€æŸ¥æ˜¯å¦å…è®¸å¦ä¸€å¯¹å¼€å§‹æ¸¸æˆ:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> q.waitP &gt; <span class="number">0</span> &amp;&amp; q.waitT &gt; <span class="number">0</span> &amp;&amp; !q.playP &amp;&amp; !q.playT &#123;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯è¿™æ ·, åˆ™ç›¸åº”åœ°æ›´æ–°çŠ¶æ€, å¹¶ä¸”ä¸€ä¸ªæµ‹è¯•äººå‘˜å’Œä¸€ä¸ªç¨‹åºå‘˜è¢«è§£é”.</p><p>æˆ‘ä»¬ç°åœ¨ä¸å†ä½¿ç”¨äº’æ–¥é‡(å¦‚è§£å†³æ–¹æ¡ˆ 1 ä¸­çš„æ–¹æ³•)æ¥ç®¡ç†å¯¹å…±äº«æ•°æ®çš„è®¿é—®, è€Œæ˜¯é€šè¿‡å•ç‹¬çš„ goroutine ä¸å¤–éƒ¨ä¸–ç•Œè¿›è¡Œé€šä¿¡. è¿™å°†ä½¿æˆ‘ä»¬ç¼–å†™æ›´å¤šçš„æƒ¯ç”¨çš„ Go ç¨‹åº.</p><blockquote><p>ä¸è¦é€šè¿‡å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡, é€šè¿‡é€šä¿¡å…±äº«å†…å­˜.</p></blockquote><h4 id="èµ„æº"><a href="#èµ„æº" class="headerlink" title="èµ„æº"></a>èµ„æº</h4><ul><li>Allen B. Downey â€œThe Little Book of Semaphoresâ€</li><li><a href="https://medium.com/golangspec/reusable-barriers-in-golang-156db1f75d0b" target="_blank" rel="noopener">Reusable barriers in Golang</a></li><li><a href="https://blog.golang.org/share-memory-by-communicating" target="_blank" rel="noopener">Share Memory By Communicating</a></li></ul>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ç†è§£ Go defer, panic, recover</title>
      <link href="/post/go-defer-panic-and-recover.html"/>
      <url>/post/go-defer-panic-and-recover.html</url>
      <content type="html"><![CDATA[<p>ä¸åƒ Go çš„å…¶ä»–æµç¨‹æ§åˆ¶(if, for, switch, goto, go) ä¸€æ ·, defer, panic å’Œ recover ç”¨çš„æ¯”è¾ƒå°‘.<br><a id="more"></a></p><h3 id="Defer"><a href="#Defer" class="headerlink" title="Defer"></a>Defer</h3><p>defer è¯­å¥ä¼šå°†å‡½æ•°è°ƒç”¨æ”¾å…¥ä¸€ä¸ªåˆ—è¡¨. å½“å¤–å›´çš„å‡½æ•°æ‰§è¡Œè¿”å›ååˆ—è¡¨å†…ä¿å­˜çš„å‡½æ•°è°ƒç”¨ä¼šè¢«æ‰§è¡Œ. defer åƒ Python çš„ with, finally ä¸€æ ·éƒ½å…·æœ‰ç±»ä¼¼èµ„æºæƒ…ç†çš„ä½œç”¨. å½“ç„¶ defer åœ¨è¿™æ–¹é¢æ›´çµæ´».</p><p>defer çš„è¡Œä¸ºéµå¾ª 3 ä¸ªç®€å•çš„åŸåˆ™:</p><ul><li><p>ä¸€ä¸ª defer å‡½æ•°çš„å‚æ•°åœ¨æ”¾å…¥å¾…è°ƒç”¨åˆ—è¡¨çš„æ—¶å€™è¢«ç«‹å³æ±‚å€¼. æ¯”å¦‚:</p>  <figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">a</span><span class="params">()</span></span> &#123;</span><br><span class="line">    i := <span class="number">0</span></span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(i) <span class="comment">// @1</span></span><br><span class="line">    i++</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  è¿™ä¸ªä¾‹å­ä¸­, @1 ä¸­çš„ i ä¼šè¢«ç«‹å³æ±‚å€¼, æ‰€ä»¥ a å‡½æ•°è°ƒç”¨è¿”å›æ—¶, ä¼šæ‰“å°å‡º â€œ0â€ è€Œä¸æ˜¯ â€œ1â€.</p></li><li><p>defer å‡½æ•°åœ¨å¤–å›´å‡½æ•°è¿”å›æ—¶éµå¾ª <strong>å…ˆè¿›åå‡º</strong> çš„è°ƒç”¨é¡ºåº.</p>  <figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">b</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">4</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">defer</span> fmt.Print(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  b å‡½æ•°å°†ä¼šæ‰“å°å‡º â€œ3210â€.</p></li><li><p>defer å‡½æ•°ä¼šè¯»å–å¹¶ä¸”èµ‹å€¼å¤–å›´å‡½æ•°çš„å‘½åè¿”å›å€¼(named return values).</p>  <figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">c</span><span class="params">()</span> <span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; i++ &#125;()</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  è¿™ä¸ªä¾‹å­ä¸­ i çš„å€¼ä¼š åœ¨ defer è¢«è°ƒç”¨æ—¶æ‰§è¡ŒåŠ  1 æ“ä½œ, æ‰€ä»¥ c å°†è¿”å› 2. è¿™å¯¹äºä¿®æ”¹ä¸€ä¸ªå‡½æ•°çš„ error è¿”å›å€¼å¾ˆæ–¹ä¾¿.</p></li></ul><h3 id="Panic"><a href="#Panic" class="headerlink" title="Panic"></a>Panic</h3><p>panic æ˜¯ä¸€ä¸ªå†…ç½®çš„å‡½æ•°ç”¨æ¥é˜»æ–­ä¸€èˆ¬çš„æ§åˆ¶æµç¨‹. Go spec å¯¹äº panic æœ‰ä¸€æ®µ<a href="https://golang.org/ref/spec#Handling_panics" target="_blank" rel="noopener">æè¿°</a>:</p><blockquote><p>å½“æ‰§è¡Œå‡½æ•° F æ—¶, ä¸€ä¸ªæ˜ç¡®çš„ panic è°ƒç”¨æˆ–è€…<a href="https://golang.org/ref/spec#Run_time_panics" target="_blank" rel="noopener">è¿è¡Œæ—¶ panic</a>(æ•°ç»„è¶Šç•Œè®¿é—®ç­‰)ä¼šç»ˆæ­¢ F çš„æ‰§è¡Œ. F æ‰€å±çš„ä»»ä½• defer å‡½æ•°ç»§ç»­æ‰§è¡Œ. ç´§æ¥ç€, ä»»ä½• F è°ƒç”¨è€…çš„ defer å‡½æ•°è¿è¡Œ, è€Œä¸”å¯¹äºæ‰§è¡Œä¸­çš„ goroutine ä¸­çš„ä»»ä½•é¡¶å±‚ defer å‡½æ•°ä¹Ÿæ˜¯å¦‚æ­¤. åˆ°é‚£æ—¶, ç¨‹åºç»ˆæ­¢å¹¶ä¸”æŠ¥é”™(é”™è¯¯åŒ…å«åœ¨ panic å‚æ•°ä¸­). è¯¥ç»ˆæ­¢åºåˆ—è¢«ç§°ä¸º <strong>panicking</strong>.</p></blockquote><h3 id="Recover"><a href="#Recover" class="headerlink" title="Recover"></a>Recover</h3><p>recover æ˜¯ä¸€ä¸ªå†…å»ºå‡½æ•°ç”¨æ¥æ¢å¤ä¸€ä¸ª panicking çš„ goroutine. Go spec å¯¹äº recover æœ‰ä¸€æ®µ<a href="https://golang.org/ref/spec#Handling_panics" target="_blank" rel="noopener">æè¿°</a>:</p><blockquote><p>è®¾æƒ³æœ‰ä¸€ä¸ªå‡½æ•° G, æœ‰ä¸€ä¸ª defer å‡½æ•°ä¼šè°ƒç”¨ recover å¹¶ä¸”å’Œ G åœ¨åŒä¸€ goroutine çš„å‡½æ•°å‘ç”Ÿäº† panic. å½“è¿è¡Œåˆ° defer å‡½æ•° D è°ƒç”¨çš„æ—¶å€™, D è°ƒç”¨ recover çš„è¿”å›å€¼æ˜¯ panic è°ƒç”¨æ—¶ä¼ å…¥çš„å€¼. å¦‚æœ D æ­£å¸¸è¿”å›, æ²¡æœ‰å¼€å¯ä¸€ä¸ªæ–°çš„ panic, panicking åºåˆ—ä¼šç»ˆæ­¢. åœ¨è¿™ç§æƒ…å†µä¸‹, G å’Œ panic ä¹‹é—´çš„å‡½æ•°è°ƒç”¨çŠ¶æ€è¢«åºŸå¼ƒ, å¹¶ä¸”æ­£å¸¸çš„è°ƒç”¨æ¢å¤. ç„¶å G ä¸­ä»»ä½•åœ¨ D ä¹‹å‰çš„ defer å‡½æ•°ä¼šæ‰§è¡Œ, å¹¶ä¸” G çš„æ‰§è¡Œé€šè¿‡è¿”å›åˆ°å®ƒçš„è°ƒç”¨è€…è€Œç»ˆæ­¢.</p></blockquote><p>ä»¥ä¸‹æƒ…å†µä¸­ recover çš„è¿”å›å€¼ä¸º nil:</p><ul><li>panic å‚æ•°ä¸º nil;</li><li>å½“å‰ goroutine æ²¡æœ‰å‘ç”Ÿ panicking;</li><li>recover æ²¡æœ‰è¢«ä¸€ä¸ª defer å‡½æ•°ç›´æ¥è°ƒç”¨.</li></ul><p>ä»¥ä¸‹ç¤ºä¾‹ç¨‹åºæ¼”ç¤ºäº† panic å’Œ defer çš„åŸç†:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    f()</span><br><span class="line">    fmt.Println(<span class="string">"Returned normally from f."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> r := <span class="built_in">recover</span>(); r != <span class="literal">nil</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">"Recovered in f"</span>, r)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    fmt.Println(<span class="string">"Calling g."</span>)</span><br><span class="line">    g(<span class="number">0</span>)</span><br><span class="line">    fmt.Println(<span class="string">"Returned normally from g."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">g</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> i &gt; <span class="number">3</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"Panicking!"</span>)</span><br><span class="line">        <span class="built_in">panic</span>(fmt.Sprintf(<span class="string">"%v"</span>, i))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="string">"Defer in g"</span>, i)</span><br><span class="line">    fmt.Println(<span class="string">"Printing in g"</span>, i)</span><br><span class="line">    g(i + <span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡½æ•°è¿”å›:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Calling g.</span><br><span class="line">Printing in g 0</span><br><span class="line">Printing in g 1</span><br><span class="line">Printing in g 2</span><br><span class="line">Printing in g 3</span><br><span class="line">Panicking!</span><br><span class="line">Defer in g 3</span><br><span class="line">Defer in g 2</span><br><span class="line">Defer in g 1</span><br><span class="line">Defer in g 0</span><br><span class="line">Recovered in f 4</span><br><span class="line">Returned normally from f.</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬ç§»é™¤ f ä¸­ defer å°†è¾“å‡º:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Calling g.</span><br><span class="line">Printing in g 0</span><br><span class="line">Printing in g 1</span><br><span class="line">Printing in g 2</span><br><span class="line">Printing in g 3</span><br><span class="line">Panicking!</span><br><span class="line">Defer in g 3</span><br><span class="line">Defer in g 2</span><br><span class="line">Defer in g 1</span><br><span class="line">Defer in g 0</span><br><span class="line">panic: 4</span><br><span class="line"></span><br><span class="line">panic PC=0x2a9cd8</span><br><span class="line">[stack trace omitted]</span><br></pre></td></tr></table></figure><p><em>Go æ ‡å‡†åº“ä¸­çš„çº¦å®šæ˜¯</em>, å³ä½¿ä¸€ä¸ªåŒ…åœ¨å†…éƒ¨ä½¿ç”¨ panic, å…¶å¤–éƒ¨ API ä»ä¼šç»™å‡ºæ˜ç¡®çš„é”™è¯¯è¿”å›å€¼(çœŸå®çš„ä¾‹å­å¯ä»¥å‚è§æ ‡å‡†åº“ <a href="http://golang.org/src/pkg/encoding/json/decode.go" target="_blank" rel="noopener">json åŒ…</a>). è¿™æ˜¯å¾ˆå¥½çš„ä½¿ç”¨åŸåˆ™, å°¤å…¶å½“æˆ‘ä»¬å†™è‡ªå·±åº“çš„æ—¶å€™, éš¾å…éœ€è¦å¤„ç†æ¥è‡ªç¬¬ä¸‰æ–¹çš„åŒ…è¿”å›çš„å„ç§ error, å¦‚æœä¸éœ€è¦å¤„ç†, ç®€å•çš„ä¸€ä¸ª panic ä¼šæ˜¯å¾ˆå¥½çš„æ–¹æ¡ˆ.</p><h3 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h3><p>åˆ°è¿™é‡Œå¯èƒ½å°±æ˜¯ä½ æ‰€èƒ½çœ‹åˆ°çš„å…³äº defer, panic å’Œ recover çš„æ‰€æœ‰â€å‘â€(æˆ‘ä¸€å‘ä¸è§‰å¾—æ–‡æ¡£ä¸­æœ‰çš„ä½ æ²¡çœ‹åˆ°çš„ä¸œè¥¿å«å‘). ä¸‹é¢çš„å†…å®¹å¯ä»¥ä¸çœ‹äº†, ä½†æ˜¯ä½ çœ‹äº†, ä¿è¯æ²¡åå¤„.</p><p>å½“ç„¶å¯èƒ½æœ‰äººè¯´ recover ä¸èƒ½æ¢å¤æ‰€æœ‰çš„ panic, æ¯”å¦‚å¦‚ä¸‹çš„ç¨‹åº:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> err := <span class="built_in">recover</span>(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"recovered"</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line">m := <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">wg.Add(<span class="number">1</span>)</span><br><span class="line">v := i</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> wg.Done()</span><br><span class="line">m[v] = v</span><br><span class="line">&#125;()</span><br><span class="line">&#125;</span><br><span class="line">wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿è¡Œè¯¥ç¨‹åº, é‚£ä¹ˆä¼šå¾—åˆ°å¦‚ä¸‹çš„è¾“å‡º:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fatal error: concurrent map writes</span><br><span class="line">fatal error: concurrent map writes</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><em>å…¶å®è¿™ä¸ªä¸å« panic</em>, æŒ‰å®˜æ–¹æ–‡æ¡£çš„è¯´æ³•å«: å´©æºƒ(crash) å’Œ å†…å­˜è…è´¥(memory corruption). ç”±äºç¨‹åºæ— è§† <a href="https://golang.org/ref/mem/" target="_blank" rel="noopener">Go å†…å­˜æ¨¡å‹</a> è€Œå¯¼è‡´çš„æ•°æ®ç«äº‰(data race).</p><p>å½“ç„¶å¯¹äºä»¥ä¸Šç¨‹åºæ¥è¯´, è¿è¡Œç¨‹åºå´©æºƒæ˜¯æ˜¾è€Œæ˜“è§çš„, ç„¶è€Œæœ‰çš„ç¨‹åºè¿è¡Œæ—¶ä¸ä¼šæ˜¾å¼çš„çš„å´©æºƒ, å¦‚:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>)</span><br><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">m[<span class="string">"1"</span>] = <span class="string">"a"</span></span><br><span class="line">c &lt;- <span class="literal">true</span></span><br><span class="line">&#125;()</span><br><span class="line">m[<span class="string">"2"</span>] = <span class="string">"b"</span></span><br><span class="line">&lt;-c</span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> m &#123;</span><br><span class="line">fmt.Println(k, v)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2 b</span><br><span class="line">1 a</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ£€æµ‹å’Œé¢„é˜²è¿™ç§å´©æºƒ, Go å†…å»ºäº†æ•°æ®ç«äº‰æ¢æµ‹å™¨(data race detector), å¯ä»¥é€šè¿‡ä¼ é€’ flag: -race ç»™ go å‘½ä»¤æ¥å¯ç”¨:</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ go <span class="built_in">test</span> -race mypkg</span><br><span class="line">$ go run -race mysrc.go</span><br><span class="line">$ go build -race mycmd</span><br><span class="line">$ go install -race mypkg</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†æ¬¡å¯¹ä¸Šé¢çš„ç¨‹åºä½¿ç”¨å‘½ä»¤: go run -race main.go, é‚£ä¹ˆæ•°æ®æ¢æµ‹å™¨å¯ä»¥æ£€æµ‹åˆ°:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">==================</span><br><span class="line">WARNING: DATA RACE</span><br><span class="line">Write at 0x00c420090180 by goroutine 6:</span><br><span class="line">  runtime.mapassign_faststr()</span><br><span class="line">      /usr/local/Cellar/go/1.10/libexec/src/runtime/hashmap_fast.go:694 +0x0</span><br><span class="line">  main.main.func1()</span><br><span class="line">      /Users/a/.go/src/github.com/gorocks/snippets/go/cmd/gosnippets/main.go:9 +0x5d</span><br><span class="line"></span><br><span class="line">Previous write at 0x00c420090180 by main goroutine:</span><br><span class="line">  runtime.mapassign_faststr()</span><br><span class="line">      /usr/local/Cellar/go/1.10/libexec/src/runtime/hashmap_fast.go:694 +0x0</span><br><span class="line">  main.main()</span><br><span class="line">      /Users/a/.go/src/github.com/gorocks/snippets/go/cmd/gosnippets/main.go:12 +0xc9</span><br><span class="line"></span><br><span class="line">Goroutine 6 (running) created at:</span><br><span class="line">  main.main()</span><br><span class="line">      /Users/a/.go/src/github.com/gorocks/snippets/go/cmd/gosnippets/main.go:8 +0x9a</span><br><span class="line">==================</span><br><span class="line">1 a</span><br><span class="line">2 b</span><br><span class="line">Found 1 data race(s)</span><br><span class="line">exit status 66</span><br></pre></td></tr></table></figure><h4 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4><ul><li><a href="https://blog.golang.org/defer-panic-and-recover" target="_blank" rel="noopener">Defer, Panic, and Recover</a></li><li><a href="https://golang.org/ref/spec" target="_blank" rel="noopener">Go spec</a></li><li><a href="https://golang.org/ref/mem/" target="_blank" rel="noopener">The Go Memory Model</a></li><li><a href="https://golang.org/doc/articles/race_detector.html" target="_blank" rel="noopener">Data Race Detector</a></li></ul>]]></content>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å®šä¹‰ Go æ¨¡å—</title>
      <link href="/post/vgo-module.html"/>
      <url>/post/vgo-module.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ª <a href="https://research.swtch.com/vgo-module" target="_blank" rel="noopener">Defining Go Modules</a>, <a href="https://lingchao.xin/tag/vgo.html">Go &amp; Versioning</a> çš„ç¬¬ 6 éƒ¨åˆ†, ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰.<br><a id="more"></a></p><p>æ­£å¦‚åœ¨<a href="https://lingchao.xin/post/vgo-intro.html">æ¦‚è¿°æ–‡ç« </a>ä¸­ä»‹ç»çš„, Go æ¨¡å—æ˜¯ä½œä¸ºä¸€ä¸ªç‰ˆæœ¬åŒ–çš„è½¯ä»¶åŒ…é›†åˆå•å…ƒ, è¿åŒåˆ—å‡ºå…¶ä»–æ‰€éœ€æ¨¡å—çš„ go.mod æ–‡ä»¶. è½¬å‘æ¨¡å—æ˜¯æˆ‘ä»¬é‡æ–°å®¡è§†å’Œä¿®æ­£ go å‘½ä»¤å¦‚ä½•ç®¡ç†æºä»£ç çš„è®¸å¤šç»†èŠ‚çš„æœºä¼š. åœ¨æˆ‘ä»¬æ‰“ç®—ä½¿ç”¨æ¨¡å—å¼ƒç”¨å½“å‰çš„ go get æ¨¡å‹æ—¶, 10 å¹´å·²ç»è¿‡å»äº†. æˆ‘ä»¬éœ€è¦ç¡®ä¿æ¨¡å—è®¾è®¡å°†åœ¨æœªæ¥åå¹´ä¸ºæˆ‘ä»¬æä¾›è‰¯å¥½çš„æœåŠ¡. å°¤å…¶æ˜¯:</p><ul><li>æˆ‘ä»¬å¸Œæœ›é¼“åŠ±æ›´å¤šçš„å¼€å‘äººå‘˜ä¸ºä»–ä»¬çš„è½¯ä»¶åŒ…æ‰“æ ‡ç­¾(tag), è€Œä¸æ˜¯æœŸæœ›ç”¨æˆ·åªä¼šé€‰æ‹©ä¸€ä¸ªå¯¹ä»–ä»¬æ¥è¯´çœ‹èµ·æ¥å¾ˆå¥½çš„æäº¤å“ˆå¸Œ. æ ‡è®°æ˜¾å¼å‘å¸ƒæ¸…æ¥šåœ°è¡¨æ˜äº†å¯¹åˆ«äººæœ‰ç”¨çš„ä»¥åŠæ­£åœ¨å¼€å‘çš„ä¸œè¥¿. åŒæ—¶, å®ƒä»ç„¶å¯ä»¥ - å°½ç®¡å¯èƒ½ä¸æ–¹ä¾¿ - è¯·æ±‚ç‰¹å®šçš„æäº¤.</li><li>æˆ‘ä»¬æƒ³è„±ç¦»ç‰ˆæœ¬æ§åˆ¶å·¥å…·å¦‚ bzr, fossil, git, hg, ä»¥åŠ svn æ¥ä¸‹è½½æºä»£ç . å› ä¸ºè¿™äº›ç ´åäº†ç”Ÿæ€ç³»ç»Ÿ: ä¾‹å¦‚, ä½¿ç”¨ Bazaar æˆ– Fossil å¼€å‘çš„è½¯ä»¶åŒ…å¯¹äºä¸èƒ½æˆ–ä¸é€‰æ‹©å®‰è£…è¿™äº›å·¥å…·çš„ç”¨æˆ·è€Œè¨€æ˜¯ä¸å¯ç”¨çš„. ç‰ˆæœ¬æ§åˆ¶å·¥å…·ä¹Ÿæ˜¯<a href="https://golang.org/issue/22131" target="_blank" rel="noopener">æ¿€åŠ¨äººå¿ƒçš„</a> <a href="https://www.mercurial-scm.org/wiki/WhatsNew/Archive#Mercurial_3.2.3_.282014-12-18.29" target="_blank" rel="noopener">å®‰å…¨</a> <a href="https://git-blame.blogspot.com/2014/12/git-1856-195-205-214-and-221-and.html" target="_blank" rel="noopener">é—®é¢˜</a>çš„æ¥æº. å°†å®ƒä»¬ç§»åˆ°å®‰å…¨è¾¹ç•Œä¹‹å¤–æ˜¯ä¸€ä»¶å¥½äº‹.</li><li>æˆ‘ä»¬å¸Œæœ›å…è®¸åœ¨å•ä¸ªæºä»£ç åº“ä¸­å¼€å‘å¤šä¸ªæ¨¡å—, ä½†ç‰ˆæœ¬ä¿æŒç‹¬ç«‹. å°½ç®¡å¤§å¤šæ•°å¼€å‘äººå‘˜å¯èƒ½ä¼šç»§ç»­ä½¿ç”¨æ¯ä¸ªä»£ç åº“ä½œä¸ºä¸€ä¸ªæ¨¡å—, ä½†å¤§å‹é¡¹ç›®å¯èƒ½ä¼šå› åœ¨ä¸€ä¸ªä»£ç åº“ä¸­æ‹¥æœ‰å¤šä¸ªæ¨¡å—è€Œå—ç›Š. ä¾‹å¦‚, æˆ‘ä»¬å¸Œæœ›å°† golang.org/x/text ä¿ç•™ä¸ºå•ä¸ªä»£ç åº“, ä½†èƒ½å¤Ÿå°†ä»æ—¢å®šè½¯ä»¶åŒ…åˆ†ç¦»å‡ºå»çš„å®éªŒæ€§æ–°è½¯ä»¶åŒ…åˆ†åˆ«ç‰ˆæœ¬åŒ–.</li><li>æˆ‘ä»¬å¸Œæœ›è®©ä¸ªäººå’Œå…¬å¸èƒ½å¤Ÿè½»æ¾åœ°å°†ç¼“å­˜ä»£ç†æ”¾åœ¨ go get ä¹‹å‰è¿›è¡Œä¸‹è½½, æ— è®ºæ˜¯å¦å¯ç”¨(ä½¿ç”¨æœ¬åœ°å‰¯æœ¬ä»¥ç¡®ä¿æ˜å¤©ä¸‹è½½ä¾ç„¶å·¥ä½œ)æˆ–æ˜¯å¦å®‰å…¨(åŒ…åœ¨å…¬å¸ä½¿ç”¨ä¹‹å‰è¿›è¡ŒéªŒè¯).</li><li>æˆ‘ä»¬å¸Œæœ›åœ¨å°†æ¥çš„æŸä¸ªæ—¶å€™, ä¸º Go ç¤¾åŒºå¼•å…¥ä¸€ä¸ªå…±äº«ä»£ç†, ç±»ä¼¼äº Rust, Node å’Œå…¶ä»–è¯­è¨€æ‰€ä½¿ç”¨çš„ä»£ç†. åŒæ—¶, è®¾è®¡å¿…é¡»åœ¨æ²¡æœ‰å‡è®¾ä»£ç†æˆ–æ³¨å†Œçš„æƒ…å†µä¸‹è¿è¡Œè‰¯å¥½.</li><li>æˆ‘ä»¬å¸Œæœ›æ¶ˆé™¤ vendor ç›®å½•. å®ƒä»¬æ˜¯ä¸ºäº†å¯é‡å¤æ€§å’Œå¯ç”¨æ€§è€Œæ¨å‡ºçš„, ä½†æˆ‘ä»¬ç°åœ¨æ‹¥æœ‰æ›´å¥½çš„æœºåˆ¶. å¯é‡ç°æ€§ç”±æ­£ç¡®çš„ç‰ˆæœ¬æ§åˆ¶å¤„ç†, å¯ç”¨æ€§ç”±ç¼“å­˜ä»£ç†å¤„ç†.</li></ul><p>è¿™ç¯‡æ–‡ç« ä»‹ç»äº†è§£å†³è¿™äº›é—®é¢˜çš„ vgo è®¾è®¡çš„éƒ¨åˆ†å†…å®¹. è¿™é‡Œçš„ä¸€åˆ‡éƒ½æ˜¯åˆæ­¥çš„: å¦‚æœæˆ‘ä»¬å‘ç°å®ƒä¸æ­£ç¡®, æˆ‘ä»¬ä¼šæ”¹å˜è®¾è®¡.</p><h3 id="ç‰ˆæœ¬åŒ–å‘å¸ƒ"><a href="#ç‰ˆæœ¬åŒ–å‘å¸ƒ" class="headerlink" title="ç‰ˆæœ¬åŒ–å‘å¸ƒ"></a>ç‰ˆæœ¬åŒ–å‘å¸ƒ</h3><p>æŠ½è±¡ç•Œé™è®©é¡¹ç›®è§„æ¨¡åŒ–. æœ€åˆ, æ‰€æœ‰çš„ Go è½¯ä»¶åŒ…éƒ½å¯ä»¥è¢«æ‰€æœ‰å…¶ä»–çš„ Go è½¯ä»¶åŒ…å¯¼å…¥. æˆ‘ä»¬åœ¨ Go 1.4 ä¸­å¼•å…¥äº†å†…éƒ¨(internal)ç›®å½•çº¦å®š, ä»¥æ¶ˆé™¤å¼€å‘äººå‘˜é€‰æ‹©æ„é€ ä¸€ä¸ªåŒ…å«å¤šä¸ªè½¯ä»¶åŒ…çš„ç¨‹åºçš„é—®é¢˜, å› ä¸ºéœ€è¦æ‹…å¿ƒå…¶ä»–ç”¨æˆ·å¯¼å…¥å†…éƒ¨è¾…åŠ©è½¯ä»¶åŒ…, è¿™äº›è¾…åŠ©è½¯ä»¶åŒ…å¹¶ä¸å…¬ç”¨.</p><p>Go ç¤¾åŒºç°åœ¨ä¸ä»£ç åº“æäº¤æœ‰ç±»ä¼¼çš„å¯è§æ€§é—®é¢˜. ä»Šå¤©, ç”¨æˆ·é€šè¿‡æäº¤æ ‡è¯†ç¬¦(é€šå¸¸æ˜¯ Git å“ˆå¸Œ) æ¥è¯†åˆ«åŒ…ç‰ˆæœ¬æ˜¯éå¸¸æ™®éçš„, å…¶ç»“æœæ˜¯, å°†å·¥ä½œç»„ç»‡ä¸ºä¸€ç³»åˆ—æäº¤çš„å¼€å‘äººå‘˜éœ€è¦æ‹…å¿ƒ, è‡³å°‘åœ¨ä»–ä»¬çš„æƒ³æ³•èƒŒå, ç”¨æˆ·å›ºå®šçš„è¿™äº›æäº¤å¯èƒ½å¹¶ä¸ä¸ºå…¬å¼€ä½¿ç”¨. (è¯‘æ³¨: ä½œè€…çš„æ„æ€æ˜¯è¯´å¯¹äº Git è¿™ç§æ¥è¯´æŸä¸€ä¸ª commit æœ‰å¯èƒ½åªæ˜¯å®éªŒæ€§è´¨çš„æäº¤, æœ¬è´¨ä¸Šè¯´ä¸æ˜¯ä¸ºäº†å…¬ç”¨.) æˆ‘ä»¬éœ€è¦æ”¹å˜ Go å¼€æºç¤¾åŒºçš„æœŸè®¸, ä»¥ç¡®ç«‹ä½œè€…æ ‡ç­¾å‘å¸ƒå’Œç”¨æˆ·æ‰€å–œæ¬¢çš„è§„èŒƒ.</p><p>æˆ‘ä¸è®¤åŒè¿™ä¸€ç‚¹: ç”¨æˆ·åº”è¯¥ä»ä½œè€…å‘å¸ƒçš„ç‰ˆæœ¬ä¸­è¿›è¡Œé€‰æ‹©, è€Œä¸æ˜¯ä» Git å†å²è®°å½•ä¸­æŒ‘é€‰å•ç‹¬çš„æäº¤, è¿™ä¸€ç‚¹å°¤å…¶æœ‰äº‰è®®. å›°éš¾çš„éƒ¨åˆ†æ­£åœ¨æ”¹å˜è§„èŒƒ. æˆ‘ä»¬éœ€è¦è®©ä½œè€…æ˜“äºæ ‡è®°æäº¤å¹¶æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨è¿™äº›æ ‡è®°.</p><p>ä½œè€…ä»Šå¤©å…±äº«ä»£ç çš„æœ€å¸¸ç”¨æ–¹å¼æ˜¯ä»£ç æ‰˜ç®¡ç½‘ç«™, å°¤å…¶æ˜¯ GitHub. å¯¹äº GitHub ä¸Šçš„ä»£ç , æ‰€æœ‰ä½œè€…éœ€è¦åšçš„æ˜¯æ ‡è®°æäº¤å¹¶æ¨é€æ ‡ç­¾. æˆ‘ä»¬è¿˜è®¡åˆ’æä¾›ä¸€ä¸ªå·¥å…·(å¯èƒ½ç§°ä¸º go release)æ¥æ¯”è¾ƒä¸åŒç‰ˆæœ¬çš„æ¨¡å—åœ¨ç±»å‹çº§åˆ«çš„ API å…¼å®¹æ€§,  ä»¥æ•è·ç±»å‹ç³»ç»Ÿä¸­å¯è§çš„æ„å¤–ç ´åæ€§æ›´æ”¹, ä»¥åŠå¸®åŠ©ä½œè€…åœ¨å‘å¸ƒçš„æ—¶å€™åšå‡ºå†³å®šæ˜¯æ¬¡è¦ç‰ˆæœ¬(å› ä¸ºå®ƒå¢åŠ äº†æ–°çš„ API æˆ–æ›´æ”¹äº†è®¸å¤šè¡Œä»£ç )è¿˜æ˜¯åªæ˜¯ä¸€ä¸ªè¡¥ä¸ç‰ˆæœ¬.</p><p>å¯¹äºç”¨æˆ·æ¥è¯´, vgo æœ¬èº«å®Œå…¨æ˜¯æ ¹æ®æ ‡ç­¾ç‰ˆæœ¬æ¥è¿ä½œçš„. ç„¶è€Œ, æˆ‘ä»¬çŸ¥é“, è‡³å°‘åœ¨ä»æ—§å®è·µå‘æ–°å®è·µè¿‡æ¸¡çš„è¿‡ç¨‹ä¸­, ä¹Ÿè®¸æ— é™æœŸåœ°ä½œä¸ºå¼•å¯¼æ–°é¡¹ç›®çš„ä¸€ç§æ–¹å¼, ä¸ºäº†å…è®¸æŒ‡å®šæäº¤, å¿…é¡»æœ‰ä¸€ä¸ªé€ƒç”Ÿèˆ±å£. (è¯‘æ³¨: åŸæ–‡ä½œè€…æˆè™çš„è¯´æ³•, å…¶å®å°±æ˜¯å˜é€šæ–¹æ¡ˆ.) è¿™åœ¨ vgo ä¸­æ˜¯å¯èƒ½çš„, ä½†å®ƒçš„è®¾è®¡æ˜¯ä¸ºäº†è®©ç”¨æˆ·æ›´å€¾å‘äºæ˜ç¡®æ ‡è®°çš„ç‰ˆæœ¬.</p><p>å…·ä½“æ¥è¯´, vgo ç†è§£ç‰¹æ®Šçš„ä¼ªç‰ˆæœ¬ v0.0.0-yyyymmddhhmmss-commit å¼•ç”¨ç»™å®šçš„æäº¤æ ‡è¯†ç¬¦, å®ƒé€šå¸¸æ˜¯ä¸€ä¸ªç¼©çŸ­çš„ Git å“ˆå¸Œ, å¹¶ä¸”å¿…é¡»å…·æœ‰ä¸(UTC)æ—¶é—´æˆ³åŒ¹é…çš„æäº¤æ—¶é—´. è¿™ç§å½¢å¼æ˜¯ v0.0.0 é¢„å‘å¸ƒçš„æœ‰æ•ˆè¯­ä¹‰ç‰ˆæœ¬å­—ç¬¦ä¸². ä¾‹å¦‚, èŠ‚é€‰è‡ª Gopkg.toml çš„ä¸€æ®µ:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[[projects]]</span><br><span class="line">  name = &quot;google.golang.org/appengine&quot;</span><br><span class="line">  packages = [</span><br><span class="line">    &quot;internal&quot;,</span><br><span class="line">    &quot;internal/base&quot;,</span><br><span class="line">    &quot;internal/datastore&quot;,</span><br><span class="line">    &quot;internal/log&quot;,</span><br><span class="line">    &quot;internal/remote_api&quot;,</span><br><span class="line">    &quot;internal/urlfetch&quot;,</span><br><span class="line">    &quot;urlfetch&quot;</span><br><span class="line">  ]</span><br><span class="line">  revision = &quot;150dc57a1b433e64154302bdc40b6bb8aefa313a&quot;</span><br><span class="line">  version = &quot;v1.0.0&quot;</span><br><span class="line"></span><br><span class="line">[[projects]]</span><br><span class="line">  branch = &quot;master&quot;</span><br><span class="line">  name = &quot;github.com/google/go-github&quot;</span><br><span class="line">  packages = [&quot;github&quot;]</span><br><span class="line">  revision = &quot;922ceac0585d40f97d283d921f872fc50480e06e&quot;</span><br></pre></td></tr></table></figure><p>å¯¹åº”äºè¿™äº› go.mod è¡Œ:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">require (</span><br><span class="line">&quot;google.golang.org/appengine&quot; v1.0.0</span><br><span class="line">&quot;github.com/google/go-github&quot; v0.0.0-20180116225909-922ceac0585d</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>é€‰æ‹©ä¼ªç‰ˆæœ¬å½¢å¼ä»¥ä¾¿æ ‡å‡†çš„ semver ä¼˜å…ˆçº§è§„åˆ™æŒ‰æäº¤æ—¶é—´æ¯”è¾ƒä¸¤ä¸ªä¼ªç‰ˆæœ¬, å› ä¸ºæ—¶é—´æˆ³ç¼–ç ä½¿å­—ç¬¦ä¸²æ¯”è¾ƒåŒ¹é…æ—¶é—´æ¯”è¾ƒ. è¿™ç§å½¢å¼è¿˜å¯ä»¥ç¡®ä¿ vgo å§‹ç»ˆä¼˜å…ˆä½¿ç”¨å¸¦æ ‡ç­¾çš„è¯­ä¹‰ç‰ˆæœ¬è€Œä¸ä½¿ç”¨æœªæ ‡è®°çš„ä¼ªç‰ˆæœ¬, å³ä½¿ v0.0.1 éå¸¸æ—§, å®ƒçš„ä¼˜å…ˆçº§æ¯”ä»»ä½• v0.0.0 é¢„å‘å¸ƒç‰ˆæœ¬éƒ½è¦é«˜. (è¿˜è¦æ³¨æ„, è¿™ä¸depå‘é¡¹ç›®æ·»åŠ æ–°ä¾èµ–é¡¹æ—¶æ‰€åšçš„é€‰æ‹©ç›¸åŒ¹é….) å½“ç„¶, ä¼ªç‰ˆæœ¬å­—ç¬¦ä¸²å¾ˆéš¾ä½¿ç”¨: å®ƒä»¬åœ¨ go.mod æ–‡ä»¶é‡Œ, ä¹Ÿå¯ä»¥ vgo list -m è¾“å‡º. æ‰€æœ‰è¿™äº›ä¸ä¾¿ä¹‹å¤„éƒ½æœ‰åŠ©äºé¼“åŠ±ä½œè€…å’Œç”¨æˆ·æ›´å–œæ¬¢æ˜ç¡®æ ‡è®°çš„ç‰ˆæœ¬, æœ‰ç‚¹åƒä¸å¾—ä¸å†™ import â€œunsafeâ€ è¿™ç§é¢å¤–çš„æ­¥éª¤ä¸€æ ·é¼“åŠ±å¼€å‘äººå‘˜å€¾å‘äºç¼–å†™å®‰å…¨çš„ä»£ç .</p><h3 id="go-mod-æ–‡ä»¶"><a href="#go-mod-æ–‡ä»¶" class="headerlink" title="go.mod æ–‡ä»¶"></a>go.mod æ–‡ä»¶</h3><p>æ¨¡å—ç‰ˆæœ¬ç”±æºæ–‡ä»¶æ ‘å®šä¹‰. go.mod æ–‡ä»¶æè¿°äº†è¯¥æ¨¡å—, å¹¶ä¸”è¿˜æŒ‡å‡ºäº†æ ¹ç›®å½•. å½“ vgo è¿è¡Œåœ¨ä¸€ä¸ªç›®å½•ä¸­æ—¶, å®ƒä¼šæŸ¥çœ‹å½“å‰ç›®å½•, ç„¶åæŸ¥æ‰¾è¿ç»­çˆ¶ç›®å½•, ä»¥æ‰¾åˆ°æ ‡è®°æ ¹ç›®å½•çš„ go.mod.</p><p>æ–‡ä»¶æ ¼å¼æ˜¯é¢å‘è¡Œçš„, åªé€šè¿‡ â€œ//â€œ æ³¨é‡Š. æ¯è¡Œä¿å­˜å•ä¸ªæŒ‡ä»¤, è¯¥æŒ‡ä»¤æ˜¯å•ä¸ªåŠ¨è¯(module, require, exclude, æˆ–è€… replace, ç”±<a href="https://research.swtch.com/vgo-mvs" target="_blank" rel="noopener">æœ€å°ç‰ˆæœ¬é€‰æ‹©</a>æ‰€å®šä¹‰), éšåæ˜¯å‚æ•°:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">module &quot;my/thing&quot;</span><br><span class="line">require &quot;other/thing&quot; v1.0.2</span><br><span class="line">require &quot;new/thing&quot; v2.3.4</span><br><span class="line">exclude &quot;old/thing&quot; v1.2.3</span><br><span class="line">replace &quot;bad/thing&quot; v1.4.5 =&gt; &quot;good/thing&quot; v1.4.5</span><br></pre></td></tr></table></figure><p>é¡¶å¤´çš„åŠ¨è¯å¯ä»¥ä»ä¸´è¿‘çš„è¡Œé‡Œåˆ†è§£å‡ºæ¥, è‡ªæˆä¸€ä¸ªå—, å°±åƒ Go å¯¼å…¥åŒ…ä¸€æ ·:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">require (</span><br><span class="line">&quot;new/thing&quot; v2.3.4</span><br><span class="line">&quot;old/thing&quot; v1.2.3</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>æˆ‘å¯¹æ–‡ä»¶æ ¼å¼çš„ç›®æ ‡æ˜¯ (1) æ¸…æ™°å’Œç®€å•, (2) æ˜“äºäººä»¬é˜…è¯», ç¼–è¾‘, æ“ä½œå’Œæ¯”è¾ƒ, (3) æ˜“äº vgo ç­‰ç¨‹åºè¯»å–, ä¿®æ”¹å’Œå›å†™, ä¿ç•™è¯„è®ºå’Œæ€»ä½“ç»“æ„, ä»¥åŠ (4) æœ‰é™çš„æœªæ¥å¢é•¿ç©ºé—´. æˆ‘çœ‹äº† JSON, TOML, XML å’Œ YAML, ä½†ä»–ä»¬æ²¡æœ‰ä¸€ä¸ªä¼¼ä¹åŒæ—¶æ‹¥æœ‰è¿™å››ä¸ªå±æ€§. ä¾‹å¦‚, Gopkg.toml ä¸Šé¢ä½¿ç”¨çš„æ–¹æ³•ä¸ºæ¯ä¸ªä¾èµ–ä¹¦å†™ä¸‰è¡Œ, è¿™ä½¿å¾—å®ƒä»¬æ›´éš¾ä»¥æµè§ˆ, æ’åºå’Œæ¯”è¾ƒ. ç›¸å, æˆ‘è®¾è®¡äº†ä¸€ä¸ªæœ€å°æ ¼å¼, è®©äººè”æƒ³åˆ° Goç¨‹åºçš„å¤´éƒ¨, ä½†å¸Œæœ›æ²¡æœ‰è¶³å¤Ÿæ¥è¿‘è®©äººå›°æƒ‘. æˆ‘æ”¹å†™äº†ä¸€ä¸ªå·²å­˜åœ¨çš„æ³¨é‡Šå‹å¥½çš„è§£æå™¨.</p><p>æœ€ç»ˆé›†æˆçš„ go å‘½ä»¤å¯èƒ½ä¼šæ›´æ”¹æ–‡ä»¶æ ¼å¼, ç”šè‡³é‡‡ç”¨æ›´æ ‡å‡†çš„æ¡†æ¶, ä½†å¯¹äºå…¼å®¹æ€§, æˆ‘ä»¬å°†ä¿æŒç»§ç»­é˜…è¯»ä»Šå¤© go.mod æ–‡ä»¶çš„èƒ½åŠ›, å°±å¦‚åŒ vgo è¿˜å¯ä»¥ä» GLOCKFILE, Godeps/Godeps.json, Gopkg.lock, dependencies.tsv, glide.lock, vendor.conf, vendor.yml, vendor/manifest, ä»¥åŠ vendor/vendor.json æ–‡ä»¶ä¸­è¯»å–ä¾èµ–ä¿¡æ¯ä¸€æ ·.</p><h3 id="ä»ä»£ç åº“åˆ°æ¨¡å—"><a href="#ä»ä»£ç åº“åˆ°æ¨¡å—" class="headerlink" title="ä»ä»£ç åº“åˆ°æ¨¡å—"></a>ä»ä»£ç åº“åˆ°æ¨¡å—</h3><p>å¼€å‘äººå‘˜åœ¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­å·¥ä½œ, æ˜¾ç„¶ vgo å¿…é¡»å°½å¯èƒ½ç®€å•. ä¾‹å¦‚, æœŸæœ›å¼€å‘äººå‘˜è‡ªå·±å‡†å¤‡æ¨¡å—å­˜æ¡£(archives)æ˜¯ä¸åˆç†çš„. ç›¸å, vgo å¯ä»¥æŒ‰ç…§ä¸€äº›åŸºæœ¬çš„, ä¸æ˜¾çœ¼çš„çº¦å®š, ä»ä»»ä½•ç‰ˆæœ¬æ§åˆ¶åº“ç›´æ¥å¯¼å‡ºæ¨¡å—.</p><p>é¦–å…ˆ, åˆ›å»ºä¸€ä¸ªä»£ç åº“å¹¶ç”¨ç±»ä¼¼äº v0.1.0 è¿™æ ·çš„ä¸€ä¸ª semver æ ¼å¼æ ‡è®°ä¸€ä¸ªæäº¤, å°±è¶³å¤Ÿäº†. é¡¶å¤´çš„ v æ˜¯å¿…éœ€çš„, å¹¶ä¸”è¿˜éœ€è¦ä¸‰ä¸ªæ•°å­—. è™½ç„¶ vgo å®ƒè‡ªå·±æ¥å—å‘½ä»¤è¡Œä¸­ v0.1 çš„ç®€å†™å½¢å¼, ä½†è§„èŒƒå½¢å¼ v0.1.0 å¿…é¡»åœ¨ä»£ç åº“æ ‡è®°ä¸­ä½¿ç”¨, ä»¥é¿å…æ­§ä¹‰. åªæœ‰æ ‡ç­¾æ˜¯å¿…éœ€çš„. ä¸ºäº†ä¸ä½¿ç”¨ vgo çš„æ—¶å€™ä¹Ÿå¯ä»¥ä½¿ç”¨æäº¤, åœ¨è¿™ä¸€ç‚¹ä¸Šä¸€ä¸ª go.mod æ–‡ä»¶è¦æ±‚å¹¶ä¸ä¸¥æ ¼. åˆ›å»ºæ–°çš„æ ‡è®°æäº¤å¯åˆ›å»ºæ–°çš„æ¨¡å—ç‰ˆæœ¬. ç®€å•.</p><p>å½“å¼€å‘äººå‘˜åˆ°è¾¾ v2 æ—¶, è¯­ä¹‰å¯¼å…¥ç‰ˆæœ¬æ§åˆ¶æ„å‘³ç€ /v2/ åœ¨æ¨¡å—æ ¹å‰ç¼€çš„æœ«å°¾æ·»åŠ äº†ä¸€ä¸ªå¯¼å…¥è·¯å¾„: my/thing/v2/sub/pkg. æ­£å¦‚<a href="https://research.swtch.com/vgo-import" target="_blank" rel="noopener">å‰é¢çš„æ–‡ç« </a>ä¸­æ‰€è¿°, è¿™ä¸ªçº¦æŸæœ‰å¾ˆå¥½çš„ç†ç”±, ä½†æ˜¯å®ƒä»ç„¶åç¦»ç°æœ‰çš„å·¥å…·. æ„è¯†åˆ°è¿™ä¸€ç‚¹, vgo å¦‚æœä¸å…ˆæ£€æŸ¥ go.mod æ–‡ä»¶ä¸­æœ‰ä¸»ç‰ˆæœ¬çš„æ¨¡å—è·¯å¾„å£°æ˜(ä¾‹å¦‚, module â€œmy/thing/v2â€) å°±ä¸ä¼šä½¿ç”¨æºç åº“ä¸­çš„ v2 æˆ–æ›´é«˜æ ‡è®°ç‰ˆæœ¬. Vgo ä½¿ç”¨è¯¥å£°æ˜ä½œä¸ºä½œè€…ä½¿ç”¨è¯­ä¹‰å¯¼å…¥ç‰ˆæœ¬æ§åˆ¶æ¥å‘½åè¯¥æ¨¡å—ä¸­çš„åŒ…çš„è¯æ®. è¿™å¯¹å¤šåŒ…æ¨¡å—æ¥è¯´å°¤å…¶é‡è¦, å› ä¸ºæ¨¡å—ä¸­çš„å¯¼å…¥è·¯å¾„å¿…é¡»åŒ…å« /v2/ å…ƒç´ ä»¥é¿å…å¼•ç”¨å› v1 æ¨¡å—.</p><p>æˆ‘ä»¬é¢„è®¡å¤§å¤šæ•°å¼€å‘äººå‘˜ä¼šæ›´å–œæ¬¢éµå¾ªé€šå¸¸çš„ â€œä¸»åˆ†æ”¯â€ çº¦å®š, å…¶ä¸­ä¸åŒçš„ä¸»ç‰ˆæœ¬å­˜åœ¨äºä¸åŒçš„åˆ†æ”¯ä¸­. åœ¨è¿™ç§æƒ…å†µä¸‹, v2 åˆ†æ”¯ä¸­çš„æ ¹ç›®å½•å°†æœ‰ä¸€ä¸ªè¡¨æ˜ v2 çš„ go.mod, å¦‚ä¸‹æ‰€ç¤º:</p><p><img src="/static/images/gitmod-1@2x.png" width="591px" height="416px"></p><p>è¿™å¤§è‡´æ˜¯å¤§å¤šæ•°å¼€å‘äººå‘˜å·²åœ¨å·¥ä½œçš„(æµç¨‹). åœ¨å›¾ä¸­, v1.0.0 æ ‡ç­¾æŒ‡å‘ä¸€ä¸ªæ—©äº vgo çš„æäº¤. å®ƒæ ¹æœ¬æ²¡æœ‰ go.mod æ–‡ä»¶, è€Œä¸”å·¥ä½œæ­£å¸¸. åœ¨æäº¤æ ‡è®° v1.0.1 ä¸­, ä½œè€…æ·»åŠ äº†ä¸€ä¸ª go.mod module â€œmy/thingâ€.<br>ç„¶è€Œ, åœ¨é‚£ä¸ªæäº¤ä¹‹å, ä½œè€…åˆ†å‰äº†ä¸€ä¸ªæ–°çš„ v2 å¼€å‘åˆ†æ”¯. é™¤äº†ä»»ä½•æ›´æ”¹ä»£ç æç¤º V2 (åŒ…æ‹¬æ›´æ¢ bar ç”¨ quux)æ—¶, go.mod åœ¨æ–°çš„åˆ†æ”¯æ›´æ–°ä¸º module â€œmy/thing/v2â€. åˆ†æ”¯å¯ä»¥ç‹¬ç«‹å‰è¿›. äº‹å®ä¸Š, vgo çœŸçš„ä¸çŸ¥é“åˆ†æ”¯(çš„å­˜åœ¨). å®ƒåªæ˜¯å°†æ ‡ç­¾è§£æä¸ºæäº¤, ç„¶ååœ¨æäº¤ä¸­æŸ¥çœ‹ go.mod æ–‡ä»¶. åŒæ ·, è¯¥ go.mod æ–‡ä»¶æ˜¯ v2 åŠæ›´é«˜ç‰ˆæœ¬æ‰€å¿…éœ€çš„, ä»¥ä¾¿ vgo å¯ä»¥ä½¿ç”¨è¯¥æ–‡ä»¶ä¸­çš„ module è¡Œä½œä¸ºä»£ç ä½¿ç”¨äº†è¯­ä¹‰å¯¼å…¥ç‰ˆæœ¬æ§åˆ¶çš„æ ‡å¿—, æ‰€ä»¥ foo å¯¼å…¥çš„æ˜¯ my/thing/v2/foo/quux, ä¸æ˜¯ my/thing/foo/quux.</p><p>ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆ, vgo è¿˜æ”¯æŒ â€œä¸»å­ç›®å½•â€ çº¦å®š, åœ¨å­ç›®å½•ä¸­å¼€å‘äº† V1 ä»¥ä¸Šçš„ä¸»è¦ç‰ˆæœ¬:</p><p><img src="/static/images/gitmod-2@2x.png" width="376px" height="768px"></p><p>åœ¨è¿™ç§æƒ…å†µä¸‹, v2.0.0 ä¸æ˜¯é€šè¿‡å°†æ•´ä¸ªæ ‘åˆ†å‰ä¸ºå•ç‹¬çš„åˆ†æ”¯è€Œæ˜¯é€šè¿‡å°†å…¶å¤åˆ¶åˆ°å­ç›®å½•ä¸­æ¥åˆ›å»ºçš„. å†æ¬¡ go.mod æ›´æ–°ä¸º â€œmy/thing/v2â€. ä¹‹å, v1.x.x æ ‡è®°æŒ‡å‘æ ¹ç›®å½•æ–‡ä»¶çš„æäº¤, ä¸åŒ…å« v2/, è€Œ v2.x.x æ ‡è®°ä»…æŒ‡å‘ v2/ å­ç›®å½•çš„æäº¤. go.mod æ–‡ä»¶å¯ä»¥ä½¿ vgo åŒºåˆ†è¿™ä¸¤ç§æƒ…å†µ. å°† v1.x.x å’Œ v2.x.x æ ‡è®°æŒ‡å‘ç›¸åŒçš„æäº¤ä¹Ÿæ˜¯æœ‰æ„ä¹‰çš„: å®ƒä»¬å°†å¤„ç†æäº¤çš„ä¸åŒå­æ ‘.</p><p>æˆ‘ä»¬æœŸæœ›å¼€å‘è€…å¯èƒ½ä¼šå¼ºçƒˆåœ°é€‰æ‹©ä¸€ç§æˆ–å¦ä¸€ç§çº¦å®š. vgo åŒæ—¶æ”¯æŒè¿™ä¸¤ç§. è¯·æ³¨æ„, å¯¹äº v2 ä»¥ä¸Šçš„ä¸»ç‰ˆæœ¬, ä¸»å­ç›®å½•æ–¹æ¡ˆå¯èƒ½ä¼šä¸º go get ç”¨æˆ·æä¾›ä¼˜é›…çš„è¿‡æ¸¡. å¦ä¸€æ–¹é¢, dep æˆ– vendoring å·¥å…·çš„ç”¨æˆ·åº”è¯¥èƒ½å¤Ÿä½¿ç”¨ä»»ä½•çº¦å®šä¹‹ä¸€æ¥ä½¿ç”¨ä»£ç åº“. å½“ç„¶, æˆ‘ä»¬ä¼šç¡®ä¿ dep å¯ä»¥.</p><h3 id="å¤šæ¨¡å—ä»£ç åº“"><a href="#å¤šæ¨¡å—ä»£ç åº“" class="headerlink" title="å¤šæ¨¡å—ä»£ç åº“"></a>å¤šæ¨¡å—ä»£ç åº“</h3><p>å¼€å‘äººå‘˜ä¹Ÿå¯èƒ½å‘ç°åœ¨å•ä¸ªæºä»£ç åº“ä¸­ç»´æŠ¤ä¸€ç»„æ¨¡å—æ˜¯å¾ˆæœ‰ç”¨çš„. æˆ‘ä»¬æƒ³è®© vgo æ”¯æŒè¿™ç§å¯èƒ½æ€§. æ€»çš„æ¥è¯´, ä¸åŒçš„å¼€å‘äººå‘˜, å›¢é˜Ÿ, é¡¹ç›®å’Œå…¬å¸åº”ç”¨æºä»£ç æ§åˆ¶çš„æ–¹å¼å·²ç»æœ‰å¾ˆå¤§å·®å¼‚, æˆ‘ä»¬è®¤ä¸ºå°† â€œå•ä¸€ä»£ç åº“ç­‰åŒäºä¸€ä¸ªæ¨¡å—â€ è¿™æ ·çš„å•ä¸€æ˜ å°„å¼ºåŠ ç»™æ‰€æœ‰å¼€å‘äººå‘˜å¹¶ä¸æ˜¯å¾ˆæœ‰æˆæ•ˆ. åœ¨è¿™æ–¹é¢æœ‰ä¸€å®šçš„çµæ´»æ€§ä¹Ÿåº”è¯¥æœ‰åŠ©äº vgo é€‚åº”å›´ç»•æºç æ§åˆ¶çš„æœ€ä½³å®è·µä¸æ–­å˜åŒ–.</p><p>åœ¨ä¸»å­ç›®å½•çº¦å®šä¸­, v2/ åŒ…å«æ¨¡å— â€œmy/thing/v2â€. ä¸€ä¸ªè‡ªç„¶çš„æ‰©å±•å…è®¸æ²¡æœ‰ä¸ºä¸»ç‰ˆæœ¬å‘½åçš„å­ç›®å½•. ä¾‹å¦‚, æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ª blue/ åŒ…å« â€œmy/thing/blueâ€ æ¨¡å—çš„å­ç›®å½•, å¹¶ç”±å…·æœ‰è¯¥æ¨¡å—è·¯å¾„ blue/go.mod çš„æ–‡ä»¶ç¡®è®¤. åœ¨è¿™ç§æƒ…å†µä¸‹, å¤„ç†è¯¥æ¨¡å—çš„æºä»£ç æ§åˆ¶æäº¤æ ‡ç­¾å°†é‡‡ç”¨è¿™ç§å½¢å¼ blue/v1.x.x. åŒæ ·, æ ‡ç­¾ blue/v2.x.x å°†å¤„ç† blue/v2/ å­ç›®å½•. blue/go.mod æ–‡ä»¶çš„å­˜åœ¨å°† blue/ æ ‘ä»å¤–éƒ¨ my/thing æ¨¡å—ä¸­æ’é™¤.</p><p>åœ¨ Go é¡¹ç›®ä¸­, æˆ‘ä»¬æ‰“ç®—æ¢ç´¢ä½¿ç”¨è¿™ä¸ªçº¦å®šæ¥å…è®¸åƒ golang.org/x/text è¿™æ ·çš„ä»£ç åº“å®šä¹‰å¤šä¸ªç‹¬ç«‹çš„æ¨¡å—. è¿™è®©æˆ‘ä»¬ä¿ç•™äº†ç²—ç²’åº¦æºç æ§åˆ¶çš„ä¾¿åˆ©, ä½†ä»ç„¶åœ¨ä¸åŒçš„æ—¶é—´å°†ä¸åŒçš„å­æ ‘æå‡åˆ° v1.</p><h3 id="å·²è¿‡æ—¶çš„ç‰ˆæœ¬"><a href="#å·²è¿‡æ—¶çš„ç‰ˆæœ¬" class="headerlink" title="å·²è¿‡æ—¶çš„ç‰ˆæœ¬"></a>å·²è¿‡æ—¶çš„ç‰ˆæœ¬</h3><p>ä½œè€…è¿˜éœ€è¦èƒ½å¤Ÿå¼ƒç”¨ä¸€ä¸ªç‰ˆæœ¬, ä»¥è¡¨æ˜å®ƒä¸åº”è¯¥å†è¢«ä½¿ç”¨. è¿™è¿˜æ²¡æœ‰åœ¨ vgo åŸå‹ä¸­å®ç°, ä½†å®ƒå¯ä»¥å·¥ä½œçš„ä¸€ç§æ–¹å¼æ˜¯åœ¨ä»£ç æ‰˜ç®¡ç«™ç‚¹ä¸Šå®šä¹‰ä¸€ä¸ªæ ‡è®° v1.0.0+deprecated (ç†æƒ³æƒ…å†µä¸‹æŒ‡å‘ä¸ v1.0.0 ç›¸åŒçš„æäº¤)å°†è¡¨æ˜è¯¥æäº¤å·²è¢«å¼ƒç”¨. å½“ç„¶é‡è¦çš„æ˜¯ä¸è¦å®Œå…¨åˆ é™¤æ ‡ç­¾, å› ä¸ºè¿™ä¼šç ´åæ„å»º. å¼ƒç”¨çš„æ¨¡å—ä¼šä»¥æŸç§æ–¹å¼åœ¨ vgo list -m -u è¾“å‡ºä¸­é«˜äº®æ˜¾ç¤º(â€œæ˜¾ç¤ºæˆ‘çš„æ¨¡å—å’Œæœ‰å…³æ›´æ–°çš„ä¿¡æ¯â€), ä»¥ä¾¿ç”¨æˆ·çŸ¥é“è¦æ›´æ–°.</p><p>å¦å¤–, å› ä¸ºç¨‹åºå¯ä»¥åœ¨è¿è¡Œæ—¶è®¿é—®è‡ªå·±çš„æ¨¡å—åˆ—è¡¨å’Œç‰ˆæœ¬, æ‰€ä»¥ç¨‹åºä¹Ÿå¯ä»¥é…ç½®ä¸ºæ ¹æ®æŸäº›é€‰å®šçš„æƒé™æ£€æŸ¥è‡ªå·±çš„æ¨¡å—ç‰ˆæœ¬, å¹¶åœ¨è¿è¡Œå¼ƒç”¨ç‰ˆæœ¬æ—¶ä»¥æŸç§æ–¹å¼è‡ªè¡ŒæŠ¥å‘Š. åŒæ ·, è¿™é‡Œçš„ç»†èŠ‚è¿˜æ²¡æœ‰è§£å†³, ä½†æ˜¯ä¸€æ—¦å¼€å‘äººå‘˜å’Œå·¥å…·å…±äº«æè¿°ç‰ˆæœ¬çš„è¯æ±‡è¡¨, è¿™å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­.</p><h3 id="å‘å¸ƒ"><a href="#å‘å¸ƒ" class="headerlink" title="å‘å¸ƒ"></a>å‘å¸ƒ</h3><p>ç»™å®šä¸€ä¸ªæºä»£ç æ§åˆ¶åº“, å¼€å‘äººå‘˜éœ€è¦èƒ½å¤Ÿä»¥ vgo å¯ä»¥ä½¿ç”¨çš„å½¢å¼å‘å¸ƒå®ƒ. åœ¨ä¸€èˆ¬æƒ…å†µä¸‹, æˆ‘ä»¬å°†æä¾›ä¸€ä¸ªå‘½ä»¤, ä½œè€…è¿è¡Œå®ƒä»¬å°†å…¶æºä»£ç æ§åˆ¶ä»£ç åº“è½¬æ¢ä¸ºé€šè¿‡ä»»ä½•é™æ€æ–‡ä»¶ web æœåŠ¡å™¨æä¾›ç»™ vgo ä½¿ç”¨çš„æ–‡ä»¶æ ‘. ä¸å½“å‰ go get ç±»ä¼¼, vgo éœ€è¦ä¸€ä¸ªå¸¦æœ‰ <meta> æ ‡ç­¾çš„é¡µé¢æ¥å¸®åŠ©å°†æ¨¡å—åç§°è½¬æ¢ä¸ºè¯¥æ¨¡å—çš„æ–‡ä»¶æ ‘. ä¾‹å¦‚, è¦æŸ¥æ‰¾ swtch.com/testmod, vgo å‘½ä»¤å°†è¿™æ ·è·å–é€šå¸¸çš„é¡µé¢:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ curl -sSL &apos;https://swtch.com/testmod?go-get=1&apos;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;meta name=&quot;go-import&quot; content=&quot;swtch.com/testmod mod https://storage.googleapis.com/gomodules/rsc&quot;&gt;</span><br><span class="line">Nothing to see here.</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>mod æœåŠ¡å™¨ç±»å‹è¡¨æ˜æ¨¡å—é€šè¿‡è¯¥åŸºæœ¬ URL ä¸Šçš„æ–‡ä»¶æ•°æä¾›. storage.googleapis.com/gomodules/rsc ä¸­è¿™ä¸ªç®€å•æ¡ˆä¾‹ä¸­çš„ç›¸å…³æ–‡ä»¶æ˜¯:</p><ul><li><a href="https://storage.googleapis.com/gomodules/rsc/swtch.com/testmod/@v/list" target="_blank" rel="noopener">.../swtch.com/testmod/@v/list</a></li><li><a href="https://storage.googleapis.com/gomodules/rsc/swtch.com/testmod/@v/v1.0.0.info" target="_blank" rel="noopener">.../swtch.com/testmod/@v/v1.0.0.info</a></li><li><a href="https://storage.googleapis.com/gomodules/rsc/swtch.com/testmod/@v/v1.0.0.mod" target="_blank" rel="noopener">.../swtch.com/testmod/@v/v1.0.0.mod</a></li><li><a href="https://storage.googleapis.com/gomodules/rsc/swtch.com/testmod/@v/v1.0.0.zip" target="_blank" rel="noopener">.../swtch.com/testmod/@v/v1.0.0.zip</a></li></ul><p>è¿™äº› URL çš„ç¡®åˆ‡å«ä¹‰åœ¨åé¢çš„ â€œä¸‹è½½åè®®â€ ä¸€èŠ‚ä¸­è®¨è®º.</p><h3 id="ä»£ç æ‰˜ç®¡ç½‘ç«™"><a href="#ä»£ç æ‰˜ç®¡ç½‘ç«™" class="headerlink" title="ä»£ç æ‰˜ç®¡ç½‘ç«™"></a>ä»£ç æ‰˜ç®¡ç½‘ç«™</h3><p>å¯¹äºä»£ç æ‰˜ç®¡ç½‘ç«™ä¸Šå·¨å¤§æ•°é‡çš„å¼€å‘, æˆ‘ä»¬å¸Œæœ› vgo å°½å¯èƒ½é¡ºåˆ©åœ°èå…¥è¿›æ¥. è€Œä¸å¸Œæœ›å¼€å‘äººå‘˜åœ¨å…¶ä»–åœ°æ–¹å‘å¸ƒæ¨¡å—, ç„¶åè®© vgo æ”¯æŒä½¿ç”¨åŸºäº HTTP çš„API ç›´æ¥ä»è¿™äº›ç«™ç‚¹è¯»å–æ‰€éœ€ä¿¡æ¯. ä¸€èˆ¬æ¥è¯´, æ¡£æ¡ˆä¸‹è½½å¯ä»¥æ¯”ç°æœ‰ç‰ˆæœ¬æ§åˆ¶ç­¾å‡ºå¿«å¾—å¤š. ä¾‹å¦‚, åœ¨ä½¿ç”¨åƒå…†äº’è”ç½‘è¿æ¥çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šå·¥ä½œæ—¶, éœ€è¦ 10 ç§’é’Ÿå°† <a href="https://github.com/cockroachdb/cockroach" target="_blank" rel="noopener">CockroachDB æºç æ ‘</a>ä½œä¸º GitHub çš„ zip æ–‡ä»¶ä¸‹è½½, ä½†éœ€è¦å¤§çº¦ 4 åˆ†é’Ÿçš„æ—¶é—´è¿›è¡Œ git clone. ç½‘ç«™åªéœ€æä¾›ä¸€ä¸ªå¯ä»¥é€šè¿‡ç®€å•çš„ HTTP GET è·å–çš„ä»»ä½•å½¢å¼çš„å­˜æ¡£. ä¾‹å¦‚, Gerrit æœåŠ¡å™¨ä»…æ”¯æŒä¸‹è½½ gzipped å½’æ¡£æ–‡ä»¶. Vgo å°†ä¸‹è½½çš„æ¡£æ¡ˆè½¬æ¢ä¸ºæ ‡å‡†å½¢å¼.</p><p>æœ€åˆçš„åŸå‹åªåŒ…æ‹¬å¯¹ GitHub å’Œ Go é¡¹ç›®çš„ Gerrit æœåŠ¡å™¨çš„æ”¯æŒ, ä½†æ˜¯åœ¨è¿›å…¥ Go ä¸»å·¥å…·é“¾ä¹‹å‰, æˆ‘ä»¬ä¹Ÿä¼šå¢åŠ å¯¹ Bitbucket å’Œå…¶ä»–ä¸»è¦æ‰˜ç®¡ç«™ç‚¹çš„æ”¯æŒ.</p><p>é€šè¿‡è½»é‡çº§ä»£ç åº“çº¦å®š(ä¸»è¦ä¸å¼€å‘äººå‘˜å·²ç»åœ¨åšçš„äº‹æƒ…ç›¸åŒ¹é…)ä»¥åŠå¯¹å·²çŸ¥ä»£ç æ‰˜ç®¡ç«™ç‚¹çš„æ”¯æŒç›¸ç»“åˆ, æˆ‘ä»¬é¢„è®¡å¤§å¤šæ•°å¼€æºæ´»åŠ¨éƒ½ä¸ä¼šå—åˆ°å‘æ¨¡å—è½¬ç§»çš„å½±å“ï¼Œè€Œåªæ˜¯ç®€å•åœ°åœ¨æ¯ä¸ªä»£ç åº“é‡Œé¢æ·»åŠ  go.mod.</p><p>ä½¿ç”¨æ—§ç‰ˆæœ¬ go get (ç›´æ¥ä½¿ç”¨ git å’Œå…¶ä»–æºç æ§åˆ¶å·¥å…·)çš„å…¬å¸éœ€è¦è¿›è¡Œè°ƒæ•´. ä¹Ÿè®¸ç¼–å†™ä¸€ä¸ªæ»¡è¶³ vgo æœŸæœ›ä½†ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶å·¥å…·çš„ä»£ç†æ˜¯æœ‰æ„ä¹‰çš„. ç„¶å, å…¬å¸å¯ä»¥è¿è¡Œå…¶ä¸­çš„ä¸€ç§äº§ç”Ÿç±»ä¼¼ä½¿ç”¨å¼€æºæ‰˜ç®¡ç«™ç‚¹çš„ä½“éªŒ.</p><h3 id="æ¨¡å—æ¡£æ¡ˆ"><a href="#æ¨¡å—æ¡£æ¡ˆ" class="headerlink" title="æ¨¡å—æ¡£æ¡ˆ"></a>æ¨¡å—æ¡£æ¡ˆ</h3><p>ä»ä»£ç åº“åˆ°æ¨¡å—çš„æ˜ å°„æœ‰ç‚¹å¤æ‚, å› ä¸ºå¼€å‘äººå‘˜ä½¿ç”¨æºä»£ç æ§åˆ¶çš„æ–¹å¼å„ä¸ç›¸åŒ. æœ€ç»ˆç›®æ ‡æ˜¯å°†æ‰€æœ‰å¤æ‚æ€§æ˜ å°„åˆ°ä»£ç†æˆ–å…¶ä»–ä»£ç ä½¿ç”¨è€…(ä¾‹å¦‚ godoc.org æˆ–ä»»ä½•ä»£ç æ£€æŸ¥å·¥å…·)ä½¿ç”¨çš„ Go æ¨¡å—çš„é€šç”¨å•ä¸€æ ¼å¼.</p><p>vgo åŸå‹ä¸­çš„æ ‡å‡†æ ¼å¼æ˜¯ zip æ¡£æ¡ˆ, å…¶ä¸­æ‰€æœ‰è·¯å¾„éƒ½ä»¥æ¨¡å—è·¯å¾„å’Œç‰ˆæœ¬å¼€å¤´. ä¾‹å¦‚, è¿è¡Œ rsc.io/quoteV1.5.2 çš„ vgo get å, ä½ å¯ä»¥åœ¨ vgo çš„ä¸‹è½½ç¼“å­˜é‡Œæ‰¾åˆ° zip æ–‡ä»¶:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ unzip -l $GOPATH/src/v/cache/rsc.io/quote/@v/v1.5.2.zip</span><br><span class="line">     1479  00-00-1980 00:00   rsc.io/quote@v1.5.2/LICENSE</span><br><span class="line">      131  00-00-1980 00:00   rsc.io/quote@v1.5.2/README.md</span><br><span class="line">      240  00-00-1980 00:00   rsc.io/quote@v1.5.2/buggy/buggy_test.go</span><br><span class="line">       55  00-00-1980 00:00   rsc.io/quote@v1.5.2/go.mod</span><br><span class="line">      793  00-00-1980 00:00   rsc.io/quote@v1.5.2/quote.go</span><br><span class="line">      917  00-00-1980 00:00   rsc.io/quote@v1.5.2/quote_test.go</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>æˆ‘ä½¿ç”¨äº† zip, å› ä¸ºå®ƒæ˜¯ç²¾å¿ƒæŒ‡å®šçš„, å¹¿æ³›æ”¯æŒçš„, å¹¶ä¸”å¦‚æœéœ€è¦å¯ä»¥å¹²å‡€åœ°æ‰©å±•, å¹¶å…è®¸éšæœºè®¿é—®å•ä¸ªæ–‡ä»¶. (ç›¸æ¯”ä¹‹ä¸‹, tar æ–‡ä»¶æ˜¯å¦ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„é€‰æ‹©, ä½†æ˜¯éƒ½ä¸æ»¡è¶³è¿™äº›ç‰¹ç‚¹.)</p><h3 id="ä¸‹è½½åè®®"><a href="#ä¸‹è½½åè®®" class="headerlink" title="ä¸‹è½½åè®®"></a>ä¸‹è½½åè®®</h3><p>è¦ä¸‹è½½æœ‰å…³æ¨¡å—çš„ä¿¡æ¯ä»¥åŠæ¨¡å—æœ¬èº«, vgo åŸå‹ä»…å‘å‡ºç®€å•çš„ HTTP GET è¯·æ±‚. ä¸€ä¸ªå…³é”®çš„è®¾è®¡ç›®æ ‡æ˜¯ä½¿å¾—å¯ä»¥ä»é™æ€æ‰˜ç®¡ç«™ç‚¹æä¾›æ¨¡å—, å› æ­¤è¯·æ±‚æ²¡æœ‰ URL æŸ¥è¯¢å‚æ•°.</p><p>æ­£å¦‚æˆ‘ä»¬å‰é¢çœ‹åˆ°çš„, è‡ªå®šä¹‰åŸŸå¯ä»¥æŒ‡å®šæ¨¡å—æ‰˜ç®¡åœ¨ç‰¹å®šçš„åŸºæœ¬ URL. åƒ vgo ä»Šå¤©å®ç°çš„é‚£æ ·(ä½†æ˜¯, vgo çš„æ‰€æœ‰è¿™äº›å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–), è¯¥æ¨¡å—æ‰˜ç®¡æœåŠ¡å™¨å¿…é¡»æä¾›å››ç§è¯·æ±‚æ ¼å¼:</p><ul><li><code>GET baseURL/module/@v/list</code> è·å–æ‰€æœ‰å·²çŸ¥ç‰ˆæœ¬çš„åˆ—è¡¨, æ¯è¡Œä¸€ä¸ª.</li><li><code>GET baseURL/module/@v/version.info</code> è·å–æœ‰å…³è¯¥ç‰ˆæœ¬çš„ JSON æ ¼å¼çš„å…ƒæ•°æ®.</li><li><code>GET baseURL/module/@v/version.mod</code> è·å–è¯¥ç‰ˆæœ¬çš„ go.mod æ–‡ä»¶.</li><li><code>GET baseURL/module/@v/version.zip</code> è·å–è¯¥ç‰ˆæœ¬çš„ zip æ–‡ä»¶.</li></ul><p>ä»¥ version.info å½¢å¼æä¾›çš„ JSON ä¿¡æ¯å¯èƒ½ä¼šæ¼”åŒ–, ä½†ç°åœ¨å®ƒå¯¹åº”äºæ­¤ç»“æ„:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type RevInfo struct &#123;</span><br><span class="line">Version string    // version string</span><br><span class="line">Name    string    // complete ID in underlying repository</span><br><span class="line">Short   string    // shortened ID, for use in pseudo-version</span><br><span class="line">Time    time.Time // commit time</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>vgo list -m -u å‘½ä»¤é€šè¿‡ä½¿ç”¨ Time å­—æ®µæ˜¾ç¤ºæ¯ä¸ªå¯ç”¨æ›´æ–°çš„æäº¤æ—¶é—´.</p><p>ä¸€ä¸ªé€šç”¨çš„æ¨¡å—æ‰˜ç®¡æœåŠ¡å™¨ä¹Ÿå¯ä»¥æœ‰é€‰æ‹©åœ°å“åº”é semver ç‰ˆæœ¬çš„ version.info è¯·æ±‚. åƒè¿™æ ·çš„ vgo å‘½ä»¤:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vgo get my/thing/v2@1459def</span><br></pre></td></tr></table></figure><p>å°†è·å– 1459def.info å¹¶ä½¿ç”¨ Time å’Œ Short å­—æ®µæ´¾ç”Ÿä¼ªç‰ˆæœ¬.</p><p>è¿˜æœ‰ä¸¤ç§å¯é€‰çš„è¯·æ±‚å½¢å¼:</p><ul><li><code>GET baseURL/module/@t/yyyymmddhhmmss</code> åœ¨ç»™å®šçš„æ—¶é—´æˆ³ä¹‹å‰è¿”å›æˆ–è¿”å›æœ€æ–°ç‰ˆæœ¬çš„ .info JSON.</li><li><code>GET baseURL/module/@t/yyyymmddhhmmss/branch</code> åŒä¸Š, ä½†å°†æœç´¢é™åˆ¶åœ¨ç»™å®šåˆ†æ”¯ä¸Šçš„æäº¤.</li></ul><p>è¿™äº›æ”¯æŒåœ¨ vgo ä½¿ç”¨æœªæ ‡è®°çš„æäº¤. å¦‚æœ vgo æ­£åœ¨æ·»åŠ ä¸€ä¸ªæ¨¡å—å´æ ¹æœ¬æ‰¾ä¸åˆ°æ ‡ç­¾æäº¤, å®ƒå°†ä½¿ç”¨ç¬¬ä¸€ç§å½¢å¼æ¥æŸ¥æ‰¾æˆªè‡³ç›®å‰çš„æœ€æ–°æäº¤. å®ƒåœ¨æŸ¥æ‰¾å¯ç”¨æ›´æ–°æ—¶ä¹Ÿæ˜¯å¦‚æ­¤, å‡å®šä»ç„¶æ²¡æœ‰æ ‡è®°æäº¤. åˆ†æ”¯é™åˆ¶å½¢å¼ç”¨äº gopkg.in çš„å†…éƒ¨æ¨¡æ‹Ÿ. è¿™äº›å½¢å¼ä¹Ÿæ”¯æŒå‘½ä»¤è¡Œè¯­æ³•:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vgo get my/thing/v2@2018-02-01T15:34:45</span><br><span class="line">vgo get my/thing/v2@2018-02-01T15:34:45@branch</span><br></pre></td></tr></table></figure><p>è¿™å¯èƒ½æ˜¯ä¸€ä¸ªå¤±è¯¯, ä½†ä»–ä»¬åœ¨ä»Šå¤©çš„åŸå‹, æ‰€ä»¥æˆ‘æåˆ°ä»–ä»¬.</p><h3 id="ä»£ç†æœåŠ¡å™¨"><a href="#ä»£ç†æœåŠ¡å™¨" class="headerlink" title="ä»£ç†æœåŠ¡å™¨"></a>ä»£ç†æœåŠ¡å™¨</h3><p>ä¸ªäººå’Œå…¬å¸éƒ½å¯èƒ½æ›´å–œæ¬¢ä»ä»£ç†æœåŠ¡å™¨ä¸‹è½½ Go æ¨¡å—, æ— è®ºæ˜¯ä¸ºäº†æ•ˆç‡, å¯ç”¨æ€§, å®‰å…¨æ€§, è®¸å¯è¯åˆè§„æ€§è¿˜æ˜¯ä»»ä½•å…¶ä»–åŸå› . å¦‚å‰ä¸¤èŠ‚æ‰€è¿°, ä½¿ç”¨æ ‡å‡†çš„ Go æ¨¡å—æ ¼å¼å’Œæ ‡å‡†çš„ä¸‹è½½åè®®ä½¿å¾—å¼•å…¥å¯¹ä»£ç†çš„æ”¯æŒå˜å¾—å¾®ä¸è¶³é“. å¦‚æœ $GOPROXY è®¾ç½®äº†ç¯å¢ƒå˜é‡, vgo åˆ™ä»ç»™å®šçš„åŸºç¡€ URL è·å–æœåŠ¡å™¨ä¸­çš„æ‰€æœ‰æ¨¡å—, è€Œä¸æ˜¯ä»å…¶é€šå¸¸çš„ä½ç½®è·å–. ä¸ºäº†ä¾¿äºè°ƒè¯•, $GOPROXY ç”šè‡³å¯ä»¥æ˜¯æŒ‡å‘æœ¬åœ°æ–‡ä»¶æ ‘çš„ file:/// URL.</p><p>æˆ‘ä»¬æ‰“ç®—ç¼–å†™ä¸€ä¸ªåŸºäº vgo æœ¬åœ°ç¼“å­˜çš„åŸºæœ¬ä»£ç†æœåŠ¡å™¨, æ ¹æ®éœ€è¦ä¸‹è½½æ–°æ¨¡å—. åœ¨ä¸€ç»„è®¡ç®—æœºä¸­å…±äº«è¿™æ ·çš„ä»£ç†å°†æœ‰åŠ©äºå‡å°‘æ¥è‡ªä»£ç†ç”¨æˆ·çš„å†—ä½™ä¸‹è½½, ä½†æ›´é‡è¦çš„æ˜¯ç¡®ä¿å°†æ¥çš„å¯ç”¨æ€§, å³ä½¿åŸå§‹å‰¯æœ¬æ¶ˆå¤±. ä»£ç†ä¹Ÿå¯ä»¥é€‰æ‹©ä¸å…è®¸ä¸‹è½½æ–°æ¨¡å—. åœ¨æ­¤æ¨¡å¼ä¸‹, ä»£ç†ä¼šå°†å¯ç”¨æ¨¡å—é™åˆ¶åˆ°ä»£ç†ç®¡ç†å‘˜åˆ—å…¥ç™½åå•çš„é‚£äº›æ¨¡å—. è¿™ä¸¤ç§ä»£ç†æ¨¡å¼éƒ½æ˜¯ä¼ä¸šç¯å¢ƒä¸­ç»å¸¸éœ€è¦çš„åŠŸèƒ½.</p><p>ä¹Ÿè®¸æœ‰ä¸€å¤©, å»ºç«‹ go get é»˜è®¤ä½¿ç”¨çš„åˆ†å¸ƒå¼ä»£ç†æœåŠ¡å™¨é›†åˆæ˜¯æœ‰æ„ä¹‰, ä»¥ç¡®ä¿å…¨çƒ Go å¼€å‘è€…çš„æ¨¡å—å¯ç”¨æ€§å’Œå¿«é€Ÿä¸‹è½½. ä½†è¿˜æ²¡å‡†å¤‡å¥½. ä»Šå¤©, æˆ‘ä»¬ä¸“æ³¨äºç¡®ä¿ go get æ— éœ€å‡è®¾ä»»ä½•ç±»å‹çš„é›†ä¸­å¼ä»£ç†æœåŠ¡å™¨å³å¯è¿è¡Œ.</p><h3 id="Vendoring-çš„ç»“æŸ"><a href="#Vendoring-çš„ç»“æŸ" class="headerlink" title="Vendoring çš„ç»“æŸ"></a>Vendoring çš„ç»“æŸ</h3><p>Vendor ç›®å½•æœ‰ä¸¤ä¸ªç›®çš„. é¦–å…ˆ, ä»–ä»¬é€šè¿‡å…¶å†…å®¹æŒ‡å®šåœ¨ go build è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¾èµ–å…³ç³»çš„ç¡®åˆ‡ç‰ˆæœ¬. å…¶æ¬¡, å³ä½¿åŸå§‹å‰¯æœ¬æ¶ˆå¤±, å®ƒä»¬ä¹Ÿå¯ç¡®ä¿è¿™äº›ä¾èµ–é¡¹çš„å¯ç”¨æ€§. å¦ä¸€æ–¹é¢ï¼Œvendor ç›®å½•ä¹Ÿå¾ˆéš¾ç®¡ç†å’Œè†¨èƒ€å®ƒä»¬å‡ºç°çš„ä»£ç åº“. é€šè¿‡ go.mod æ–‡ä»¶æŒ‡å®šè¦åœ¨ vgo build ä½¿ç”¨çš„ä¾èµ–å…³ç³»çš„ç¡®åˆ‡ç‰ˆæœ¬, ä»¥åŠä»£ç†æœåŠ¡å™¨ç¡®ä¿å¯ç”¨æ€§, vendor ç›®å½•ç°åœ¨å‡ ä¹å®Œå…¨æ˜¯å†—ä½™çš„. ä½†æ˜¯, å®ƒä»¬å¯ä»¥ä¸ºæœ€ç»ˆç›®çš„æœåŠ¡: å®ç°å‘æ–°ç‰ˆæœ¬ä¸–ç•Œçš„å¹³ç¨³è¿‡æ¸¡.</p><p>åœ¨æ„å»ºæ¨¡å—æ—¶ vgo (å’Œç¨å go) å°†å®Œå…¨å¿½ç•¥ vendored çš„ä¾èµ–; è¿™äº›ä¾èµ–ä¹Ÿä¸ä¼šåŒ…å«åœ¨æ¨¡å—çš„ zip æ–‡ä»¶ä¸­. ä¸ºäº†èƒ½å¤Ÿè®©ä½œè€…è¿ç§»åˆ° vgo ä¸ go.mod, åŒæ—¶ä»ç„¶æ”¯æŒæ²¡æœ‰å®Œæˆè½¬æ¢çš„ç”¨æˆ·, æ–°çš„ vgo vendor å‘½ä»¤é€šè¿‡å¡«å……æ¨¡å—çš„ vendor ç›®å½•ä¸­ç”¨æˆ·ä½¿ç”¨çš„åŒ…æ¥äº§ç”ŸåŸºäº vgo çš„æ„å»º.</p><h3 id="æ¥ä¸‹æ¥å‘¢"><a href="#æ¥ä¸‹æ¥å‘¢" class="headerlink" title="æ¥ä¸‹æ¥å‘¢ ?"></a>æ¥ä¸‹æ¥å‘¢ ?</h3><p>è¿™é‡Œçš„ç»†èŠ‚å¯èƒ½ä¼šè¢«ä¿®æ”¹, ä½†ä»Šå¤©çš„ go.mod æ–‡ä»¶å°†è¢«ä»»ä½•æœªæ¥çš„å·¥å…·æ‰€ç†è§£. è¯·å¼€å§‹ä½¿ç”¨å‘å¸ƒæ ‡ç­¾æ ‡è®°ä½ çš„è½¯ä»¶åŒ…; è¯·æ·»åŠ  go.mod æ–‡ä»¶ä½¿ä½ çš„é¡¹ç›®æœ‰æ„ä¹‰.</p><p>æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« å°†ä»‹ç»å¯¹ go å·¥å…·å‘½ä»¤è¡Œä½“éªŒçš„æ›´æ”¹.</p>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> go </tag>
            
            <tag> vgo </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å¯å¤åˆ¶, å¯éªŒè¯, å·²éªŒè¯çš„æ„å»º</title>
      <link href="/post/vgo-repro.html"/>
      <url>/post/vgo-repro.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ª <a href="https://research.swtch.com/vgo-repro" target="_blank" rel="noopener">Reproducible, Verifiable, Verified Builds</a>, <a href="https://lingchao.xin/tag/vgo.html">Go &amp; Versioning</a> çš„ç¬¬ 5 éƒ¨åˆ†, ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰.<br><a id="more"></a></p><p>ä¸€æ—¦ Go å¼€å‘äººå‘˜å’Œå·¥å…·éƒ½å…±äº«äº†åŒ…ç‰ˆæœ¬æ§åˆ¶çš„è¯æ±‡è¡¨, é‚£ä¹ˆåœ¨å·¥å…·é“¾ä¸­æ·»åŠ å¯å¤åˆ¶, å¯éªŒè¯ä»¥åŠå·²éªŒè¯çš„æ„å»ºå°±ç›¸å¯¹ç®€å•äº†. äº‹å®ä¸Š, è¿™åŸºæœ¬ä¸Šå·²ç»åœ¨ vgo åŸå‹ä¸­äº†.</p><p>ç”±äºäººä»¬æœ‰æ—¶å¯¹è¿™äº›æœ¯è¯­çš„ç¡®åˆ‡å®šä¹‰ä¸ä¸€è‡´ï¼Œè®©æˆ‘ä»¬æ¥å»ºç«‹ä¸€äº›åŸºæœ¬çš„æœ¯è¯­. é’ˆå¯¹è¿™ç¯‡æ–‡ç« :</p><ul><li>ä¸€ä¸ªå¯å¤åˆ¶çš„æ„å»º, å½“é‡å¤æ„å»ºæ—¶, ä¼šäº§ç”Ÿç›¸åŒçš„ç»“æœ.</li><li>ä¸€ä¸ªå¯éªŒè¯çš„æ„å»º, è®°å½•è¶³å¤Ÿçš„ä¿¡æ¯ä»¥ç²¾ç¡®åœ°æè¿°å¦‚ä½•é‡å¤å®ƒ.</li><li>ä¸€ä¸ªå·²éªŒè¯çš„æ„å»º, å¯ä»¥æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†é¢„æœŸçš„æºä»£ç .</li></ul><p>Vgo åœ¨é»˜è®¤æƒ…å†µä¸‹æä¾›å¯å¤åˆ¶çš„æ„å»º. ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¯éªŒè¯çš„, å› ä¸ºå®ƒä»¬è®°å½•äº†è¿›å…¥æ„å»ºçš„ç¡®åˆ‡æºä»£ç çš„ç‰ˆæœ¬. å¹¶ä¸”å¯ä»¥é…ç½®ä½ çš„ä»£ç åº“, ä»¥ä¾¿ç”¨æˆ·é‡æ–°æ„å»ºä½ çš„è½¯ä»¶, éªŒè¯ä»–ä»¬çš„æ„å»ºä¸ä½ çš„æ„å»ºåŒ¹é…, ä½¿ç”¨åŠ å¯†çš„å“ˆå¸Œ, æ— è®ºå®ƒä»¬å¦‚ä½•è·å¾—ä¾èµ–é¡¹.</p><h3 id="å¯å¤åˆ¶-é‡å¤-çš„æ„å»º"><a href="#å¯å¤åˆ¶-é‡å¤-çš„æ„å»º" class="headerlink" title="å¯å¤åˆ¶(é‡å¤)çš„æ„å»º"></a>å¯å¤åˆ¶(é‡å¤)çš„æ„å»º</h3><p>è‡³å°‘, æˆ‘ä»¬å¸Œæœ›ç¡®ä¿åœ¨ä½ æ„å»ºæˆ‘çš„ç¨‹åºæ—¶, æ„å»ºç³»ç»Ÿå†³å®šä½¿ç”¨ç›¸åŒçš„ä»£ç ç‰ˆæœ¬. æœ€å°ç‰ˆæœ¬é€‰æ‹©åœ¨é»˜è®¤æƒ…å†µä¸‹äº¤ä»˜è¯¥å±æ€§. ä»…ä½¿ç”¨ go.mod æ–‡ä»¶å°±è¶³ä»¥ç¡®å®šåº”è¯¥ä½¿ç”¨å“ªä¸ªæ¨¡å—ç‰ˆæœ¬(å‡è®¾ä¾èµ–å…³ç³»å¯ç”¨), è€Œä¸”å³ä½¿å°†æ¨¡å—çš„æ–°ç‰ˆæœ¬å¼•å…¥åˆ°ç”Ÿæ€ç³»ç»Ÿä¸­, è¿™ä¸ªå†³ç­–ä¹Ÿæ˜¯ç¨³å®šçš„. è¿™ä¸å¤§å¤šæ•°å…¶ä»–ç³»ç»Ÿä¸åŒ, åè€…è‡ªåŠ¨åœ°é‡‡ç”¨æ–°ç‰ˆæœ¬, å¹¶ä¸”éœ€è¦é™åˆ¶æ¥ç”Ÿæˆå¯å¤åˆ¶çš„æ„å»º. æˆ‘åœ¨ æœ€å°ç‰ˆæœ¬é€‰æ‹© æ–‡ç« ä¸­æåˆ°è¿‡è¿™ä¸ª, ä½†å®ƒæ˜¯ä¸€ä¸ªé‡è¦çš„, å¾®å¦™çš„ç»†èŠ‚, æ‰€ä»¥æˆ‘å°†å°è¯•åœ¨è¿™é‡Œç®€çŸ­åœ°é‡å¤ä¸€ä¸‹.</p><p>ä¸ºäº†ä½¿è¿™ä¸ªå…·ä½“åŒ–, è®©æˆ‘ä»¬çœ‹çœ‹æ¥è‡ª Rustçš„åŒ…ç®¡ç†å™¨ Cargo çš„å‡ ä¸ªçœŸæ­£çš„åŒ…. å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä¸æ˜¯åœ¨æŒ‘å‰” Cargo, æˆ‘è®¤ä¸º Cargo æ˜¯åŒ…ç®¡ç†å½“å‰è‰ºæœ¯æ°´å¹³çš„ä¸€ä¸ªä¾‹å­, å¹¶ä¸”æœ‰å¾ˆå¤šå¯ä»¥ä»ä¸­å­¦ä¹ . å¦‚æœæˆ‘ä»¬èƒ½è®© Go çš„åŒ…ç®¡ç†åƒ Cargo ä¸€æ ·å¹³ç¨³, é‚£ä¹ˆæˆ‘å¾ˆå¼€å¿ƒ. ä½†æˆ‘ä¹Ÿè®¤ä¸º, åœ¨é€‰æ‹©ç‰ˆæœ¬æ—¶, æˆ‘ä»¬æ˜¯å¦ä¼šä»é€‰æ‹©ä¸åŒçš„é»˜è®¤å€¼ä¸­å—ç›Š, è¿™æ˜¯å€¼å¾—æ¢è®¨çš„.</p><p>Cargo æ›´å–œæ¬¢ä»¥ä¸‹æ„ä¹‰ä¸Šçš„æœ€å¤§ç‰ˆæœ¬. å½“æˆ‘å†™è¿™ç¯‡æ–‡ç« æ—¶, crates.io ä¸Šæœ€æ–°çš„ <a href="https://crates.io/crates/toml" target="_blank" rel="noopener">toml</a> ç‰ˆæœ¬æ˜¯ 0.4.5. å®ƒåˆ—å‡ºäº†å¯¹ serde 1.0 æˆ–æ›´é«˜ç‰ˆæœ¬çš„ä¾èµ–; æœ€æ–°çš„ serde æ˜¯ 1.0.27. å¦‚æœä½ å¯åŠ¨ä¸€ä¸ªæ–°é¡¹ç›®å¹¶æ·»åŠ å¯¹ toml 0.4.1 æˆ–æ›´é«˜ç‰ˆæœ¬çš„ä¾èµ–, Cargo å¯ä»¥ä½œå‡ºé€‰æ‹©. æ ¹æ®çº¦æŸ, 0.4.1, 0.4.2, 0.4.3, 0.4.4 æˆ– 0.4.5 ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½æ˜¯å¯æ¥å—çš„. åœ¨æ‰€æœ‰å…¶ä»–æ¡ä»¶ç›¸åŒçš„æƒ…å†µä¸‹, Cargo å€¾å‘äºä½¿ç”¨<a href="https://research.swtch.com/cargo-newest.html" target="_blank" rel="noopener">æœ€æ–°çš„å¯æ¥å—ç‰ˆæœ¬</a> 0.4.5. åŒæ ·, ä» 1.0.0 åˆ° 1.0.27 çš„ä»»ä½•ä¸€ä¸ª serde éƒ½æ˜¯å¯ä»¥æ¥å—çš„, Cargo é€‰æ‹© 1.0.27. è¿™äº›é€‰æ‹©éšç€æ–°ç‰ˆæœ¬çš„æ¨å‡ºè€Œæ”¹å˜. å¦‚æœä»Šæ™šå‘å¸ƒäº† serde 1.0.28, å¹¶ä¸”æ˜å¤©æˆ‘å°† toml 0.4.5 æ·»åŠ åˆ°äº†é¡¹ç›®ä¸­, é‚£ä¹ˆæˆ‘å°†å¾—åˆ° 1.0.28 è€Œä¸æ˜¯ 1.0.27. æ­£å¦‚è¿„ä»Šä¸ºæ­¢æ‰€æè¿°çš„, Cargo çš„æ„å»ºæ˜¯ä¸å¯å¤åˆ¶çš„. Cargo å¯¹è¿™ä¸ªé—®é¢˜çš„(å®Œå…¨åˆç†çš„)ç­”æ¡ˆæ˜¯ä¸ä»…æœ‰ä¸€ä¸ªçº¦æŸæ–‡ä»¶ (manifest, Cargo.toml), è€Œä¸”è¿˜æœ‰ä¸€ä¸ªåœ¨æ„å»ºä¸­ä½¿ç”¨çš„ç¡®åˆ‡ç»„ä»¶(artifacts)çš„åˆ—è¡¨(lock æ–‡ä»¶ Cargo.lock). lock æ–‡ä»¶é˜»æ­¢å°†æ¥çš„å‡çº§; ä¸€æ—¦å†™å…¥, å³ä½¿ 1.0.28 å‘å¸ƒ, ä½ çš„æ„å»ºä»ç„¶ä¿ç•™åœ¨ serde 1.0.27 ä¸Š.</p><p>ç›¸æ¯”ä¹‹ä¸‹, æœ€å°ç‰ˆæœ¬é€‰æ‹©åå¥½å…è®¸çš„æœ€å°ç‰ˆæœ¬, è¿™æ˜¯é¡¹ç›®ä¸­æŸäº› go.mod æ‰€è¦æ±‚çš„ç¡®åˆ‡ç‰ˆæœ¬. è¿™ä¸ªç­”æ¡ˆä¸ä¼šéšç€æ–°ç‰ˆæœ¬çš„æ·»åŠ è€Œæ”¹å˜. å¯¹æ¯” Cargo ç¤ºä¾‹ä¸­ç»™å‡ºçš„é€‰æ‹©, vgo ä¼šé€‰æ‹© toml 0.4.1 (ä½ è¦æ±‚çš„), ç„¶åé€‰æ‹© serde 1.0 (toml è¦æ±‚çš„). è¿™äº›é€‰æ‹©æ˜¯ç¨³å®šçš„, æ²¡æœ‰ lock æ–‡ä»¶. è¿™å°±æ˜¯æˆ‘è¯´ vgo çš„æ„å»ºé»˜è®¤å¯å¤åˆ¶çš„æ„æ€.</p><h3 id="å¯éªŒè¯çš„æ„å»º"><a href="#å¯éªŒè¯çš„æ„å»º" class="headerlink" title="å¯éªŒè¯çš„æ„å»º"></a>å¯éªŒè¯çš„æ„å»º</h3><p>Go çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸€ç›´åŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸², è¡¨ç¤ºå®ƒä»¬çš„ Go ç‰ˆæœ¬. å»å¹´, æˆ‘ç¼–å†™äº†ä¸€ä¸ªå·¥å…· rsc.io/goversion, å®ƒä»ç»™å®šçš„å¯æ‰§è¡Œæ–‡ä»¶æˆ–å¯æ‰§è¡Œæ–‡ä»¶æ ‘ä¸­è·å–è¿™äº›ä¿¡æ¯. ä¾‹å¦‚, åœ¨æˆ‘çš„ Ubuntu Linux ç¬”è®°æœ¬ç”µè„‘ä¸Š, æˆ‘å¯ä»¥çœ‹çœ‹å“ªäº›ç³»ç»Ÿå®ç”¨ç¨‹åºæ˜¯ Go å®ç°çš„:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ go get -u rsc.io/goversion</span><br><span class="line">$ goversion /usr/bin</span><br><span class="line">/usr/bin/containerd go1.8.3</span><br><span class="line">/usr/bin/containerd-shim go1.8.3</span><br><span class="line">/usr/bin/ctr go1.8.3</span><br><span class="line">/usr/bin/go go1.8.3</span><br><span class="line">/usr/bin/gofmt go1.8.3</span><br><span class="line">/usr/bin/kbfsfuse go1.8.3</span><br><span class="line">/usr/bin/kbnm go1.8.3</span><br><span class="line">/usr/bin/keybase go1.8.3</span><br><span class="line">/usr/bin/snap go1.8.3</span><br><span class="line">/usr/bin/snapctl go1.8.3</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>ç°åœ¨ vgo åŸå‹å¯ä»¥ç†è§£æ¨¡å—ç‰ˆæœ¬, å®ƒä¹Ÿå°†è¿™äº›ä¿¡æ¯åŒ…å«åœ¨æœ€ç»ˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­, å¹¶ä¸”æ–°çš„ goversion -m æ ‡å¿—å°†å…¶æ‰“å°å‡ºæ¥. ä½¿ç”¨æˆ‘ä»¬æ¥è‡ª <a href="https://lingchao.xin/post/vgo-tour.html">tour</a> çš„ â€œhello, worldâ€ ç¨‹åº:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ go get -u rsc.io/goversion</span><br><span class="line">$ goversion ./hello</span><br><span class="line">./hello go1.10</span><br><span class="line">$ goversion -m hello</span><br><span class="line">./hello go1.10</span><br><span class="line">path  github.com/you/hello</span><br><span class="line">mod   github.com/you/hello  (devel)</span><br><span class="line">dep   golang.org/x/text     v0.0.0-20170915032832-14c0d48ead0c</span><br><span class="line">dep   rsc.io/quote          v1.5.2</span><br><span class="line">dep   rsc.io/sampler        v1.3.0</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>ä¸»æ¨¡å— github.com/you/hello, æ²¡æœ‰ç‰ˆæœ¬ä¿¡æ¯, å› ä¸ºå®ƒæ˜¯æœ¬åœ°å¼€å‘å‰¯æœ¬, è€Œä¸æ˜¯æˆ‘ä»¬ä¸‹è½½çš„ç‰¹å®šç‰ˆæœ¬. ä½†æ˜¯å¦‚æœæˆ‘ä»¬ç›´æ¥ä»æœ‰ç‰ˆæœ¬çš„æ¨¡å—æ„å»ºå‘½ä»¤, é‚£ä¹ˆåˆ—è¡¨ä¼šæŠ¥å‘Šæ‰€æœ‰æ¨¡å—çš„ç‰ˆæœ¬:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo build -o hello2 rsc.io/hello</span><br><span class="line">vgo: resolving import &quot;rsc.io/hello&quot;</span><br><span class="line">vgo: finding rsc.io/hello (latest)</span><br><span class="line">vgo: adding rsc.io/hello v1.0.0</span><br><span class="line">vgo: finding rsc.io/hello v1.0.0</span><br><span class="line">vgo: finding rsc.io/quote v1.5.1</span><br><span class="line">vgo: downloading rsc.io/hello v1.0.0</span><br><span class="line">$ goversion -m ./hello2</span><br><span class="line">./hello2 go1.10</span><br><span class="line">path  rsc.io/hello</span><br><span class="line">mod   rsc.io/hello       v1.0.0</span><br><span class="line">dep   golang.org/x/text  v0.0.0-20170915032832-14c0d48ead0c</span><br><span class="line">dep   rsc.io/quote       v1.5.2</span><br><span class="line">dep   rsc.io/sampler     v1.3.0</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬é›†æˆç‰ˆæœ¬è¿› Go å·¥å…·é“¾æ—¶, æˆ‘ä»¬å°†æ·»åŠ  API ä»¥ä»è¿è¡Œæ—¶åº“è®¿é—®æ­¤ä¿¡æ¯, å°±åƒ <a href="https://golang.org/pkg/runtime/#Version" target="_blank" rel="noopener">runtime.Version</a> æä¾›äº†å—é™çš„ Go ç‰ˆæœ¬ä¿¡æ¯è®¿é—®.</p><p>ä¸ºäº†å°è¯•é‡æ„äºŒè¿›åˆ¶æ–‡ä»¶, é€šè¿‡ goversion -m åˆ—å‡ºçš„ä¿¡æ¯å°±è¶³å¤Ÿäº†: å°†ç‰ˆæœ¬æ”¾å…¥ go.mod æ–‡ä»¶å¹¶æ„å»ºåœ¨è·¯å¾„è¡Œä¸Šå‘½åçš„ç›®æ ‡. ä½†å¦‚æœç»“æœä¸æ˜¯ç›¸åŒçš„äºŒè¿›åˆ¶æ–‡ä»¶, ä½ å¯èƒ½æƒ³çŸ¥é“å¦‚ä½•ç¼©å°ä¸åŒçš„æ–¹æ³•. ä»€ä¹ˆæ”¹å˜äº† ?</p><p>å½“ vgo ä¸‹è½½æ¯ä¸ªæ¨¡å—æ—¶, å®ƒä¼šè®¡ç®—ä¸è¯¥æ¨¡å—ç›¸å¯¹åº”çš„æ–‡ä»¶æ ‘çš„å“ˆå¸Œå€¼. è¯¥å“ˆå¸Œä¹ŸåŒ…å«åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­, å¹¶é™„æœ‰ç‰ˆæœ¬ä¿¡æ¯, è€Œä¸” goversion -mh ä¹Ÿå¯ä»¥æ‰“å°å‡ºå®ƒ:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ goversion -mh ./hello</span><br><span class="line">hello go1.10</span><br><span class="line">path  github.com/you/hello</span><br><span class="line">mod   github.com/you/hello  (devel)</span><br><span class="line">dep   golang.org/x/text     v0.0.0-20170915032832-14c0d48ead0c  h1:qgOY6WgZOaTkIIMiVjBQcw93ERBE4m30iBm00nkL0i8=</span><br><span class="line">dep   rsc.io/quote          v1.5.2                              h1:w5fcysjrx7yqtD/aO+QwRjYZOKnaM9Uh2b40tElTs3Y=</span><br><span class="line">dep   rsc.io/sampler        v1.3.1                              h1:F0c3J2nQCdk9ODsNhU3sElnvPIxM/xV1c/qZuAeZmac=</span><br><span class="line">$ goversion -mh ./hello2</span><br><span class="line">hello go1.10</span><br><span class="line">path  rsc.io/hello</span><br><span class="line">mod   rsc.io/hello       v1.0.0                              h1:CDmhdOARcor1WuRUvmE46PK91ahrSoEJqiCbf7FA56U=</span><br><span class="line">dep   golang.org/x/text  v0.0.0-20170915032832-14c0d48ead0c  h1:qgOY6WgZOaTkIIMiVjBQcw93ERBE4m30iBm00nkL0i8=</span><br><span class="line">dep   rsc.io/quote       v1.5.2                              h1:w5fcysjrx7yqtD/aO+QwRjYZOKnaM9Uh2b40tElTs3Y=</span><br><span class="line">dep   rsc.io/sampler     v1.3.0                              h1:7uVkIFmeBqHfdjD+gZwtXXI+RODJ2Wc4O7MPEh/QiW4=</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>h1: å‰ç¼€æŒ‡ç¤ºæ­£åœ¨æŠ¥å‘Šå“ªä¸ªå“ˆå¸Œ. ä»Šå¤©, åªæœ‰ â€œhash 1â€, æ–‡ä»¶åˆ—è¡¨çš„ SHA-256 å“ˆå¸ŒåŠå…¶å†…å®¹çš„ SHA-256 å“ˆå¸Œ. å¦‚æœæˆ‘ä»¬éœ€è¦ç¨åæ›´æ–°ä¸€ä¸ªæ–°çš„å“ˆå¸Œ, è¿™ä¸ªå‰ç¼€å°†å¸®åŠ©æˆ‘ä»¬ä»æ–°çš„å“ˆå¸Œä¸­å‘Šè¯‰æ—§çš„.</p><p>æˆ‘å¿…é¡»å¼ºè°ƒè¿™äº›å“ˆå¸Œæ˜¯ç”±æ„å»ºç³»ç»Ÿè‡ªæˆ‘æŠ¥å‘Šçš„. å¦‚æœæŸäººåœ¨æ„å»ºä¿¡æ¯ä¸­ä¸ºæ‚¨æä¾›äº†å…·æœ‰ç‰¹å®šå“ˆå¸Œå€¼çš„äºŒè¿›åˆ¶æ–‡ä»¶, åˆ™æ— æ³•ä¿è¯å…¶å‡†ç¡®æ€§. å®ƒä»¬æ˜¯æ”¯æŒä»¥åéªŒè¯çš„éå¸¸æœ‰ç”¨çš„ä¿¡æ¯, è€Œä¸æ˜¯è‡ªå·±å¯ä»¥ä¿¡ä»»çš„ç­¾å.</p><h3 id="å·²éªŒè¯çš„æ„å»º"><a href="#å·²éªŒè¯çš„æ„å»º" class="headerlink" title="å·²éªŒè¯çš„æ„å»º"></a>å·²éªŒè¯çš„æ„å»º</h3><p>ä»¥æºä»£ç å½¢å¼å‘å¸ƒç¨‹åºçš„ä½œè€…å¯èƒ½å¸Œæœ›è®©ç”¨æˆ·éªŒè¯ä»–ä»¬æ˜¯å¦æ­£åœ¨ä½¿ç”¨é¢„æœŸçš„ä¾èµ–æ„å»ºå®ƒ. æˆ‘ä»¬çŸ¥é“ vgo ä¼šåšå‡ºä¸ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„ä¾èµ–ç›¸åŒçš„å†³å®š, ä½†ä»ç„¶å­˜åœ¨å°† v1.5.2 ç­‰ç‰ˆæœ¬æ˜ å°„åˆ°å®é™…æºç æ ‘çš„é—®é¢˜. å¦‚æœ v1.5.2 çš„ä½œè€…å°†æ ‡ç­¾(tag)æ›´æ”¹ä¸ºæŒ‡å‘ä¸åŒçš„æ–‡ä»¶æ ‘, è¯¥æ€ä¹ˆåŠ ? å¦‚æœæ¶æ„ä¸­é—´ä»¶æ‹¦æˆªä¸‹è½½è¯·æ±‚å¹¶æä¾›ä¸åŒçš„ zip æ–‡ä»¶ä¼šæ€ä¹ˆæ · ? å¦‚æœç”¨æˆ·ä¸å°å¿ƒç¼–è¾‘äº† v1.5.2 çš„æœ¬åœ°å‰¯æœ¬ä¸­çš„æºæ–‡ä»¶, è¯¥æ€ä¹ˆåŠ ? vgo åŸå‹ä¹Ÿæ”¯æŒè¿™ç§éªŒè¯.</p><p>æœ€ç»ˆå½¢å¼å¯èƒ½æœ‰æ‰€ä¸åŒ, ä½†å¦‚æœä½ åœ¨ go.mod æ—è¾¹åˆ›å»ºä¸€ä¸ªåä¸º go.modverify çš„æ–‡ä»¶, é‚£ä¹ˆæ„å»ºå°†ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„æ¨¡å—çš„å·²çŸ¥å“ˆå¸Œä½¿è¯¥æ–‡ä»¶ä¿æŒæœ€æ–°:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo &gt;go.modverify</span><br><span class="line">$ vgo build</span><br><span class="line">$ tcat go.modverify  # go get rsc.io/tcat, or use cat</span><br><span class="line">golang.org/x/text  v0.0.0-20170915032832-14c0d48ead0c  h1:qgOY6WgZOaTkIIMiVjBQcw93ERBE4m30iBm00nkL0i8=</span><br><span class="line">rsc.io/quote       v1.5.2                              h1:w5fcysjrx7yqtD/aO+QwRjYZOKnaM9Uh2b40tElTs3Y=</span><br><span class="line">rsc.io/sampler     v1.3.0                              h1:7uVkIFmeBqHfdjD+gZwtXXI+RODJ2Wc4O7MPEh/QiW4=</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>go.modverify æ–‡ä»¶æ˜¯æ‰€æœ‰æœ‰å²ä»¥æ¥é‡åˆ°çš„ç‰ˆæœ¬çš„å“ˆå¸Œæ—¥å¿—: åªæ·»åŠ è¡Œ, ä¸åˆ é™¤. å¦‚æœæˆ‘ä»¬å°† rsc.io/sampler æ›´æ–°ä¸º v1.3.1, åˆ™æ—¥å¿—ç°åœ¨å°†åŒ…å«ä¸¤ä¸ªç‰ˆæœ¬çš„å“ˆå¸Œå€¼:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo get rsc.io/sampler@v1.3.1</span><br><span class="line">$ tcat go.modverify</span><br><span class="line">golang.org/x/text  v0.0.0-20170915032832-14c0d48ead0c  h1:qgOY6WgZOaTkIIMiVjBQcw93ERBE4m30iBm00nkL0i8=</span><br><span class="line">rsc.io/quote       v1.5.2                              h1:w5fcysjrx7yqtD/aO+QwRjYZOKnaM9Uh2b40tElTs3Y=</span><br><span class="line">rsc.io/sampler     v1.3.0                              h1:7uVkIFmeBqHfdjD+gZwtXXI+RODJ2Wc4O7MPEh/QiW4=</span><br><span class="line">rsc.io/sampler     v1.3.1                              h1:F0c3J2nQCdk9ODsNhU3sElnvPIxM/xV1c/qZuAeZmac=</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>å½“ go.modverify å­˜åœ¨æ—¶, vgo å°†æ£€æŸ¥ç»™å®šå†…éƒ¨ç‰ˆæœ¬ä¸­ä½¿ç”¨çš„æ‰€æœ‰ä¸‹è½½æ¨¡å—æ˜¯å¦ä¸æ–‡ä»¶ä¸­å·²æœ‰çš„æ¡ç›®ä¸€è‡´. ä¾‹å¦‚, å¦‚æœæˆ‘ä»¬å°† rsc.io/quote æ•£åˆ—çš„ç¬¬ä¸€ä¸ªæ•°å­—ä» w æ›´æ”¹ä¸º v:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo build</span><br><span class="line">vgo: verifying rsc.io/quote v1.5.2: module hash mismatch</span><br><span class="line">downloaded:   h1:w5fcysjrx7yqtD/aO+QwRjYZOKnaM9Uh2b40tElTs3Y=</span><br><span class="line">go.modverify: h1:v5fcysjrx7yqtD/aO+QwRjYZOKnaM9Uh2b40tElTs3Y=</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>æˆ–è€…å‡è®¾æˆ‘ä»¬ä¿®å¤äº†é‚£ä¸ª, ä½†æ˜¯ä¿®æ”¹äº† v1.3.0 å“ˆå¸Œ. ç°åœ¨æˆ‘ä»¬çš„æ„å»ºæˆåŠŸäº†, å› ä¸ºæ„å»ºç‰ˆæœ¬æ²¡æœ‰ä½¿ç”¨ v1.3.0, æ‰€ä»¥å®ƒçš„è¡Œè¢«(æ­£ç¡®åœ°)å¿½ç•¥äº†. ä½†æ˜¯, å¦‚æœæˆ‘ä»¬å°è¯•é™çº§åˆ° v1.3.0, é‚£ä¹ˆæ„å»ºéªŒè¯å°†å¤±è´¥:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo build</span><br><span class="line">$ vgo get rsc.io/sampler@v1.3.0</span><br><span class="line">vgo: verifying rsc.io/sampler v1.3.0: module hash mismatch</span><br><span class="line">downloaded:   h1:7uVkIFmeBqHfdjD+gZwtXXI+RODJ2Wc4O7MPEh/QiW4=</span><br><span class="line">go.modverify: h1:8uVkIFmeBqHfdjD+gZwtXXI+RODJ2Wc4O7MPEh/QiW4=</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>å¸Œæœ›ç¡®ä¿å…¶ä»–äººä½¿ç”¨ä¸ä»–ä»¬å®Œå…¨ç›¸åŒçš„æºé‡å»ºå…¶ç¨‹åºçš„å¼€å‘äººå‘˜å¯ä»¥å°† go.modverify å­˜å‚¨åœ¨å…¶ä»£ç åº“ä¸­. ç„¶åå…¶ä»–æ„å»ºä½¿ç”¨ç›¸åŒçš„ä»£ç åº“ä¼šè‡ªåŠ¨è·å¾—éªŒè¯æ„å»º. ç›®å‰, åªæœ‰æ„å»ºçš„é¡¶çº§æ¨¡å—ä¸­çš„ go.modverify é€‚ç”¨. ä½†è¯·æ³¨æ„, go.modverify ä¼šåˆ—å‡ºæ‰€æœ‰ä¾èµ–å…³ç³», åŒ…æ‹¬é—´æ¥ä¾èµ–å…³ç³», å› æ­¤æ•´ä¸ªæ„å»ºéƒ½ä¼šè¢«éªŒè¯.</p><p>go.modverify ç‰¹æ€§å¯å¸®åŠ©æ£€æµ‹ä¸åŒæœºå™¨ä¸‹è½½çš„ä¾èµ–ä¹‹é—´çš„ä¸åŒ¹é…æƒ…å†µ. å®ƒæ¯”è¾ƒ go.modverify ä¸­çš„å“ˆå¸Œå€¼å’Œæ¨¡å—ä¸‹è½½æ—¶è®¡ç®—å’Œä¿å­˜çš„å“ˆå¸Œå€¼. è¿˜å¯ä»¥æ£€æŸ¥ä¸‹è½½çš„æ¨¡å—æ˜¯å¦åœ¨æœ¬åœ°æœºå™¨ä¸Šæœ‰æ²¡æœ‰å‘ç”Ÿæ›´æ”¹. è¿™ä¸æ˜¯å…³äºå®‰å…¨æ€§çš„æ”»å‡», æ›´å¤šçš„æ˜¯å…³äºé¿å…é”™è¯¯. ä¾‹å¦‚, å› ä¸ºæºæ–‡ä»¶è·¯å¾„å‡ºç°åœ¨å †æ ˆè·Ÿè¸ªä¸­, æ‰€ä»¥åœ¨è°ƒè¯•æ—¶æ‰“å¼€è¿™äº›æ–‡ä»¶æ˜¯å¾ˆå¸¸è§çš„. å¦‚æœä½ åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­æ„å¤–åœ°(æˆ–è€…æˆ‘è®¤ä¸ºæ˜¯æ•…æ„åœ°)ä¿®æ”¹æ–‡ä»¶, é‚£ä¹ˆç¨åèƒ½å¤Ÿæ£€æµ‹åˆ°å®ƒå°†æ˜¯å¾ˆå¥½çš„. vgo verify å‘½ä»¤æ‰§è¡Œæ­¤æ“ä½œ:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ go get -u golang.org/x/vgo  # fixed a bug, sorry! :-)</span><br><span class="line">$ vgo verify</span><br><span class="line">all modules verified</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>å¦‚æœæºæ–‡ä»¶æ›´æ”¹, vgo verify ä¼šé€šçŸ¥:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo &gt;&gt;$GOPATH/src/v/rsc.io/quote@v1.5.2/quote.go</span><br><span class="line">$ vgo verify</span><br><span class="line">rsc.io/quote v1.5.2: dir has been modified (/Users/rsc/src/v/rsc.io/quote@v1.5.2)</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æ¢å¤æ–‡ä»¶, ä¸€åˆ‡éƒ½å¾ˆå¥½:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ gofmt -w $GOPATH/src/v/rsc.io/quote@v1.5.2/quote.go</span><br><span class="line">$ vgo verify</span><br><span class="line">all modules verified</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸‹è½½åä¿®æ”¹äº†ç¼“å­˜çš„ zip æ–‡ä»¶, vgo verify ä¹Ÿä¼šé€šçŸ¥, å°½ç®¡æˆ‘æ— æ³•åˆç†è§£é‡Šå¯èƒ½å‘ç”Ÿçš„æƒ…å†µ:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ zip $GOPATH/src/v/cache/rsc.io/quote/@v/v1.5.2.zip /etc/resolv.conf</span><br><span class="line">  adding: etc/resolv.conf (deflated 36%)</span><br><span class="line">$ vgo verify</span><br><span class="line">rsc.io/quote v1.5.2: zip has been modified (/Users/rsc/src/v/cache/rsc.io/quote/@v/v1.5.2.zip)</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>ç”±äº vgo åœ¨è§£å‹ç¼©åä¼šä¿ç•™åŸå§‹ zip æ–‡ä»¶, å› æ­¤å¦‚æœ vgo verify ç¡®å®šåªæœ‰ zip æ–‡ä»¶å’Œç›®å½•æ ‘ä¸­çš„ä¸€ä¸ªå·²è¢«ä¿®æ”¹, åˆ™ç”šè‡³å¯ä»¥æ‰“å°è¿™ä¸¤è€…çš„å·®å¼‚.</p><h3 id="æ¥ä¸‹æ¥å‘¢"><a href="#æ¥ä¸‹æ¥å‘¢" class="headerlink" title="æ¥ä¸‹æ¥å‘¢ ?"></a>æ¥ä¸‹æ¥å‘¢ ?</h3><p>è¿™å·²ç»åœ¨ vgo ä¸­å®ç°. ä½ å¯ä»¥å°è¯•ä¸€ä¸‹å¹¶ä½¿ç”¨å®ƒ. ä¸ vgo çš„å…¶ä»–éƒ¨åˆ†ä¸€æ ·, å¯¹äºå“ªäº›å·¥ä½œä¸æ­£å¸¸(æˆ–å·¥ä½œå‡ºè‰²)çš„åé¦ˆè¡¨ç¤ºæ„Ÿæ¿€.</p><p>è¿™é‡Œå±•ç¤ºçš„åŠŸèƒ½æ›´å¤šçš„æ˜¯ä¸€äº›ä¸œè¥¿çš„å¼€å§‹, è€Œä¸æ˜¯ä¸€ä¸ªå®Œæˆçš„åŠŸèƒ½. æ–‡ä»¶æ ‘çš„åŠ å¯†å“ˆå¸Œæ˜¯ä¸€ä¸ªæ„å»ºå—. å»ºç«‹åœ¨å®ƒä¹‹ä¸Šçš„ go.modverify æ£€æŸ¥å¼€å‘äººå‘˜æ˜¯å¦éƒ½ä½¿ç”¨å®Œå…¨ç›¸åŒçš„ä¾èµ–æ„å»ºç‰¹å®šçš„æ¨¡å—, ä½†æ˜¯åœ¨ä¸‹è½½æ–°ç‰ˆæœ¬çš„æ¨¡å—æ—¶æ²¡æœ‰éªŒè¯(é™¤éå…¶ä»–äººå·²ç»å°†å…¶æ·»åŠ åˆ° go.modverify), æ¨¡å—ä¹‹é—´ä¹Ÿæ²¡æœ‰å…±äº«é¢„æœŸçš„å“ˆå¸Œå€¼.</p><p>å¦‚ä½•è§£å†³è¿™ä¸¤ä¸ªç¼ºç‚¹çš„ç¡®åˆ‡ç»†èŠ‚å¹¶ä¸æ˜æ˜¾. å…è®¸æŸç§ç±»å‹çš„æ–‡ä»¶æ ‘çš„åŠ å¯†ç­¾åæ˜¯æœ‰æ„ä¹‰çš„, å¹¶ä¸”è¦éªŒè¯å‡çº§å‘ç°çš„ç‰ˆæœ¬ä¸ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„å¯†é’¥ç›¸åŒ. æˆ–è€…, åœ¨æ›´æ–°æ¡†æ¶(<a href="https://theupdateframework.github.io/" target="_blank" rel="noopener">TUF</a>)ä¸­é‡‡ç”¨ä¸€ç§æ–¹æ³•æ˜¯æœ‰æ„ä¹‰çš„, å°½ç®¡ç›´æ¥ä½¿ç”¨å®ƒä»¬çš„ç½‘ç»œåè®®æ˜¯ä¸å®é™…çš„. æˆ–è€…, ä¸è¦ä½¿ç”¨æ¯ä¸ªä»£ç åº“ go.modverify æ—¥å¿—, å»ºç«‹æŸç§å…±äº«çš„å…¨å±€æ—¥å¿—å¯èƒ½æœ‰æ„ä¹‰, æœ‰ç‚¹åƒ<a href="https://www.certificate-transparency.org/" target="_blank" rel="noopener">è¯ä¹¦é€æ˜åº¦</a>, æˆ–è€…ä½¿ç”¨ä¸€ä¸ªç±»ä¼¼ <a href="https://upspin.io/" target="_blank" rel="noopener">Upspin</a> çš„å…¬å…±èº«ä»½æœåŠ¡å™¨. æˆ‘ä»¬å¯èƒ½ä¼šæ¢ç´¢å¾ˆå¤šé€”å¾„, ä½†è¿™äº›éƒ½æœ‰ç‚¹è¶…å‰äº†. ç›®å‰, æˆ‘ä»¬çš„é‡ç‚¹æ˜¯æˆåŠŸåœ°å°†ç‰ˆæœ¬æ§åˆ¶é›†æˆåˆ° go å‘½ä»¤ä¸­.</p>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> go </tag>
            
            <tag> vgo </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æœ€å°ç‰ˆæœ¬é€‰æ‹©</title>
      <link href="/post/vgo-mvs.html"/>
      <url>/post/vgo-mvs.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ª <a href="https://research.swtch.com/vgo-mvs" target="_blank" rel="noopener">Minimal Version Selection</a>, <a href="https://lingchao.xin/tag/vgo.html">Go &amp; Versioning</a> çš„ç¬¬ 4 éƒ¨åˆ†, ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰.<br><a id="more"></a></p><p><a href="https://lingchao.xin/post/vgo-intro.html">ç‰ˆæœ¬åŒ–çš„ Go å‘½ä»¤</a>å¿…é¡»å†³å®šåœ¨æ¯ä¸ªç‰ˆæœ¬ä¸­ä½¿ç”¨å“ªä¸ªæ¨¡å—ç‰ˆæœ¬. æˆ‘æŠŠæŒ‡å®šæ„å»ºä¸­ç”¨åˆ°çš„æ¨¡å—å’Œç‰ˆæœ¬åˆ—è¡¨ç§°ä¹‹ä¸ºæ„å»ºåˆ—è¡¨. ä¸ºäº†ç¨³å®šå¼€å‘, ä»Šå¤©çš„æ„å»ºåˆ—è¡¨ä¹Ÿå¿…é¡»æ˜¯æ˜å¤©çš„æ„å»ºåˆ—è¡¨. ä½†æ˜¯, å¼€å‘äººå‘˜ä¹Ÿå¿…é¡»å…è®¸æ›´æ”¹æ„å»ºåˆ—è¡¨: å‡çº§æ‰€æœ‰æ¨¡å—, å‡çº§ä¸€ä¸ªæ¨¡å—æˆ–é™çº§ä¸€ä¸ªæ¨¡å—.</p><p>å› æ­¤<em>ç‰ˆæœ¬é€‰æ‹©</em>é—®é¢˜æ˜¯å®šä¹‰å…¶æ„ä¹‰å¹¶ç»™å‡ºç®—æ³•å®ç°, æ„å»ºåˆ—è¡¨ä¸­çš„ 4 ä¸ªæ“ä½œä¸º:</p><ol><li>æ„é€ å½“å‰çš„æ„å»ºåˆ—è¡¨.</li><li>å°†æ‰€æœ‰æ¨¡å—å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬.</li><li>å°†ä¸€ä¸ªæ¨¡å—å‡çº§åˆ°ç‰¹å®šçš„è¾ƒæ–°ç‰ˆæœ¬.</li><li>å°†ä¸€ä¸ªæ¨¡å—é™çº§åˆ°ç‰¹å®šçš„æ—§ç‰ˆæœ¬.</li></ol><p>æœ€åä¸¤ä¸ªæ“ä½œæŒ‡å®šä¸€ä¸ªæ¨¡å—å‡çº§æˆ–é™çº§, ä½†è¿™æ ·åšå¯èƒ½éœ€è¦å‡çº§, é™çº§, æ·»åŠ æˆ–åˆ é™¤å…¶ä»–æ¨¡å—, ç†æƒ³æƒ…å†µä¸‹åº”å°½å¯èƒ½å°‘, ä»¥æ»¡è¶³ä¾èµ–æ€§.</p><p>è¿™ç¯‡æ–‡ç« ä»‹ç»äº†æœ€å°ç‰ˆæœ¬é€‰æ‹©, è¿™æ˜¯ä¸€ç§æ–°çš„, ç®€å•çš„ç‰ˆæœ¬é€‰æ‹©é—®é¢˜. æœ€å°ç‰ˆæœ¬çš„é€‰æ‹©å¾ˆå®¹æ˜“ç†è§£å’Œé¢„æµ‹, è¿™åº”è¯¥ä½¿å…¶æ˜“äºä½¿ç”¨. å®ƒè¿˜å¯ä»¥ç”Ÿæˆé«˜ä¿çœŸæ„å»º, å…¶ä¸­ç”¨æˆ·æ„å»ºçš„ä¾èµ–å…³ç³»å°½å¯èƒ½çš„æ¥è¿‘åŒ…ä½œè€…å¼€å‘ç”¨çš„ä¾èµ–å…³ç³». å®ƒçš„å®ç°æ•ˆç‡ä¹Ÿå¾ˆé«˜, ä¸éœ€è¦æ¯”é€’å½’å›¾éå†æ›´å¤æ‚, å› æ­¤ Go ä¸­çš„å®Œæ•´çš„æœ€å°ç‰ˆæœ¬é€‰æ‹©å®ç°åªæœ‰å‡ ç™¾è¡Œä»£ç .</p><p>æœ€å°ç‰ˆæœ¬é€‰æ‹©å‡å®šæ¯ä¸ªæ¨¡å—å£°æ˜è‡ªå·±çš„ä¾èµ–æ€§éœ€æ±‚: å…¶ä»–æ¨¡å—çš„æœ€ä½ç‰ˆæœ¬åˆ—è¡¨. å‡è®¾æ¨¡å—éµå¾ªå¯¼å…¥<a href="https://lingchao.xin/post/vgo-import.html">å…¼å®¹æ€§è§„åˆ™</a> - ä»»ä½•è¾ƒæ–°ç‰ˆæœ¬ä¸­çš„åŒ…åº”è¯¥å’Œæ—§ç‰ˆä¸€æ ·å·¥ä½œ - æ‰€ä»¥ä¾èµ–æ€§éœ€æ±‚åªç»™å‡ºæœ€ä½ç‰ˆæœ¬, è€Œä¸æ˜¯æœ€é«˜ç‰ˆæœ¬æˆ–ä¸å…¼å®¹çš„æ›´é«˜ç‰ˆæœ¬çš„åˆ—è¡¨.</p><p>é‚£ä¹ˆè¿™å››ä¸ªæ“ä½œçš„å®šä¹‰æ˜¯:</p><ol><li>æ„å»ºç»™å®šç›®æ ‡çš„æ„å»ºåˆ—è¡¨: ä½¿ç”¨ç›®æ ‡æœ¬èº«å¯åŠ¨åˆ—è¡¨, ç„¶åè¿½åŠ æ¯ä¸ªéœ€æ±‚çš„æ„å»ºåˆ—è¡¨. å¦‚æœä¸€ä¸ªæ¨¡å—å¤šæ¬¡å‡ºç°åœ¨åˆ—è¡¨ä¸­, ä»…ä¿ç•™æœ€æ–°ç‰ˆæœ¬.</li><li>è¦å°†æ‰€æœ‰æ¨¡å—å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬: æ„é€ æ„å»ºåˆ—è¡¨, ä½†è¦è¯»å–æ¯ä¸ªéœ€æ±‚(requirement), å°±å¥½åƒå®ƒè¯·æ±‚äº†æœ€æ–°çš„æ¨¡å—ç‰ˆæœ¬ä¸€æ ·.</li><li>è¦å°†ä¸€ä¸ªæ¨¡å—å‡çº§åˆ°ç‰¹å®šçš„è¾ƒæ–°ç‰ˆæœ¬: æ„é€ æœªå‡çº§çš„æ„å»ºåˆ—è¡¨, ç„¶åæ·»åŠ æ–°æ¨¡å—çš„æ„å»ºåˆ—è¡¨. å¦‚æœä¸€ä¸ªæ¨¡å—å¤šæ¬¡å‡ºç°åœ¨åˆ—è¡¨ä¸­, ä»…ä¿ç•™æœ€æ–°ç‰ˆæœ¬.</li><li>è¦å°†ä¸€ä¸ªæ¨¡å—é™çº§åˆ°ç‰¹å®šçš„æ—§ç‰ˆæœ¬: å€’å›æ¯ä¸ªé¡¶çº§éœ€æ±‚çš„æ‰€éœ€ç‰ˆæœ¬, ç›´åˆ°è¯¥éœ€æ±‚çš„æ„å»ºåˆ—è¡¨ä¸å†å¼•ç”¨é™çº§æ¨¡å—çš„è¾ƒæ–°ç‰ˆæœ¬.</li></ol><p>è¿™äº›æ“ä½œç®€å•, é«˜æ•ˆä¸”æ˜“äºå®ç°.</p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>åœ¨æˆ‘ä»¬æ›´è¯¦ç»†åœ°æµ‹è¯•æœ€å°ç‰ˆæœ¬é€‰æ‹©ä¹‹å‰, è®©æˆ‘ä»¬çœ‹çœ‹ä¸ºä»€ä¹ˆéœ€è¦æ–°çš„æ–¹æ³•. åœ¨æ•´ç¯‡æ–‡ç« ä¸­, æˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹ä¸€ç»„æ¨¡å—ä½œä¸ºè¿è¡Œç¤ºä¾‹:</p><p><img src="/static/images/version-select-1@2x.png" width="463px" height="272px"></p><p>è¯¥å›¾æ˜¾ç¤ºäº†å…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç‰ˆæœ¬çš„ä¸ƒä¸ªæ¨¡å—(è™šçº¿æ¡†)çš„æ¨¡å—éœ€æ±‚å›¾. åœ¨è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶ä¹‹å, ç»™å®šæ¨¡å—çš„æ‰€æœ‰ç‰ˆæœ¬éƒ½å…±äº«ä¸€ä¸ªä¸»ç‰ˆæœ¬å·. æˆ‘ä»¬æ­£åœ¨å¼€å‘æ¨¡å— A 1, æˆ‘ä»¬å°†è¿è¡Œå‘½ä»¤æ¥æ›´æ–°å…¶ä¾èµ–æ€§è¦æ±‚. è¯¥å›¾æ˜¾ç¤ºäº† A 1 çš„å½“å‰éœ€æ±‚å’Œç”±å„ä¸ªç‰ˆæœ¬çš„å·²å‘å¸ƒæ¨¡å— B 1 è‡³ F 1 å£°æ˜çš„éœ€æ±‚.</p><p>å› ä¸ºä¸»ç‰ˆæœ¬æ˜¯æ¨¡å—æ ‡è¯†ç¬¦çš„ä¸€éƒ¨åˆ†, æ‰€ä»¥æˆ‘ä»¬å¿…é¡»çŸ¥é“æˆ‘ä»¬æ­£åœ¨å¤„ç† A 1 è€Œä¸æ˜¯ A 2, ä½†æ˜¯ A çš„ç¡®åˆ‡ç‰ˆæœ¬æœªæŒ‡å®š - æˆ‘ä»¬çš„å·¥ä½œæœªå‘å¸ƒ. åŒæ ·, ä¸åŒçš„ä¸»ç‰ˆæœ¬åªæ˜¯ä¸åŒçš„æ¨¡å—: å°±è¿™äº›ç®—æ³•è€Œè¨€, B 1 ä¸ B 2 çš„å…³ç³»ä¸å¦‚ C 1. æˆ‘ä»¬å¯ä»¥ç”¨ A 2 åˆ° A 7 æ›¿ä»£å›¾ä¸­çš„ B1 åˆ° F1, ä½†æ˜æ˜¾æŸå¤±å¾ˆå¤§, ä½†å¯¹äºç®—æ³•å¦‚ä½•å¤„ç†è¿™ä¸ªä¾‹å­æ²¡æœ‰ä»»ä½•æ”¹å˜. ç”±äºç¤ºä¾‹ä¸­çš„æ‰€æœ‰æ¨¡å—éƒ½å…·æœ‰ä¸»ç‰ˆæœ¬ 1, å› æ­¤ä»ç°åœ¨å¼€å§‹æˆ‘ä»¬å°†å°½å¯èƒ½çœç•¥ä¸»ç‰ˆæœ¬, å°† A 1 ç¼©çŸ­ä¸º A. æˆ‘ä»¬ç›®å‰çš„ A ç‰ˆæœ¬éœ€è¦ B 1.2 å’Œ C 1.2. B 1.2 ä¾æ¬¡è¦æ±‚ D 1.3. æ—©æœŸç‰ˆæœ¬ B 1.1 éœ€è¦ D 1.1. ç­‰ç­‰. è¯·æ³¨æ„, F 1.1 éœ€è¦ G 1.1, ä½† G 1.1 ä¹Ÿéœ€è¦ F 1.1. å½“å•ä¸ªåŠŸèƒ½ä»ä¸€ä¸ªæ¨¡å—ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ—¶, å£°æ˜è¿™ç§å¾ªç¯å¯èƒ½å¾ˆé‡è¦. æˆ‘ä»¬çš„ç®—æ³•ä¸èƒ½å‡å®šæ¨¡å—éœ€æ±‚å›¾æ˜¯éå¾ªç¯çš„.</p><h3 id="ä½ä¿çœŸæ„å»º"><a href="#ä½ä¿çœŸæ„å»º" class="headerlink" title="ä½ä¿çœŸæ„å»º"></a>ä½ä¿çœŸæ„å»º</h3><p>Go çš„å½“å‰ç‰ˆæœ¬é€‰æ‹©ç®—æ³•å¾ˆç®€å•, æä¾›äº†ä¸¤ç§ä¸åŒçš„ç‰ˆæœ¬é€‰æ‹©ç®—æ³•, ä½†éƒ½æ˜¯ä¸æ­£ç¡®çš„.</p><p>ç¬¬ä¸€ç§ç®—æ³•æ˜¯ go get çš„é»˜è®¤è¡Œä¸º: å¦‚æœä½ æœ‰æœ¬åœ°ç‰ˆæœ¬, è¯·ä½¿ç”¨è¯¥ç‰ˆæœ¬, å¦åˆ™è¯·ä¸‹è½½å¹¶ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬. è¿™ç§æ¨¡å¼å¯ä»¥ä½¿ç”¨å¤ªæ—§çš„ç‰ˆæœ¬: å¦‚æœä½ å·²ç»å®‰è£…äº† B 1.1 å¹¶è¿è¡Œ go get ä¸‹è½½ A, é‚£ä¹ˆ go get å°±ä¸ä¼šæ›´æ–°åˆ° B 1.2, ä»è€Œå¯¼è‡´æ„å»ºå¤±è´¥æˆ–æœ‰ bug çš„æ„å»º.</p><p>ç¬¬äºŒç§ç®—æ³•æ˜¯ go get -u çš„è¡Œä¸º: ä¸‹è½½å¹¶ä½¿ç”¨æ‰€æœ‰åŒ…çš„æœ€æ–°ç‰ˆæœ¬. æ­¤æ¨¡å¼ç”±äºä½¿ç”¨çš„ç‰ˆæœ¬å¤ªæ–°è€Œå¤±è´¥: å¦‚æœè¿è¡Œ go get -u ä¸‹è½½ A, å®ƒå°†æ­£ç¡®æ›´æ–°åˆ° B 1.2, ä½†å®ƒä¹Ÿä¼šæ›´æ–°åˆ° C 1.3 å’Œ E 1.3, è¿™ä¸æ˜¯ A æ‰€éœ€è¦çš„, å¯èƒ½æ²¡æœ‰ç»è¿‡æµ‹è¯•, å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œ.</p><p>æˆ‘å°†è¿™äº›ç»“æœç§°ä¸ºä½ä¿çœŸæ„å»º: è¢«è§†ä¸ºè¯•å›¾é‡ç° A çš„ä½œè€…æ‰€ä½¿ç”¨çš„æ„å»º, è¿™äº›æ„å»ºå› æ²¡æœ‰ç†ç”±è€Œæœ‰æ‰€ä¸åŒ(è¯‘æ³¨: æ­¤å¤„ä¸å¤ªå¥½ç¿»è¯‘). åœ¨æˆ‘ä»¬çœ‹åˆ°æœ€å°ç‰ˆæœ¬é€‰æ‹©ç®—æ³•çš„ç»†èŠ‚å, æˆ‘ä»¬å°†çœ‹åˆ°å®ƒä»¬ä¸ºä»€ä¹ˆä¼šç”Ÿæˆé«˜ä¿çœŸæ„å»º.</p><h3 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h3><p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹æ›´è¯¦ç»†çš„ç®—æ³•.</p><h4 id="ç®—æ³•-1-æ„é€ æ„å»ºåˆ—è¡¨"><a href="#ç®—æ³•-1-æ„é€ æ„å»ºåˆ—è¡¨" class="headerlink" title="ç®—æ³• 1: æ„é€ æ„å»ºåˆ—è¡¨"></a>ç®—æ³• 1: æ„é€ æ„å»ºåˆ—è¡¨</h4><p>æœ‰ä¸¤ç§æœ‰ç”¨çš„(å’Œç­‰ä»·çš„)æ–¹æ³•æ¥å®šä¹‰æ„å»ºåˆ—è¡¨çš„æ„é€ : ä½œä¸ºé€’å½’è¿‡ç¨‹å’Œå›¾å½¢éå†.</p><p>æ„å»ºåˆ—è¡¨æ„é€ çš„é€’å½’å®šä¹‰å¦‚ä¸‹. é€šè¿‡å¯åŠ¨ä¸€ä¸ªç©ºåˆ—è¡¨, æ·»åŠ  M, ç„¶åä¸º M çš„æ¯ä¸ªéœ€æ±‚é™„åŠ æ„å»ºåˆ—è¡¨, æ„å»º M çš„ç²—ç•¥æ„å»ºåˆ—è¡¨. é€šè¿‡ä»…ä¿ç•™ä»»ä½•åˆ—å‡ºæ¨¡å—çš„æœ€æ–°ç‰ˆæœ¬, ç®€åŒ–ç²—ç•¥æ„å»ºåˆ—è¡¨ä»¥ç”Ÿæˆæœ€ç»ˆæ„å»ºåˆ—è¡¨.</p><p><img src="/static/images/version-select-list@2x.png" width="467px" height="278px"></p><p>æ„å»ºåˆ—è¡¨çš„é€’å½’æ„é€ ä¸»è¦ç”¨ä½œå¿ƒç†æ¨¡å‹. è¯¥å®šä¹‰çš„å­—é¢é‡å®ç°æ•ˆç‡å¤ªä½, å¯èƒ½éœ€è¦éå¾ªç¯æ¨¡å—éœ€æ±‚å›¾çš„å¤§å°çš„æ—¶é—´æŒ‡æ•°, å¹¶ä¸”åœ¨å¾ªç¯å›¾ä¸Šæ°¸è¿œè¿è¡Œ.</p><p>ä¸€ä¸ªç­‰æ•ˆçš„, æ›´é«˜æ•ˆçš„æ„é€ åŸºäºå›¾å¯è¾¾æ€§. M çš„ç²—ç•¥æ„å»ºåˆ—è¡¨ä¹Ÿä»…ä»…æ˜¯ä» M å¼€å§‹çš„åç»­ç®­å¤´æ‰€éœ€çš„æ‰€æœ‰æ¨¡å—çš„åˆ—è¡¨.<br>è¿™å¯ä»¥é€šè¿‡å¯¹å›¾çš„ç®€å•é€’å½’éå†æ¥è®¡ç®—, æ³¨æ„ä¸è¦è®¿é—®å·²ç»è®¿é—®è¿‡çš„èŠ‚ç‚¹. ä¾‹å¦‚, A çš„ç²—ç•¥æ„å»ºåˆ—è¡¨æ˜¯ä» A å¤„å¼€å§‹å¹¶åœ¨é«˜äº®ç®­å¤´åé¢æ‰¾åˆ°çš„çªå‡ºæ˜¾ç¤ºçš„æ¨¡å—ç‰ˆæœ¬.</p><p><img src="/static/images/version-select-2@2x.png" width="463px" height="272px"></p><p>(ä»ç²—ç•¥æ„å»ºåˆ—è¡¨åˆ°æœ€ç»ˆæ„å»ºåˆ—è¡¨çš„ç®€åŒ–ä»ç„¶ç›¸åŒ)</p><p>æ³¨æ„, è¿™ä¸ªç®—æ³•åªè®¿é—®ä¸€æ¬¡ç²—ç•¥æ„å»ºåˆ—è¡¨ä¸­çš„æ¯ä¸ªæ¨¡å—, ç”±äºåªè®¿é—®é‚£äº›æ¨¡å—, å› æ­¤æ‰§è¡Œæ—¶é—´ä¸ç²—ç•¥æ„å»ºåˆ—è¡¨å¤§å°æˆæ­£æ¯” |B| , åŠ ä¸Šå¿…é¡»éå†çš„ç®­å¤´æ•°(æœ€å¤š |B|<sup>2</sup>). è¯¥ç®—æ³•å®Œå…¨å¿½ç•¥ç²—ç•¥æ„å»ºåˆ—è¡¨ä¸­çš„ç‰ˆæœ¬: ä¾‹å¦‚, å®ƒåŠ è½½å…³äº D 1.3, D 1.4 å’Œ E 1.2 çš„ä¿¡æ¯, ä½†å®ƒä¸åŠ è½½å…³äº D 1.2, E 1.1 æˆ– E 1.3 çš„ä¿¡æ¯. åœ¨ä¾èµ–ç®¡ç†è®¾ç½®ä¸­, åŠ è½½å…³äºæ¯ä¸ªæ¨¡å—ç‰ˆæœ¬çš„ä¿¡æ¯å¯èƒ½æ„å‘³ç€å•ç‹¬çš„ç½‘ç»œå¾€è¿”, é¿å…ä¸å¿…è¦çš„æ¨¡å—ç‰ˆæœ¬æ˜¯ä¸€ä¸ªé‡è¦çš„ä¼˜åŒ–.</p><h4 id="ç®—æ³•2-å‡çº§æ‰€æœ‰æ¨¡å—"><a href="#ç®—æ³•2-å‡çº§æ‰€æœ‰æ¨¡å—" class="headerlink" title="ç®—æ³•2. å‡çº§æ‰€æœ‰æ¨¡å—"></a>ç®—æ³•2. å‡çº§æ‰€æœ‰æ¨¡å—</h4><p>å‡çº§æ‰€æœ‰æ¨¡å—å¯èƒ½æ˜¯æ„å»ºåˆ—è¡¨æœ€å¸¸è§çš„ä¿®æ”¹. è¿™æ˜¯ä»Šå¤© get -u æ‰€åšçš„.</p><p>æˆ‘ä»¬é€šè¿‡å‡çº§æ¨¡å—éœ€æ±‚å›¾å¹¶åº”ç”¨å…ˆå‰çš„ç®—æ³•æ¥è®¡ç®—å‡çº§çš„æ„å»ºåˆ—è¡¨. å‡çº§åçš„æ¨¡å—éœ€æ±‚å›¾ä¸­æŒ‡å‘æ¨¡å—çš„ä»»ä½•ç‰ˆæœ¬çš„æ¯ä¸ªç®­å¤´éƒ½è¢«ä¸€ä¸ªæŒ‡å‘è¯¥æ¨¡å—çš„æœ€æ–°ç‰ˆæœ¬çš„æŒ‡é’ˆå–ä»£. (ä¹Ÿå¯ä»¥ä»å›¾ä¸­ä¸¢å¼ƒæ‰€æœ‰æ—§ç‰ˆæœ¬, ä½†æ„å»ºåˆ—è¡¨æ„é€ æ— è®ºå¦‚ä½•éƒ½ä¸ä¼šæŸ¥çœ‹å®ƒä»¬, å› æ­¤ä¸éœ€è¦æ¸…ç†å›¾.)</p><p>ä¾‹å¦‚, ä»¥ä¸‹æ˜¯å‡çº§åçš„æ¨¡å—éœ€æ±‚å›¾, åŸå§‹æ„å»ºåˆ—è¡¨ä»ä»¥é»„è‰²æ ‡è®°, è€Œå‡çº§çš„æ„å»ºåˆ—è¡¨ç°åœ¨æ ‡è®°ä¸ºçº¢è‰²:</p><p><img src="/static/images/version-select-3@2x.png" width="463px" height="272px"></p><p>è™½ç„¶è¿™å‘Šè¯‰æˆ‘ä»¬å‡çº§çš„æ„å»ºåˆ—è¡¨, ä½†å®ƒè¿˜æ²¡æœ‰å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•ä½¿æœªæ¥çš„æ„å»ºä½¿ç”¨æ„å»ºåˆ—è¡¨è€Œä¸æ˜¯æ—§æ„å»ºåˆ—è¡¨(ä»ä»¥é»„è‰²æ ‡è®°).<br>ä¸ºäº†å‡çº§å›¾è¡¨, æˆ‘ä»¬æ”¹å˜äº†æ‰€æœ‰æ¨¡å—çš„éœ€æ±‚. ä½†æ˜¯æ¨¡å— A å¼€å‘è¿‡ç¨‹ä¸­çš„å‡çº§å¿…é¡»ä»¥æŸç§æ–¹å¼è®°å½•åœ¨ A çš„éœ€æ±‚åˆ—è¡¨ä¸­(åœ¨ A çš„ go.mod æ–‡ä»¶ä¸­), ä½¿ç®—æ³• 1 ç”Ÿæˆæˆ‘ä»¬æƒ³è¦çš„æ„å»ºåˆ—è¡¨, æŒ‘é€‰çº¢è‰²æ¨¡å—è€Œä¸æ˜¯é»„è‰²æ¨¡å—.<br>ä¸ºäº†æå®šä»€ä¹ˆæ·»åŠ åˆ° A çš„éœ€æ±‚åˆ—è¡¨ä¸­å¯ä»¥è¾¾åˆ°è¿™ç§æ•ˆæœ, æˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªåŠ©æ‰‹ç®—æ³• R.</p><h4 id="ç®—æ³•-R-è®¡ç®—æœ€å°éœ€æ±‚åˆ—è¡¨"><a href="#ç®—æ³•-R-è®¡ç®—æœ€å°éœ€æ±‚åˆ—è¡¨" class="headerlink" title="ç®—æ³• R. è®¡ç®—æœ€å°éœ€æ±‚åˆ—è¡¨"></a>ç®—æ³• R. è®¡ç®—æœ€å°éœ€æ±‚åˆ—è¡¨</h4><p>ç»™å®šä¸€ä¸ªä¸ç›®æ ‡ä¸‹é¢çš„æ¨¡å—éœ€æ±‚å›¾ç›¸å…¼å®¹çš„æ„å»ºåˆ—è¡¨, æˆ‘ä»¬æƒ³ä¸ºç›®æ ‡è®¡ç®—ä¸€ä¸ªéœ€æ±‚åˆ—è¡¨, ä»¥ä¾¿äº§ç”Ÿè¯¥æ„å»ºåˆ—è¡¨. åˆ—å‡ºæ„å»ºåˆ—è¡¨ä¸­é™¤ç›®æ ‡æœ¬èº«ä¹‹å¤–çš„æ¯ä¸ªæ¨¡å—æ€»æ˜¯è¶³å¤Ÿçš„. ä¾‹å¦‚, æˆ‘ä»¬ä¸Šé¢è€ƒè™‘çš„å‡çº§å¯ä»¥å°† C 1.3 (æ›¿æ¢ C 1.2), D 1.4, E 1.3, F 1.1 å’Œ G 1.1 æ·»åŠ åˆ° A çš„éœ€æ±‚åˆ—è¡¨ä¸­. ä½†æ€»çš„æ¥è¯´, å¹¶éæ‰€æœ‰è¿™äº›æ·»åŠ éƒ½æ˜¯å¿…è¦çš„, æˆ‘ä»¬å¸Œæœ›åˆ—å‡ºå°½å¯èƒ½å°‘çš„é™„åŠ æ¨¡å—. ä¾‹å¦‚, F 1.1 æ„å‘³ç€ G 1.1 (åä¹‹äº¦ç„¶), æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦åˆ—å‡ºä¸¤è€…. ä¹ä¸€çœ‹, é€šè¿‡æ·»åŠ æ ‡è®°ä¸ºçº¢è‰²ä½†ä¸æ˜¯é»„è‰²çš„æ¨¡å—ç‰ˆæœ¬(åœ¨æ–°åˆ—è¡¨ä¸­, ä½†ä»æ—§åˆ—è¡¨ä¸­ç¼ºå¤±)å¼€å§‹ä¼¼ä¹å¾ˆè‡ªç„¶. é‚£ç§å¯å‘æ³•ä¼šé”™è¯¯åœ°ä¸¢å¼ƒ D 1.4, è¿™æ˜¯æ—§çš„éœ€æ±‚ C 1.2 æ‰€æš—ç¤ºçš„, è€Œä¸æ˜¯æ–°çš„éœ€æ±‚ C 1.3.</p><p>ç›¸å, ä»¥åå‘ååºè®¿é—®æ¨¡å—æ˜¯æ­£ç¡®çš„, ä¹Ÿå°±æ˜¯è¯´, åªæœ‰åœ¨è€ƒè™‘åˆ°æ‰€æœ‰æŒ‡å‘å®ƒçš„æ¨¡å—åæ‰è®¿é—®æ¨¡å—, å¹¶ä¸”åªæœ‰åœ¨æ¨¡å—æ²¡æœ‰è¢«å·²è®¿é—®çš„æ¨¡å—æš—ç¤ºçš„æƒ…å†µä¸‹æ‰ä¿ç•™æ¨¡å—.</p><p>å¯¹äºéå¾ªç¯å›¾, ç»“æœæ˜¯å”¯ä¸€çš„, æœ€å°çš„ä¸€ç»„æ·»åŠ . å¯¹äºå¾ªç¯å›¾, åå‘ååºéå†å¿…é¡»æ‰“ç ´å¾ªç¯, ç„¶åå¯¹äºä¸å‚ä¸å¾ªç¯çš„æ¨¡å—, æ·»åŠ é›†æ˜¯å”¯ä¸€ä¸”æœ€å°çš„. åªè¦ç»“æœæ˜¯æ­£ç¡®å’Œç¨³å®šçš„, æˆ‘ä»¬å°±ä¼šåœ¨å¾ªç¯çš„æƒ…å†µä¸‹æ¥å—éæœ€å°çš„ç­”æ¡ˆ. åœ¨æœ¬ä¾‹ä¸­, å‡çº§éœ€è¦æ·»åŠ  C 1.3 (æ›¿æ¢ C 1.2), D 1.4 å’Œ E 1.3. å®ƒå¯ä»¥ä¸¢å¼ƒ F 1.1 (ç”± C 1.3 æš—ç¤º) å’Œ G 1.1 (ä¹Ÿç”± C 1.3 æš—ç¤º).</p><h4 id="ç®—æ³•-3-å‡çº§ä¸€ä¸ªæ¨¡å—"><a href="#ç®—æ³•-3-å‡çº§ä¸€ä¸ªæ¨¡å—" class="headerlink" title="ç®—æ³• 3. å‡çº§ä¸€ä¸ªæ¨¡å—"></a>ç®—æ³• 3. å‡çº§ä¸€ä¸ªæ¨¡å—</h4><p>è°¨æ…çš„å¼€å‘äººå‘˜é€šå¸¸åªéœ€å‡çº§ä¸€ä¸ªæ¨¡å—, è€Œä¸å¿…å‡çº§æ‰€æœ‰æ¨¡å—, åªéœ€å°½å¯èƒ½å°‘åœ°æ›´æ”¹æ„å»ºåˆ—è¡¨. ä¾‹å¦‚, æˆ‘ä»¬å¯èƒ½æƒ³è¦å‡çº§åˆ° C 1.3, å¹¶ä¸”æˆ‘ä»¬ä¸å¸Œæœ›è¯¥æ“ä½œè¿›è¡Œä¸å¿…è¦çš„æ›´æ”¹, ä¾‹å¦‚å‡çº§åˆ° E 1.3. å’Œç®—æ³• 2 ä¸€æ ·, æˆ‘ä»¬å¯ä»¥å‡çº§ä¸€ä¸ªæ¨¡å—, æ–¹æ³•æ˜¯å‡çº§éœ€æ±‚å›¾, ä»ä¸­æ„é€ å‡ºä¸€ä¸ªæ„å»ºåˆ—è¡¨(ç®—æ³• 1), ç„¶åå°†è¯¥åˆ—è¡¨è¿˜åŸä¸ºé¡¶å±‚æ¨¡å—(ç®—æ³• R)çš„ä¸€ç»„éœ€æ±‚. ä¸ºäº†å‡çº§éœ€æ±‚å›¾, æˆ‘ä»¬ä»é¡¶å±‚æ¨¡å—æ·»åŠ ä¸€ä¸ªæ–°ç®­å¤´åˆ°å‡çº§åçš„æ¨¡å—ç‰ˆæœ¬.</p><p>ä¾‹å¦‚, å¦‚æœæˆ‘ä»¬æƒ³æ›´æ”¹ A çš„æ„å»ºä»¥å‡çº§åˆ° C 1.3, åˆ™æ­¤å¤„ä¸ºå‡çº§åçš„éœ€æ±‚å›¾:</p><p><img src="/static/images/version-select-4@2x.png" width="463px" height="272px"></p><p>åƒä»¥å‰ä¸€æ ·, æ–°çš„æ„å»ºåˆ—è¡¨çš„æ¨¡å—è¢«æ ‡è®°ä¸ºçº¢è‰², è€Œæ—§çš„æ„å»ºåˆ—è¡¨æ˜¯é»„è‰².</p><p>å‡çº§å¯¹æ„å»ºåˆ—è¡¨çš„å½±å“æ˜¯è¿›è¡Œå‡çº§çš„å”¯ä¸€æœ€ä½é™åº¦çš„æ–¹å¼, å¢åŠ äº†æ–°çš„æ¨¡å—ç‰ˆæœ¬ä»¥åŠä»»ä½•éšå«çš„è¦æ±‚, ä½†æ²¡æœ‰å…¶ä»–è¦æ±‚. è¯·æ³¨æ„, åœ¨æ„å»ºå‡çº§åçš„å›¾è¡¨æ—¶, æˆ‘ä»¬åªèƒ½æ·»åŠ æ–°ç®­å¤´, è€Œä¸èƒ½æ›¿æ¢æˆ–åˆ é™¤æ—§ç®­å¤´. ä¾‹å¦‚, å¦‚æœä» A åˆ° C 1.3 çš„æ–°ç®­å¤´å°†æ—§ç®­å¤´ä» A æ›´æ¢ä¸º C 1.2, åˆ™å‡çº§åçš„æ„å»ºåˆ—è¡¨å°†çœç•¥ D 1.4. ä¹Ÿå°±æ˜¯è¯´, C çš„å‡çº§ä¼šé™çº§ D, è¿™æ˜¯ä¸€ä¸ªæ„å¤–çš„, ä¸éœ€è¦çš„å’Œéæœ€å°çš„å˜åŒ–. ä¸€æ—¦æˆ‘ä»¬è®¡ç®—äº†å‡çº§çš„æ„å»ºåˆ—è¡¨, æˆ‘ä»¬å°±å¯ä»¥è¿è¡Œ(ä¸Šé¢çš„)ç®—æ³• R æ¥å†³å®šå¦‚ä½•æ›´æ–°éœ€æ±‚åˆ—è¡¨.<br>åœ¨è¿™ç§æƒ…å†µä¸‹, æˆ‘ä»¬æœ€ç»ˆä¼šç”¨ C 1.3 æ›¿æ¢ C 1.2, ä½†æ˜¯ä¹Ÿä¼šåœ¨ D 1.4 ä¸Šæ·»åŠ ä¸€ä¸ªæ–°çš„éœ€æ±‚, ä»¥é¿å… D çš„æ„å¤–é™çº§. è¯·æ³¨æ„, è¯¥é€‰æ‹©æ€§å‡çº§åªä¼šå°†å…¶ä»–æ¨¡å—æ›´æ–°ä¸º C çš„æœ€ä½éœ€æ±‚: C çš„å‡çº§ä¸ä¼šç®€å•åœ°è·å–æ¯ä¸ª C çš„æœ€æ–°ä¾èµ–é¡¹.</p><h4 id="ç®—æ³•-4-é™çº§ä¸€ä¸ªæ¨¡å—"><a href="#ç®—æ³•-4-é™çº§ä¸€ä¸ªæ¨¡å—" class="headerlink" title="ç®—æ³• 4. é™çº§ä¸€ä¸ªæ¨¡å—"></a>ç®—æ³• 4. é™çº§ä¸€ä¸ªæ¨¡å—</h4><p>æˆ‘ä»¬ä¹Ÿå¯èƒ½ä¼šåœ¨å‡çº§æ‰€æœ‰æ¨¡å—åå‘ç°, æœ€æ–°çš„æ¨¡å—ç‰ˆæœ¬æœ‰é—®é¢˜, è¿™å¿…é¡»é¿å…. åœ¨è¿™ç§æƒ…å†µä¸‹, æˆ‘ä»¬éœ€è¦èƒ½å¤Ÿé™çº§åˆ°æ—©æœŸç‰ˆæœ¬çš„æ¨¡å—. é™çº§ä¸€ä¸ªæ¨¡å—å¯èƒ½éœ€è¦é™çº§å…¶ä»–æ¨¡å—, ä½†æˆ‘ä»¬å¸Œæœ›é™çº§å°½å¯èƒ½å°‘çš„å…¶ä»–æ¨¡å—. åƒå‡çº§ä¸€æ ·, é™çº§å¿…é¡»é€šè¿‡ä¿®æ”¹ç›®æ ‡çš„éœ€æ±‚åˆ—è¡¨å¯¹å…¶è¿›è¡Œæ›´æ”¹. ä¸å‡çº§ä¸åŒ, é™çº§å¿…é¡»é€šè¿‡åˆ é™¤éœ€æ±‚æ¥å®ç°, è€Œä¸æ˜¯æ·»åŠ å®ƒä»¬. è¿™ä¸ªæƒ³æ³•å¼•å‡ºäº†ä¸€ä¸ªéå¸¸ç®€å•çš„é™çº§ç®—æ³•, å®ƒå¯ä»¥å•ç‹¬è€ƒè™‘æ¯ä¸ªç›®æ ‡çš„éœ€æ±‚. å¦‚æœéœ€æ±‚ä¸å»ºè®®çš„é™çº§ä¸å…¼å®¹(å³, å¦‚æœéœ€æ±‚çš„æ„å»ºåˆ—è¡¨åŒ…å«ç°åœ¨ä¸å…è®¸çš„æ¨¡å—ç‰ˆæœ¬), åˆ™ä¾æ¬¡å°è¯•è¾ƒæ—©çš„ç‰ˆæœ¬, ç›´è‡³æ‰¾åˆ°ä¸é™çº§å…¼å®¹çš„ç‰ˆæœ¬.</p><p>ä¾‹å¦‚, ä»åŸå§‹æ„å»ºå›¾å¼€å§‹, å‡è®¾æˆ‘ä»¬å‘ç° D 1.4 å­˜åœ¨é—®é¢˜, å®é™…ä¸Šæ˜¯åœ¨ D 1.3 ä¸­å¼•å…¥çš„, å› æ­¤æˆ‘ä»¬å†³å®šé™çº§åˆ° D 1.2. æˆ‘ä»¬çš„ç›®æ ‡æ¨¡å— A ä¾èµ–äº B 1.2 å’Œ C 1.2. è¦ä» D 1.4 é™çº§åˆ° D 1.2, æˆ‘ä»¬å¿…é¡»æ‰¾åˆ°æ—©æœŸç‰ˆæœ¬çš„ B å’Œ C, å®ƒä»¬ä¸éœ€è¦(ç›´æ¥æˆ–é—´æ¥çš„)æ™šäº D 1.2 ç‰ˆæœ¬.</p><p>è™½ç„¶æˆ‘ä»¬å¯ä»¥åˆ†åˆ«è€ƒè™‘æ¯ä¸ªéœ€æ±‚, ä½†å°†æ¨¡å—éœ€æ±‚å›¾ä½œä¸ºä¸€ä¸ªæ•´ä½“æ¥è€ƒè™‘ä¼šæ›´é«˜æ•ˆ. åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­, é™çº§è§„åˆ™ç›¸å½“äºåˆ é™¤ D çš„ä¸å¯ç”¨ç‰ˆæœ¬, ç„¶åä»ä¸å¯ç”¨æ¨¡å—å‘åçš„ç®­å¤´æŸ¥æ‰¾å’Œåˆ é™¤å…¶ä»–ä¸å¯ç”¨çš„æ¨¡å—. æœ€å, å‰©ä¸‹çš„ A çš„éœ€æ±‚çš„æœ€æ–°ç‰ˆæœ¬å¯ä»¥è®°å½•ä¸ºæ–°çš„éœ€æ±‚.</p><p><img src="/static/images/version-select-5@2x.png" width="463px" height="272px"></p><p>åœ¨è¿™ç§æƒ…å†µä¸‹, é™çº§åˆ° D 1.2 æ„å‘³ç€é™çº§åˆ° B 1.1 å’Œ C 1.1. ä¸ºäº†é¿å…ä¸å¿…è¦çš„é™çº§åˆ° E 1.1, æˆ‘ä»¬è¿˜å¿…é¡»åœ¨ E 1.2 ä¸Šæ·»åŠ æ–°çš„éœ€æ±‚. æˆ‘ä»¬å¯ä»¥åº”ç”¨ç®—æ³• R æ¥æ‰¾åˆ°å†™å…¥ go.mod çš„æœ€å°éœ€æ±‚é›†åˆ.</p><p>è¯·æ³¨æ„, å¦‚æœæˆ‘ä»¬å…ˆå‡çº§åˆ° C 1.3, é‚£ä¹ˆé™çº§åˆ° D 1.2 å°†ç»§ç»­ä½¿ç”¨ C 1.3, å®ƒæ ¹æœ¬ä¸ä½¿ç”¨ä»»ä½•ç‰ˆæœ¬çš„ D. ä½†é™çº§ä»…é™äºé™çº§è½¯ä»¶åŒ…, è€Œä¸æ˜¯å‡çº§è½¯ä»¶åŒ…; å¦‚æœéœ€è¦åœ¨é™çº§å‰è¿›è¡Œå‡çº§, ç”¨æˆ·å¿…é¡»æ˜ç¡®è¦æ±‚.</p><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>æœ€å°ç‰ˆæœ¬é€‰æ‹©éå¸¸ç®€å•. å®ƒé€šè¿‡æ¶ˆé™¤å…³äºç­”æ¡ˆæ˜¯ä»€ä¹ˆçš„æ‰€æœ‰çµæ´»æ€§æ¥å®ç°ç®€å•æ€§: æ„å»ºåˆ—è¡¨æ­£å¥½æ˜¯éœ€æ±‚ä¸­æŒ‡å®šçš„ç‰ˆæœ¬. çœŸæ­£çš„ç³»ç»Ÿéœ€è¦æ›´å¤§çš„çµæ´»æ€§, ä¾‹å¦‚æ’é™¤æŸäº›æ¨¡å—ç‰ˆæœ¬æˆ–æ›¿æ¢å…¶ä»–æ¨¡å—çš„èƒ½åŠ›. åœ¨æˆ‘ä»¬æ·»åŠ ä¹‹å‰, å€¼å¾—ç ”ç©¶å½“å‰ç³»ç»Ÿç®€å•æ€§çš„ç†è®ºåŸºç¡€, å› æ­¤æˆ‘ä»¬è¦ç†è§£å“ªç§æ‰©å±•ä¿ç•™ç®€å•æ€§, å“ªäº›ä¸å¿….</p><p>å¦‚æœæ‚¨ç†Ÿæ‚‰å¤§å¤šæ•°å…¶ä»–ç³»ç»Ÿå¤„ç†ç‰ˆæœ¬é€‰æ‹©çš„æ–¹å¼, æˆ–è€…ä½ è¿˜è®°å¾—æˆ‘ä¸€å¹´å‰å‘å¸ƒçš„ <a href="https://research.swtch.com/version-sat" target="_blank" rel="noopener">Version SAT</a> æ–‡ç« , å¯èƒ½æœ€å°ç‰ˆæœ¬é€‰æ‹©æœ€æ˜¾è‘—çš„ç‰¹å¾æ˜¯å®ƒä¸èƒ½è§£å†³ä¸€èˆ¬çš„å¸ƒå°”å¯æ»¡è¶³æ€§(Boolean satisfiability)æˆ– SAT. æ­£å¦‚æˆ‘åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­è§£é‡Šçš„é‚£æ ·, ç‰ˆæœ¬æœç´¢å¾ˆå°‘ç”¨äºè§£å†³ SAT; åœ¨è¿™äº›ç³»ç»Ÿä¸­çš„ç‰ˆæœ¬æœç´¢, æœ¬è´¨ä¸Šæ˜¯å¤æ‚çš„é—®é¢˜, æˆ‘ä»¬ä¸çŸ¥é“è¿™äº›é—®é¢˜æ˜¯å¦æœ‰é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆ. å¦‚æœæˆ‘ä»¬æƒ³é¿å…è¿™ç§å‘½è¿, æˆ‘ä»¬éœ€çŸ¥é“è¾¹ç•Œåœ¨å“ªé‡Œ, åœ¨æˆ‘ä»¬æ¢ç´¢è®¾è®¡ç©ºé—´çš„æ—¶å€™, å“ªé‡Œä¸è¯¥èµ°. æ–¹ä¾¿åœ°æ˜¯, Schaefer çš„äºŒåˆ†æ³•å®šç†ç²¾ç¡®åœ°æè¿°äº†è¿™äº›è¾¹ç•Œ. å®ƒç¡®å®šäº†å…­ä¸ªå¸ƒå°”å…¬å¼çš„é™åˆ¶ç±», å…¶å¯æ»¡è¶³æ€§å¯ä»¥åœ¨å¤šé¡¹å¼æ—¶é—´å†…ç¡®å®š, ç„¶åè¯æ˜å¯¹äºè¶…å‡ºè¿™äº›ç±»çš„ä»»ä½•ä¸€ç±»å…¬å¼, å¯æ»¡è¶³æ€§æ˜¯ NP å®Œå¤‡çš„. ä¸ºäº†é¿å… NP å®Œå¤‡æ€§, æˆ‘ä»¬éœ€è¦å°†ç‰ˆæœ¬é€‰æ‹©é—®é¢˜é™åˆ¶åœ¨ Schaefer çš„æŸä¸€é™åˆ¶ç±»ä¸­.</p><p>äº‹å®è¯æ˜, æœ€å°ç‰ˆæœ¬é€‰æ‹©ä½äºå…­ä¸ªæ˜“å¤„ç†çš„ SAT å­é—®é¢˜ä¸­çš„ä¸‰ä¸ªäº¤é›†: 2-SAT, Horn-SAT å’Œ Dual-Horn-SAT. ä¸æœ€å°ç‰ˆæœ¬é€‰æ‹©æ„å»ºç›¸å¯¹åº”çš„å…¬å¼æ˜¯ä¸€ç»„å­å¥çš„ AND, å…¶ä¸­æ¯ä¸ªå­å¥éƒ½æ˜¯å•ä¸ªæ­£æ–‡æœ¬(æ­¤ç‰ˆæœ¬å¿…é¡»å®‰è£…, ä¾‹å¦‚åœ¨å‡çº§æœŸé—´), å•ä¸ªè´Ÿæ–‡æœ¬(æ­¤ç‰ˆæœ¬ä¸å¯ç”¨, ä¾‹å¦‚åœ¨é™çº§æœŸé—´), æˆ–è€…ä¸€ä¸ªè´Ÿé¢å’Œä¸€ä¸ªæ­£é¢æ–‡å­—çš„ OR (æš—ç¤º: å¦‚æœå®‰è£…äº†æ­¤ç‰ˆæœ¬, åˆ™è¿˜å¿…é¡»å®‰è£…æ­¤å…¶ä»–ç‰ˆæœ¬). è¯¥å…¬å¼æ˜¯ä¸€ä¸ª 2-CNF å…¬å¼, å› ä¸ºæ¯ä¸ªå­å¥è‡³å¤šæœ‰ä¸¤ä¸ªå˜é‡. è¯¥å…¬å¼ä¹Ÿæ˜¯ä¸€ä¸ª Horn å…¬å¼, å› ä¸ºæ¯ä¸ªå­å¥æœ€å¤šåªæœ‰ä¸€ä¸ªæ­£æ–‡æœ¬. è¯¥å…¬å¼ä¹Ÿæ˜¯åŒé‡ Horn å…¬å¼, å› ä¸ºæ¯ä¸ªå­å¥æœ€å¤šåªæœ‰ä¸€ä¸ªè´Ÿæ–‡æœ¬. ä¹Ÿå°±æ˜¯è¯´, æœ€å°ç‰ˆæœ¬é€‰æ‹©å¸¦æ¥çš„æ¯ä¸ªå¯æ»¡è¶³æ€§é—®é¢˜éƒ½å¯ä»¥é€šè¿‡é€‰æ‹©ä¸‰ç§ä¸åŒçš„é«˜æ•ˆç®—æ³•æ¥è§£å†³. æ­£å¦‚æˆ‘ä»¬ä¸Šé¢æ‰€åšçš„é‚£æ ·, åˆ©ç”¨è¿™äº›é—®é¢˜çš„éå¸¸æœ‰é™çš„ç»“æ„æ¥è¿›ä¸€æ­¥ä¸“ä¸šåŒ–æ›´åŠ ç®€å•å’Œé«˜æ•ˆ.</p><p>è™½ç„¶ 2-SAT æ˜¯ SAT å­é—®é¢˜æœ€æœ‰åçš„ä¾‹å­, å¹¶ä¸”æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆ, ä½†è¿™äº›é—®é¢˜éƒ½æ˜¯ Horn å’ŒåŒé‡ Horn å…¬å¼çš„äº‹å®æ›´æœ‰è¶£. æ¯ä¸ª Horn å…¬å¼éƒ½æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„ä»¤äººæ»¡æ„çš„åˆ†é…, æœ€å°‘çš„å˜é‡è®¾ç½®ä¸º true. è¿™è¯æ˜äº†æ„é€ æ„å»ºåˆ—è¡¨ä»¥åŠæ¯æ¬¡å‡çº§éƒ½æœ‰å”¯ä¸€çš„æœ€å°ç­”æ¡ˆ. é™¤éç»å¯¹å¿…è¦, å¦åˆ™ç‹¬ç‰¹çš„æœ€å°å‡çº§ä¸ä¼šä½¿ç”¨ç»™å®šæ¨¡å—çš„è¾ƒæ–°ç‰ˆæœ¬. ç›¸å, æ¯ä¸ªåŒé‡ Horn å…¬å¼ä¹Ÿå…·æœ‰ç‹¬ç‰¹çš„ä»¤äººæ»¡æ„çš„åˆ†é…, å…¶ä¸­æœ€å°‘çš„å˜é‡è®¾ç½®ä¸º false. è¿™è¯æ˜æ¯ä¸ªé™çº§éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æœ€å°ç­”æ¡ˆ. é™¤éç»å¯¹å¿…è¦, å¦åˆ™ç‹¬ç‰¹çš„æœ€ä½çº§åˆ«é™çº§ä¸ä¼šä½¿ç”¨ç»™å®šæ¨¡å—çš„è¾ƒæ—§ç‰ˆæœ¬. å¦‚æœæˆ‘ä»¬æƒ³æ‰©å±•æœ€å°ç‰ˆæœ¬é€‰æ‹©, ä¾‹å¦‚æ’é™¤æŸäº›æ¨¡å—çš„èƒ½åŠ›, æˆ‘ä»¬åªèƒ½é€šè¿‡ç»§ç»­ä½¿ç”¨å¯è¡¨ç¤ºä¸º Horn å’ŒåŒé‡ Hornå…¬å¼çš„çº¦æŸæ¥ä¿æŒå”¯ä¸€æ€§å’Œæœ€å°åŒ–å±æ€§.</p><p>(æ’ä¸€å¥: æœ€å°ç‰ˆæœ¬é€‰æ‹©è§£å†³çš„é—®é¢˜æ˜¯ NL å®Œå¤‡é—®é¢˜: å› ä¸º NL æ˜¯ 2-SAT çš„ä¸€ä¸ªå­é›†, å¹¶ä¸”å®ƒæ˜¯ NL-hard é—®é¢˜, å› ä¸º st-connectivity å¯ä»¥ç®€å•åœ°è½¬æ¢ä¸ºæœ€å°ç‰ˆæœ¬é€‰æ‹©æ„å»ºåˆ—è¡¨æ„é€ é—®é¢˜. ä»¤äººæ„‰å¿«çš„æ˜¯æˆ‘ä»¬å·²ç»ç”¨ä¸€ä¸ª NL å®Œå¤‡é—®é¢˜å–ä»£äº†ä¸€ä¸ª NP å®Œå¤‡é—®é¢˜, ä½†æ˜¯çŸ¥é“è¿™ä¸€ç‚¹å‡ ä¹æ²¡æœ‰ä»€ä¹ˆå®é™…ä»·å€¼: NL åªä¿è¯ä¸€ä¸ªå¤šé¡¹å¼æ—¶é—´è§£, è€Œæˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªçº¿æ€§æ—¶é—´è§£.</p><h3 id="æ’é™¤æ¨¡å—"><a href="#æ’é™¤æ¨¡å—" class="headerlink" title="æ’é™¤æ¨¡å—"></a>æ’é™¤æ¨¡å—</h3><p>æœ€å°ç‰ˆæœ¬é€‰æ‹©å§‹ç»ˆé€‰æ‹©æ»¡è¶³æ„å»ºæ€»ä½“è¦æ±‚çš„æœ€å°(æœ€æ—§)æ¨¡å—ç‰ˆæœ¬. å¦‚æœè¯¥ç‰ˆæœ¬ä»¥æŸç§æ–¹å¼å‡ºç°é—®é¢˜, åˆ™å‡çº§æˆ–é™çº§æ“ä½œå¯ä»¥ä¿®æ”¹é¡¶çº§ç›®æ ‡çš„éœ€æ±‚åˆ—è¡¨ä»¥å¼ºåˆ¶é€‰æ‹©ä¸åŒçš„ç‰ˆæœ¬.</p><p>æ˜ç¡®è®°å½•è¯¥ç‰ˆæœ¬æœ‰é—®é¢˜ä¹Ÿå¾ˆæœ‰ç”¨, ä»¥é¿å…åœ¨å°†æ¥çš„å‡çº§æˆ–é™çº§æ“ä½œä¸­é‡æ–°å¼•å…¥è¯¥ç‰ˆæœ¬. ä½†æ˜¯æˆ‘ä»¬å¸Œæœ›ä»¥ä¿æŒå‰ä¸€èŠ‚çš„å”¯ä¸€æ€§å’Œæœ€å°æ€§çš„æ–¹å¼æ¥åšåˆ°è¿™ä¸€ç‚¹, æ‰€ä»¥æˆ‘ä»¬å¿…é¡»ä½¿ç”¨ Horn å’ŒåŒé‡ Hornå…¬å¼çš„çº¦æŸæ¡ä»¶. è¿™æ„å‘³ç€æ„å»ºçº¦æŸåªèƒ½æ˜¯æ— æ¡ä»¶çš„è‚¯å®šæ–­è¨€(å¿…é¡»å®‰è£… X:X), æ— æ¡ä»¶çš„å¦å®šæ–­è¨€(Â¬Y:Y ä¸èƒ½å®‰è£…)å’Œæ­£é¢å«ä¹‰(Xâ†’Z, ç­‰ä»·äº Xâˆ¨Z: å¦‚æœ X å·²å®‰è£…, é‚£ä¹ˆ Z å¿…é¡»å®‰è£…). å¦å®šçš„å«ä¹‰(Xâ†’Â¬Y, ç­‰åŒäº Â¬Xâˆ¨Â¬Y: å¦‚æœå®‰è£…äº† X, é‚£ä¹ˆ Y ä¸èƒ½å®‰è£…)ä¸èƒ½ä½œä¸ºçº¦æŸæ·»åŠ å´ä¸ç ´åè¡¨å•. å› æ­¤æ¨¡å—æ’é™¤å¿…é¡»æ˜¯æ— æ¡ä»¶çš„: å®ƒä»¬å¿…é¡»ç‹¬ç«‹äºæ„å»ºåˆ—è¡¨æ„é€ æœŸé—´çš„é€‰æ‹©è€Œå†³å®š.</p><p>æˆ‘ä»¬å¯ä»¥åšçš„æ˜¯å…è®¸ä¸€ä¸ªæ¨¡å—å£°æ˜å®ƒè‡ªå·±çš„æ’é™¤æ¨¡å—ç‰ˆæœ¬çš„æœ¬åœ°åˆ—è¡¨. å°±æœ¬åœ°è€Œè¨€, æˆ‘çš„æ„æ€æ˜¯ä»…åœ¨è¯¥æ¨¡å—å†…éƒ¨å»ºç«‹è¯¥åˆ—è¡¨æ‰è¢«æŸ¥é˜…; å°†æ¨¡å—ç”¨ä½œä¾èµ–çš„è¾ƒå¤§æ„å»ºä¼šå¿½ç•¥æ’é™¤åˆ—è¡¨. åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­, å¦‚æœ A çš„æ„å»ºå‚è€ƒäº† D 1.3 çš„åˆ—è¡¨, é‚£ä¹ˆç¡®åˆ‡çš„æ’é™¤é›†åˆå°†å–å†³äºæ„å»ºæ˜¯é€‰æ‹©äº† D 1.3 è¿˜æ˜¯ D 1.4, ä»è€Œä½¿æ’é™¤æ¡ä»¶å˜å¾—æœ‰æ¡ä»¶å¹¶å¯¼è‡´ NP-å®Œå¤‡ æœç´¢é—®é¢˜. åªæœ‰é¡¶å±‚æ¨¡å—ä¿è¯åœ¨æ„å»ºä¸­, å› æ­¤åªä½¿ç”¨é¡¶å±‚æ¨¡å—çš„æ’é™¤åˆ—è¡¨. è¯·æ³¨æ„ï¼Œåªè¦åœ¨å¼€å§‹æ„å»ºä¹‹å‰å†³å®šä½¿ç”¨åˆ—è¡¨, å¹¶ä¸”åˆ—è¡¨å†…å®¹ä¸ä¾èµ–äºå“ªäº›æ¨¡å—, å°±å¯ä»¥å‚è€ƒå…¶ä»–æ¥æºçš„æ’é™¤åˆ—è¡¨, ä¾‹å¦‚é€šè¿‡ç½‘ç»œåŠ è½½çš„å…¨å±€æ’é™¤åˆ—è¡¨åœ¨æ„å»ºæœŸé—´è¢«é€‰ä¸­.</p><p>å°½ç®¡æ‰€æœ‰å…³æ³¨ç‚¹éƒ½æ˜¯æ— æ¡ä»¶æ’é™¤, ä½†ä¼¼ä¹æˆ‘ä»¬å·²ç»æœ‰æœ‰æ¡ä»¶æ’é™¤: C 1.2 éœ€è¦ D 1.4, å› æ­¤æš—å«æ’é™¤ D 1.3. ä½†æ˜¯æˆ‘ä»¬çš„ç®—æ³•ä¸ä¼šå°†å…¶è§†ä¸ºæ’é™¤. å½“ç®—æ³• 1 è¿è¡Œæ—¶, å®ƒå°† D 1.3(å¯¹äº B)å’Œ D 1.4(å¯¹äº C)éƒ½æ·»åŠ åˆ°ç²—ç•¥æ„å»ºåˆ—è¡¨è¿åŒå®ƒä»¬çš„æœ€ä½è¦æ±‚. åªæœ‰ D 1.4 å­˜åœ¨, æœ€ç»ˆçš„ç®€åŒ–è¿‡ç¨‹æ‰ä¼šåˆ é™¤ D 1.3. è¿™ç§å£°æ˜ä¸å…¼å®¹æ€§å’Œå£°æ˜æœ€ä½è¦æ±‚ä¹‹é—´çš„åŒºåˆ«è‡³å…³é‡è¦. å£°æ˜ä¸å¾—ä½¿ç”¨ D 1.3 æ„å»º C 1.2, åªæè¿°å¦‚ä½•å¤±è´¥. å£°æ˜ C 1.2 å¿…é¡»ç”¨ D 1.4 æ„å»º, è€Œä¸æ˜¯æè¿°å¦‚ä½•æˆåŠŸ.</p><p>æ’é™¤å¿…é¡»æ˜¯æ— æ¡ä»¶çš„. çŸ¥é“è¿™ä¸ªäº‹å®å¾ˆé‡è¦, ä½†å®ƒå¹¶æ²¡æœ‰å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•å®æ–½æ’é™¤. ä¸€ä¸ªç®€å•çš„ç­”æ¡ˆæ˜¯æ·»åŠ æ’é™¤ä½œä¸ºæ„å»ºçº¦æŸ, åƒ â€œD 1.3 ä¸èƒ½å®‰è£…â€ è¿™æ ·çš„å­å¥. ä¸å¹¸çš„æ˜¯, å•ç‹¬æ·»åŠ è¯¥å­å¥ä¼šå¯¼è‡´éœ€è¦ D 1.3 çš„æ¨¡å—(å¦‚ B 1.2)å¯ä»¥è¢«å¸è½½. æˆ‘ä»¬éœ€è¦ä»¥æŸç§æ–¹å¼è¡¨è¾¾ B 1.2 å¯ä»¥é€‰æ‹© D 1.4. è¿™æ ·åšçš„ç®€å•æ–¹æ³•æ˜¯ä¿®æ”¹æ„å»ºçº¦æŸ, å°† â€œB 1.2 â†’ D 1.3â€ æ›´æ”¹ä¸º â€œB 1.2 â†’ D 1.3 âˆ¨ D 1.4â€, å¹¶ä¸”é€šå¸¸å…è®¸æ‰€æœ‰å°†æ¥çš„ D ç‰ˆæœ¬. ä½†æ˜¯è¯¥æ¡æ¬¾(ç­‰åŒäº B 1.2 âˆ¨ D 1.3 âˆ¨ D 1.4) æœ‰ä¸¤ä¸ªæ­£é¢æ–‡å­—, ä½¿æ•´ä½“æ„å»ºå…¬å¼ä¸å†æ˜¯ Horn å…¬å¼. å®ƒä»ç„¶æ˜¯ä¸€ä¸ªåŒé‡ Horn å…¬å¼, æ‰€ä»¥æˆ‘ä»¬ä»ç„¶å¯ä»¥å®šä¹‰ä¸€ä¸ªçº¿æ€§æ—¶é—´æ„å»ºåˆ—è¡¨æ„é€ , ä½†æ˜¯æ„é€  - ä¹Ÿå°±æ˜¯å¦‚ä½•æ‰§è¡Œå‡çº§çš„é—®é¢˜ - å°†ä¸å†ä¿è¯å…·æœ‰å”¯ä¸€çš„, æœ€å°çš„ç­”æ¡ˆ.</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å˜ç°æœ‰çš„çº¦æŸæ¥å®ç°å®ƒä»¬, è€Œä¸æ˜¯å°†æ’é™¤ä½œä¸ºæ–°çš„çº¦æŸæ¡ä»¶æ¥å®æ–½. ä¹Ÿå°±æ˜¯è¯´, æˆ‘ä»¬å¯ä»¥ä¿®æ”¹éœ€æ±‚å›¾, å°±åƒæˆ‘ä»¬å‡çº§å’Œé™çº§ä¸€æ ·. å¦‚æœä¸€ä¸ªç‰¹å®šçš„æ¨¡å—è¢«æ’é™¤, é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†å®ƒä»æ¨¡å—éœ€æ±‚å›¾ä¸­ç§»é™¤, ä½†ä¹Ÿå¯ä»¥æ”¹å˜è¯¥æ¨¡å—ä¸Šçš„ä»»ä½•ç°æœ‰éœ€æ±‚, ä»¥ä¾¿ç”¨ä¸‹ä¸€ä¸ªæ›´æ–°çš„ç‰ˆæœ¬æ›¿ä»£. ä¾‹å¦‚, å¦‚æœæˆ‘ä»¬æ’é™¤ D 1.3, é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿä¼šæ›´æ–° B 1.2 ä»¥è¦æ±‚ D 1.4:</p><p><img src="/static/images/version-select-6@2x.png" width="463px" height="272px"></p><p>å¦‚æœåˆ é™¤äº†æœ€æ–°ç‰ˆæœ¬çš„æ¨¡å—, åˆ™éœ€è¦åˆ é™¤ä»»ä½•éœ€è¦è¯¥ç‰ˆæœ¬çš„æ¨¡å—, å¦‚é™çº§ç®—æ³•ä¸­æ‰€è¿°. ä¾‹å¦‚, å¦‚æœ G 1.1 è¢«ç§»é™¤, é‚£ä¹ˆ C 1.3 ä¹Ÿéœ€è¦è¢«ç§»é™¤.</p><p>ä¸€æ—¦æ’é™¤å·²è¢«åº”ç”¨åˆ°æ¨¡å—éœ€æ±‚å›¾ä¸­, ç®—æ³•å°±åƒä»¥å‰ä¸€æ ·ç»§ç»­.</p><h3 id="æ›´æ¢æ¨¡å—"><a href="#æ›´æ¢æ¨¡å—" class="headerlink" title="æ›´æ¢æ¨¡å—"></a>æ›´æ¢æ¨¡å—</h3><p>åœ¨ A çš„å¼€å‘è¿‡ç¨‹ä¸­, å‡è®¾æˆ‘ä»¬åœ¨ D 1.4 ä¸­å‘ç°äº†ä¸€ä¸ª bug, æˆ‘ä»¬æƒ³æµ‹è¯•ä¸€ä¸ªæ½œåœ¨çš„ä¿®å¤. æˆ‘ä»¬éœ€è¦ä¸€äº›æ–¹æ³•æ¥å°†æˆ‘ä»¬çš„æ„å»ºä¸­çš„ D 1.4 æ›¿æ¢ä¸ºæœªå‘å¸ƒçš„å‰¯æœ¬ U. æˆ‘ä»¬å¯ä»¥å…è®¸ä¸€ä¸ªæ¨¡å—å°†å…¶å£°æ˜ä¸ºæ›¿æ¢: â€œå°±åƒ D 1.4 çš„æºç å’Œéœ€æ±‚æ¨¡å—å·²ç»è¢« U çš„æ›¿æ¢äº†ä¸€æ ·ç»§ç»­å‰è¡Œâ€.</p><p>å’Œæ’é™¤ä¸€æ ·, æ›¿æ¢å¯ä»¥é€šè¿‡åœ¨é¢„å¤„ç†æ­¥éª¤ä¸­ä¿®æ”¹æ¨¡å—éœ€æ±‚å›¾æ¥å®ç°, è€Œä¸æ˜¯é€šè¿‡å¢åŠ å¤„ç†å›¾çš„ç®—æ³•å¤æ‚åº¦æ¥å®ç°. ä¸æ’é™¤ä¸€æ ·, æ›¿æ¢åˆ—è¡¨å¯¹äºä¸€ä¸ªæ¨¡å—ä¹Ÿæ˜¯æœ¬åœ°çš„. A çš„æ„å»ºå‚è€ƒ A çš„æ›¿æ¢åˆ—è¡¨, è€Œä¸æ˜¯æ¥è‡ª B 1.2, C 1.2 æˆ–æ„å»ºä¸­çš„ä»»ä½•å…¶ä»–æ¨¡å—çš„. è¿™é¿å…äº†æœ‰æ¡ä»¶çš„æ›¿æ¢, é‚£å°†éš¾ä»¥å®ç°, å¹¶ä¸”è¿˜é¿å…äº†æ›¿æ¢å†²çªçš„å¯èƒ½æ€§: å¦‚æœ B 1.2 å’Œ C 1.2 ä¸º E 1.2 æŒ‡å®šäº†ä¸åŒçš„æ›¿æ¢é¡¹, è¯¥æ€ä¹ˆåŠ ? æ›´ä¸€èˆ¬åœ°è¯´, ä¿æŒä¸€ä¸ªæ¨¡å—çš„æœ¬åœ°æ’é™¤å’Œæ›¿æ¢é™åˆ¶äº†è¯¥æ¨¡å—å¯¹å…¶ä»–æ„å»ºçš„æ§åˆ¶.</p><h3 id="è°æ§åˆ¶ä½ çš„æ„å»º"><a href="#è°æ§åˆ¶ä½ çš„æ„å»º" class="headerlink" title="è°æ§åˆ¶ä½ çš„æ„å»º"></a>è°æ§åˆ¶ä½ çš„æ„å»º</h3><p>é¡¶å±‚æ¨¡å—çš„ä¾èµ–å…³ç³»å¿…é¡»å¯¹é¡¶å±‚æ„å»ºè¿›è¡Œä¸€å®šçš„æ§åˆ¶. B 1.2 éœ€è¦èƒ½å¤Ÿç¡®ä¿å®ƒæ˜¯ç”¨ D 1.3 æˆ–æ›´é«˜ç‰ˆæœ¬æ„å»ºçš„, è€Œä¸æ˜¯ D 1.2. å¦åˆ™, æˆ‘ä»¬ä¼šç»“æŸå½“å‰çš„ go get è¿‡æ—¶ä¾èµ–å¤±è´¥æ¨¡å¼.</p><p>åŒæ—¶, ä¸ºäº†ä½¿æ„å»ºä¿æŒå¯é¢„æµ‹æ€§å’Œå¯ç†è§£æ€§, æˆ‘ä»¬ä¸èƒ½ä¾èµ–å¯¹é¡¶çº§æ„å»ºçš„ä»»æ„ç»†ç²’åº¦æ§åˆ¶. è¿™ä¼šå¯¼è‡´å†²çªå’Œæ„å¤–. ä¾‹å¦‚, å‡è®¾ B å£°æ˜å®ƒéœ€è¦ D çš„å¶æ•°ç‰ˆæœ¬, è€Œ C å£°æ˜å®ƒéœ€è¦ D çš„ç´ æ•°ç‰ˆæœ¬. D ç»å¸¸æ›´æ–°å¹¶ä¸”è¾¾åˆ° D 1.99. å•ç‹¬ä½¿ç”¨ B æˆ– C, æ€»æ˜¯å¯ä»¥ä½¿ç”¨ç›¸å¯¹è¾ƒæ–°ç‰ˆæœ¬çš„ D (åˆ†åˆ«ä¸º D 1.98 æˆ– D 1.97). ä½†æ˜¯å½“ A åŒæ—¶ä½¿ç”¨ B å’Œ C æ—¶, æ„å»ºä¼šé»˜é»˜åœ°é€‰æ‹©æ›´è€çš„(å¹¶ä¸”æ›´ç¼“æ…¢çš„) D 1.2. è¿™æ˜¯ä¸€ä¸ªæç«¯çš„ä¾‹å­, ä½†å®ƒæå‡ºäº†ä¸€ä¸ªé—®é¢˜: ä¸ºä»€ä¹ˆ B å’Œ C çš„ä½œè€…åº”è¯¥å¯¹ A çš„æ„å»ºæœ‰å¦‚æ­¤çš„æç«¯æ§åˆ¶ ? åœ¨æˆ‘å†™è¿™ç¯‡æ–‡ç« æ—¶, æœ‰ä¸€ä¸ª<a href="https://github.com/kubernetes/client-go/issues/325" target="_blank" rel="noopener">å¼€æ”¾çš„ bug æŠ¥å‘Š</a>, Kubernetes Go å®¢æˆ·ç«¯å£°æ˜äº†ä¸€ä¸ªéœ€æ±‚, å®ƒä¾èµ–äº gopkg.in/yaml.v2 ä¸¤å¹´å‰çš„ä¸€ä¸ªç‰¹å®šç‰ˆæœ¬. å½“å¼€å‘äººå‘˜å°è¯•åœ¨å·²ä½¿ç”¨ Kubernetes Go å®¢æˆ·ç«¯çš„ç¨‹åºä¸­ä½¿ç”¨è¯¥ YAML åº“çš„æ–°åŠŸèƒ½æ—¶, å³ä½¿å°è¯•å‡çº§åˆ°æœ€æ–°çš„å¯èƒ½ç‰ˆæœ¬å, ä½¿ç”¨æ–°åŠŸèƒ½çš„ä»£ç ä»æ— æ³•ç¼–è¯‘, å› ä¸º â€œlatestâ€ å—é™äº Kubernetes çš„éœ€æ±‚. åœ¨è¿™ç§æƒ…å†µä¸‹, ä½¿ç”¨ä¸¤å¹´å‰çš„ YAML åº“ç‰ˆæœ¬åœ¨ Kubernetes ä»£ç åº“çš„èƒŒæ™¯ä¸‹å¯èƒ½æ˜¯å®Œå…¨åˆç†çš„. æ˜¾ç„¶ Kubernetes ä½œè€…åº”è¯¥å®Œå…¨æ§åˆ¶è‡ªå·±çš„æ„å»º, ä½†æ˜¯è¿™ç§æ§åˆ¶çº§åˆ«æ‰©å±•åˆ°å…¶ä»–å¼€å‘äººå‘˜çš„æ„å»ºæ²¡æœ‰ä»»ä½•æ„ä¹‰.</p><p>åœ¨æ¨¡å—éœ€æ±‚, æ’é™¤å’Œæ›¿æ¢çš„è®¾è®¡ä¸­, æˆ‘è¯•å›¾å¹³è¡¡å…è®¸ä¾èµ–è¶³å¤Ÿæ§åˆ¶çš„ç«äº‰å…³æ³¨, ä»¥ç¡®ä¿æˆåŠŸæ„å»º, è€Œä¸å…è®¸ä»–ä»¬è¿›è¡Œå¤ªå¤šæ§åˆ¶, ä»è€ŒæŸå®³æ„å»º. æœ€ä½éœ€æ±‚çš„ç»“åˆæ²¡æœ‰å†²çª, æ‰€ä»¥ä»æ‰€æœ‰ä¾èµ–ä¸­æ”¶é›†å®ƒä»¬æ˜¯å¯è¡Œçš„(ç”šè‡³å®¹æ˜“çš„). ä½†æ’é™¤å’Œæ›¿æ¢å¯ä»¥å¹¶ä¸”ä¼šå‘ç”Ÿå†²çª, æ‰€ä»¥æˆ‘ä»¬åªå…è®¸å®ƒä»¬ç”±é¡¶å±‚æ¨¡å—æŒ‡å®š.</p><p>å› æ­¤, æ¨¡å—ä½œè€…å®Œå…¨æ§åˆ¶äº†è¯¥æ¨¡å—çš„æ„å»º, å› ä¸ºå®ƒæ˜¯æ­£åœ¨æ„å»ºçš„ä¸»è¦ç¨‹åº, ä½†ä¸èƒ½å®Œå…¨æ§åˆ¶ä¾èµ–äºæ¨¡å—çš„å…¶ä»–ç”¨æˆ·çš„æ„å»º. æˆ‘ç›¸ä¿¡å¯¹äºæ¯”ç°æœ‰ç³»ç»Ÿæ›´å¤§, æ›´åˆ†æ•£çš„ä»£ç åº“æ¥è¯´, è¿™ç§åŒºåˆ«å°†ä½¿ç‰ˆæœ¬é€‰æ‹©è§„æ¨¡æœ€å°åŒ–.</p><h3 id="é«˜ä¿çœŸæ„å»º"><a href="#é«˜ä¿çœŸæ„å»º" class="headerlink" title="é«˜ä¿çœŸæ„å»º"></a>é«˜ä¿çœŸæ„å»º</h3><p>ç°åœ¨å›åˆ°é«˜ä¿çœŸæ„å»ºçš„é—®é¢˜.</p><p>åœ¨æ–‡ç« çš„å¼€å¤´, æˆ‘ä»¬çœ‹åˆ°, ä½¿ç”¨ go get æ„å»º A, å¯ä»¥ä½¿ç”¨ä¸åŒäº A çš„ä½œè€…æ‰€ä½¿ç”¨çš„ä¾èµ–, æ²¡æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç†ç”±. æˆ‘æŠŠå®ƒç§°ä¸ºä½ä¿çœŸæ„å»º, å› ä¸ºå®ƒæ˜¯ A çš„åŸå§‹æ„å»ºçš„è¾ƒå·®å†ç°. ä½¿ç”¨æœ€å°ç‰ˆæœ¬é€‰æ‹©, æ„å»ºæ˜¯é«˜ä¿çœŸçš„. æ¨¡å—çš„æºä»£ç ä¸­åŒ…å«çš„æ¨¡å—éœ€æ±‚å”¯ä¸€ç¡®å®šäº†å¦‚ä½•ç›´æ¥æ„å»ºå®ƒ. ç”¨æˆ·æ„å»ºçš„ A å°†å®Œå…¨åŒ¹é…ä½œè€…çš„æ„å»º: å¯å¤åˆ¶æ„å»º. ä½†é«˜ä¿çœŸæ„å‘³ç€æ›´å¤š.</p><p>å¯å¤åˆ¶æ„å»ºé€šå¸¸è¢«ç†è§£ä¸ºæ•´ä¸ªç¨‹åºæ„å»ºçš„äºŒå…ƒå±æ€§: ç”¨æˆ·çš„æ„å»ºä¸ä½œè€…å®Œå…¨ç›¸åŒ, æˆ–è€…ä¸ç›¸åŒ. åœ¨æ„å»ºä¸€ä¸ªåº“æ¨¡å—ä½œä¸ºå¤§å‹ç¨‹åºçš„ä¸€éƒ¨åˆ†æ—¶å‘¢ ? ç”¨æˆ·æ„å»ºä¸€ä¸ªåº“ä¸ä½œè€…çš„æ„å»ºå°½å¯èƒ½åŒ¹é…æ—¶å¾ˆæœ‰å¸®åŠ©çš„. ç„¶åç”¨æˆ·è¿è¡Œä½œè€…å¼€å‘å’Œæµ‹è¯•çš„ç›¸åŒä»£ç (åŒ…æ‹¬ä¾èµ–). å½“ç„¶, åœ¨ä¸€ä¸ªæ›´å¤§çš„é¡¹ç›®ä¸­, ç”¨æˆ·æ„å»ºä¸€ä¸ªåº“å¯èƒ½æ— æ³•å®Œå…¨åŒ¹é…ä½œè€…çš„æ„å»º. è¯¥æ„å»ºçš„å¦ä¸€éƒ¨åˆ†å¯èƒ½ä¼šå¼ºåˆ¶ä½¿ç”¨æ›´æ–°çš„ä¾èµ–, ä»è€Œä½¿ç”¨æˆ·çš„åº“æ„å»ºåç¦»ä½œè€…çš„æ„å»º. å½“åªæ˜¯ä¸ºäº†æ»¡è¶³æ„å»ºä¸­å…¶ä»–åœ°æ–¹çš„éœ€æ±‚æ—¶, æ„å»ºåç¦»äº†ä½œè€…è‡ªå·±çš„æ„å»º, æˆ‘ä»¬å°†æ„å»ºç§°ä¸ºé«˜ä¿çœŸçš„æ„å»º.</p><p>å†è€ƒè™‘ä¸€ä¸‹æˆ‘ä»¬æœ€åˆçš„ä¾‹å­:</p><p><img src="/static/images/version-select-1@2x.png" width="463px" height="272px"></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, è™½ç„¶ B çš„ä½œè€…ä½¿ç”¨ D 1.3, ä½† A çš„å†…éƒ¨ç»“åˆäº† B 1.2 å’Œ D 1.4. è¿™ç§æ”¹å˜æ˜¯å¿…è¦çš„, å› ä¸º A ä¹Ÿä½¿ç”¨ C 1.2, è€Œå®ƒéœ€è¦ D 1.4. A çš„æ„å»ºä»ç„¶æ˜¯ B 1.2 çš„é«˜ä¿çœŸæ„å»º: å®ƒé€šè¿‡ä½¿ç”¨ D 1.4 è€Œåç¦», ä½†ä»…ä»…å› ä¸ºé‚£æ˜¯å¿…é¡»çš„. ç›¸å, å¦‚æœæ„å»ºä½¿ç”¨ E 1.3, å¦‚ get -u, Dep å’Œ Cargo é€šå¸¸æ‰€åšçš„é‚£æ ·, æ„å»ºå°†ä¼šæ˜¯ä½ä¿çœŸæ„å»º: å› ä¸ºå®ƒæ˜¯ä¸å¿…è¦åœ°åç¦»çš„.</p><p>æœ€å°ç‰ˆæœ¬é€‰æ‹©é€šè¿‡ä½¿ç”¨æ»¡è¶³éœ€æ±‚çš„æœ€æ—§ç‰ˆæœ¬æ¥æä¾›é«˜ä¿çœŸæ„å»º. æ–°ç‰ˆæœ¬çš„å‘å¸ƒå¯¹æ„å»ºæ²¡æœ‰å½±å“. ç›¸æ¯”ä¹‹ä¸‹, åŒ…æ‹¬ Cargo å’Œ Dep åœ¨å†…çš„å¤§å¤šæ•°å…¶ä»–ç³»ç»Ÿä½¿ç”¨å¯ç”¨çš„æœ€æ–°ç‰ˆæœ¬, ä»¥æ»¡è¶³ â€œmanifest fileâ€ ä¸­åˆ—å‡ºçš„éœ€æ±‚. æ–°ç‰ˆæœ¬çš„å‘å¸ƒä¼šæ›´æ”¹å…¶æ„å»ºå†³ç­–. ä¸ºäº†è·å¾—å¯å¤åˆ¶çš„æ„å»º, è¿™äº›ç³»ç»Ÿæ·»åŠ äº†ç¬¬äºŒç§æœºåˆ¶, å³ â€œlock fileâ€, å®ƒåˆ—å‡ºäº†æ„å»ºåº”è¯¥ä½¿ç”¨çš„ç‰¹å®šç‰ˆæœ¬. é”å®šæ–‡ä»¶ç¡®ä¿äº†æ•´ä¸ªç¨‹åºçš„å¯å¤åˆ¶æ„å»º, ä½†æ˜¯å¯¹äºåº“æ¨¡å—å®ƒå´è¢«å¿½ç•¥; <a href="http://doc.crates.io/faq.html#why-do-binaries-have-cargolock-in-version-control-but-not-libraries" target="_blank" rel="noopener">Cargo FAQ</a> è§£é‡Šè¯´è¿™æ˜¯ â€œè¿™æ­£æ˜¯å› ä¸ºåº“ä¸åº”è¯¥è¢«å®ƒçš„æ‰€æœ‰ç”¨æˆ·è¿›è¡Œç¡®å®šæ€§çš„é‡æ–°ç¼–è¯‘â€. ç¡®å®, å®Œç¾çš„å¤åˆ¶å¹¶ä¸æ€»æ˜¯å¯èƒ½çš„, ä½†é€šè¿‡å®Œå…¨æ”¾å¼ƒ, Cargo æ–¹æ¡ˆæ‰¿è®¤ä¸å¿…è¦çš„åç¦»åº“ä½œè€…çš„æ„å»º. ä¹Ÿå°±æ˜¯è¯´, å®ƒæä¾›äº†ä½ä¿çœŸæ„å»º. åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­, å½“ A é¦–å…ˆå°† B 1.2 æˆ– C 1.2 æ·»åŠ åˆ°å…¶æ„å»ºä¸­æ—¶, Cargo ä¼šçœ‹åˆ°å®ƒä»¬éœ€è¦ E 1.2 æˆ–æ›´é«˜ç‰ˆæœ¬, å¹¶ä¸”ä¼šé€‰æ‹© E 1.3. ç„¶è€Œ, ç›´åˆ°å¦å¤–æŒ‡ç¤º, ä½œä¸º B å’Œ C çš„ä½œè€…, ç»§ç»­ç”¨ E 1.2 æ„å»ºå®ƒä¼¼ä¹æ›´å¥½. ä½¿ç”¨æœ€æ—§çš„å…è®¸ç‰ˆæœ¬è¿˜æ¶ˆé™¤äº†å…·æœ‰ä¸¤ä¸ªä¸åŒæ–‡ä»¶(manifest å’Œ lock)çš„å†—ä½™, è¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½æŒ‡å®šè¦ä½¿ç”¨å“ªäº›æ¨¡å—ç‰ˆæœ¬.</p><p>è‡ªåŠ¨ä½¿ç”¨è¾ƒæ–°çš„ç‰ˆæœ¬ä¹Ÿä½¿å¾—æœ€ä½éœ€æ±‚å®¹æ˜“å‡ºé”™. å‡è®¾æˆ‘ä»¬å¼€å§‹ä½¿ç”¨å½“æ—¶çš„æœ€æ–°ç‰ˆæœ¬ B 1.1 å¼€å‘ A, å¹¶ä¸”æˆ‘ä»¬è®°å½• A ä»…éœ€è¦ B 1.1. ä½†æ˜¯ç„¶å B 1.2 å‡ºæ¥äº†, æˆ‘ä»¬å¼€å§‹åœ¨æˆ‘ä»¬è‡ªå·±çš„æ„å»ºå’Œ lock æ–‡ä»¶ä¸­ä½¿ç”¨å®ƒ, è€Œä¸æ›´æ–° manifest. è¿™æ—¶, ä¸å†æœ‰ A å’Œ B 1.1 çš„ä»»ä½•å¼€å‘æˆ–æµ‹è¯•. æˆ‘ä»¬å¯èƒ½ä¼šå¼€å§‹ä½¿ç”¨ B 1.2 ä¸­çš„æ–°åŠŸèƒ½æˆ–ä¾èµ–å®ƒçš„é”™è¯¯ä¿®å¤, ä½†ç°åœ¨ A é”™è¯¯åœ°å°†å…¶æœ€ä½éœ€æ±‚åˆ—ä¸º B 1.1. å¦‚æœç”¨æˆ·æ€»æ˜¯é€‰æ‹©æ¯”æœ€ä½éœ€æ±‚æ›´æ–°çš„ç‰ˆæœ¬, é‚£ä¹ˆæ²¡æœ‰å¤ªå¤§çš„ä¼¤å®³: ä»–ä»¬ä¹Ÿä¼šä½¿ç”¨ B 1.2. ä½†æ˜¯å½“ç³»ç»Ÿç¡®å®å°è¯•ä½¿ç”¨å£°æ˜çš„æœ€å°ç‰ˆæœ¬æ—¶, å®ƒå°†ä¼šå‡ºé”™. ä¾‹å¦‚, å½“ç”¨æˆ·å°è¯•å¯¹ A è¿›è¡Œæœ‰é™æ›´æ–°æ—¶, ç³»ç»Ÿæ— æ³•çœ‹åˆ°å¯¹ B 1.2 çš„æ›´æ–°ä¹Ÿæ˜¯å¿…éœ€çš„. æ›´ä¸€èˆ¬åœ°è¯´, æ¯å½“æœ€ä½ç‰ˆæœ¬(manifest ä¸­)å’Œæ„å»ºç‰ˆæœ¬(lock ä¸­)ä¸åŒæ—¶, ä¸ºä»€ä¹ˆæˆ‘ä»¬è®¤ä¸ºä½¿ç”¨æœ€ä½ç‰ˆæœ¬æ„å»ºå°†ç”Ÿæˆå¯ç”¨çš„åº“ ? ä¸ºäº†è¯•å›¾æ£€æµ‹è¿™ä¸ªé—®é¢˜, <a href="https://github.com/rust-lang/cargo/issues/4100" target="_blank" rel="noopener">Cargo å¼€å‘è€…å·²ç»å»ºè®®</a>åœ¨å‘å¸ƒå‰ä½¿ç”¨ cargo publish å°è¯•ä½¿ç”¨æœ€ä½ç‰ˆæœ¬çš„æ‰€æœ‰ä¾èµ–è¿›è¡Œæ„å»º. å½“ A å¼€å§‹ä½¿ç”¨ B 1.2 ä¸­çš„æ–°åŠŸèƒ½æ—¶, å®ƒä¼šæ£€æµ‹åˆ°ä½¿ç”¨ B.1.1 æ„å»ºå°†å¤±è´¥ - ä½†å®ƒä¸ä¼šæ£€æµ‹ A ä½•æ—¶å¼€å§‹ä¾èµ–äºæ–°çš„é”™è¯¯ä¿®å¤.</p><p>æ ¹æœ¬çš„é—®é¢˜æ˜¯, åœ¨ç‰ˆæœ¬é€‰æ‹©æœŸé—´é€‰æ‹©æœ€æ–°å…è®¸ç‰ˆæœ¬çš„æ¨¡å—ä¼šäº§ç”Ÿä½ä¿çœŸæ„å»º. é’ˆå¯¹æ•´ä¸ªç¨‹åºæ„å»º, Lock æ–‡ä»¶æ˜¯éƒ¨åˆ†è§£å†³æ–¹æ¡ˆ; åƒ cargo publish è¿™æ ·çš„é¢å¤–æ„å»ºæ£€æŸ¥ä¹Ÿæ˜¯éƒ¨åˆ†è§£å†³æ–¹æ¡ˆ. æ›´å®Œæ•´çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ä½œè€…æ‰€ç”¨çš„æ¨¡å—ç‰ˆæœ¬æ„å»º. è¿™ä½¿å¾—ç”¨æˆ·çš„æ„å»ºå°½å¯èƒ½æ¥è¿‘ä½œè€…çš„æ„å»º: é«˜ä¿çœŸæ„å»º.</p><h3 id="å‡çº§é€Ÿåº¦"><a href="#å‡çº§é€Ÿåº¦" class="headerlink" title="å‡çº§é€Ÿåº¦"></a>å‡çº§é€Ÿåº¦</h3><p>é‰´äºæœ€å°ç‰ˆæœ¬é€‰æ‹©é‡‡ç”¨äº†æ¯ä¸ªä¾èµ–é¡¹çš„æœ€å°å…è®¸ç‰ˆæœ¬, å¾ˆå®¹æ˜“è®¤ä¸ºè¿™ä¼šå¯¼è‡´ä½¿ç”¨å¾ˆæ—§çš„è½¯ä»¶åŒ…å‰¯æœ¬, è¿›è€Œå¯èƒ½å¯¼è‡´ä¸å¿…è¦çš„é”™è¯¯æˆ–å®‰å…¨é—®é¢˜. ä¸è¿‡, åœ¨å®è·µä¸­, æˆ‘è®¤ä¸ºæƒ…å†µæ­£å¥½ç›¸å, å› ä¸ºå…è®¸çš„æœ€å°ç‰ˆæœ¬æ˜¯æ‰€æœ‰çº¦æŸä¸­æœ€å¤§çš„ä¸€ä¸ª, å› æ­¤, å¯¹æ„å»ºä¸­çš„æ‰€æœ‰æ¨¡å—æä¾›çš„ä¸€ä¸ªæ§åˆ¶æ æ†æ˜¯å¼ºåˆ¶ä½¿ç”¨è¾ƒæ–°ç‰ˆæœ¬çš„ä¾èµ–é¡¹çš„èƒ½åŠ›, è€Œä¸æ˜¯ä½¿ç”¨è¯¥ç‰ˆæœ¬. æˆ‘å¸Œæœ›æœ€å°ç‰ˆæœ¬é€‰æ‹©çš„ç”¨æˆ·æœ€ç»ˆä¼šå¾—åˆ°ä¸€äº›ç¨‹åº, è¿™äº›ç¨‹åºå‡ ä¹å’Œä»–ä»¬çš„æœ‹å‹ä¸€æ ·, éƒ½æ˜¯ä½¿ç”¨åƒ Cargo è¿™æ ·æ›´æœ‰ä¾µç•¥æ€§çš„ç³»ç»Ÿçš„æœ€æ–°ç‰ˆæœ¬.</p><p>ä¾‹å¦‚, å‡è®¾æ‚¨æ­£åœ¨ç¼–å†™ä¸€ä¸ªä¾èµ–äºå°‘æ•°å…¶ä»–æ¨¡å—çš„ç¨‹åº, æ‰€æœ‰è¿™äº›æ¨¡å—éƒ½ä¾èµ–äºä¸€äº›éå¸¸å¸¸è§çš„æ¨¡å—, æ¯”å¦‚ gopkg.in/yaml.v2. ä½ çš„ç¨‹åºçš„æ„å»ºå°†ä½¿ç”¨ä½ çš„æ¨¡å—æ‰€è¯·æ±‚çš„æœ€æ–°çš„ YAML ç‰ˆæœ¬, ä»¥åŠå°‘é‡çš„ä¾èµ–é¡¹. å³ä½¿åªæœ‰ä¸€ä¸ªä¾èµ–é¡¹, ä¹Ÿä¼šè¿«ä½¿ä½ çš„æ„å»ºæ›´æ–°è®¸å¤šå…¶ä»–ä¾èµ–é¡¹. è¿™ä¸æˆ‘å‰é¢æåˆ°çš„ Kubernetes Go å®¢æˆ·ç«¯é—®é¢˜æ­£å¥½ç›¸å.</p><p>å¦‚æœæœ‰ä»€ä¹ˆåŒºåˆ«çš„è¯, æœ€å°ç‰ˆæœ¬é€‰æ‹©åè€Œä¼šé‡åˆ°ç›¸åçš„é—®é¢˜, å³è¿™ä¸ª â€œæœ€å°å€¼çš„æœ€å¤§å€¼â€ ç­”æ¡ˆå°±åƒä¸€ä¸ªæ£˜è½®, è¿«ä½¿ä¾èµ–å…³ç³»å‘å‰è¿‡å¿«. ä½†æˆ‘è®¤ä¸º, åœ¨å®è·µä¸­, ä¾èµ–æ€§å°†ä»¥æ­£ç¡®çš„é€Ÿåº¦å‘å‰æ¨è¿›, æœ€ç»ˆçš„ç»“æœæ˜¯, å…¶é€Ÿåº¦æ°å¥½æ¯” Cargo å’Œå®ƒçš„åŒä¼´ä»¬çš„é€Ÿåº¦è¦æ…¢ä¸€äº›.</p><h3 id="å‡çº§æ—¶é—´"><a href="#å‡çº§æ—¶é—´" class="headerlink" title="å‡çº§æ—¶é—´"></a>å‡çº§æ—¶é—´</h3><p>æœ€å°ç‰ˆæœ¬é€‰æ‹©çš„ä¸€ä¸ªå…³é”®ç‰¹æ€§æ˜¯åœ¨å¼€å‘äººå‘˜è¦æ±‚å‡çº§ä¹‹å‰ä¸ä¼šå‘ç”Ÿ. ä½ ä¸ä¼šå¾—åˆ°ä¸€ä¸ªæœªç»æµ‹è¯•çš„æ¨¡å—ç‰ˆæœ¬, é™¤éä½ è¦æ±‚å‡çº§è¯¥æ¨¡å—.</p><p>ä¾‹å¦‚, åœ¨ Cargo ä¸­, å¦‚æœåŒ… B ä¾èµ–äºåŒ… C 2.9, å¹¶ä¸”å°† B æ·»åŠ åˆ°ä½ çš„æ„å»ºä¸­, é‚£ä¹ˆä½ å°±ä¸èƒ½è·å¾— C 2.9. ä½ åœ¨é‚£ä¸€åˆ»å¾—åˆ°äº†æœ€æ–°çš„å…è®¸ç‰ˆæœ¬, ä¹Ÿè®¸æ˜¯ C 2.15. ä¹Ÿè®¸ C 2.15 åœ¨å‡ åˆ†é’Ÿå‰æ‰å‘å¸ƒ, è€Œä½œè€…è¿˜æ²¡æœ‰è¢«å‘ŠçŸ¥ä¸€ä¸ªé‡è¦çš„é”™è¯¯.<br>è¿™å¯¹ä½ å’Œä½ çš„æ„å»ºæ¥è¯´å¤ªç³Ÿç³•äº†. å¦ä¸€æ–¹é¢, åœ¨æœ€å°ç‰ˆæœ¬é€‰æ‹©ä¸­, æ¨¡å— B çš„ go.mod æ–‡ä»¶å°†åˆ—å‡º B çš„ä½œè€…æ‰€å¼€å‘å’Œæµ‹è¯•çš„ C çš„ç¡®åˆ‡ç‰ˆæœ¬. ä½ ä¼šå¾—åˆ°é‚£ä¸ªç‰ˆæœ¬çš„. æˆ–è€…, ä½ çš„ç¨‹åºä¸­çš„å…¶ä»–æ¨¡å—ä½¿ç”¨è¾ƒæ–°ç‰ˆæœ¬çš„ C è¿›è¡Œäº†å¼€å‘å’Œæµ‹è¯•. ç„¶åä½ ä¼šå¾—åˆ°é‚£ä¸ªç‰ˆæœ¬. ä½†æ˜¯ä½ æ°¸è¿œä¸ä¼šå¾—åˆ°ç¨‹åºä¸­çš„æŸä¸ªæ¨¡å—åœ¨ go.mod æ–‡ä»¶ä¸­æ²¡æœ‰æ˜ç¡®è¦æ±‚çš„ C çš„ç‰ˆæœ¬. è¿™æ„å‘³ç€ä½ åªèƒ½å¾—åˆ°ä¸€ä¸ªä¸ºåˆ«äººå·¥ä½œçš„ C çš„ç‰ˆæœ¬, è€Œä¸æ˜¯æœ€è¿‘çš„ç‰ˆæœ¬, å¯èƒ½æ²¡æœ‰ä¸ºä»»ä½•äººå·¥ä½œè¿‡.</p><p>æ˜ç¡®åœ°è¯´, æˆ‘è¿™é‡Œçš„ç›®çš„ä¸æ˜¯æŒ‘å‰” Cargo, æˆ‘è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªè®¾è®¡å¾—å¾ˆå¥½çš„ç³»ç»Ÿ. æˆ‘åœ¨è¿™é‡Œä½¿ç”¨ Cargo ä½œä¸ºè®¸å¤šå¼€å‘äººå‘˜éƒ½ç†Ÿæ‚‰çš„æ¨¡å‹çš„ä¸€ä¸ªç¤ºä¾‹, æ¥å°è¯•ä¼ è¾¾åœ¨æœ€å°ç‰ˆæœ¬é€‰æ‹©ä¸­ä¼šæœ‰ä»€ä¹ˆä¸åŒ.</p><h3 id="æœ€å°åŒ–"><a href="#æœ€å°åŒ–" class="headerlink" title="æœ€å°åŒ–"></a>æœ€å°åŒ–</h3><p>æˆ‘å°†æ­¤ç³»ç»Ÿæœ€å°ç‰ˆæœ¬é€‰æ‹©ç§°ä¸ºç³»ç»Ÿæœ€å°ç‰ˆæœ¬é€‰æ‹©, å› ä¸ºæ•´ä¸ªç³»ç»Ÿçœ‹èµ·æ¥æ˜¯æœ€å°çš„: æˆ‘ä¸çŸ¥é“å¦‚ä½•åˆ é™¤ä»»ä½•å†…å®¹è€Œä¸ç ´åå®ƒ. æ¯«æ— ç–‘é—®, æœ‰äº›äººä¼šè¯´, å¤ªå¤šçš„å·²ç»è¢«åˆ é™¤äº†, ä½†åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®ƒä¼¼ä¹å®Œå…¨èƒ½å¤Ÿå¤„ç†æˆ‘å·²ç»æ£€æŸ¥è¿‡çš„ç°å®ä¸–ç•Œçš„æ¡ˆä¾‹. æˆ‘ä»¬å°†é€šè¿‡å¯¹ vgo åŸå‹è¿›è¡Œè¯•éªŒæ¥å‘ç°æ›´å¤šçš„é—®é¢˜.</p><p>æœ€å°ç‰ˆæœ¬é€‰æ‹©çš„å…³é”®æ˜¯å®ƒå¯¹æ¨¡å—çš„æœ€å°å…è®¸ç‰ˆæœ¬çš„åå¥½. å½“æˆ‘å°† go get-u çš„ â€œå°†æ‰€æœ‰ä¸œè¥¿å‡çº§åˆ°æœ€æ–°çš„â€ æ–¹æ³•, åº”ç”¨äºèƒ½å¤Ÿä¾èµ–å¯¼å…¥å…¼å®¹æ€§è§„åˆ™çš„ç³»ç»Ÿä¸­æ—¶, æˆ‘æ„è¯†åˆ° manifest å’Œ lock çš„å­˜åœ¨éƒ½æ˜¯ä¸ºäº†ç›¸åŒçš„ç›®çš„: è§£å†³ â€œå°†æ‰€æœ‰ä¸œè¥¿å‡çº§åˆ°æœ€æ–°çš„â€ é»˜è®¤è¡Œä¸º. manifest æè¿°å“ªäº›æ–°ç‰ˆæœ¬æ˜¯ä¸éœ€è¦çš„, è€Œ lock æè¿°å“ªäº›æ–°ç‰ˆæœ¬æ˜¯ä¸æƒ³è¦çš„. ç›¸å, ä¸ºä»€ä¹ˆä¸æ›´æ”¹é»˜è®¤å€¼å‘¢ ? ä½¿ç”¨å…è®¸çš„æœ€å°ç‰ˆæœ¬, é€šå¸¸æ˜¯ä½œè€…ä½¿ç”¨çš„å‡†ç¡®ç‰ˆæœ¬, å¹¶å°†å‡çº§çš„æ—¶é—´å®Œå…¨ç•™ç»™ç”¨æˆ·æ§åˆ¶. è¿™ç§æ–¹æ³•å¯¼è‡´åœ¨æ²¡æœ‰ lock æ–‡ä»¶çš„æƒ…å†µä¸‹å¯å¤åˆ¶çš„æ„å»º, æ›´ä¸€èˆ¬çš„æƒ…å†µä¸‹, äº§ç”Ÿäº†åªåœ¨éœ€è¦æ—¶æ‰åç¦»ä½œè€…è‡ªå·±çš„æ„å»ºçš„é«˜ä¿çœŸç‰ˆæœ¬.</p><p>æœ€é‡è¦çš„æ˜¯, æˆ‘æƒ³æ‰¾åˆ°ä¸€ä¸ªå¯ç†è§£çš„, å¯é¢„æµ‹çš„, ç”šè‡³äºæ— èŠçš„ç‰ˆæœ¬é€‰æ‹©ç®—æ³•. å…¶ä»–ç³»ç»Ÿä¼¼ä¹ä¸ºå±•ç°åŸå§‹çµæ´»æ€§å’Œå¼ºå¤§è¿›è¡Œäº†ä¼˜åŒ–, æœ€å°ç‰ˆæœ¬é€‰æ‹©çš„ç›®æ ‡æ˜¯æ— å½¢çš„. æˆ‘å¸Œæœ›å®ƒæˆåŠŸ.</p>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> go </tag>
            
            <tag> vgo </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è¯­ä¹‰å¯¼å…¥ç‰ˆæœ¬æ§åˆ¶</title>
      <link href="/post/vgo-import.html"/>
      <url>/post/vgo-import.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ª <a href="https://research.swtch.com/vgo-import" target="_blank" rel="noopener">Semantic Import Versioning</a>, <a href="https://lingchao.xin/tag/vgo.html">Go &amp; Versioning</a> çš„ç¬¬ 3 éƒ¨åˆ†, ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰.<br><a id="more"></a></p><p>å¦‚ä½•å°†ä¸å…¼å®¹çš„æ›´æ”¹éƒ¨ç½²åˆ°ç°æœ‰è½¯ä»¶åŒ… ? è¿™æ˜¯ä»»ä½•åŒ…ç®¡ç†ç³»ç»Ÿä¸­çš„æ ¹æœ¬æŒ‘æˆ˜å’Œå†³æ–­. é—®é¢˜çš„ç­”æ¡ˆå†³å®šäº†æ‰€äº§ç”Ÿçš„ç³»ç»Ÿçš„å¤æ‚æ€§, å®ƒå†³å®šäº†å¦‚ä½•è½»æ¾æˆ–éš¾ä»¥ä½¿ç”¨åŒ…ç®¡ç†. (å®ƒè¿˜å†³å®šå¦‚ä½•è½»æ¾æˆ–éš¾ä»¥å®ç°åŒ…ç®¡ç†, ä½†ç”¨æˆ·ä½“éªŒæ›´é‡è¦.)</p><p>ä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜, è¿™ç¯‡æ–‡ç« é¦–å…ˆä»‹ç»äº† Go çš„å¯¼å…¥å…¼å®¹æ€§è§„åˆ™:</p><blockquote><p>å¦‚æœæ—§åŒ…å’Œæ–°åŒ…å…·æœ‰ç›¸åŒçš„å¯¼å…¥è·¯å¾„, æ–°è½¯ä»¶åŒ…å¿…é¡»å‘åå…¼å®¹æ—§è½¯ä»¶åŒ….</p></blockquote><p>æˆ‘ä»¬ä» Go ä¸€å¼€å§‹å°±ä¸»å¼ è¿™ä¸ªåŸåˆ™, ä½†æˆ‘ä»¬æ²¡æœ‰ç»™å®ƒä¸€ä¸ªåå­—æˆ–è€…è¿™æ ·ä¸€ä¸ªç›´æ¥çš„é™ˆè¿°.</p><p>å¯¼å…¥å…¼å®¹æ€§è§„åˆ™å¤§å¤§ç®€åŒ–äº†ä½¿ç”¨ä¸å…¼å®¹ç‰ˆæœ¬çš„è½¯ä»¶åŒ…çš„ä½“éªŒ. å½“æ¯ä¸ªä¸åŒç‰ˆæœ¬å…·æœ‰ä¸åŒçš„å¯¼å…¥è·¯å¾„æ—¶, å…³äºç»™å®šå¯¼å…¥è¯­å¥çš„é¢„æœŸè¯­ä¹‰æ²¡æœ‰æ­§ä¹‰. è¿™ä½¿å¼€å‘äººå‘˜å’Œå·¥å…·æ›´å®¹æ˜“ç†è§£ Go ç¨‹åº.</p><p>ä»Šå¤©çš„å¼€å‘äººå‘˜å¸Œæœ›ä½¿ç”¨è¯­ä¹‰ç‰ˆæœ¬æ¥æè¿°è½¯ä»¶åŒ…, å› æ­¤æˆ‘ä»¬å°†å®ƒä»¬åº”ç”¨åˆ°æ¨¡å‹ä¸­. å…·ä½“æ¥è¯´, æ¨¡å— my/thing è¢«å¯¼å…¥æˆ my/thing ä½œä¸º v0, è¯¥é˜¶æ®µé¢„è®¡ä¼šå‘ç”Ÿç ´åæ€§æ›´æ”¹, å¹¶ä¸”ä¸ä¼šå—åˆ°ä¿æŠ¤, å¹¶ä¸”æŒç»­åˆ°ç¬¬ä¸€ä¸ªç¨³å®šçš„ä¸»è¦ç‰ˆæœ¬ V1. ä½†æ˜¯å½“æ·»åŠ  v2 çš„æ—¶å€™, æˆ‘ä»¬ä¸å†é‡æ–°å®šä¹‰ç°åœ¨ç¨³å®šçš„ my/thing çš„æ‰€ä»£è¡¨çš„å«ä¹‰, è€Œæ˜¯ç»™å®ƒä¸€ä¸ªæ–°çš„åå­—: my/thing/v2.</p><p><img src="/static/images/impver@2x.png" width="458px" height="223px"></p><p>æˆ‘å°†è¿™ç§çº¦å®šç§°ä¸ºè¯­ä¹‰å¯¼å…¥ç‰ˆæœ¬æ§åˆ¶, è¿™æ˜¯åœ¨ä½¿ç”¨è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶æ—¶éµå¾ªå¯¼å…¥å…¼å®¹æ€§è§„åˆ™çš„ç»“æœ.</p><p>ä¸€å¹´å‰, æˆ‘ç›¸ä¿¡æŠŠç‰ˆæœ¬æ”¾å…¥è¿™æ ·çš„å¯¼å…¥è·¯å¾„æ˜¯ä¸‘é™‹çš„, ä¸å¯å–çš„, å¹¶ä¸”å¯èƒ½æ˜¯å¯ä»¥é¿å…çš„. ä½†æ˜¯åœ¨è¿‡å»çš„ä¸€å¹´é‡Œ, æˆ‘å·²ç»å¼€å§‹ç†è§£å®ƒä»¬ä¸ºç³»ç»Ÿå¸¦æ¥å¤šå°‘æ¸…æ™°å’Œç®€å•. åœ¨è¿™ç¯‡æ–‡ç« ä¸­, æˆ‘å¸Œæœ›èƒ½è®©ä½ äº†è§£æˆ‘ä¸ºä»€ä¹ˆæ”¹å˜ä¸»æ„.</p><h3 id="ä¸€ä¸ªä¾èµ–çš„æ•…äº‹"><a href="#ä¸€ä¸ªä¾èµ–çš„æ•…äº‹" class="headerlink" title="ä¸€ä¸ªä¾èµ–çš„æ•…äº‹"></a>ä¸€ä¸ªä¾èµ–çš„æ•…äº‹</h3><p>ä¸ºäº†ä½¿è®¨è®ºå…·ä½“åŒ–, è¯·è€ƒè™‘ä»¥ä¸‹æ•…äº‹. è¿™ä¸ªæ•…äº‹å½“ç„¶æ˜¯è™šæ„çš„, ä½†å®ƒæ˜¯ç”±ä¸€ä¸ªçœŸæ­£çš„é—®é¢˜æ‰€é©±åŠ¨. å½“ dep å‘å¸ƒæ—¶, Google ç¼–å†™ OAuth2 è½¯ä»¶åŒ…çš„å›¢é˜Ÿé—®æˆ‘, ä»–ä»¬åº”è¯¥å¦‚ä½•å¼•å…¥ä»–ä»¬é•¿æœŸä»¥æ¥éƒ½æƒ³åšçš„ä¸€äº›ä¸å…¼å®¹çš„æ”¹è¿›. æˆ‘è¶Šæƒ³å®ƒ, è¶Šæ˜¯æ„è¯†åˆ°è¿™ä¸åƒå¬èµ·æ¥çš„é‚£ä¹ˆå®¹æ˜“, è‡³å°‘ä¸åƒæ²¡æœ‰è¯­ä¹‰å¯¼å…¥ç‰ˆæœ¬çš„é‚£æ ·.</p><h4 id="åºå¹•"><a href="#åºå¹•" class="headerlink" title="åºå¹•"></a>åºå¹•</h4><p>ä»åŒ…ç®¡ç†å·¥å…·çš„è§’åº¦æ¥çœ‹, åˆ†ä¸ºä»£ç ä½œè€…å’Œä»£ç ç”¨æˆ·. Alice, Anna å’Œ Amy æ˜¯ä¸åŒä»£ç åŒ…çš„ä½œè€…. Alice åœ¨ Google å·¥ä½œå¹¶ç¼–å†™ OAuth2 è½¯ä»¶åŒ…. Amy åœ¨å¾®è½¯å·¥ä½œå¹¶ç¼–å†™äº† Azure å®¢æˆ·ç«¯åº“. Anna åœ¨äºšé©¬é€Šå·¥ä½œå¹¶æ’°å†™äº† AWS å®¢æˆ·ç«¯åº“. Ugo æ˜¯æ‰€æœ‰è¿™äº›è½¯ä»¶åŒ…çš„ç”¨æˆ·. ä»–æ­£åœ¨å¼€å‘æœ€ç»ˆçš„äº‘åº”ç”¨ Unity, å¹¶ä½¿ç”¨æ‰€æœ‰è¿™äº›è½¯ä»¶åŒ…å’Œå…¶ä»–è½¯ä»¶åŒ….</p><p>ä½œä¸ºä½œè€…, Alice, Anna å’Œ Amy éœ€è¦èƒ½å¤Ÿç¼–å†™å’Œå‘å¸ƒä»–ä»¬è½¯ä»¶åŒ…çš„æ–°ç‰ˆæœ¬. è½¯ä»¶åŒ…çš„æ¯ä¸ªç‰ˆæœ¬éƒ½ä¸ºå…¶æ¯ä¸ªä¾èµ–é¡¹æŒ‡å®šäº†æ‰€éœ€çš„ç‰ˆæœ¬.</p><p>ä½œä¸ºç”¨æˆ·, Ugo éœ€è¦èƒ½å¤Ÿç”¨è¿™äº›å…¶ä»–è½¯ä»¶åŒ…ä¸€èµ·æ„å»º Unity. ä»–éœ€è¦ç²¾ç¡®æ§åˆ¶åœ¨ç‰¹å®šæ„å»ºä¸­ä½¿ç”¨å“ªäº›ç‰ˆæœ¬; å½“ä»–é€‰æ‹©æ—¶ä»–éœ€è¦èƒ½å¤Ÿæ›´æ–°åˆ°æ–°ç‰ˆæœ¬.</p><p>å½“ç„¶, æˆ‘ä»¬çš„æœ‹å‹å¯èƒ½æœŸæœ›ä»åŒ…ç®¡ç†å·¥å…·ä¸­è·å¾—æ›´å¤š, ç‰¹åˆ«æ˜¯åœ¨å‘ç°, æµ‹è¯•, å¯ç§»æ¤æ€§å’Œæœ‰ç”¨çš„è¯Šæ–­æ–¹é¢, ä½†è¿™äº›ä¸æ•…äº‹æ— å…³.</p><p>éšç€æˆ‘ä»¬çš„æ•…äº‹é€æ¸æ‰“å¼€, Ugo çš„ Unity æ„å»ºä¾èµ–å…³ç³»çœ‹èµ·æ¥åƒè¿™æ ·:</p><p><img src="/static/images/deps-a1-short2@2x.png" width="550px" height="351px"></p><h4 id="ç« èŠ‚-1"><a href="#ç« èŠ‚-1" class="headerlink" title="ç« èŠ‚ 1"></a>ç« èŠ‚ 1</h4><p>æ¯ä¸ªäººéƒ½ç‹¬ç«‹ç¼–å†™è½¯ä»¶.</p><p>åœ¨è°·æ­Œ, Alice ä¸€ç›´åœ¨ä¸º OAuth2 è½¯ä»¶åŒ…è®¾è®¡ä¸€ä¸ªæ–°çš„, æ›´ç®€å•, æ›´æ˜“äºä½¿ç”¨çš„ API. å®ƒä»ç„¶å¯ä»¥å®Œæˆæ—§è½¯ä»¶åŒ…å¯ä»¥å®Œæˆçš„æ‰€æœ‰å·¥ä½œ, ä½†åªéœ€è¦ä¸€åŠçš„ API æ¥å£. å¥¹å°†å…¶å‘å¸ƒä¸º OAuth2 r2. (è¿™é‡Œçš„ r ä»£è¡¨ä¿®è®¢. ç›®å‰, ä¿®è®¢å·å¹¶ä¸è¡¨ç¤ºé™¤é¡ºåºä¹‹å¤–çš„ä»»ä½•å†…å®¹: ç‰¹åˆ«æ˜¯, å®ƒä»¬ä¸æ˜¯è¯­ä¹‰ç‰ˆæœ¬)</p><p>åœ¨å¾®è½¯, Amy æ­£å¤„äºåº”æœ‰çš„é•¿å‡æœŸä¸­, å¥¹çš„å›¢é˜Ÿå†³å®šåœ¨å¥¹å›æ¥ä¹‹å‰ä¸åšä»»ä½•ä¸ OAuth2 r2 ç›¸å…³çš„æ›´æ”¹. Azure åŒ…ç°åœ¨å°†ç»§ç»­ä½¿ç”¨ OAuth2 r1.</p><p>åœ¨äºšé©¬é€Š, Anna å‘ç°ä½¿ç”¨ OAuth2 r2 å¯ä»¥è®©å¥¹åœ¨å®ç° AWS r1 çš„è¿‡ç¨‹ä¸­åˆ é™¤è®¸å¤šéš¾çœ‹çš„ä»£ç , å› æ­¤å¥¹å°† AWS æ›´æ”¹ä¸ºä½¿ç”¨ OAuth2 r2. å¥¹ä¸€è·¯ä¿®å¤äº†ä¸€äº›é”™è¯¯, å¹¶å°†ç»“æœå‘å¸ƒä¸º AWS r2.</p><p>Ugo è·å–äº†æœ‰å…³ Azure è¡Œä¸ºçš„ bug æŠ¥å‘Š, å¹¶è¿½è¸ªåˆ° Azure å®¢æˆ·ç«¯åº“çš„ä¸€ä¸ª bug. åœ¨ä¼‘å‡ä¹‹å‰, Amy å·²ç»åœ¨ Azure r2 ä¸­å‘å¸ƒäº†è¯¥ bug çš„ä¿®å¤ç¨‹åº. Ugo å‘ Unity æ·»åŠ äº†ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹, ç¡®è®¤å®ƒå¤±è´¥, å¹¶è¦æ±‚åŒ…ç®¡ç†å·¥å…·æ›´æ–°åˆ° Azure r2.</p><p>æ›´æ–°ä¹‹å, Ugo çš„æ„å»ºçœ‹èµ·æ¥åƒè¿™æ ·:</p><p><img src="/static/images/deps-a1.5@2x.png" width="550px" height="427px"></p><p>ä»–ç¡®è®¤æ–°çš„æµ‹è¯•é€šè¿‡, å¹¶ä¸”ä»–æ‰€æœ‰çš„æ—§æµ‹è¯•ä»ç„¶é€šè¿‡. ä»–é”å®š Azure æ›´æ–°å¹¶å‘å¸ƒæ›´æ–°åçš„ Unity.</p><h4 id="ç« èŠ‚-2"><a href="#ç« èŠ‚-2" class="headerlink" title="ç« èŠ‚ 2"></a>ç« èŠ‚ 2</h4><p>Amazon å¤§å¼ æ——é¼“åœ°æ¨å‡ºäº†ä»–ä»¬æ–°çš„äº‘æœåŠ¡: Amazon Zeta Functions. ä¸ºäº†å‡†å¤‡å‘å¸ƒ, Anna ç»™ AWS è½¯ä»¶åŒ…æ·»åŠ äº† Zeta æ”¯æŒ, å¥¹ç°åœ¨å°†å®ƒå‘å¸ƒä¸º AWS r3.</p><p>å½“ Ugo å¬åˆ°æœ‰å…³ Amazon Zeta çš„æ¶ˆæ¯æ—¶, ä»–å†™äº†ä¸€äº›æµ‹è¯•ç¨‹åº, å¹¶å¯¹ä»–ä»¬å·¥ä½œçš„æ•ˆæœæ„Ÿåˆ°éå¸¸å…´å¥‹, å› æ­¤ä»–è·³è¿‡åˆé¤æ›´æ–°å» Unity. ä»Šå¤©çš„æ›´æ–°ä¸å¦‚æœ€åä¸€æ¬¡. Ugo å¸Œæœ›ä½¿ç”¨ Azure r2 å’Œ AWS r3 (æ¯ä¸ªç‰ˆæœ¬çš„æœ€æ–°ç‰ˆæœ¬)æ¥æ„å»ºåŒ…å« Zeta æ”¯æŒçš„ Unity. ä½†  Azure r2 éœ€è¦ OAuth2 r1 (è€Œä¸æ˜¯ r2 ), è€Œ AWS r3 éœ€è¦ OAuth2 r2 (è€Œä¸æ˜¯ r1). ç»å…¸çš„è±å½¢ä¾èµ–, å¯¹å§? Ugo ä¸åœ¨ä¹å®ƒæ˜¯ä»€ä¹ˆ. ä»–åªæ˜¯æƒ³æ„å»º Unity.</p><p>æ›´ç³Ÿçš„æ˜¯, è¿™ä¼¼ä¹ä¸æ˜¯ä»»ä½•äººçš„é”™. Alice å†™äº†ä¸€ä¸ªæ›´å¥½çš„ OAuth2 åŒ…. Amy ä¿®å¤äº†ä¸€äº› Azure bug å¹¶å»åº¦å‡. Anna è§‰å¾— AWS åº”è¯¥ä½¿ç”¨æ–°çš„ OAuth2 (å†…éƒ¨å®ç°ç»†èŠ‚), å¹¶ä¸”åæ¥å¢åŠ äº† Zeta æ”¯æŒ. Ugo å¸Œæœ› Unity ä½¿ç”¨æœ€æ–°çš„ Azure å’Œ AWS è½¯ä»¶åŒ…. å¾ˆéš¾è¯´ä»–ä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªåšé”™äº†ä»€ä¹ˆ. å¦‚æœè¿™äº›äººæ²¡æœ‰é”™, é‚£ä¹ˆä¹Ÿè®¸åŒ…ç®¡ç†é”™äº†. æˆ‘ä»¬ä¸€ç›´å‡è®¾åœ¨ Ugo çš„ Unity æ„å»ºä¸­åªèƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬çš„ OAuth2. ä¹Ÿè®¸è¿™å°±æ˜¯é—®é¢˜æ‰€åœ¨: ä¹Ÿè®¸åŒ…ç®¡ç†å™¨åº”è¯¥å…è®¸åœ¨å•ä¸ªæ„å»ºä¸­åŒ…å«ä¸åŒçš„ç‰ˆæœ¬. è¿™ä¸ªä¾‹å­ä¼¼ä¹è¡¨æ˜å®ƒå¿…é¡»è¿™æ ·.</p><p>Ugo ä»ç„¶å¡ä½äº†, æ‰€ä»¥ä»–æœç´¢äº† StackOverflow å¹¶æ‰¾åˆ°äº†åŒ…ç®¡ç†å™¨çš„ -fmultiverseæ ‡å¿—, å®ƒå…è®¸å¤šä¸ªç‰ˆæœ¬, ä»¥ä¾¿ä»–çš„ç¨‹åºæ„å»ºä¸º:</p><p><img src="/static/images/deps-a2-short@2x.png" width="550px" height="351px"></p><p>Ugo è¯•äº†. å®ƒä¸èµ·ä½œç”¨. è¿›ä¸€æ­¥æ·±å…¥ç ”ç©¶è¿™ä¸ªé—®é¢˜, Ugo å‘ç° Azure å’Œ AWS éƒ½åœ¨ä½¿ç”¨åä¸º Moauth çš„æµè¡Œ OAuth2 ä¸­é—´ä»¶åº“, å®ƒç®€åŒ–äº†éƒ¨åˆ† OAuth2 å¤„ç†. Moauth ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ API æ›¿ä»£å“: ç”¨æˆ·ä»ç„¶ç›´æ¥å¯¼å…¥ OAuth2, ä½†ä»–ä»¬ä½¿ç”¨ Moauth æ¥ç®€åŒ–ä¸€äº› API è°ƒç”¨. Moauth å‚ä¸çš„ç»†èŠ‚æ²¡æœ‰ä» OAuth2 r1 æ”¹ä¸º r2, å› æ­¤ Moauth r1 (å”¯ä¸€å­˜åœ¨çš„ç‰ˆæœ¬)ä¸ä¸¤è€…å…¼å®¹. Azure r2 å’Œ AWS r3 éƒ½ä½¿ç”¨ Moauth r1. åœ¨ä»…ä½¿ç”¨ Azure æˆ–ä»…ä½¿ç”¨ AWS çš„ç¨‹åºä¸­, è¿™ç§æ–¹å¼æ•ˆæœå¾ˆå¥½, ä½† Ugo çš„ Unity æ„å»ºçœ‹èµ·æ¥åƒè¿™æ ·:</p><p><img src="/static/images/deps-a3-short@2x.png" width="550px" height="454px"></p><p>Unity éœ€è¦ä¸¤ä¸ª OAuth2 æ‹·è´, ä½† Moauth å¯¼å…¥å“ªä¸ªæ‹·è´ ?</p><p>ä¸ºäº†ä½¿æ„å»ºå·¥ä½œ, æˆ‘ä»¬ä¼¼ä¹éœ€è¦ä¸¤ä¸ªå®Œå…¨ç›¸åŒçš„Moauthå‰¯æœ¬: ä¸€ä¸ªå¯¼å…¥ OAuth2 r1 ä¾› Azure ä½¿ç”¨, å¦ä¸€ä¸ªå¯¼å…¥ OAuth2 r2 ä¾› AWS ä½¿ç”¨. ä¸€ä¸ªå¿«é€Ÿçš„ StackOverflow æœç´¢æ˜¾ç¤ºè½¯ä»¶åŒ…ç®¡ç†å™¨æœ‰ä¸€ä¸ªæ ‡å¿—(flag): -fclone. Ugo çš„ç¨‹åºä½¿ç”¨è¿™ä¸ªæ ‡å¿—æ¥æ„å»ºä¸º:</p><p><img src="/static/images/deps-a4-short@2x.png" width="550px" height="451px"></p><p>è¿™å®é™…ä¸Šå¯ä»¥å·¥ä½œå¹¶é€šè¿‡äº†æµ‹è¯•, è™½ç„¶ Ugo ç°åœ¨æƒ³çŸ¥é“æ˜¯å¦è¿˜æœ‰æ›´å¤šçš„æ½œåœ¨é—®é¢˜. ä»–éœ€è¦å›å®¶åƒæ™šé¥­.</p><h4 id="ç« èŠ‚-3"><a href="#ç« èŠ‚-3" class="headerlink" title="ç« èŠ‚ 3"></a>ç« èŠ‚ 3</h4><p>Amy å·²ç»ç»“æŸåº¦å‡å›åˆ°äº†å¾®è½¯. å¥¹è§‰å¾— Azure å¯ä»¥ç»§ç»­ä½¿ç”¨ OAuth2 r1 ä¸€æ®µæ—¶é—´, ä½†å¥¹æ„è¯†åˆ°å®ƒå¯ä»¥å¸®åŠ©ç”¨æˆ·ç›´æ¥ä¼ é€’ Moauth ä»¤ç‰Œåˆ° Azure API. å¥¹ä»¥å‘åå…¼å®¹çš„æ–¹å¼å°†å…¶æ·»åŠ åˆ° Azure åŒ…ä¸­, å¹¶å‘å¸ƒ Azure r3. åœ¨äºšé©¬é€Šè¿™è¾¹, Anna å–œæ¬¢ Azure åŒ…åŸºäº Moauth çš„æ–° API, å¹¶å‘ AWS åŒ…æ·»åŠ äº†ç±»ä¼¼çš„ API, å‘å¸ƒä¸º AWS r4.</p><p>Ugo çœ‹åˆ°äº†è¿™äº›å˜åŒ–, å¹¶å†³å®šæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬çš„ Azure å’Œ AWS, ä»¥ä¾¿ä½¿ç”¨åŸºäº Moauth çš„ API. è¿™æ¬¡å¡äº†ä»–ä¸€ä¸ªä¸‹åˆ. é¦–å…ˆä»–æš‚æ—¶æ›´æ–° Azure å’Œ AWS åŒ…, è€Œä¸ä¿®æ”¹ Unity. å®ƒçš„ç¨‹åºå¯ä»¥æ„å»º!</p><p>ä»¤äººå…´å¥‹çš„æ˜¯, Ugo å°† Unity æ”¹å˜ä¸ºä½¿ç”¨åŸºäº Moauth çš„ Azure API, è€Œä¸”ä¹Ÿå¯ä»¥æ„å»º. ä½†æ˜¯, å½“ä»–å°† Unity æ›´æ”¹ä¸ºä½¿ç”¨åŸºäº Moauth çš„ AWS API æ—¶, æ„å»ºå¤±è´¥. å›°æƒ‘çš„æ˜¯, ä»–æ¢å¤äº†ä»–çš„ Azure æ›´æ”¹, åªç•™ä¸‹ AWS æ›´æ”¹, æ„å»ºæˆåŠŸ. ä»–å°† Azure æ›´æ”¹æ”¾å›, æ„å»ºå†æ¬¡å¤±è´¥. Ugo è¿”å›åˆ° StackOverflow (ç»§ç»­æœç´¢).</p><p>Ugo äº†è§£åˆ°, å½“é€šè¿‡ -fmultiverse -fclone ä»…ä½¿ç”¨ä¸€ä¸ªåŸºäº Moauth çš„ API (åœ¨æœ¬ä¾‹ä¸­ä¸º Azure) æ—¶, Unity éšå¼åœ°æ„å»ºä¸º:</p><p><img src="/static/images/deps-a5-short@2x.png" width="596px" height="451px"></p><p>ä½†æ˜¯å½“ä»–ä½¿ç”¨ä¸¤ä¸ªåŸºäº Moauth çš„ API æ—¶, Unity ä¸­çš„å•ä¸ªå¯¼å…¥ â€œmoauthâ€ æ˜¯ä¸æ˜ç¡®çš„. ç”±äº Unity æ˜¯ä¸»è¦çš„è½¯ä»¶åŒ…, å®ƒä¸èƒ½è¢«å…‹éš†(ä¸ Moauth æœ¬èº«ç›¸å):</p><p><img src="/static/images/deps-a6-short@2x.png" width="628px" height="451px"></p><p>ä¸€ä¸ª StackOverflow è¯„è®ºå»ºè®®å°† Moauth å¯¼å…¥ç§»åŠ¨åˆ°ä¸¤ä¸ªä¸åŒçš„åŒ…ä¸­, ç„¶åè®© Unity å¯¼å…¥å®ƒä»¬. Ugo å°è¯•äº†è¿™ä¸€ç‚¹, ä»¤äººéš¾ä»¥ç½®ä¿¡çš„æ˜¯, å®ƒå¯ä»¥å·¥ä½œ:</p><p><img src="/static/images/deps-a7-short@2x.png" width="561px" height="601px"></p><p>Ugo æŒ‰æ—¶å›äº†å®¶. ä»–å¯¹åŒ…ç®¡ç†å¹¶ä¸æ»¡æ„, ä½†ä»–ç°åœ¨æ˜¯ StackOverflow çš„å¿ å®ç²‰ä¸.</p><h3 id="åŸºäºè¯­ä¹‰ç‰ˆæœ¬çš„å¤è¿°"><a href="#åŸºäºè¯­ä¹‰ç‰ˆæœ¬çš„å¤è¿°" class="headerlink" title="åŸºäºè¯­ä¹‰ç‰ˆæœ¬çš„å¤è¿°"></a>åŸºäºè¯­ä¹‰ç‰ˆæœ¬çš„å¤è¿°</h3><p>å‡è®¾åŒ…ç®¡ç†ä½¿ç”¨å®ƒä»¬è€Œä¸æ˜¯åŸå§‹æ•…äº‹çš„ â€˜râ€™ æ•°å­—, è®©æˆ‘ä»¬æŒ¥åŠ¨ä¸€æŠŠé­”æ–å¹¶ç”¨è¯­ä¹‰ç‰ˆæœ¬å¤è¿°æ•…äº‹.</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›å˜åŒ–:</p><ul><li>OAuth2 r1 å˜ä¸º OAuth2 1.0.0</li><li>Moauth r1 å˜ä¸º Moauth 1.0.0</li><li>Azure r1 å˜ä¸º Azure 1.0.0</li><li>AWS r1 å˜ä¸º AWS 1.0.0</li><li>OAuth2 r2 å˜ä¸º OAuth2 2.0.0 (éƒ¨åˆ†ä¸å…¼å®¹çš„ API)</li><li>Azure r2 å˜ä¸º Azure 1.0.1 (bug ä¿®å¤)</li><li>AWS r2 å˜ä¸º AWS 1.0.1 (bug ä¿®å¤, å†…éƒ¨ä½¿ç”¨ OAuth2 2.0.0)</li><li>AWS r3 å˜ä¸º AWS 1.1.0 (åŠŸèƒ½æ›´æ–°: æ·»åŠ  Zeta)</li><li>Azure r3 å˜ä¸º Azure 1.1.0 (åŠŸèƒ½æ›´æ–°: æ·»åŠ  Moauth API)</li><li>AWS r4 å˜ä¸º AWS 1.2.0 (åŠŸèƒ½æ›´æ–°: æ·»åŠ  Moauth API)</li></ul><p><strong>æ•…äº‹æ²¡æœ‰ä»»ä½•å˜åŒ–</strong>. Ugo ä»ç„¶é‡åˆ°ç›¸åŒçš„æ„å»ºé—®é¢˜, ä»–ä»ç„¶ä¸å¾—ä¸è½¬å‘ä½¿ç”¨ StackOverflow æ¥äº†è§£æ„å»ºæ ‡å¿—(flag)å’Œé‡æ„æŠ€æœ¯, ä»¥ä¿æŒ Unity æˆåŠŸæ„å»º. æ ¹æ® semver, Ugo åº”è¯¥æ²¡æœ‰ä»»ä½•æ›´æ–°çš„éº»çƒ¦: åœ¨æ•…äº‹ä¸­æ²¡æœ‰ä¸€ä¸ª Unity å¯¼å…¥çš„åŒ…æ”¹å˜äº†ä¸»è¦ç‰ˆæœ¬. åªæœ‰ OAuth2 æ·±å…¥ Unity çš„ä¾èµ–æ ‘. Unity æœ¬èº«ä¸ä¼šå¯¼å…¥ OAuth2. ä»€ä¹ˆåœ°æ–¹å‡ºäº†é”™ ?</p><p>è¿™é‡Œçš„é—®é¢˜æ˜¯, semver è§„èŒƒå®é™…ä¸Šä¸ä»…ä»…æ˜¯é€‰æ‹©å’Œæ¯”è¾ƒç‰ˆæœ¬å­—ç¬¦ä¸²çš„æ–¹å¼. å®ƒæ²¡æœ‰è¯´åˆ«çš„. ç‰¹åˆ«æ˜¯, åœ¨å¢åŠ ä¸»ç‰ˆæœ¬å·å, å¦‚ä½•å¤„ç†ä¸å…¼å®¹çš„æ›´æ”¹ä¹Ÿæ²¡æœ‰æåŠ.</p><p>semver æœ€æœ‰ä»·å€¼çš„éƒ¨åˆ†æ˜¯é¼“åŠ±åœ¨å¯èƒ½çš„æƒ…å†µä¸‹è¿›è¡Œå‘åå…¼å®¹çš„æ›´æ”¹. FAQ æ­£ç¡®çš„è®°å½•åˆ°:</p><blockquote><p>â€œä¸å…¼å®¹çš„æ›´æ”¹ä¸åº”è¯¥è½»å¾®å¼•å…¥å…·æœ‰å¤§é‡ç›¸å…³ä»£ç çš„è½¯ä»¶. å‡çº§å¿…é¡»æ‰¿æ‹…çš„æˆæœ¬å¯èƒ½å¾ˆå¤§. ä¸å¾—ä¸é€šè¿‡å¢åŠ ä¸»ç‰ˆæœ¬å·æ¥å‘å¸ƒä¸å…¼å®¹çš„æ›´æ”¹æ„å‘³ç€ä½ å°†ä¼šè€ƒè™‘æ›´æ”¹çš„å½±å“å¹¶è¯„ä¼°æ¶‰åŠçš„ æˆæœ¬/æ”¶ç›Š ç‡.â€</p></blockquote><p>æˆ‘å½“ç„¶åŒæ„ â€œä¸åº”è¯¥è½»æ˜“å¼•å…¥ä¸å…¼å®¹çš„å˜åŒ–â€. æˆ‘è®¤ä¸º semver ç¼ºä¹çš„åœ°æ–¹æ˜¯: â€œä¸å¾—ä¸é€šè¿‡å¢åŠ ä¸»ç‰ˆæœ¬å·â€ æ˜¯ä¿ƒä½¿ä½  â€œæ€è€ƒä½ æ›´æ”¹çš„å½±å“å¹¶è¯„ä¼°æ¶‰åŠçš„ æˆæœ¬/æ”¶ç›Š ç‡â€ çš„ä¸€ä¸ªæ­¥éª¤. æ°æ°ç›¸å: è¯»å– semver å¤ªå®¹æ˜“äº†, å› ä¸ºè¿™æ„å‘³ç€åªè¦ä½ åœ¨è¿›è¡Œä¸å…¼å®¹çš„æ›´æ”¹æ—¶é€’å¢ä¸»ç‰ˆæœ¬, å…¶ä»–æ‰€æœ‰æ“ä½œéƒ½å¯ä»¥è§£å†³. è¿™ä¸ªä¾‹å­è¡¨æ˜æƒ…å†µå¹¶éå¦‚æ­¤.</p><p>ä» Alice çš„è§’åº¦æ¥çœ‹, OAuth2 API éœ€è¦å‘åå…¼å®¹çš„å˜æ›´, å¹¶ä¸”å½“å¥¹åšå‡ºè¿™äº›æ›´æ”¹æ—¶, semver ä¼¼ä¹æ‰¿è¯ºå‘å¸ƒä¸å…¼å®¹çš„ OAuth2 è½¯ä»¶åŒ…ä¼šå¾ˆå¥½, å‰ææ˜¯å¥¹ç»™äº†å®ƒ 2.0.0 ç‰ˆæœ¬. ä½†æ˜¯è¿™ç§ç»è¿‡ semver è®¤å¯çš„æ”¹å˜å¼•å‘äº† Ugo å’Œ Unity çš„ä¸€ç³»åˆ—é—®é¢˜.</p><p>è¯­ä¹‰ç‰ˆæœ¬æ˜¯ä½œè€…å‘ç”¨æˆ·ä¼ è¾¾æœŸæœ›çš„é‡è¦æ–¹å¼, ä½†è¿™å°±æ˜¯ä»–ä»¬çš„å…¨éƒ¨. å°±å…¶æœ¬èº«è€Œè¨€, ä¸èƒ½æœŸæœ›è§£å†³è¿™äº›è¾ƒå¤§çš„æ„å»ºé—®é¢˜. ç›¸å, è®©æˆ‘ä»¬çœ‹çœ‹è§£å†³æ„å»ºé—®é¢˜çš„æ–¹æ³•. ä¹‹å, æˆ‘ä»¬å¯ä»¥è€ƒè™‘å¦‚ä½•åœ¨è¿™ç§æ–¹æ³•ä¸­æ°å½“çš„ä½¿ç”¨ semver.</p><h3 id="å¯¼å…¥ç‰ˆæœ¬æ§åˆ¶å¤è¿°"><a href="#å¯¼å…¥ç‰ˆæœ¬æ§åˆ¶å¤è¿°" class="headerlink" title="å¯¼å…¥ç‰ˆæœ¬æ§åˆ¶å¤è¿°"></a>å¯¼å…¥ç‰ˆæœ¬æ§åˆ¶å¤è¿°</h3><p>å†ä¸€æ¬¡, è®©æˆ‘ä»¬ä½¿ç”¨å¯¼å…¥å…¼å®¹æ€§è§„åˆ™é‡æ–°è®²è¿°æ•…äº‹:</p><blockquote><p>åœ¨ Go ä¸­, å¦‚æœæ—§åŒ…å’Œæ–°åŒ…å…·æœ‰ç›¸åŒçš„å¯¼å…¥è·¯å¾„, æ–°è½¯ä»¶åŒ…å¿…é¡»å‘åå…¼å®¹æ—§è½¯ä»¶åŒ….</p></blockquote><p>ç°åœ¨æƒ…èŠ‚å˜åŒ–æ›´åŠ æ˜¾è‘—. æ•…äº‹ä»¥åŒæ ·çš„æ–¹å¼å¼€å§‹, ä½†åœ¨ç¬¬ 1 ç« ä¸­, å½“ Alice å†³å®šåˆ›å»ºä¸€ä¸ªéƒ¨åˆ†ä¸å…¼å®¹çš„æ–° OAuth2 API æ—¶, å¥¹ä¸èƒ½ä½¿ç”¨ â€œoauth2â€ ä½œä¸ºå…¶å¯¼å…¥è·¯å¾„. ç›¸å, å¥¹å°†æ–°ç‰ˆæœ¬å‘½åä¸º Pocoauth, å¹¶ä¸ºå…¶æä¾›å¯¼å…¥è·¯å¾„ â€œpocoauthâ€.</p><p>é¢å¯¹ä¸¤ä¸ªä¸åŒçš„ OAuth2 è½¯ä»¶åŒ…, Moe (Moauth çš„ä½œè€…) å¿…é¡»ä¸º Pocoauth ç¼–å†™ç¬¬äºŒä¸ªè½¯ä»¶åŒ… Moauth, ä»–å‘½åä¸º Pocomoauth å¹¶ç»™å‡ºäº†å¯¼å…¥è·¯å¾„ â€œpocomoauthâ€.</p><p>å½“ Anna å°† AWS è½¯ä»¶åŒ…æ›´æ–°ä¸ºæ–°çš„ OAuth2 API æ—¶, å¥¹è¿˜å°†è¯¥ä»£ç ä¸­çš„å¯¼å…¥è·¯å¾„ä» â€œoauth2â€ æ›´æ”¹ä¸º â€œpocoauthâ€, å¹¶å°† â€œmoauthâ€ ä¸­çš„å¯¼å…¥è·¯å¾„æ›´æ”¹ä¸º â€œpocomoauthâ€. ç„¶å, éšç€ AWS r2 å’Œ AWS r3 çš„å‘å¸ƒ, æ•…äº‹ä¼šç»§ç»­è¿›è¡Œ.</p><p>åœ¨ç¬¬ 2 ç« ä¸­, å½“ Ugo çƒ­åˆ‡åœ°é‡‡ç”¨ Amazon Zeta æ—¶, ä¸€åˆ‡æ­£å¸¸. æ‰€æœ‰è½¯ä»¶åŒ…ä»£ç ä¸­çš„å¯¼å…¥éƒ½å®Œå…¨åŒ¹é…éœ€è¦æ„å»ºçš„ä»£ç . ä»–ä¸å¿…åœ¨ StackOverflow ä¸ŠæŸ¥æ‰¾ç‰¹æ®Šæ ‡å¿—(flag), è€Œä¸”ä»–åˆé¤ä»…ä»…æ™šäº†äº”åˆ†é’Ÿ.</p><p><img src="/static/images/deps-b1-short@2x.png" width="550px" height="517px"></p><p>åœ¨ç¬¬ 3 ç« ä¸­, Amy å°†åŸºäº Moauth çš„ API æ·»åŠ åˆ° Azure, è€Œ Anna åˆ™å°†ç›¸åŒçš„åŸºäº Pocomoauth çš„ API æ·»åŠ åˆ° AWS.</p><p>å½“ Ugo å†³å®šæ›´æ–° Azure å’Œ AWS æ—¶, å†æ¬¡æ²¡æœ‰é—®é¢˜. ä»–æ›´æ–°çš„ç¨‹åºä¸éœ€è¦ä»»ä½•ç‰¹æ®Šçš„é‡æ„:</p><p><img src="/static/images/deps-b2-short@2x.png" width="550px" height="467px"></p><p>åœ¨è¿™ä¸ªæ•…äº‹ç‰ˆæœ¬çš„æœ«å°¾, Ugo ç”šè‡³éƒ½æ²¡æœ‰æƒ³åˆ°ä»–çš„åŒ…ç®¡ç†å™¨. å®ƒæ­£å¸¸å·¥ä½œ; ä»–å‡ ä¹æ²¡æœ‰æ³¨æ„åˆ°å®ƒåœ¨é‚£é‡Œ.</p><p>ä¸æ•…äº‹çš„è¯­ä¹‰ç‰ˆæœ¬ç¿»è¯‘ç›¸æ¯”, è¿™é‡Œä½¿ç”¨å¯¼å…¥ç‰ˆæœ¬åŒ–æ”¹å˜äº†ä¸¤ä¸ªå…³é”®ç»†èŠ‚. é¦–å…ˆ, å½“ Alice ä»‹ç»äº†å¥¹å‘åå…¼å®¹çš„ OAuth2 API æ—¶, å¥¹ä¸å¾—ä¸å°†å…¶ä½œä¸ºä¸€ä¸ªæ–°åŒ…å‘å¸ƒ (Pocoauth). å…¶æ¬¡, ç”±äº Moe çš„å°è£…åŒ… Moauth åœ¨å…¶ API ä¸­å…¬å¼€äº† OAuth2 åŒ…çš„ç±»å‹å®šä¹‰, Alice å‘å¸ƒäº†ä¸€ä¸ªæ–°åŒ…è¿«ä½¿ Moe ä¹Ÿå‘å¸ƒäº†ä¸€ä¸ªæ–°åŒ… (Pocomoauth). Ugo æœ€ç»ˆçš„ Unity æ„å»ºè¿›å±•é¡ºåˆ©, å› ä¸º Alice å’Œ Moe çš„è½¯ä»¶åŒ…æ‹†åˆ†åˆ›å»ºä¿æŒäº† Unity ç­‰å®¢æˆ·ç«¯æ„å»ºå’Œè¿è¡Œæ‰€éœ€çš„ç»“æ„. å–è€Œä»£ä¹‹çš„æ˜¯, Ugo å’Œåƒä»–ä¸€æ ·çš„ç”¨æˆ·ä¸å†éœ€è¦è¯¸å¦‚ -fmultiverse -fclone è¿™æ ·å¤–æ¥é‡æ„è¾…åŠ©çš„ä¸å®Œæ•´åŒ…ç®¡ç†çš„å¤æ‚æ€§, å¯¼å…¥å…¼å®¹æ€§è§„åˆ™å°†å°‘é‡é¢å¤–çš„å·¥ä½œæ¨ç»™åŒ…ä½œè€…, ä»è€Œè®©æ‰€æœ‰ç”¨æˆ·æ”¶ç›Š.</p><p>éœ€è¦ä¸ºæ¯ä¸ªå‘åä¸å…¼å®¹çš„ API æ›´æ”¹å¼•å…¥ä¸€ä¸ªæ–°åç§°è‚¯å®šä¼šæœ‰æˆæœ¬, ä½†æ­£å¦‚ semver FAQ æ‰€è¿°, è¯¥æˆæœ¬åº”é¼“åŠ±ä½œè€…æ›´æ¸…æ¥šåœ°è€ƒè™‘è¿™äº›å˜åŒ–çš„å½±å“ä»¥åŠå®ƒä»¬æ˜¯å¦çœŸçš„æœ‰å¿…è¦. è€Œåœ¨å¯¼å…¥ç‰ˆæœ¬æ§åˆ¶çš„æƒ…å†µä¸‹, æˆæœ¬ä¼šä¸ºç”¨æˆ·å¸¦æ¥æ˜¾è‘—çš„æ”¶ç›Š.</p><p>å¯¼å…¥ç‰ˆæœ¬æ§åˆ¶ (Import Versioning) çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯ç¨‹åºåŒ…åç§°å’Œå¯¼å…¥è·¯å¾„æ˜¯ Go å¼€å‘äººå‘˜èƒ½å¾ˆå¥½ç†è§£çš„æ¦‚å¿µ. å¦‚æœä½ å‘Šè¯‰ä¸€ä¸ªåŒ…ä½œè€…, åšå‡ºå‘åä¸å…¼å®¹çš„æ›´æ”¹éœ€è¦åˆ›å»ºå…·æœ‰ä¸åŒå¯¼å…¥è·¯å¾„çš„ä¸åŒåŒ…, é‚£ä¹ˆ - å³ä¾¿æ²¡æœ‰ä»»ä½•ç‰ˆæœ¬æ§åˆ¶çš„çŸ¥è¯† - ä½œè€…å¯ä»¥é€šè¿‡å¯¹å®¢æˆ·ç«¯åŒ…çš„å½±å“æ¨ç†: å®¢æˆ·ç«¯éœ€è¦æ›´æ”¹ä»–ä»¬çš„å¯¼å…¥ä¸€æ¬¡; Moauth ä¸å†é€‚ç”¨äºæ–°çš„è½¯ä»¶åŒ…, ç­‰ç­‰.</p><p>èƒ½å¤Ÿæ›´æ¸…æ¥šåœ°é¢„æµ‹å¯¹ç”¨æˆ·çš„å½±å“, ä½œè€…å¯èƒ½ä¼šå¯¹ä»–ä»¬çš„å˜åŒ–åšå‡ºä¸åŒçš„, æ›´å¥½çš„å†³ç­–. Alice å¯èƒ½ä¼šå¯»æ±‚å°†æ–°çš„æ›´æ¸…æ™°çš„ API ä¸ç°æœ‰ API ä¸€èµ·å¼•å…¥æœ€åˆçš„ OAuth2 åŒ…ä¸­, ä»¥é¿å…åŒ…æ‹†åˆ†. Moe å¯èƒ½ä¼šæ›´ä»”ç»†åœ°è€ƒè™‘æ˜¯å¦å¯ä»¥ä½¿ç”¨æ¥å£æ¥ä½¿ Moauth æ”¯æŒ OAuth2 å’Œ Pocoauth, ä»è€Œé¿å…ä½¿ç”¨æ–°çš„ Pocomoauth åŒ…. Amy å¯èƒ½ä¼šè®¤ä¸ºæ›´æ–°åˆ° Pocoauth å’Œ Pocomoauth æ˜¯å€¼å¾—çš„, è€Œä¸æ˜¯æš´éœ² Azure API ä½¿ç”¨è¿‡æ—¶çš„ OAuth2 å’Œ Moauth åŒ…çš„äº‹å®. Anna å¯èƒ½ä¼šå°è¯•è®© AWS API å…è®¸ Moauth æˆ– Pocomoauth ä½¿ Azure ç”¨æˆ·æ›´å®¹æ˜“åˆ‡æ¢.</p><p>ç›¸æ¯”ä¹‹ä¸‹, semver â€œä¸»ç‰ˆæœ¬å‡çº§ (bump)â€ çš„å«ä¹‰è¿œä¸æ˜¯é‚£ä¹ˆæ¸…æ™°, å¹¶ä¸”ä¸ä¼šå¯¹ä½œè€…æ–½åŠ åŒæ ·çš„è®¾è®¡å‹åŠ›. éœ€è¦æ¸…æ¥šçš„æ˜¯, è¿™ç§æ–¹æ³•ä¸ºä½œè€…åˆ›é€ äº†æ›´å¤šçš„å·¥ä½œ, ä½†é€šè¿‡ä¸ºç”¨æˆ·å¸¦æ¥æ˜¾è‘—çš„å¥½å¤„, è¿™é¡¹å·¥ä½œæ˜¯åˆç†çš„. æ€»çš„æ¥è¯´, è¿™ç§æƒè¡¡æ˜¯æœ‰é“ç†çš„, å› ä¸ºè½¯ä»¶åŒ…çš„ç›®æ ‡æ˜¯æ‹¥æœ‰æ¯”ä½œè€…æ›´å¤šçš„ç”¨æˆ·, å¹¶ä¸”å¸Œæœ›æ‰€æœ‰è½¯ä»¶åŒ…è‡³å°‘æ‹¥æœ‰ä¸ä½œè€…ä¸€æ ·å¤šçš„ç”¨æˆ·.</p><h3 id="è¯­ä¹‰å¯¼å…¥ç‰ˆæœ¬æ§åˆ¶"><a href="#è¯­ä¹‰å¯¼å…¥ç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="è¯­ä¹‰å¯¼å…¥ç‰ˆæœ¬æ§åˆ¶"></a>è¯­ä¹‰å¯¼å…¥ç‰ˆæœ¬æ§åˆ¶</h3><p>ä¸Šä¸€èŠ‚å±•ç¤ºäº†åœ¨æ›´æ–°æœŸé—´, å¯¼å…¥ç‰ˆæœ¬å¦‚ä½•å¸¦æ¥ç®€å•, å¯é¢„æµ‹çš„æ„å»º. ä½†æ˜¯, åœ¨æ¯æ¬¡å‘åå…¼å®¹çš„æ›´æ”¹ä¸­é€‰æ‹©ä¸€ä¸ªæ–°åå­—å¯¹ç”¨æˆ·æ¥è¯´éƒ½å¾ˆå›°éš¾å¹¶ä¸”æ²¡æœ‰ä»»ä½•å¸®åŠ©. é‰´äº OAuth2 å’Œ Pocoauth ä¹‹é—´çš„é€‰æ‹©, Amy åº”è¯¥ä½¿ç”¨å“ªä¸ª ? æ²¡æœ‰è¿›ä¸€æ­¥è°ƒæŸ¥, å°±æ²¡æœ‰åŠæ³•çŸ¥é“. ç›¸æ¯”ä¹‹ä¸‹, è¯­ä¹‰ç‰ˆæœ¬åŒ–ä½¿å¾—è¿™å¾ˆå®¹æ˜“: OAuth2 2.0.0 æ˜¾ç„¶æ˜¯ OAuth2 1.0.0 çš„é¢„æœŸæ›¿ä»£å“.</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶, å¹¶é€šè¿‡åœ¨å¯¼å…¥è·¯å¾„ä¸­åŒ…å«ä¸»ç‰ˆæœ¬æ¥éµå¾ªå¯¼å…¥å…¼å®¹æ€§è§„åˆ™. Alice å¯ä»¥ç”¨æ–°çš„å¯¼å…¥è·¯å¾„ â€œoauth2/v2â€ è°ƒç”¨å¥¹æ–°çš„ API OAuth2 2.0.0, è€Œä¸éœ€è¦åˆ›å»ºä¸€ä¸ªå¯çˆ±ä½†ä¸ç›¸å…³çš„æ–°åç§° Pocoauth. Moe ä¹Ÿä¸€æ ·: Moauth 2.0.0 (å¯¼å…¥ä¸º â€œmoauth/v2â€ ) ä¹Ÿå¯ä»¥æˆä¸º OAuth2 2.0.0 çš„è¾…åŠ©åŒ…, å°±åƒ Moauth 1.0.0 æ˜¯ OAuth2 1.0.0 çš„è¾…åŠ©åŒ…ä¸€æ ·.</p><p>å½“ Ugo åœ¨ç¬¬  2ç« ä¸­æ·»åŠ  Zeta æ”¯æŒæ—¶, ä»–çš„æ„å»ºçœ‹èµ·æ¥åƒè¿™æ ·:</p><p><img src="/static/images/deps-c1-short@2x.png" width="567px" height="467px"></p><p>å› ä¸º â€œmoauthâ€ å’Œ â€œmoauth/v2â€ åªæ˜¯ä¸åŒçš„è½¯ä»¶åŒ…, æ‰€ä»¥ Ugo å®Œå…¨æ¸…æ¥šä»–éœ€è¦å¦‚ä½•ä½¿ç”¨ Azure çš„ â€œmoauthâ€ ä»¥åŠä½¿ç”¨ AWS çš„ â€œmoauth/v2â€: å¯¼å…¥ä¸¤è€….</p><p><img src="/static/images/deps-c2-short@2x.png" width="550px" height="467px"></p><p>ä¸ºäº†å…¼å®¹ç°æœ‰çš„ Go ç”¨æ³•, å¹¶ä½œä¸ºä¸åšå‘åä¸å…¼å®¹çš„ API æ›´æ”¹çš„å°é¼“åŠ±, æˆ‘åœ¨æ­¤å‡å®šä¸»è¦ç‰ˆæœ¬ 1 ä»å¯¼å…¥è·¯å¾„ä¸­çœç•¥: import â€œmoauthâ€, è€Œä¸æ˜¯ â€œmoauth/v1â€. åŒæ ·, ä¸»è¦ç‰ˆæœ¬ 0 æ˜ç¡®æ‹’ç»å…¼å®¹æ€§, ä¹Ÿä»å¯¼å…¥è·¯å¾„ä¸­çœç•¥. è¿™é‡Œçš„æƒ³æ³•æ˜¯, é€šè¿‡ä½¿ç”¨ v0 ä¾èµ–å…³ç³», ç”¨æˆ·æ˜ç¡®æ‰¿è®¤ç ´åçš„å¯èƒ½æ€§å¹¶åœ¨é€‰æ‹©æ›´æ–°æ—¶æ‰¿æ‹…å¤„ç†å®ƒçš„è´£ä»». (å½“ç„¶, æ›´æ–°ä¸ä¼šè‡ªåŠ¨å‘ç”Ÿæ˜¯å¾ˆé‡è¦çš„. æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­çœ‹åˆ°å¦‚ä½•æœ€å°åŒ–ç‰ˆæœ¬é€‰æ‹©å¯¹æ­¤æœ‰æ‰€å¸®åŠ©.)</p><h3 id="åŠŸèƒ½æ€§åç§°å’Œä¸å¯å˜çš„å«ä¹‰"><a href="#åŠŸèƒ½æ€§åç§°å’Œä¸å¯å˜çš„å«ä¹‰" class="headerlink" title="åŠŸèƒ½æ€§åç§°å’Œä¸å¯å˜çš„å«ä¹‰"></a>åŠŸèƒ½æ€§åç§°å’Œä¸å¯å˜çš„å«ä¹‰</h3><p>äºŒåå¹´å‰, Rob Pike å’Œæˆ‘æ­£åœ¨ä¿®æ”¹ Plan 9 C åº“çš„å†…éƒ¨ç»“æ„, Rob æ•™ä¼šäº†æˆ‘è¿™æ ·ä¸€ä¸ªç»éªŒæ³•åˆ™, å½“ä½ æ”¹å˜ä¸€ä¸ªå‡½æ•°çš„è¡Œä¸ºæ—¶, ä½ ä¹Ÿæ”¹å˜å®ƒçš„åå­—. æ—§çš„åå­—æœ‰ä¸€ä¸ªå«ä¹‰. é€šè¿‡å¯¹æ–°åç§°ä½¿ç”¨ä¸åŒçš„å«ä¹‰å¹¶åˆ é™¤æ—§åç§°, æˆ‘ä»¬ç¡®ä¿ç¼–è¯‘å™¨ä¼šå¤§å£°æŠ±æ€¨éœ€è¦æ£€æŸ¥å’Œæ›´æ–°çš„æ¯æ®µä»£ç , è€Œä¸æ˜¯é™é™åœ°ç¼–è¯‘ä¸æ­£ç¡®çš„ä»£ç . å¦‚æœäººä»¬æœ‰ä»–ä»¬è‡ªå·±çš„ç¨‹åºåœ¨ä½¿ç”¨è¿™ä¸ªå‡½æ•°, ä»–ä»¬ä¼šå¾—åˆ°ç¼–è¯‘æ—¶å¤±è´¥, è€Œä¸æ˜¯é•¿æ—¶é—´çš„è°ƒè¯•ä¼šè¯. åœ¨å½“ä»Šåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶çš„ä¸–ç•Œä¸­, æœ€åä¸€ä¸ªé—®é¢˜è¢«æ”¾å¤§äº†, è¿™ä½¿å¾—åç§°å˜å¾—æ›´åŠ é‡è¦. å¹¶å‘ç¼–å†™çš„æ—§ä»£ç æ‰€æœŸæœ›çš„æ—§çš„è¯­ä¹‰ä¸åº”è¯¥åœ¨åˆå¹¶çš„æ—¶å€™è¢«æ–°çš„è¯­ä¹‰æ›¿ä»£.</p><p>å½“ç„¶, åˆ é™¤æ—§å‡½æ•°åªæœ‰åœ¨å¯ä»¥æ‰¾åˆ°æ‰€æœ‰ç”¨åˆ°å®ƒçš„åœ°æ–¹, æˆ–è€…å½“ç”¨æˆ·äº†è§£ä»–ä»¬æœ‰è´£ä»»è·Ÿä¸Šå˜åŒ–æ—¶æ‰ä¼šèµ·ä½œç”¨, ä¾‹å¦‚åœ¨ Plan 9 ç­‰ç ”ç©¶ç³»ç»Ÿä¸­. å¯¹äºå¯¼å‡ºçš„ API, é€šå¸¸ä¼šæ›´å¥½åœ°ä¿ç•™æ—§åç§°å’Œæ—§è¡Œä¸º, å¹¶åªæ·»åŠ æ–°è¡Œä¸ºçš„æ–°åç§°. Rich Hickey åœ¨ 2016 å¹´çš„ â€œ<a href="https://www.youtube.com/watch?v=oyLBGkS5ICk" target="_blank" rel="noopener">Spec-ulation</a>â€œ æ¼”è®²ä¸­æåˆ°äº†è¿™ä¸€ç‚¹, å³åªæ·»åŠ æ–°åç§°å’Œè¡Œä¸º, ä¸åˆ é™¤æ—§åç§°æˆ–é‡æ–°å®šä¹‰å…¶å«ä¹‰, æ­£æ˜¯å‡½æ•°å¼ç¼–ç¨‹é¼“åŠ±çš„ä¸ªä½“å˜é‡æˆ–æ•°æ®ç»“æ„. åŠŸèƒ½æ€§æ–¹æ³•åœ¨å°è§„æ¨¡ç¼–ç¨‹ä¸­å¸¦æ¥äº†æ˜ç¡®æ€§å’Œå¯é¢„æµ‹æ€§æ–¹é¢çš„å¥½å¤„, å¹¶ä¸”åœ¨åº”ç”¨æ—¶æ•ˆç›Šæ›´å¤§, å°±åƒå¯¼å…¥å…¼å®¹æ€§è§„åˆ™ä¸€æ ·, å¯¹äºæ•´ä¸ª API: ä¾èµ–åœ°ç‹±å®é™…ä¸Šåªæ˜¯å¯å˜æ€§è€Œå·². è¿™åªæ˜¯æ¼”è®²ä¸­çš„ä¸€ä¸ªå°ç‚¹; æ•´ä¸ªæ¼”è®²å€¼å¾—ä¸€çœ‹.</p><p>åœ¨ â€œgo getâ€ çš„æ—©æœŸ, å½“äººä»¬è¯¢é—®æœ‰å…³åšå‡ºå‘åä¸å…¼å®¹çš„å˜åŒ–æ—¶, æˆ‘ä»¬çš„å›åº”æ˜¯ - åŸºäºå¤šå¹´æ¥å¯¹è¿™äº›è½¯ä»¶å˜åŒ–çš„ç»éªŒå¾—å‡ºçš„ç›´è§‰ - æ˜¯ç»™å‡ºå¯¼å…¥ç‰ˆæœ¬è§„åˆ™, ä½†æ²¡æœ‰æ˜ç¡®çš„è§£é‡Š, ä¸ºä»€ä¹ˆè¿™ç§æ–¹æ³•æ¯”ä¸æŠŠä¸»ç‰ˆæœ¬æ”¾åœ¨å¯¼å…¥è·¯å¾„ä¸­æ›´å¥½. Go 1.2 æ·»åŠ äº†ä¸€ä¸ªå…³äºè½¯ä»¶åŒ…ç‰ˆæœ¬æ§åˆ¶çš„ FAQ æ¡ç›®, å®ƒæä¾›äº†åŸºæœ¬çš„å»ºè®® (Go 1.10 ä¹Ÿæ˜¯):</p><blockquote><p>æ‰“ç®—ä¾›å…¬ä¼—ä½¿ç”¨çš„è½¯ä»¶åŒ…åº”è¯¥å°½é‡ä¿æŒå‘åå…¼å®¹æ€§. <a href="https://golang.org/doc/go1compat.html" target="_blank" rel="noopener">Go 1 å…¼å®¹æ€§å‡†åˆ™</a>åœ¨è¿™é‡Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å‚è€ƒ: ä¸è¦åˆ é™¤å¯¼å‡ºçš„åç§°, é¼“åŠ±æ ‡è®°çš„å¤åˆå­—é¢é‡ç­‰ç­‰. å¦‚æœéœ€è¦ä¸åŒçš„åŠŸèƒ½, è¯·æ·»åŠ æ–°åç§°è€Œä¸æ˜¯æ›´æ”¹æ—§åç§°. å¦‚æœéœ€è¦å®Œå…¨ç ´åå…¼å®¹æ€§, è¯·ä½¿ç”¨æ–°çš„å¯¼å…¥è·¯å¾„åˆ›å»ºæ–°çš„ç¨‹åºåŒ….</p></blockquote><p>è¿™ç¯‡åšæ–‡çš„ä¸€ä¸ªåŠ¨æœºæ˜¯ç”¨ä¸€ä¸ªæ¸…æ™°â€‹â€‹å¯ä¿¡çš„ä¾‹å­æ¥å±•ç¤ºä¸ºä»€ä¹ˆéµå¾ªè§„åˆ™æ˜¯å¦‚æ­¤é‡è¦.</p><h3 id="é¿å…å•ä¾‹-Singleton-é—®é¢˜"><a href="#é¿å…å•ä¾‹-Singleton-é—®é¢˜" class="headerlink" title="é¿å…å•ä¾‹ (Singleton) é—®é¢˜"></a>é¿å…å•ä¾‹ (Singleton) é—®é¢˜</h3><p>å¯¹è¯­ä¹‰å¯¼å…¥ç‰ˆæœ¬ç®¡ç†æ–¹æ³•çš„ä¸€ä¸ªæ™®éåå¯¹æ„è§æ˜¯, åŒ…ä½œè€…ä»Šå¤©é¢„è®¡åœ¨ç»™å®šçš„æ„å»ºä¸­åªæœ‰ä¸€ä¸ªåŒ…çš„å‰¯æœ¬. åœ¨ä¸åŒä¸»è¦ç‰ˆæœ¬ä¸­å…è®¸å¤šä¸ªåŒ…å¯èƒ½ä¼šç”±äºå•ä¾‹çš„æ„å¤–é‡å¤è€Œå¯¼è‡´é—®é¢˜. ä¸€ä¸ªä¾‹å­æ˜¯æ³¨å†Œä¸€ä¸ª HTTP handler. å¦‚æœ my/thing ä¸º /debug/my/thing æ³¨å†Œäº†ä¸€ä¸ª HTTP handler, é‚£ä¹ˆæ‹¥æœ‰è¯¥ç¨‹åºåŒ…çš„ä¸¤ä¸ªå‰¯æœ¬å°†å¯¼è‡´é‡å¤çš„æ³¨å†Œ, è¿™åœ¨æ³¨å†Œæ—¶ä¼šå¼•èµ·ææ…Œ. å¦ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚æœç¨‹åºä¸­æœ‰ä¸¤ä¸ª HTTP å †æ ˆ. æ˜¾ç„¶, åªæœ‰ä¸€ä¸ª HTTP å †æ ˆå¯ä»¥åœ¨ç«¯å£ 80 ä¸Šç›‘å¬; æˆ‘ä»¬ä¸å¸Œæœ›ä¸€åŠçš„ç¨‹åºæ³¨å†Œä¸ä¼šè¢«ä½¿ç”¨çš„ handlers. <strong>Go å¼€å‘è€…å·²ç»ç”±äº vendored åŒ…å‡ºç°è¿™æ ·çš„é—®é¢˜</strong>.</p><p>è¿ç§»åˆ° vgo å’Œè¯­ä¹‰å¯¼å…¥ç‰ˆæœ¬å¯ä»¥æ¾„æ¸…å¹¶ç®€åŒ–å½“å‰çš„æƒ…å†µ. é€šè¿‡å–ä»£ vendoring å¯¼è‡´çš„ä¸å¯æ§çš„é‡å¤é—®é¢˜, åŒ…ä½œè€…å°†ä¿è¯æ¯ä¸ªä¸»ç‰ˆæœ¬çš„è½¯ä»¶åŒ…åªæœ‰ä¸€ä¸ªå®ä¾‹. é€šè¿‡å°†ä¸»è¦ç‰ˆæœ¬åŒ…å«åœ¨å¯¼å…¥è·¯å¾„ä¸­, åŒ…ä½œè€…åº”è¯¥æ›´æ¸…æ¥š my/thing å’Œ my/thing/v2 æ˜¯ä¸åŒçš„å¹¶ä¸”éœ€è¦èƒ½å¤Ÿå…±å­˜. æˆ–è®¸è¿™æ„å‘³ç€åœ¨ /debug/my/thing/v2 ä¸Šå¯¼å‡º v2 è°ƒè¯•ä¿¡æ¯. æˆ–è€…è¿™ä¹Ÿè®¸æ„å‘³ç€åè°ƒ. ä¹Ÿè®¸ v2 å¯ä»¥è´Ÿè´£æ³¨å†Œ handler, ä½†ä¹Ÿå¯ä»¥ä¸º v1 æä¾›ä¸€ä¸ªé’©å­(hook)æ¥æä¾›ä¿¡æ¯ä»¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š. è¿™æ„å‘³ç€ my/thing å¯¼å…¥ my/thing/v2 æˆ–åä¹‹äº¦ç„¶; å…·æœ‰ä¸åŒçš„å¯¼å…¥è·¯å¾„, è¿™å¾ˆå®¹æ˜“åšåˆ°å¹¶ä¸”æ˜“äºç†è§£. ç›¸å, å¦‚æœ v1 å’Œv2 éƒ½æ˜¯ my/thing, é‚£ä¹ˆå¾ˆéš¾ç†è§£å¯¼å…¥è‡ªå·±çš„å¯¼å…¥è·¯å¾„å¹¶è·å–å…¶ä»–å¯¼å…¥è·¯å¾„çš„å«ä¹‰.</p><h3 id="è‡ªåŠ¨-API-æ›´æ–°"><a href="#è‡ªåŠ¨-API-æ›´æ–°" class="headerlink" title="è‡ªåŠ¨ API æ›´æ–°"></a>è‡ªåŠ¨ API æ›´æ–°</h3><p>å…è®¸ç¨‹åºåŒ…çš„ v1 å’Œ v2 å…±å­˜äºä¸€ä¸ªå¤§å‹ç¨‹åºä¸­çš„å…³é”®åŸå› ä¹‹ä¸€æ˜¯å¯ä»¥ä¸€æ¬¡å‡çº§è¯¥ç¨‹åºåŒ…çš„å®¢æˆ·ç«¯, å¹¶ä¸”ä»ç„¶å…·æœ‰å¯æ„å»ºçš„ç»“æœ. è¿™æ˜¯é€æ­¥ä¿®å¤ä»£ç çš„æ›´ä¸€èˆ¬é—®é¢˜çš„å…·ä½“å®ä¾‹. (è¯·å‚é˜…æˆ‘çš„ 2016 å¹´æ–‡ç«  â€œ<a href="https://talks.golang.org/2016/refactor.article" target="_blank" rel="noopener">Codebase Refactoring (with help from Go),</a>â€œ äº†è§£æ›´å¤šå…³äºè¯¥é—®é¢˜çš„ä¿¡æ¯.)</p><p>é™¤äº†ä¿æŒç¨‹åºçš„æ„å»ºå¤–, è¯­ä¹‰å¯¼å…¥ç‰ˆæœ¬æ§åˆ¶å¯¹é€æ­¥ä¿®å¤ä»£ç æœ‰å¾ˆå¤§çš„å¥½å¤„, æˆ‘åœ¨å‰é¢çš„ç« èŠ‚ä¸­æåˆ°è¿‡: ä»£ç åŒ…çš„ä¸€ä¸ªä¸»ç‰ˆæœ¬å¯ä»¥å¯¼å…¥å¹¶ç”¨å¦ä¸€ä¸ªç‰ˆæœ¬ç¼–å†™. å°† v2 API ç¼–å†™ä¸º v1 å®ç°çš„å°è£…å¾ˆç®€å•, åä¹‹äº¦ç„¶. è¿™è®©ä»–ä»¬èƒ½å¤Ÿå…±äº«ä»£ç , å¹¶ä¸”é€šè¿‡é€‚å½“çš„è®¾è®¡é€‰æ‹©å’Œä½¿ç”¨ç±»å‹åˆ«å, ç”šè‡³å¯ä»¥å…è®¸ä½¿ç”¨ v1 å’Œ v2 çš„å®¢æˆ·ç«¯è¿›è¡Œäº’æ“ä½œ. å®ƒè¿˜å¯ä»¥å¸®åŠ©è§£å†³å®šä¹‰è‡ªåŠ¨ API æ›´æ–°ä¸­çš„å…³é”®æŠ€æœ¯é—®é¢˜.</p><p>åœ¨ Go 1 ä¹‹å‰, æˆ‘ä»¬ä¸¥é‡ä¾èµ–äº go fix, åœ¨æ›´æ–°åˆ°æ–°çš„ Go ç‰ˆæœ¬å, ç”¨æˆ·è¿è¡Œå®ƒå¹¶æ‰¾åˆ°ä¸å†ç¼–è¯‘çš„ç¨‹åº. æ›´æ–°ç¼–è¯‘ä¸è¿‡çš„ä»£ç ä½¿å¾—æˆ‘ä»¬æ— æ³•ä½¿ç”¨å¤§å¤šæ•°æˆ‘ä»¬çš„ç¨‹åºåˆ†æå·¥å…·, è¿™äº›å·¥å…·è¦æ±‚å…¶è¾“å…¥æ˜¯æœ‰æ•ˆçš„ç¨‹åº. å¦å¤–, æˆ‘ä»¬æƒ³çŸ¥é“å¦‚ä½•å…è®¸ Go æ ‡å‡†åº“ä¹‹å¤–çš„åŒ…çš„ä½œè€…æä¾›ç‰¹å®šäºå…¶è‡ªå·±çš„ API æ›´æ–°çš„ â€œä¿®å¤â€. åœ¨å•ä¸ªç¨‹åºä¸­å‘½åå’Œå¤„ç†å¤šä¸ªä¸å…¼å®¹ç‰ˆæœ¬çš„è½¯ä»¶åŒ…çš„èƒ½åŠ›æç¤ºäº†ä¸€ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆ: å¦‚æœ v1 API å‡½æ•°å¯ä»¥ä½œä¸º v2 API çš„åŒ…è£…å™¨æ¥å®ç°, åˆ™åŒ…è£…å™¨å®ç°æ˜¯ä¿®è®¢è§„èŒƒçš„ä¸¤å€. ä¾‹å¦‚, å‡è®¾ API çš„ v1 å‡½æ•°å…·æœ‰ EnableFoo å’Œ DisableFoo å‡½æ•°, v2 ç”¨ä¸€ä¸ª SetFoo(enabled bool) æ›¿æ¢è¯¥å‡½æ•°å¯¹. v2 å‘å¸ƒå, v1 å¯ä»¥ä½œä¸º v2 çš„åŒ…è£…å®ç°:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package p // v1</span><br><span class="line"></span><br><span class="line">import v2 &quot;p/v2&quot;</span><br><span class="line"></span><br><span class="line">func EnableFoo() &#123;</span><br><span class="line">//go:fix</span><br><span class="line">v2.SetFoo(true)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func DisableFoo() &#123;</span><br><span class="line">//go:fix</span><br><span class="line">v2.SetFoo(false)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç‰¹åˆ«çš„ //go:fix æ³¨é‡Šä¼šæŒ‡ç¤ºå»ä¿®æ­£åé¢çš„åŒ…è£…ä½“åº”è¯¥è¢«å†…è”åˆ°è°ƒç”¨ä¸­. ç„¶åè¿è¡Œ go fix å°†é‡å†™è°ƒç”¨ v1 EnableFoo ä¸º v2 SetFoo(true). é‡å†™å¾ˆå®¹æ˜“æŒ‡å®šå’Œç±»å‹æ£€æŸ¥, å› ä¸ºå®ƒæ˜¯ç®€å•çš„ Go ä»£ç . æ›´å¥½çš„æ˜¯, é‡å†™æ˜¾ç„¶æ˜¯å®‰å…¨çš„: v1 EnableFoo å·²ç»åœ¨è°ƒç”¨ v2 SetFoo(true), æ‰€ä»¥é‡å†™è°ƒç”¨æ˜¾ç„¶ä¸ä¼šæ”¹å˜ç¨‹åºçš„å«ä¹‰.</p><p>åˆç†çš„åšæ³•å¯èƒ½æ˜¯ä½¿ç”¨ç¬¦å·æ‰§è¡Œæ¥ä¿®å¤åå‘ API æ›´æ”¹, ä»ä½¿ç”¨ SetFoo çš„ v1 åˆ°ä½¿ç”¨ EnableFoo å’Œ DisableFoo çš„ v2. v1 SetFoo å®ç°å¯ä»¥è¯»å–:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package q // v1</span><br><span class="line"></span><br><span class="line">import v2 &quot;q/v2&quot;</span><br><span class="line"></span><br><span class="line">func SetFoo(enabled bool) &#123;</span><br><span class="line">if enabled &#123;</span><br><span class="line">//go:fix</span><br><span class="line">v2.EnableFoo()</span><br><span class="line">&#125; else &#123;</span><br><span class="line">//go:fix</span><br><span class="line">v2.DisableFoo()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶å go fix ä¼šæ›´æ–° SetFoo(true) ä¸º EnableFoo(), SetFoo(false) ä¸º DisableFoo(). è¿™ç§ä¿®è¡¥ç¨‹åºç”šè‡³ä¼šåº”ç”¨äºå•ä¸ªä¸»è¦ç‰ˆæœ¬ä¸­çš„ API æ›´æ–°. ä¾‹å¦‚, v1 å¯èƒ½ä¼šè¢«å¼ƒç”¨(ä½†ä¿ç•™) SetFoo, å¹¶å¼•å…¥ EnableFoo å’Œ DisableFoo. åŒæ ·çš„ä¿®å¤å°†å¸®åŠ©è°ƒç”¨è€…æ‘†è„±å·²å¼ƒç”¨çš„ API.</p><p>è¦æ¸…æ¥šçš„æ˜¯, ä»Šå¤©è¿™è¿˜æ²¡æœ‰å®ç°, ä½†å®ƒçœ‹èµ·æ¥å¾ˆæœ‰å‰æ™¯, è€Œä¸”é€šè¿‡èµ‹äºˆä¸åŒçš„ä¸œè¥¿ä»¥ä¸åŒçš„åç§°, ä½¿å¾—è¿™ç§å·¥å…·æˆä¸ºå¯èƒ½. è¿™äº›ç¤ºä¾‹æ¼”ç¤ºäº†å°†æŒä¹…çš„, ä¸å¯å˜çš„åç§°é™„åŠ åˆ°ç‰¹å®šä»£ç è¡Œä¸ºçš„èƒ½åŠ›. æˆ‘ä»¬åªéœ€éµå¾ªè¿™æ ·çš„è§„åˆ™: å½“ä½ æ”¹å˜æŸäº›ä¸œè¥¿æ—¶, ä½ ä¹Ÿæ”¹å˜äº†å®ƒçš„åå­—.</p><h3 id="è‡´åŠ›äºå…¼å®¹æ€§"><a href="#è‡´åŠ›äºå…¼å®¹æ€§" class="headerlink" title="è‡´åŠ›äºå…¼å®¹æ€§"></a>è‡´åŠ›äºå…¼å®¹æ€§</h3><p>è¯­ä¹‰å¯¼å…¥ç‰ˆæœ¬æ§åˆ¶å¯¹åŒ…çš„ä½œè€…æ¥è¯´æ›´æœ‰ç”¨. ä»–ä»¬ä¸èƒ½åªæ˜¯å†³å®šå‘å¸ƒ v2, è¿œç¦» v1, å¹¶ç•™ä¸‹åƒ Ugo è¿™æ ·çš„ç”¨æˆ·æ¥åº”å¯¹è¿™ç§åæœ. ä½†é‚£äº›è¿™ä¹ˆåšçš„åŒ…ä½œè€…æ­£åœ¨ä¼¤å®³ç”¨æˆ·. åœ¨æˆ‘çœ‹æ¥, å¦‚æœç³»ç»Ÿéš¾ä»¥ä¼¤å®³ç”¨æˆ·, å¹¶ä¸”è‡ªç„¶è€Œç„¶åœ°åŒ…ä½œè€…ä¹Ÿä¸ä¼šä½œå‡ºä¼¤å®³ç”¨æˆ·çš„è¡Œä¸º, é‚£ä¹ˆè¿™ä¼¼ä¹æ˜¯ä»¶å¥½äº‹.</p><p>æ›´ä¸€èˆ¬åœ°è¯´, Sam Boyer åœ¨ GopherCon 2017 ä¸Šè°ˆåˆ°äº†è½¯ä»¶åŒ…ç®¡ç†å¦‚ä½•è°ƒèŠ‚æˆ‘ä»¬çš„ç¤¾äº¤äº’åŠ¨, ä»¥åŠäººä»¬æ„å»ºè½¯ä»¶çš„åä½œ. æˆ‘ä»¬å¯ä»¥å†³å®š. æˆ‘ä»¬æ˜¯å¦å¸Œæœ›åœ¨ä¸€ä¸ªå›´ç»•ç³»ç»Ÿåˆ›å»ºçš„ç¤¾åŒºä¸­å·¥ä½œ, è¯¥ç³»ç»Ÿå¯ä»¥ä¼˜åŒ–å…¼å®¹æ€§, å¹³æ»‘è¿‡æ¸¡ä»¥åŠä¸€èµ·å¾ˆå¥½çš„å·¥ä½œ ? æˆ–è€…æˆ‘ä»¬æ˜¯å¦å¸Œæœ›åœ¨ä¸€ä¸ªå›´ç»•ç³»ç»Ÿåˆ›å»ºçš„ç¤¾åŒºä¸­å·¥ä½œ, è¯¥ç³»ç»Ÿå¯ä»¥ä¼˜åŒ–åˆ›å»ºå’Œæè¿°ä¸å…¼å®¹æ€§, è¿™ä½¿å¾—ä½œè€…ç ´åç”¨æˆ·ç¨‹åºä¹Ÿå¯ä»¥æ¥å— ? å¯¼å…¥ç‰ˆæœ¬æ§åˆ¶, ç‰¹åˆ«æ˜¯é€šè¿‡å°†è¯­ä¹‰ä¸»ç‰ˆæœ¬æå‡åˆ°å¯¼å…¥è·¯å¾„æ¥å¤„ç†è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶, å°±æ˜¯æˆ‘ä»¬å¦‚ä½•ç¡®ä¿åœ¨ç¬¬ä¸€ç§ç¤¾åŒºä¸­å·¥ä½œ.</p><p>è®©æˆ‘ä»¬è‡´åŠ›äºå…¼å®¹æ€§.</p>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> go </tag>
            
            <tag> vgo </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ç‰ˆæœ¬åŒ– Go ä¹‹æ—…</title>
      <link href="/post/vgo-tour.html"/>
      <url>/post/vgo-tour.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ª <a href="https://research.swtch.com/vgo-tour" target="_blank" rel="noopener">A Tour of Versioned Go (vgo)</a>, <a href="https://lingchao.xin/tag/vgo.html">Go &amp; Versioning</a> çš„ç¬¬ 2 éƒ¨åˆ†, ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰.<br><a id="more"></a></p><p>å¯¹æˆ‘è€Œè¨€, è®¾è®¡æ„å‘³ç€ä¸€éåˆä¸€éåœ°æ„å»º, æ‹†é™¤å’Œå†æ„å»º. ä¸ºäº†ç¼–å†™<a href="https://research.swtch.com/vgo-intro" target="_blank" rel="noopener">æ–°çš„ç‰ˆæœ¬æ§åˆ¶ææ¡ˆ</a>, æˆ‘æ„å»ºäº†ä¸€ä¸ªåŸå‹ vgo, æ¥å¤„ç†è®¸å¤šç»†å¾®çš„ç»†èŠ‚. è¿™ç¯‡åšæ–‡å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ vgo.</p><p>ä½ ç°åœ¨å¯ä»¥é€šè¿‡è¿è¡Œ go get golang.org/x/vgo ä¸‹è½½å¹¶å°è¯• vgo. Vgo æ˜¯ go å‘½ä»¤çš„ä¸€ä¸ªç›´æ¥æ›¿æ¢(å’Œåˆ†æ”¯æ‹·è´). ä½ è¿è¡Œ vgo è€Œä¸æ˜¯ go, å®ƒå°†ä½¿ç”¨ä½ å®‰è£…åœ¨ $GOROOT (Go 1.10 beta1 æˆ–æ›´é«˜ç‰ˆæœ¬) çš„ç¼–è¯‘å™¨å’Œæ ‡å‡†åº“.</p><p>éšç€æˆ‘ä»¬æ›´å¤šåœ°äº†è§£ä»€ä¹ˆå¯è¡Œ, ä»€ä¹ˆä¸å¯è¡Œ, vgo çš„è¯­ä¹‰å’Œå‘½ä»¤è¡Œç»†èŠ‚å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–. ä½†æ˜¯, æˆ‘ä»¬æ‰“ç®—é¿å… go.mod æ–‡ä»¶æ ¼å¼çš„å‘åä¸å…¼å®¹çš„æ›´æ”¹, ä»¥ä¾¿ä»Šå¤©æ·»åŠ äº† go.mod çš„é¡¹ç›®ä»¥åä¹Ÿå¯ä»¥å·¥ä½œ. åœ¨æˆ‘ä»¬å®Œå–„ææ¡ˆæ—¶, æˆ‘ä»¬ä¹Ÿä¼šç›¸åº”åœ°æ›´æ–° vgo.</p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>è¯¥éƒ¨åˆ†æ¼”ç¤ºæ€ä¹ˆä½¿ç”¨ vgo. è¯·æŒ‰ç…§æ­¥éª¤è¿›è¡Œå®éªŒ.</p><p>ä»å®‰è£… vgo å¼€å§‹:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ go get -u golang.org/x/vgo</span><br></pre></td></tr></table></figure><p>ä½ ä¸€å®šä¼šé‡åˆ°æœ‰è¶£çš„ bug, å› ä¸º vgo ç°åœ¨æœ€å¤šåªæœ‰è½»å¾®çš„æµ‹è¯•. è¯·ä½¿ç”¨ <a href="https://golang.org/issue" target="_blank" rel="noopener">Go é—®é¢˜è·Ÿè¸ª</a> è¿›è¡Œ bug ä¸ŠæŠ¥, æ ‡é¢˜ä»¥ â€œx/vgoâ€ å¼€å¤´. å¤šè°¢.</p><h3 id="Hello-world"><a href="#Hello-world" class="headerlink" title="Hello, world"></a>Hello, world</h3><p>æˆ‘ä»¬æ¥å†™ä¸€ä¸ªæœ‰è¶£çš„ â€œHello, worldâ€ ç¨‹åº. åœ¨ GOPATH/src ç›®å½•ä¹‹å¤–åˆ›å»ºä¸€ä¸ªç›®å½•å¹¶åˆ‡æ¢åˆ°å®ƒ:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cd $HOME</span><br><span class="line">$ mkdir hello</span><br><span class="line">$ cd hello</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ›å»ºä¸€ä¸ª hello.go:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main <span class="comment">// import "github.com/you/hello"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"rsc.io/quote"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(quote.Hello())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä¸‹è½½å®ƒ:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ curl -sS https://swtch.com/hello.go &gt;hello.go</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªç©ºçš„ go.mod æ–‡ä»¶æ¥æ ‡è®°æ­¤æ¨¡å—çš„æ ¹ç›®å½•, ç„¶åæ„å»ºå¹¶è¿è¡Œæ–°ç¨‹åº:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo &gt;go.mod</span><br><span class="line">$ vgo build</span><br><span class="line">vgo: resolving import &quot;rsc.io/quote&quot;</span><br><span class="line">vgo: finding rsc.io/quote (latest)</span><br><span class="line">vgo: adding rsc.io/quote v1.5.2</span><br><span class="line">vgo: finding rsc.io/quote v1.5.2</span><br><span class="line">vgo: finding rsc.io/sampler v1.3.0</span><br><span class="line">vgo: finding golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c</span><br><span class="line">vgo: downloading rsc.io/quote v1.5.2</span><br><span class="line">vgo: downloading rsc.io/sampler v1.3.0</span><br><span class="line">vgo: downloading golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c</span><br><span class="line">$ ./hello</span><br><span class="line">Hello, world.</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œæ²¡æœ‰æ˜¾å¼çš„éœ€è¦è¿è¡Œ vgo get. æ™®é€šçš„ vgo build å°†åœ¨é‡åˆ°æœªçŸ¥å¯¼å…¥æ—¶æŸ¥æ‰¾åŒ…å«å®ƒçš„æ¨¡å—, å¹¶å°†è¯¥æ¨¡å—çš„æœ€æ–°ç‰ˆæœ¬ä½œä¸ºä¾èµ–æ·»åŠ åˆ°å½“å‰æ¨¡å—ä¸­.</p><p>è¿è¡Œä»»ä½• vgo å‘½ä»¤çš„ä¸€ä¸ªå‰¯ä½œç”¨æ˜¯å¿…è¦æ—¶ä¼šæ›´æ–° go.mod. è¿™ç§æƒ…å†µä¸‹, vgo build ä¼šå†™å…¥æ–°çš„ go.mod æ–‡ä»¶:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat go.mod</span><br><span class="line">module &quot;github.com/you/hello&quot;</span><br><span class="line"></span><br><span class="line">require &quot;rsc.io/quote&quot; v1.5.2</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>ç”±äº go.mod å·²å†™å…¥, ä¸‹ä¸€æ¬¡ vgo build å°†ä¸ä¼šå†æ¬¡è§£æå¯¼å…¥æˆ–æ‰“å°é‚£ä¹ˆå¤š:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo build</span><br><span class="line">$ ./hello</span><br><span class="line">Hello, world.</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>å³ä½¿æ˜å¤©å‘å¸ƒäº† rsc.io/quote v1.5.3 æˆ– v1.6.0, è¯¥ç›®å½•ä¸­çš„æ„å»ºä»å°†ç»§ç»­ä½¿ç”¨ v1.5.2, é™¤éè¿›è¡Œæ˜ç¡®çš„å‡çº§(è§ä¸‹æ–‡).</p><p>go.mod æ–‡ä»¶åˆ—ä¸¾äº†ä¾èµ–çš„æœ€å°é›†åˆ, å¿½ç•¥äº†å·²åˆ—ä¸¾ä¸­æ‰€éšå«çš„. åœ¨è¿™ç§æƒ…å†µä¸‹, rsc.io/quote v1.5.2 ä¾èµ–ç‰¹å®šç‰ˆæœ¬çš„ rsc.io/sampler å’Œ golang.org/x/text, æ‰€ä»¥åœ¨ go.mod ä¸­é‡å¤åˆ—ä¸¾å®ƒä»¬æ˜¯å†—ä½™çš„.</p><p>ä½¿ç”¨ vgo list -m ä»ç„¶å¯ä»¥æ‰¾åˆ°æ„å»ºæ‰€éœ€çš„å…¨å¥—æ¨¡å—:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo list -m</span><br><span class="line">MODULE                VERSION</span><br><span class="line">github.com/you/hello  -</span><br><span class="line">golang.org/x/text     v0.0.0-20170915032832-14c0d48ead0c</span><br><span class="line">rsc.io/quote          v1.5.2</span><br><span class="line">rsc.io/sampler        v1.3.0</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ä½ å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ä»¬ç®€å•çš„ â€œhello worldâ€ ç¨‹åºä¼šä½¿ç”¨ golang.org/x/text. å®é™…ä¸Š rsc.io/quote ä¾èµ– rsc.io/sampler, åè€…åˆä¾èµ– golang.org/x/text è¿›è¡Œ <a href="https://blog.golang.org/matchlang" target="_blank" rel="noopener">language matching</a> .</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ LANG=fr ./hello</span><br><span class="line">Bonjour le monde.</span><br><span class="line">$</span><br></pre></td></tr></table></figure><h3 id="å‡çº§"><a href="#å‡çº§" class="headerlink" title="å‡çº§"></a>å‡çº§</h3><p>æˆ‘ä»¬å·²ç»çœ‹åˆ°, å½“å¿…é¡»å°†æ–°æ¨¡å—æ·»åŠ åˆ°æ„å»ºä»¥è§£å†³æ–°çš„å¯¼å…¥æ—¶, vgo ä¼šé‡‡ç”¨æœ€æ–°çš„æ¨¡å—. æ­¤å‰, å®ƒéœ€è¦ rsc.io/quote, å¹¶å‘ç° v1.5.2 æ˜¯æœ€æ–°çš„. ä½†é™¤äº†è§£ææ–°çš„å¯¼å…¥, vgo ä»…ä½¿ç”¨ go.mod æ–‡ä»¶ä¸­åˆ—å‡ºçš„ç‰ˆæœ¬. åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­, rsc.io/quote é—´æ¥ä¾èµ–äº golang.org/x/text å’Œ rsc.io/sampler çš„ç‰¹å®šç‰ˆæœ¬. äº‹å®è¯æ˜, è¿™ä¸¤ä¸ªè½¯ä»¶åŒ…éƒ½æœ‰è¾ƒæ–°çš„ç‰ˆæœ¬, æ­£å¦‚æˆ‘ä»¬é€šè¿‡ vgo list -u (æ£€æŸ¥æ›´æ–°çš„è½¯ä»¶åŒ…)çœ‹åˆ°çš„é‚£æ ·:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo list -m -u</span><br><span class="line">MODULE                VERSION                             LATEST</span><br><span class="line">github.com/you/hello  -                                   -</span><br><span class="line">golang.org/x/text     v0.0.0-20170915032832-14c0d48ead0c  v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">rsc.io/quote          v1.5.2 (2018-02-14 10:44)           -</span><br><span class="line">rsc.io/sampler        v1.3.0 (2018-02-13 14:05)           v1.99.99 (2018-02-13 17:20)</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªè½¯ä»¶åŒ…éƒ½æœ‰æ›´æ–°çš„ç‰ˆæœ¬, æ‰€ä»¥æˆ‘ä»¬å¯èƒ½æƒ³åœ¨æˆ‘ä»¬çš„ hello ç¨‹åºä¸­å‡çº§å®ƒä»¬.</p><p>é¦–å…ˆå‡çº§ golang.org/x/text:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo get golang.org/x/text</span><br><span class="line">vgo: finding golang.org/x/text v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">vgo: downloading golang.org/x/text v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">$ cat go.mod</span><br><span class="line">module &quot;github.com/you/hello&quot;</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">&quot;golang.org/x/text&quot; v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">&quot;rsc.io/quote&quot; v1.5.2</span><br><span class="line">)</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>vgo get å‘½ä»¤å°†æŸ¥æ‰¾ç»™å®šæ¨¡å—çš„æœ€æ–°ç‰ˆæœ¬, å¹¶é€šè¿‡æ›´æ–° go.mod æ¥å°†è¯¥ç‰ˆæœ¬æ·»åŠ ä¸ºå½“å‰æ¨¡å—çš„ä¾èµ–. ä»ç°åœ¨å¼€å§‹, æœªæ¥çš„æ„å»ºå°†ä½¿ç”¨è¾ƒæ–°çš„ text æ¨¡å—:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo list -m</span><br><span class="line">MODULE                VERSION</span><br><span class="line">github.com/you/hello  -</span><br><span class="line">golang.org/x/text     v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">rsc.io/quote          v1.5.2</span><br><span class="line">rsc.io/sampler        v1.3.0</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>å½“ç„¶, å‡çº§ä¹‹å, æµ‹è¯•ä¸€åˆ‡ä»ç„¶å·¥ä½œè‰¯å¥½æ˜¯ä¸ªå¥½ä¸»æ„. æˆ‘ä»¬çš„ä¾èµ– rsc.io/quote å’Œ rsc.io/sampler å°šæœªä½¿ç”¨è¾ƒæ–°çš„ text æ¨¡å—è¿›è¡Œæµ‹è¯•. æˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬åˆ›å»ºçš„é…ç½®ä¸­è¿è¡Œä»–ä»¬çš„æµ‹è¯•:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo test all</span><br><span class="line">?   github.com/you/hello[no test files]</span><br><span class="line">?   golang.org/x/text/internal/gen[no test files]</span><br><span class="line">ok  golang.org/x/text/internal/tag0.020s</span><br><span class="line">?   golang.org/x/text/internal/testtext[no test files]</span><br><span class="line">ok  golang.org/x/text/internal/ucd0.020s</span><br><span class="line">ok  golang.org/x/text/language0.068s</span><br><span class="line">ok  golang.org/x/text/unicode/cldr0.063s</span><br><span class="line">ok  rsc.io/quote0.015s</span><br><span class="line">ok  rsc.io/sampler0.016s</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>åœ¨åŸç‰ˆ go å‘½ä»¤ä¸­, è½¯ä»¶åŒ…æ¨¡å¼ all æ„å‘³ç€ GOPATH ä¸­èƒ½æ‰¾åˆ°çš„æ‰€æœ‰è½¯ä»¶åŒ…. è¿™å‡ ä¹æ€»æ˜¯å¤ªå¤šè€Œæ— ç”¨. åœ¨ vgo ä¸­, æˆ‘ä»¬å·²ç»å°† all çš„å«ä¹‰ç¼©å°ä¸º â€œå½“å‰æ¨¡å—ä¸­çš„æ‰€æœ‰è½¯ä»¶åŒ…, ä»¥åŠå®ƒä»¬ä»¥é€’å½’æ–¹å¼å¯¼å…¥çš„è½¯ä»¶åŒ…â€. rsc.io/quote æ¨¡å—çš„ 1.5.2 ç‰ˆæœ¬åŒ…å«ä¸€ä¸ª buggy åŒ…:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo test rsc.io/quote/...</span><br><span class="line">ok  rsc.io/quote(cached)</span><br><span class="line">--- FAIL: Test (0.00s)</span><br><span class="line">buggy_test.go:10: buggy!</span><br><span class="line">FAIL</span><br><span class="line">FAILrsc.io/quote/buggy0.014s</span><br><span class="line">(exit status 1)</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>ç„¶è€Œ, é™¤éæˆ‘ä»¬æ¨¡å—ä¸­çš„æŸä¸ªåŒ…å¯¼å…¥ buggy, å¦åˆ™å®ƒæ˜¯ä¸ç›¸å¹²çš„, æ‰€ä»¥å®ƒä¸åŒ…å«åœ¨ all é‡Œé¢. æ— è®ºå¦‚ä½•, å‡çº§çš„ x/text çœ‹èµ·æ¥å¯ä»¥å·¥ä½œ. æ­¤æ—¶æˆ‘ä»¬å¤šåŠå¯ä»¥æäº¤ go.mod.</p><p>å¦ä¸€ç§é€‰æ‹©æ˜¯ä½¿ç”¨ vgo get -u å‡çº§æ„å»ºæ‰€éœ€çš„æ‰€æœ‰æ¨¡å—:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo get -u</span><br><span class="line">vgo: finding golang.org/x/text latest</span><br><span class="line">vgo: finding rsc.io/quote latest</span><br><span class="line">vgo: finding rsc.io/sampler latest</span><br><span class="line">vgo: finding rsc.io/sampler v1.99.99</span><br><span class="line">vgo: finding golang.org/x/text latest</span><br><span class="line">vgo: downloading rsc.io/sampler v1.99.99</span><br><span class="line">$ cat go.mod</span><br><span class="line">module &quot;github.com/you/hello&quot;</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">&quot;golang.org/x/text&quot; v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">&quot;rsc.io/quote&quot; v1.5.2</span><br><span class="line">&quot;rsc.io/sampler&quot; v1.99.99</span><br><span class="line">)</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œ, vgo get -u ä¿ç•™äº†å‡çº§åçš„ text æ¨¡å—, å¹¶å°† rsc.io/sampler å‡çº§åˆ°å…¶æœ€æ–°ç‰ˆæœ¬ v1.99.99.</p><p>è®©æˆ‘ä»¬æ¥è¿è¡Œæµ‹è¯•:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo test all</span><br><span class="line">?   github.com/you/hello[no test files]</span><br><span class="line">?   golang.org/x/text/internal/gen[no test files]</span><br><span class="line">ok  golang.org/x/text/internal/tag(cached)</span><br><span class="line">?   golang.org/x/text/internal/testtext[no test files]</span><br><span class="line">ok  golang.org/x/text/internal/ucd(cached)</span><br><span class="line">ok  golang.org/x/text/language0.070s</span><br><span class="line">ok  golang.org/x/text/unicode/cldr(cached)</span><br><span class="line">--- FAIL: TestHello (0.00s)</span><br><span class="line">quote_test.go:19: Hello() = &quot;99 bottles of beer on the wall, 99 bottles of beer, ...&quot;, want &quot;Hello, world.&quot;</span><br><span class="line">FAIL</span><br><span class="line">FAILrsc.io/quote0.014s</span><br><span class="line">--- FAIL: TestHello (0.00s)</span><br><span class="line">hello_test.go:31: Hello([en-US fr]) = &quot;99 bottles of beer on the wall, 99 bottles of beer, ...&quot;, want &quot;Hello, world.&quot;</span><br><span class="line">hello_test.go:31: Hello([fr en-US]) = &quot;99 bottles of beer on the wall, 99 bottles of beer, ...&quot;, want &quot;Bonjour le monde.&quot;</span><br><span class="line">FAIL</span><br><span class="line">FAILrsc.io/sampler0.014s</span><br><span class="line">(exit status 1)</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥ rsc.io/sampler v1.99.99 å‡ºäº†é—®é¢˜. æœç„¶:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo build</span><br><span class="line">$ ./hello</span><br><span class="line">99 bottles of beer on the wall, 99 bottles of beer, ...</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>vgo get -u è·å–æ¯ä¸ªä¾èµ–çš„æœ€æ–°ç‰ˆæœ¬çš„è¡Œä¸ºæ­£å’Œ go get ä¸‹è½½æ‰€æœ‰ä¸åœ¨ GOPATH çš„åŒ…æ‰€åšçš„ä¸€æ ·. åœ¨ä¸€ä¸ª GOPATH é‡Œç©ºæ— ä¸€ç‰©çš„ç³»ç»Ÿä¸Š:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ go get -d rsc.io/hello</span><br><span class="line">$ go build -o badhello rsc.io/hello</span><br><span class="line">$ ./badhello</span><br><span class="line">99 bottles of beer on the wall, 99 bottles of beer, ...</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>é‡è¦çš„åŒºåˆ«æ˜¯, é»˜è®¤æƒ…å†µä¸‹, vgo ä¸ä¼šä»¥è¿™ç§æ–¹å¼è¿è¡Œ. ä½ ä¹Ÿå¯ä»¥é€šè¿‡é™çº§æ’¤æ¶ˆå®ƒ.</p><h3 id="é™çº§"><a href="#é™çº§" class="headerlink" title="é™çº§"></a>é™çº§</h3><p>è¦é™çº§è½¯ä»¶åŒ…, è¯·ä½¿ç”¨ vgo list -t æ˜¾ç¤ºå¯ç”¨çš„æ ‡è®°(tag)ç‰ˆæœ¬:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo list -t rsc.io/sampler</span><br><span class="line">rsc.io/sampler</span><br><span class="line">v1.0.0</span><br><span class="line">v1.2.0</span><br><span class="line">v1.2.1</span><br><span class="line">v1.3.0</span><br><span class="line">v1.3.1</span><br><span class="line">v1.99.99</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨ vgo è·å–è¦æ±‚çš„ç‰¹å®šç‰ˆæœ¬, ä¾‹å¦‚ v1.3.1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat go.mod</span><br><span class="line">module &quot;github.com/you/hello&quot;</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">&quot;golang.org/x/text&quot; v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">&quot;rsc.io/quote&quot; v1.5.2</span><br><span class="line">&quot;rsc.io/sampler&quot; v1.99.99</span><br><span class="line">)</span><br><span class="line">$ vgo get rsc.io/sampler@v1.3.1</span><br><span class="line">vgo: finding rsc.io/sampler v1.3.1</span><br><span class="line">vgo: downloading rsc.io/sampler v1.3.1</span><br><span class="line">$ vgo list -m</span><br><span class="line">MODULE                VERSION</span><br><span class="line">github.com/you/hello  -</span><br><span class="line">golang.org/x/text     v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">rsc.io/quote          v1.5.2</span><br><span class="line">rsc.io/sampler        v1.3.1</span><br><span class="line">$ cat go.mod</span><br><span class="line">module &quot;github.com/you/hello&quot;</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">&quot;golang.org/x/text&quot; v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">&quot;rsc.io/quote&quot; v1.5.2</span><br><span class="line">&quot;rsc.io/sampler&quot; v1.3.1</span><br><span class="line">)</span><br><span class="line">$ vgo test all</span><br><span class="line">?   github.com/you/hello[no test files]</span><br><span class="line">?   golang.org/x/text/internal/gen[no test files]</span><br><span class="line">ok  golang.org/x/text/internal/tag(cached)</span><br><span class="line">?   golang.org/x/text/internal/testtext[no test files]</span><br><span class="line">ok  golang.org/x/text/internal/ucd(cached)</span><br><span class="line">ok  golang.org/x/text/language(cached)</span><br><span class="line">ok  golang.org/x/text/unicode/cldr(cached)</span><br><span class="line">ok  rsc.io/quote0.016s</span><br><span class="line">ok  rsc.io/sampler0.015s</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>é™çº§ä¸€ä¸ªè½¯ä»¶åŒ…å¯èƒ½éœ€è¦é™çº§å…¶ä»–è½¯ä»¶åŒ…. ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo get rsc.io/sampler@v1.2.0</span><br><span class="line">vgo: finding rsc.io/sampler v1.2.0</span><br><span class="line">vgo: finding rsc.io/quote v1.5.1</span><br><span class="line">vgo: finding rsc.io/quote v1.5.0</span><br><span class="line">vgo: finding rsc.io/quote v1.4.0</span><br><span class="line">vgo: finding rsc.io/sampler v1.0.0</span><br><span class="line">vgo: downloading rsc.io/sampler v1.2.0</span><br><span class="line">$ vgo list -m</span><br><span class="line">MODULE                VERSION</span><br><span class="line">github.com/you/hello  -</span><br><span class="line">golang.org/x/text     v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">rsc.io/quote          v1.4.0</span><br><span class="line">rsc.io/sampler        v1.2.0</span><br><span class="line">$ cat go.mod</span><br><span class="line">module &quot;github.com/you/hello&quot;</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">&quot;golang.org/x/text&quot; v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">&quot;rsc.io/quote&quot; v1.4.0</span><br><span class="line">&quot;rsc.io/sampler&quot; v1.2.0</span><br><span class="line">)</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ç§æƒ…å†µä¸‹, rsc.io/quote v1.5.0 æ˜¯ç¬¬ä¸€ä¸ªéœ€è¦ rsc.io/sampler v1.3.0 çš„ç‰ˆæœ¬; æ—©æœŸç‰ˆæœ¬åªéœ€è¦ v1.0.0(æˆ–æ›´é«˜ç‰ˆæœ¬). é™çº§é€‰æ‹©äº† rsc.io/quote v1.4.0, è¿™æ˜¯ä¸ v1.2.0 å…¼å®¹çš„æœ€æ–°ç‰ˆæœ¬.</p><p>ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®š none ä½œä¸ºç‰ˆæœ¬æ¥å®Œå…¨åˆ é™¤ä¸€ä¸ªä¾èµ–, è¿™æ˜¯ä¸€ç§æç«¯çš„é™çº§å½¢å¼:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo get rsc.io/sampler@none</span><br><span class="line">vgo: downloading rsc.io/quote v1.4.0</span><br><span class="line">vgo: finding rsc.io/quote v1.3.0</span><br><span class="line">$ vgo list -m</span><br><span class="line">MODULE                VERSION</span><br><span class="line">github.com/you/hello  -</span><br><span class="line">golang.org/x/text     v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">rsc.io/quote          v1.3.0</span><br><span class="line">$ cat go.mod</span><br><span class="line">module &quot;github.com/you/hello&quot;</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">&quot;golang.org/x/text&quot; v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">&quot;rsc.io/quote&quot; v1.3.0</span><br><span class="line">)</span><br><span class="line">$ vgo test all</span><br><span class="line">vgo: downloading rsc.io/quote v1.3.0</span><br><span class="line">?   github.com/you/hello[no test files]</span><br><span class="line">ok  rsc.io/quote0.014s</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬å›åˆ°ä¸€åˆ‡éƒ½æ˜¯æœ€æ–°ç‰ˆæœ¬çš„çŠ¶æ€, åŒ…æ‹¬ rsc.io/sampler v1.99.99:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo get -u</span><br><span class="line">vgo: finding golang.org/x/text latest</span><br><span class="line">vgo: finding rsc.io/quote latest</span><br><span class="line">vgo: finding rsc.io/sampler latest</span><br><span class="line">vgo: finding golang.org/x/text latest</span><br><span class="line">$ vgo list -m</span><br><span class="line">MODULE                VERSION</span><br><span class="line">github.com/you/hello  -</span><br><span class="line">golang.org/x/text     v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">rsc.io/quote          v1.5.2</span><br><span class="line">rsc.io/sampler        v1.99.99</span><br><span class="line">$</span><br></pre></td></tr></table></figure><h3 id="æ’é™¤-Excluding"><a href="#æ’é™¤-Excluding" class="headerlink" title="æ’é™¤ (Excluding)"></a>æ’é™¤ (Excluding)</h3><p>åœ¨ç¡®å®š v1.99.99 å¹¶ä¸é€‚ç”¨äºæˆ‘ä»¬çš„ hello world ç¨‹åºå, æˆ‘ä»¬å¯èƒ½æƒ³è®°å½•ä¸‹è¿™ä¸ªäº‹å®, ä»¥é¿å…å°†æ¥å‡ºç°é—®é¢˜. æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘ go.mod æ·»åŠ  exclude æŒ‡ä»¤æ¥åšåˆ°è¿™ä¸€ç‚¹:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">exclude &quot;rsc.io/sampler&quot; v1.99.99</span><br></pre></td></tr></table></figure><p>ä¹‹åçš„æ“ä½œè¡¨ç°çš„å¥½åƒè¯¥æ¨¡å—ä¸å­˜åœ¨ä¸€æ ·:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo &apos;exclude &quot;rsc.io/sampler&quot; v1.99.99&apos; &gt;&gt;go.mod</span><br><span class="line">$ vgo list -t rsc.io/sampler</span><br><span class="line">rsc.io/sampler</span><br><span class="line">v1.0.0</span><br><span class="line">v1.2.0</span><br><span class="line">v1.2.1</span><br><span class="line">v1.3.0</span><br><span class="line">v1.3.1</span><br><span class="line">v1.99.99 # excluded</span><br><span class="line">$ vgo get -u</span><br><span class="line">vgo: finding golang.org/x/text latest</span><br><span class="line">vgo: finding rsc.io/quote latest</span><br><span class="line">vgo: finding rsc.io/sampler latest</span><br><span class="line">vgo: finding rsc.io/sampler latest</span><br><span class="line">vgo: finding golang.org/x/text latest</span><br><span class="line">$ vgo list -m</span><br><span class="line">MODULE                VERSION</span><br><span class="line">github.com/you/hello  -</span><br><span class="line">golang.org/x/text     v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">rsc.io/quote          v1.5.2</span><br><span class="line">rsc.io/sampler        v1.3.1</span><br><span class="line">$ cat go.mod</span><br><span class="line">module &quot;github.com/you/hello&quot;</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">&quot;golang.org/x/text&quot; v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">&quot;rsc.io/quote&quot; v1.5.2</span><br><span class="line">&quot;rsc.io/sampler&quot; v1.3.1</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">exclude &quot;rsc.io/sampler&quot; v1.99.99</span><br><span class="line">$ vgo test all</span><br><span class="line">?   github.com/you/hello[no test files]</span><br><span class="line">?   golang.org/x/text/internal/gen[no test files]</span><br><span class="line">ok  golang.org/x/text/internal/tag(cached)</span><br><span class="line">?   golang.org/x/text/internal/testtext[no test files]</span><br><span class="line">ok  golang.org/x/text/internal/ucd(cached)</span><br><span class="line">ok  golang.org/x/text/language(cached)</span><br><span class="line">ok  golang.org/x/text/unicode/cldr(cached)</span><br><span class="line">ok  rsc.io/quote(cached)</span><br><span class="line">ok  rsc.io/sampler(cached)</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>æ’é™¤ä»…é€‚ç”¨äºå½“å‰æ¨¡å—çš„æ„å»º. å¦‚æœå½“å‰æ¨¡å—è¢«æ›´å¤§çš„æ„å»ºæ‰€ä¾èµ–, åˆ™æ’é™¤ä¸é€‚ç”¨. ä¾‹å¦‚, rsc.io/quote çš„ go.mod ä¸­çš„æ’é™¤ä¸é€‚ç”¨äºæˆ‘ä»¬çš„ â€œhello, worldâ€ æ„å»º.</p><p>è¿™ä¸€ç­–ç•¥çš„æƒè¡¡è®©å½“å‰æ¨¡å—çš„ä½œè€…å‡ ä¹å¯ä»¥ä»»æ„æ§åˆ¶è‡ªå·±çš„æ„å»º, è€Œä¸ä¼šå—åˆ°å®ƒä»¬ä¾èµ–çš„æ¨¡å—å‡ ä¹ä»»æ„æ§åˆ¶çš„å½±å“.</p><p>æ­¤æ—¶, æ­£ç¡®çš„ä¸‹ä¸€æ­¥æ˜¯è”ç³» rsc.io/sampler çš„ä½œè€…å¹¶åœ¨ v1.99.99 ä¸­æŠ¥å‘Šé—®é¢˜, å› æ­¤å®ƒå¯ä»¥åœ¨ v1.99.100 ä¸­ä¿®å¤. ä¸å¹¸çš„æ˜¯, ä½œè€…æœ‰ä¸€ä¸ªåšæ–‡ä¾èµ–å®ƒè€Œä¸äºˆä¿®å¤.</p><h3 id="æ›¿æ¢-Replacing"><a href="#æ›¿æ¢-Replacing" class="headerlink" title="æ›¿æ¢ (Replacing)"></a>æ›¿æ¢ (Replacing)</h3><p>å¦‚æœç¡®å®åœ¨ä¾èµ–ä¸­å‘ç°äº†é—®é¢˜, åˆ™éœ€è¦ä¸€ç§æ–¹æ³•å°†å…¶æš‚æ—¶æ›¿æ¢ä¸ºä¸€ä¸ªåˆé€‚çš„å‰¯æœ¬. å‡è®¾æˆ‘ä»¬æƒ³æ”¹å˜ä¸€äº›å…³äº rsc.io/quote çš„è¡Œä¸º. ä¹Ÿè®¸æˆ‘ä»¬æƒ³è¦è§£å†³ rsc.io/sampler ä¸­çš„é—®é¢˜, æˆ–è€…æˆ‘ä»¬æƒ³è¦åšå…¶ä»–çš„äº‹æƒ…. ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨é€šå¸¸çš„ git å‘½ä»¤æ£€å‡º quote æ¨¡å—:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ git clone https://github.com/rsc/quote ../quote</span><br><span class="line">Cloning into &apos;../quote&apos;...</span><br></pre></td></tr></table></figure><p>ç„¶åç¼–è¾‘ ../quote/quote.go æ¥æ”¹å˜ func Hello çš„ä¸€äº›å†…å®¹. ä¾‹å¦‚, æˆ‘æŠŠå®ƒçš„è¿”å›å€¼ä» sampler.Hello() æ›´æ”¹ä¸º sampler.Glass(), è¿™æ˜¯ä¸€ä¸ªæ›´æœ‰è¶£çš„é—®å€™è¯­.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cd ../quote</span><br><span class="line">$ &lt;edit quote.go&gt;</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>æ”¹å˜äº†å…‹éš†ä»£ç ä¹‹å, æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘ go.mod æ·»åŠ  replace æŒ‡ä»¤æ¥è®©æˆ‘ä»¬çš„æ„å»ºä½¿ç”¨å®ƒæ¥ä»£æ›¿çœŸæ­£çš„æ„å»º:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">replace &quot;rsc.io/quote&quot; v1.5.2 =&gt; &quot;../quote&quot;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥æ„å»ºæˆ‘ä»¬çš„ç¨‹åº:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cd ../hello</span><br><span class="line">$ echo &apos;replace &quot;rsc.io/quote&quot; v1.5.2 =&gt; &quot;../quote&quot;&apos; &gt;&gt;go.mod</span><br><span class="line">$ vgo list -m</span><br><span class="line">MODULE                VERSION</span><br><span class="line">github.com/you/hello  -</span><br><span class="line">golang.org/x/text     v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">rsc.io/quote          v1.5.2</span><br><span class="line"> =&gt; ../quote</span><br><span class="line">rsc.io/sampler        v1.3.1</span><br><span class="line">$ vgo build</span><br><span class="line">$ ./hello</span><br><span class="line">I can eat glass and it doesn&apos;t hurt me.</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>ä½ ä¹Ÿå¯ä»¥å°†ä¸€ä¸ªä¸åŒçš„æ¨¡å—å‘½åä¸ºæ›¿æ¢æ¨¡å—. ä¾‹å¦‚, ä½ å¯ä»¥å…‹éš† github.com/rsc/quote, ç„¶åå°†æ›´æ”¹æ¨é€åˆ°ä½ è‡ªå·±çš„åˆ†æ”¯.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cd ../quote</span><br><span class="line">$ git commit -a -m &apos;my fork&apos;</span><br><span class="line">[master 6151719] my fork</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line">$ git tag v0.0.0-myfork</span><br><span class="line">$ git pu https://github.com/you/quote v0.0.0-myfork</span><br><span class="line">To https://github.com/you/quote</span><br><span class="line"> * [new tag]         v0.0.0-myfork -&gt; v0.0.0-myfork</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>ç„¶åä½ å¯ä»¥ä½¿ç”¨å®ƒä½œä¸ºæ›¿æ¢:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cd ../hello</span><br><span class="line">$ echo &apos;replace &quot;rsc.io/quote&quot; v1.5.2 =&gt; &quot;github.com/you/quote&quot; v0.0.0-myfork&apos; &gt;&gt;go.mod</span><br><span class="line">$ vgo list -m</span><br><span class="line">vgo: finding github.com/you/quote v0.0.0-myfork</span><br><span class="line">MODULE                    VERSION</span><br><span class="line">github.com/you/hello      -</span><br><span class="line">golang.org/x/text         v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">rsc.io/quote              v1.5.2</span><br><span class="line"> =&gt; github.com/you/quote  v0.0.0-myfork</span><br><span class="line">rsc.io/sampler            v1.3.1</span><br><span class="line">$ vgo build</span><br><span class="line">vgo: downloading github.com/you/quote v0.0.0-myfork</span><br><span class="line">$ LANG=fr ./hello</span><br><span class="line">Je peux manger du verre, Ã§a ne me fait pas mal.</span><br><span class="line">$</span><br></pre></td></tr></table></figure><h3 id="å‘åå…¼å®¹æ€§"><a href="#å‘åå…¼å®¹æ€§" class="headerlink" title="å‘åå…¼å®¹æ€§"></a>å‘åå…¼å®¹æ€§</h3><p>å³ä½¿ä½ æƒ³ä¸ºä½ çš„é¡¹ç›®ä½¿ç”¨ vgo, ä½ ä¹Ÿä¸å¯èƒ½è¦æ±‚ä½ çš„æ‰€æœ‰çš„ç”¨æˆ·éƒ½æœ‰ vgo. ç›¸å, ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª vendor ç›®å½•, ä»¥å…è®¸ go å‘½ä»¤ç”¨æˆ·ç”Ÿæˆå‡ ä¹ç›¸åŒçš„æ„å»º(å½“ç„¶, åœ¨ GOPATH ä¸­ç¼–è¯‘):</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vgo vendor</span><br><span class="line">$ mkdir -p $GOPATH/src/github.com/you</span><br><span class="line">$ cp -a . $GOPATH/src/github.com/you/hello</span><br><span class="line">$ go build -o vhello github.com/you/hello</span><br><span class="line">$ LANG=es ./vhello</span><br><span class="line">Puedo comer vidrio, no me hace daÃ±o.</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>æˆ‘è¯´è¿™äº›æ„å»º â€œå‡ ä¹ç›¸åŒâ€, å› ä¸ºå·¥å…·é“¾çœ‹åˆ°çš„å¹¶åœ¨æœ€ç»ˆäºŒè¿›åˆ¶æ–‡ä»¶ä¸­è®°å½•çš„å¯¼å…¥è·¯å¾„æ˜¯ä¸åŒçš„. vendored ç‰ˆæœ¬å‚è§ vendor ç›®å½•:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ go tool nm hello | grep sampler.hello</span><br><span class="line"> 1170908 B rsc.io/sampler.hello</span><br><span class="line">$ go tool nm vhello | grep sampler.hello</span><br><span class="line"> 11718e8 B github.com/you/hello/vendor/rsc.io/sampler.hello</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>é™¤äº†è¿™ç§å·®å¼‚, æ„å»ºåº”è¯¥äº§ç”Ÿç›¸åŒçš„äºŒè¿›åˆ¶æ–‡ä»¶. ä¸ºäº†æä¾›ä¼˜é›…çš„è½¬æ¢, åŸºäº vgo çš„æ„å»ºå®Œå…¨å¿½ç•¥ vendor ç›®å½•, ä¸€å¦‚æ—¢å¾€çš„æ¨¡å—æ„ŸçŸ¥ go å‘½ä»¤æ„å»º.</p><h2 id="æ¥ä¸‹æ¥"><a href="#æ¥ä¸‹æ¥" class="headerlink" title="æ¥ä¸‹æ¥ ?"></a>æ¥ä¸‹æ¥ ?</h2><p>è¯·å°è¯• vgo. åœ¨å­˜å‚¨åº“ä¸­å¼€å§‹æ ‡è®°(tagging)ç‰ˆæœ¬. åˆ›å»ºå¹¶æ£€å…¥(check in) go.mod æ–‡ä»¶. åœ¨ golang.org/issue ä¸Šä¸ŠæŠ¥é—®é¢˜, å¹¶åœ¨æ ‡é¢˜å¼€å¤´æ·»åŠ  â€œx/vgo:â€ æ˜å¤©ä¼šæœ‰æ›´å¤šçš„åšæ–‡. è°¢è°¢, ç©å¾—å¼€å¿ƒ!</p>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> go </tag>
            
            <tag> vgo </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Go += åŒ…ç‰ˆæœ¬</title>
      <link href="/post/vgo-intro.html"/>
      <url>/post/vgo-intro.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ª <a href="https://research.swtch.com/vgo-intro" target="_blank" rel="noopener">Go += Package Versioning</a>, <a href="https://lingchao.xin/tag/vgo.html">Go &amp; Versioning</a> çš„ç¬¬ 1 éƒ¨åˆ†, ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰.<br><a id="more"></a></p><p>æˆ‘ä»¬éœ€è¦å°†åŒ…ç‰ˆæœ¬æ§åˆ¶æ·»åŠ åˆ° Go.</p><p>æ›´ç¡®åˆ‡åœ°è¯´, æˆ‘ä»¬éœ€è¦å°†è½¯ä»¶åŒ…ç‰ˆæœ¬çš„æ¦‚å¿µæ·»åŠ åˆ° Go å¼€å‘äººå‘˜å’Œæˆ‘ä»¬çš„å·¥å…·çš„å·¥ä½œè¯æ±‡è¡¨ä¸­, ä»¥ä¾¿åœ¨å½¼æ­¤äº¤è°ˆæ—¶å‡†ç¡®åœ°ç¡®å®šåº”è¯¥æ„å»º, è¿è¡Œæˆ–åˆ†æå“ªä¸ªç¨‹åº. go å‘½ä»¤éœ€è¦èƒ½å¤Ÿå‘Šè¯‰å¼€å‘äººå‘˜å…·ä½“å“ªäº›ç‰ˆæœ¬çš„è½¯ä»¶åŒ…åœ¨ç‰¹å®šæ„å»ºä¸­, åä¹‹äº¦ç„¶.</p><p>ç‰ˆæœ¬æ§åˆ¶å¯ä»¥è®©æˆ‘ä»¬å¯ç”¨å¯é‡å¤æ„å»º, æ‰€ä»¥å¦‚æœæˆ‘å‘Šè¯‰ä½ è¯•ç”¨æˆ‘çš„ç¨‹åºçš„æœ€æ–°ç‰ˆæœ¬, æˆ‘çŸ¥é“ä½ å°†ä¸ä»…è·å¾—æˆ‘çš„ä»£ç çš„æœ€æ–°ç‰ˆæœ¬, è€Œä¸”è¿˜åŒ…æ‹¬æˆ‘çš„ä»£ç æ‰€ä¾èµ–åŒ…çš„ç²¾ç¡®çš„åŒä¸€ç‰ˆæœ¬, æ‰€ä»¥ä½ å’Œæˆ‘å°†æ„å»ºå®Œå…¨ç­‰ä»·çš„äºŒè¿›åˆ¶.</p><p>ç‰ˆæœ¬æ§åˆ¶è¿˜å¯ä»¥è®©æˆ‘ä»¬ç¡®ä¿æ˜å¤©ç¨‹åºçš„æ„å»ºæ–¹å¼ä¸ä»Šå¤©çš„å®Œå…¨ç›¸åŒ. å³ä½¿æœ‰æ›´æ–°ç‰ˆæœ¬çš„ä¾èµ–, go å‘½ä»¤ä¹Ÿä¸åº”è¯¥ä½¿ç”¨å®ƒä»¬é™¤éè¢«è¦æ±‚è¿™æ ·åš.</p><p>å°½ç®¡æˆ‘ä»¬å¿…é¡»æ·»åŠ ç‰ˆæœ¬æ§åˆ¶, ä½†æˆ‘ä»¬ä¹Ÿä¸èƒ½ç§»é™¤å½“å‰ go å‘½ä»¤çš„æœ€ä½³éƒ¨åˆ†: ç®€å•, é€Ÿåº¦ä»¥åŠæ˜“æ‡‚. å½“å‰, è®¸å¤šç¨‹åºå‘˜å¤§å¤šä¸å…³æ³¨ç‰ˆæœ¬æ§åˆ¶, è€Œä¸”å¤§éƒ¨åˆ†éƒ½å·¥ä½œè‰¯å¥½. å¦‚æœæˆ‘ä»¬æ­£ç¡®åœ°è·å¾—äº†æ¨¡å‹å’Œé»˜è®¤å€¼, æˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿä»¥è¿™æ ·çš„æ–¹å¼æ·»åŠ ç‰ˆæœ¬æ§åˆ¶, å³ç¨‹åºå‘˜ä»ç„¶å¤§å¤šä¸å…³æ³¨ç‰ˆæœ¬æ§åˆ¶, å¹¶ä¸”ä¸€åˆ‡éƒ½æ›´å¥½, è€Œä¸”æ›´æ˜“äºç†è§£. ç°æœ‰çš„å·¥ä½œæµç¨‹åº”è¯¥å°½å¯èƒ½å°‘åœ°æ”¹å˜. å‘å¸ƒæ–°ç‰ˆæœ¬åº”è¯¥éå¸¸ç®€å•. ä¸€èˆ¬æ¥è¯´, ç‰ˆæœ¬ç®¡ç†å·¥ä½œå¿…é¡»ä»åå°æ·¡å‡º, è€Œä¸æ˜¯æ—¥å¸¸å…³æ³¨.</p><p>ç®€è€Œè¨€ä¹‹, æˆ‘ä»¬éœ€è¦æ·»åŠ è½¯ä»¶åŒ…ç‰ˆæœ¬æ§åˆ¶, ä½†æˆ‘ä»¬è¿˜ä¸èƒ½ç ´å go get. è¿™ç¯‡æ–‡ç« è‰æ‹Ÿäº†ä¸€ä¸ªåšè¿™ä»¶äº‹çš„æ°åˆ°å¥½å¤„çš„ææ¡ˆ, ä»¥åŠä»Šå¤©å°±å¯ä»¥å°è¯•çš„åŸå‹æ¼”ç¤º, å¸Œæœ›è¿™å°†æˆä¸ºæœ€ç»ˆ go å‘½ä»¤é›†æˆçš„åŸºç¡€. æˆ‘æ‰“ç®—å°†è¿™ç¯‡æ–‡ç« ä½œä¸ºæœ‰æ•ˆè®¨è®ºä»€ä¹ˆå¯è¡Œä»¥åŠä»€ä¹ˆä¸å¯è¡Œçš„å¼€å§‹. åŸºäºè¿™ä¸€è®¨è®º, æˆ‘å°†å¯¹ææ¡ˆå’ŒåŸå‹è¿›è¡Œè°ƒæ•´, ç„¶åæˆ‘å°†æäº¤ä¸€ä»½æ­£å¼çš„ <a href="https://golang.org/s/proposal" target="_blank" rel="noopener">Go ææ¡ˆ</a>, ä½œä¸ºå¯é€‰åŠŸèƒ½é›†æˆåˆ° Go 1.11 ä¸­.</p><p>è¿™ä¸ªææ¡ˆä¿ç•™äº† go get æœ€å¥½çš„éƒ¨åˆ†, å¢åŠ äº†å¯é‡å¤æ„å»º, é‡‡ç”¨äº†è¯­ä¹‰ç‰ˆæœ¬åŒ–, æ¶ˆé™¤äº† vendoring, å¼ƒç”¨äº† GOPATH è½¬è€Œé‡‡ç”¨äº†åŸºäºé¡¹ç›®çš„å·¥ä½œæµç¨‹, å¹¶ä¸”æä¾›äº†ä¸€ä¸ªä» dep å’Œå…¶å‰ä»»ä»¬çš„å¹³æ»‘è¿ç§». ä¹Ÿå°±æ˜¯è¯´, è¿™ä¸ªææ¡ˆè¿˜å¤„äºæ—©æœŸé˜¶æ®µ. å¦‚æœç»†èŠ‚è¿˜ä¸æ­£ç¡®, æˆ‘ä»¬ä¼šèŠ±æ—¶é—´åœ¨é›†æˆè¿› Go ä¸»å‘è¡Œç‰ˆä¹‹å‰ä¿®å¤å®ƒä»¬.</p><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>åœ¨æˆ‘ä»¬çœ‹è¿™ä¸ªææ¡ˆä¹‹å‰, è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬åšåˆ°äº†ä»€ä¹ˆ. è¿™å¯èƒ½æœ‰ç‚¹é•¿, ä½†å†å²å¯¹å½“ä¸‹æœ‰é‡è¦çš„å¯ç¤º, å¹¶æœ‰åŠ©äºç†è§£ææ¡ˆä¸ºä»€ä¹ˆä¼šä½œå‡ºæ”¹å˜. å¦‚æœä½ ä¸è€çƒ¦, è¯·è·³åˆ°<a href="https://research.swtch.com/vgo-intro#proposal" target="_blank" rel="noopener">ææ¡ˆ</a>æˆ–é˜…è¯»é™„å¸¦çš„<a href="https://research.swtch.com/vgo-tour" target="_blank" rel="noopener">ç¤ºä¾‹åšå®¢æ–‡ç« </a>.</p><h3 id="Makefiles-goinstall-ä»¥åŠ-go-get"><a href="#Makefiles-goinstall-ä»¥åŠ-go-get" class="headerlink" title="Makefiles, goinstall, ä»¥åŠ go get"></a>Makefiles, goinstall, ä»¥åŠ go get</h3><p>2009 å¹´ 11 æœˆ, Go çš„æœ€åˆç‰ˆæœ¬æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨, é“¾æ¥å™¨å’Œä¸€äº›åº“. ä½ å¿…é¡»è¿è¡Œ 6g å’Œ 6l ç¼–è¯‘å’Œé“¾æ¥ä½ çš„ç¨‹åº, å¹¶ä¸”æˆ‘ä»¬åŒ…å«äº†ç¤ºä¾‹ makefile(s). åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹, æœ‰ä¸€ä¸ªæœ€å°åŒ–çš„ gobuild å°è£…å¯ä»¥æ„å»ºå•ä¸ªåŒ…å¹¶å†™å…¥ä¸€ä¸ªåˆé€‚çš„ makefile. æ²¡æœ‰æ—¢å®šçš„æ–¹å¼ä¸å…¶ä»–äººåˆ†äº«ä»£ç . æˆ‘ä»¬çŸ¥é“è¿˜éœ€è¦æ›´å¤šçš„ä¸œè¥¿, ä½†æ˜¯æˆ‘ä»¬å·²ç»å‘å¸ƒäº†æˆ‘ä»¬æ‰€æœ‰çš„ä¸œè¥¿, å¹¶è®¡åˆ’åœ¨ç¤¾åŒºä¸­å®Œæˆå‰©ä¸‹çš„å·¥ä½œ.</p><p>2010 å¹´ 2 æœˆ, æˆ‘ä»¬æå‡ºäº† <a href="https://groups.google.com/d/msg/golang-nuts/8JFwR3ESjjI/cy7qZzN7Lw4J" target="_blank" rel="noopener">goinstall</a> ä¸€ä¸ªæ–°çš„é›¶é…ç½®å‘½ä»¤, ç”¨äºä»æºç æ§åˆ¶ä»“åº“(å¦‚ Bitbucket å’Œ GitHub )ä¸‹è½½è½¯ä»¶åŒ…. Goinstall å¼•å…¥äº†ä»Šå¤©å¼€å‘äººå‘˜è®¤ä¸ºç†æ‰€å½“ç„¶çš„å¯¼å…¥è·¯å¾„çº¦å®š. ç”±äºå½“æ—¶æ²¡æœ‰ä»»ä½•ä»£ç éµå¾ªè¿™äº›çº¦å®š, æ‰€ä»¥ goinstall èµ·åˆåªèƒ½å¤„ç†é™¤æ ‡å‡†åº“ä¹‹å¤–æ²¡æœ‰ä»»ä½•å…¶ä»–åŒ…å¯¼å…¥çš„è½¯ä»¶åŒ…. ä½†æ˜¯å¼€å‘äººå‘˜å¾ˆå¿«ä»ä»–ä»¬è‡ªå·±çš„å„ç§å‘½åæ–¹æ¡ˆè½¬ç§»åˆ°äº†æˆ‘ä»¬ä»Šå¤©æ‰€çŸ¥é“çš„ç»Ÿä¸€çº¦å®š, å¹¶ä¸”å·²å‘å¸ƒçš„ Go åŒ…é›†åˆå‘å±•æˆä¸ºä¸€ä¸ªè¿è´¯çš„ç”Ÿæ€ç³»ç»Ÿ.</p><p>Goinstall ä¹Ÿæ¶ˆé™¤äº† makefile ä»¥åŠä¸ä¹‹ç›¸å…³çš„ç”¨æˆ·å®šä¹‰æ„å»ºå˜åŠ¨çš„å¤æ‚æ€§. å°½ç®¡å¯¹äºåŒ…ä½œè€…åœ¨æ¯æ¬¡æ„å»ºæœŸé—´ä¸èƒ½ç”Ÿæˆä»£ç æ¥è¯´æœ‰æ—¶ä¸æ–¹ä¾¿, ä½†è¿™ç§ç®€åŒ–å¯¹äºåŒ…ç”¨æˆ·æ¥è¯´éå¸¸é‡è¦: ç”¨æˆ·ä¸å¿…æ‹…å¿ƒé¦–æ¬¡å®‰è£…ä¸æ„å»ºä¹‹å‰ä½¿ç”¨çš„åŒ…ä½œè€…ç›¸åŒçš„ä¸€ç»„å·¥å…·. ç®€åŒ–å¯¹äºå·¥å…·æ¥è¯´ä¹Ÿæ˜¯è‡³å…³é‡è¦çš„. makefile æ˜¯ç¼–è¯‘åŒ…çš„ä¸€ä¸ªå¿…è¦çš„æ­¥éª¤, åå‘å·¥ç¨‹å¦‚ä½•åº”ç”¨ä¸åŒçš„å·¥å…·, å¦‚ go vet æˆ–ä»£ç å®Œæˆ, åˆ°ç›¸åŒçš„åŒ…, å¯èƒ½ä¼šéå¸¸å›°éš¾. å³ä½¿æ­£ç¡®åœ°è·å¾—æ„å»ºä¾èµ–å…³ç³», ä»¥ä¾¿åœ¨å¿…è¦æ—¶é‡æ–°æ„å»ºåŒ…, å¹¶ä¸”åªåœ¨å¿…è¦æ—¶é‡æ–°æ„å»ºåŒ…, è¿™å¯¹äºä»»æ„ makefile éå¸¸å›°éš¾. è™½ç„¶æœ‰äº›äººåœ¨çµæ´»æ€§è¢«å‰¥å¤ºçš„æ—¶å€™è¡¨ç¤ºåå¯¹, ä½†å›æƒ³èµ·æ¥, è¿™äº›å¥½å¤„è¿œè¿œè¶…è¿‡äº†ä¸ä¾¿ä¹‹å¤„.</p><p>2011 å¹´ 12 æœˆ, ä½œä¸º Go 1 å‡†å¤‡å·¥ä½œçš„ä¸€éƒ¨åˆ†, æˆ‘ä»¬æ¨å‡ºäº† <a href="https://groups.google.com/d/msg/golang-dev/8DNjlySemwI/-1CDvVX6QVcJ" target="_blank" rel="noopener">go</a> å‘½ä»¤, go get æ›¿æ¢äº† gobuild .</p><p>æ€»ä½“è€Œè¨€, go get å…·æœ‰å˜é©æ„ä¹‰, å¯è®© Go å¼€å‘äººå‘˜å…±äº«æºä»£ç å¹¶æ„å»ºå½¼æ­¤çš„å·¥ä½œ, å¹¶é€šè¿‡åœ¨ go å‘½ä»¤å†…éƒ¨éš”ç¦»æ„å»ºç³»ç»Ÿçš„ç»†èŠ‚æ¥å¯ç”¨å·¥å…·. ä½†æ˜¯ go get ç¼ºå°‘ä»»ä½•ç‰ˆæœ¬æ§åˆ¶çš„æ¦‚å¿µ. å¾ˆæ˜æ˜¾åœ¨<a href="https://groups.google.com/d/msg/golang-nuts/8JFwR3ESjjI/cy7qZzN7Lw4J" target="_blank" rel="noopener">ç¬¬ä¸€æ¬¡ goinstall è®¨è®º</a>ä¸­æˆ‘ä»¬éœ€è¦åšä¸€äº›å…³äºç‰ˆæœ¬æ§åˆ¶çš„å†…å®¹. ä¸å¹¸çš„æ˜¯, è‡³å°‘å¯¹äºæˆ‘ä»¬åœ¨ Go å›¢é˜Ÿä¸­, æˆ‘ä»¬ä¸æ¸…æ¥šç©¶ç«Ÿè¯¥æ€ä¹ˆåš. å½“ go get éœ€è¦ä¸€ä¸ªåŒ…æ—¶, å®ƒæ€»æ˜¯è·å–æœ€æ–°çš„å‰¯æœ¬, å°†ä¸‹è½½å’Œæ›´æ–°æ“ä½œå§”æ‰˜ç»™åƒ Git æˆ– Mercurial è¿™æ ·çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ. è½¯ä»¶åŒ…ç‰ˆæœ¬çš„è¿™ç§æ— çŸ¥å¯¼è‡´äº†è‡³å°‘ä¸¤ä¸ªæ˜¾è‘—çš„ç¼ºé™·.</p><h3 id="ç‰ˆæœ¬å’Œ-API-ç¨³å®šæ€§"><a href="#ç‰ˆæœ¬å’Œ-API-ç¨³å®šæ€§" class="headerlink" title="ç‰ˆæœ¬å’Œ API ç¨³å®šæ€§"></a>ç‰ˆæœ¬å’Œ API ç¨³å®šæ€§</h3><p>go get çš„ç¬¬ä¸€ä¸ªæ˜¾è‘—ç¼ºç‚¹æ˜¯, å¦‚æœæ²¡æœ‰ç‰ˆæœ¬æ§åˆ¶çš„æ¦‚å¿µ, å®ƒå°±ä¸èƒ½å‘Šè¯‰ç”¨æˆ·å¯¹ç»™å®šæ›´æ–°æœŸæœ›å‘ç”Ÿä»€ä¹ˆæ ·çš„å˜åŒ–.</p><p>2013 å¹´ 11 æœˆ, Go 1.2 æ·»åŠ äº†ä¸€ä¸ªå…³äºåŒ…ç‰ˆæœ¬æ§åˆ¶çš„å¸¸è§é—®é¢˜è§£ç­”æ¡ç›®, æä¾›äº†åŸºæœ¬çš„å»ºè®® (Go 1.10ä¹Ÿæ²¡æœ‰å˜):</p><blockquote><p>æ‰“ç®—ä¾›å…¬ä¼—ä½¿ç”¨çš„è½¯ä»¶åŒ…åº”è¯¥å°½é‡ä¿æŒå‘åå…¼å®¹æ€§. <a href="https://golang.org/doc/go1compat.html" target="_blank" rel="noopener">Go 1 å…¼å®¹æ€§å‡†åˆ™</a>åœ¨è¿™é‡Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å‚è€ƒ: ä¸è¦åˆ é™¤å¯¼å‡ºçš„åç§°, é¼“åŠ±æ ‡è®°çš„å¤åˆæ–‡å­—ç­‰ç­‰. å¦‚æœéœ€è¦ä¸åŒçš„åŠŸèƒ½, è¯·æ·»åŠ æ–°åç§°è€Œä¸æ˜¯æ›´æ”¹æ—§åç§°. å¦‚æœéœ€è¦å®Œå…¨æ‰“ç ´å…¼å®¹æ€§, è¯·åˆ›å»ºæ–°çš„å¯¼å…¥è·¯å¾„çš„è½¯ä»¶åŒ….</p></blockquote><p>2014 å¹´ 3 æœˆ, Gustavo Niemeyer åˆ›å»ºäº† <a href="https://gopkg.in/" target="_blank" rel="noopener">gopkg.in</a>, å¹¿è€Œå‘Šä¹‹ä¸º â€œGoè¯­è¨€çš„ç¨³å®šAPIâ€. è¯¥åŸŸåæ˜¯ä¸€ä¸ªç‰ˆæœ¬æ„ŸçŸ¥çš„ GitHub é‡å®šå‘å™¨, å…è®¸å¯¼å…¥è·¯å¾„, å¦‚ gopkg.in/yaml.v1 å’Œ gopkg.in/yaml.v2 å¼•ç”¨å•ä¸ª Git ä»“åº“çš„ä¸åŒæäº¤ (å¯èƒ½ä½äºä¸åŒåˆ†æ”¯ä¸Š) . åœ¨è¯­ä¹‰ç‰ˆæœ¬åŒ–ä¹‹å, åŒ…ä½œè€…éœ€è¦åœ¨è¿›è¡Œé‡å¤§æ›´æ”¹æ—¶å¼•å…¥ä¸€ä¸ªæ–°çš„ä¸»è¦ç‰ˆæœ¬, ä»¥ä¾¿è¾ƒæ—©ç‰ˆæœ¬çš„ v1 å¯¼å…¥è·¯å¾„å¯ä»¥ä½œä¸ºå…ˆå‰ç‰ˆæœ¬çš„æ›¿ä»£ç‰ˆæœ¬, è€Œ v2 å¯¼å…¥è·¯å¾„å¯èƒ½æ˜¯å®Œå…¨ä¸åŒçš„ API.</p><p>2015 å¹´ 8 æœˆ, Dave Cheney æå‡º<a href="https://github.com/golang/go/issues/12302" target="_blank" rel="noopener">é‡‡ç”¨è¯­ä¹‰ç‰ˆæœ¬åŒ–çš„ææ¡ˆ</a>. è¿™åœ¨æ¥ä¸‹æ¥çš„å‡ ä¸ªæœˆé‡Œå¼•å‘äº†ä¸€åœºæœ‰è¶£çš„è®¨è®º, å…¶ä¸­æ¯ä¸ªäººä¼¼ä¹éƒ½è®¤ä¸º, ä½¿ç”¨è¯­ä¹‰ç‰ˆæœ¬æ ‡è®°ä»£ç ä¼¼ä¹æ˜¯ä¸€ä¸ªå¥½ä¸»æ„, ä½†æ²¡æœ‰äººçŸ¥é“ä¸‹ä¸€æ­¥: è¿™äº›ç‰ˆæœ¬åº”è¯¥ä½¿ç”¨ä»€ä¹ˆå·¥å…· ?</p><p>ä»»ä½•å…³äºè¯­ä¹‰ç‰ˆæœ¬çš„è®¨è®ºéƒ½ä¸å¯é¿å…åœ°åŒ…å«å¼•ç”¨æµ·å‹’å§†æ³•åˆ™çš„åé©³, å…¶ä¸­æŒ‡å‡º:</p><blockquote><p>æ‹¥æœ‰è¶³å¤Ÿæ•°é‡çš„ API ç”¨æˆ·, æ— è®ºä½ åœ¨åˆåŒä¸­æ‰¿è¯ºä»€ä¹ˆ, éƒ½æ— å…³ç´§è¦. ç³»ç»Ÿä¸­æ‰€æœ‰å¯è§‚å¯Ÿåˆ°çš„è¡Œä¸ºéƒ½å°†è¢«æŸäººä¾èµ–.</p></blockquote><p>è™½ç„¶æµ·å‹’å§†æ³•åˆ™åœ¨ç»éªŒä¸Šæ˜¯çœŸå®çš„, ä½†æ˜¯è¯­ä¹‰ç‰ˆæœ¬åŒ–ä»ç„¶æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„æ–¹æ³•æ¥æ„å»ºå¯¹å‘å¸ƒä¹‹é—´å…³ç³»çš„æœŸæœ›. ä» 1.2.3 æ›´æ–°åˆ° 1.2.4 ä¸åº”è¯¥ç ´åä½ çš„ä»£ç , è€Œä» 1.2.3 æ›´æ–°åˆ° 2.0.0 æ˜¯å¯èƒ½çš„. å¦‚æœä»£ç åœ¨æ›´æ–°åˆ° 1.2.4 ååœæ­¢å·¥ä½œ, ä½œè€…å¾ˆå¯èƒ½ä¼šæ¬¢è¿ bug æŠ¥å‘Šå¹¶åœ¨ 1.2.5 ä¸­å‘å¸ƒä¿®å¤. å¦‚æœä½ çš„ä»£ç åœ¨æ›´æ–°åˆ° 2.0.0 ä¹‹ååœæ­¢å·¥ä½œ(ç”šè‡³ç¼–è¯‘), é‚£ä¹ˆè¿™ç§æ”¹å˜æ›´æœ‰å¯èƒ½æ˜¯æ•…æ„çš„, å¹¶ä¸”åœ¨ 2.0.1 ä¸­ä¿®å¤ä½ çš„ä»£ç çš„æœºä¼šç›¸å¯¹è¾ƒå°‘.</p><p>æˆ‘æ²¡æœ‰ä»æµ·å‹’å§†æ³•åˆ™ä¸­å¾—å‡ºç»“è®º: è¯­ä¹‰ç‰ˆæœ¬åŒ–æ˜¯ä¸å¯èƒ½çš„, æˆ‘è®¤ä¸ºæ„å»ºåº”è¯¥å°å¿ƒåœ°ä½¿ç”¨ä½œè€…æ‰€åšçš„æ¯ä¸ªä¾èµ–çš„å®Œå…¨ç›¸åŒçš„ç‰ˆæœ¬, é™¤éè¢«è¿«. ä¹Ÿå°±æ˜¯è¯´, æ„å»ºåº”è¯¥é»˜è®¤ä¸ºå°½å¯èƒ½é‡ç°.</p><h3 id="Vendoring-ä»¥åŠå¯é‡å¤æ€§æ„å»º"><a href="#Vendoring-ä»¥åŠå¯é‡å¤æ€§æ„å»º" class="headerlink" title="Vendoring ä»¥åŠå¯é‡å¤æ€§æ„å»º"></a>Vendoring ä»¥åŠå¯é‡å¤æ€§æ„å»º</h3><p>go get çš„ç¬¬äºŒä¸ªæ˜¾è‘—çš„ç¼ºç‚¹æ˜¯, å¦‚æœæ²¡æœ‰ç‰ˆæœ¬æ§åˆ¶çš„æ¦‚å¿µ, å®ƒä¸èƒ½ç¡®ä¿ç”šè‡³ä¸èƒ½è¡¨è¾¾å¯é‡å¤æ„å»ºçš„æƒ³æ³•. æ— æ³•ç¡®å®šä½ çš„ç”¨æˆ·æ­£åœ¨ç¼–è¯‘ä½ çš„ä»£ç æ‰€ä¾èµ–çš„ç›¸åŒç‰ˆæœ¬. 2013 å¹´ 11 æœˆ, Go 1.2 å¸¸è§é—®é¢˜è§£ç­”è¿˜æ·»åŠ äº†ä»¥ä¸‹åŸºæœ¬å»ºè®®:</p><blockquote><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯å¤–éƒ¨æä¾›çš„è½¯ä»¶åŒ…, å¹¶æ‹…å¿ƒå®ƒå¯èƒ½ä¼šä»¥æ„æƒ³ä¸åˆ°çš„æ–¹å¼æ›´æ”¹, æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯å°†å…¶å¤åˆ¶åˆ°æœ¬åœ°ä»“åº“ (è¿™æ˜¯ Google å†…éƒ¨é‡‡å–çš„æ–¹æ³•). å°†å‰¯æœ¬å­˜å‚¨åœ¨æ–°çš„å¯¼å…¥è·¯å¾„ä¸‹, ä»¥å°†å…¶æ ‡è¯†ä¸ºæœ¬åœ°å‰¯æœ¬. ä¾‹å¦‚, ä½ å¯èƒ½ä¼šå¤åˆ¶ â€œoriginal.com/pkgâ€ åˆ° â€œyou.com/external/original.com/pkgâ€. Keith Rarick çš„ goven æ˜¯å¸®åŠ©å®ç°è¿™ä¸€è¿‡ç¨‹è‡ªåŠ¨åŒ–çš„å·¥å…·ä¹‹ä¸€.</p></blockquote><p>Goven, Keith Rarick äº 2012 å¹´ 3 æœˆå¼€å§‹åˆ›å»º, å®ƒå°†ä¾èµ–é¡¹å¤åˆ¶åˆ°ä½ çš„ä»“åº“ä¸­, å¹¶æ›´æ–°å…¶ä¸­çš„æ‰€æœ‰å¯¼å…¥è·¯å¾„ä»¥åæ˜ æ–°ä½ç½®. ä»¥è¿™ç§æ–¹å¼ä¿®æ”¹ä¾èµ–é¡¹çš„æºä»£ç å¯¹äºæ„å»ºå®ƒè€Œè¨€æ˜¯å¿…è¦çš„, ä½†ä¹Ÿæ˜¯ä¸å¹¸çš„. è¿™äº›ä¿®æ”¹ä½¿å¾—å®ƒéš¾ä»¥ä¸ä½¿ç”¨è¯¥ä¾èµ–å…³ç³»çš„å…¶ä»–å¤åˆ¶ä»£ç è¿›è¡Œæ¯”è¾ƒå’Œåˆå¹¶æ›´æ–°çš„å‰¯æœ¬å’Œæ‰€éœ€çš„æ›´æ–°.</p><p>Keith åœ¨ 2013 å¹´ 9 æœˆå®£å¸ƒäº† <a href="https://groups.google.com/d/msg/golang-nuts/8NJq6jTIpas/Vpf-KZtVu9MJ" target="_blank" rel="noopener">godep</a>: â€œä¸€ä¸ªå†»ç»“è½¯ä»¶åŒ…ä¾èµ–å…³ç³»çš„æ–°å·¥å…·â€. godep çš„ä¸»è¦è¿›å±•æ˜¯æ·»åŠ æˆ‘ä»¬ç°åœ¨æ‰€ç†è§£çš„ Go vendoring - å³å°†ä¾èµ–å¤åˆ¶åˆ°é¡¹ç›®ä¸­, è€Œä¸ä¿®æ”¹æºæ–‡ä»¶ - æ²¡æœ‰ç›´æ¥å·¥å…·é“¾é€šè¿‡ä»¥æŸç§æ–¹å¼è®¾ç½® GOPATH æ¥æ”¯æŒ.</p><p>2014 å¹´ 10 æœˆ, Keith å»ºè®®åœ¨ Go å·¥å…·é“¾ä¸­<a href="https://groups.google.com/forum/#!msg/golang-dev/74zjMON9glU/dGhnoi2IMzsJ" target="_blank" rel="noopener">å¢åŠ å¯¹ â€œå¤–éƒ¨è½¯ä»¶åŒ…â€ æ¦‚å¿µçš„æ”¯æŒ</a>, ä»¥ä¾¿å·¥å…·å¯ä»¥æ›´å¥½åœ°ç†è§£ä½¿ç”¨è¯¥çº¦å®šçš„é¡¹ç›®. å±Šæ—¶, æœ‰è®¸å¤šç±»ä¼¼äº godep çš„åŠªåŠ›. Matt Farina å†™äº†ä¸€ç¯‡åšå®¢æ–‡ç« : â€œ<a href="https://codeengineered.com/blog/2014/glide-go-package-management/" target="_blank" rel="noopener">Glide In The Sea of Go Package Managers</a>â€œ, å°†æœ€æ–°çš„åŒ…ç®¡ç†å™¨ç‰¹åˆ«æ˜¯ glide ä¸ godep è¿›è¡Œæ¯”è¾ƒ.</p><p>2015 å¹´ 4 æœˆ, Dave Cheney ä»‹ç»äº† gb ä¸€ä¸ª â€œåŸºäºé¡¹ç›®çš„æ„å»ºå·¥å…·â€¦å…è®¸é€šè¿‡æºä»£ç  vendoring é‡å¤æ„å»ºâ€, è€Œä¸”æ— éœ€é‡æ–°å¯¼å…¥. (gb çš„å¦ä¸€ä¸ªåŠ¨æœºæ˜¯é¿å…å°†ä»£ç å­˜å‚¨åœ¨ GOPATH ä¸­çš„ç‰¹å®šç›®å½•ä¸­, è¿™å¯¹äºè®¸å¤šå¼€å‘äººå‘˜çš„å·¥ä½œæµç¨‹æ¥è¯´ä¸å¤ªé€‚åˆ).</p><p>é‚£å¹´æ˜¥å¤©, Jason Buberel å¯¹ Go åŒ…ç®¡ç†è¿›è¡Œäº†è°ƒæŸ¥, ä»¥äº†è§£å¯ä»¥é‡‡å–ä»€ä¹ˆæªæ–½æ¥ç»Ÿä¸€è¿™äº›å¤šé‡åŠªåŠ›, é¿å…é‡å¤å’Œæµªè´¹å·¥ä½œ. ä»–çš„è°ƒæŸ¥åœ¨ Go å›¢é˜Ÿä¸­æ¸…æ¥šåœ°è¡¨æ˜, go å‘½ä»¤éœ€è¦ç›´æ¥æ”¯æŒ vendoring è€Œä¸æ˜¯é‡å†™ import . ä¸æ­¤åŒæ—¶, Daniel Theophanes å¼€å§‹äº†ä¸€ä¸ªæ–‡ä»¶æ ¼å¼è§„èŒƒ, ä»¥æè¿° vendor ç›®å½•ä¸­ç¡®åˆ‡çš„å‡ºå¤„å’Œä»£ç ç‰ˆæœ¬. 2015 å¹´ 6 æœˆ, æˆ‘ä»¬æ¥å— Keith çš„ææ¡ˆä½œä¸º Go 1.5 vendor å®éªŒæ–¹å¼, åœ¨ Go 1.5 ä¸­å¯é€‰, å¹¶åœ¨ Go 1.6 ä¸­é»˜è®¤å¯ç”¨. æˆ‘ä»¬é¼“åŠ±æ‰€æœ‰ vendoring å·¥å…·ä½œè€…ä¸ Daniel åˆä½œé‡‡ç”¨å•ä¸€å…ƒæ•°æ®æ–‡ä»¶æ ¼å¼.</p><p>å°† vendoring æ¦‚å¿µçº³å…¥ Go å·¥å…·é“¾å…è®¸ç¨‹åºåˆ†æå·¥å…·å¦‚ go vet ä½¿ç”¨ vendoring æ›´å¥½åœ°ç†è§£é¡¹ç›®, ç°åœ¨æœ‰åå‡ ä¸ª Go è½¯ä»¶åŒ…ç®¡ç†å™¨æˆ– vendoring å·¥å…·æ¥ç®¡ç† vendor ç›®å½•. å¦ä¸€æ–¹é¢, å› ä¸ºè¿™äº›å·¥å…·éƒ½ä½¿ç”¨ä¸åŒçš„å…ƒæ•°æ®æ–‡ä»¶æ ¼å¼, æ‰€ä»¥å®ƒä»¬ä¸èƒ½äº’æ“ä½œ, å¹¶ä¸”ä¸èƒ½è½»æ¾å…±äº«å…³äºä¾èµ–éœ€æ±‚çš„ä¿¡æ¯.</p><p>ä»æ ¹æœ¬ä¸Šè¯´, vendoring æ˜¯è§£å†³è½¯ä»¶åŒ…ç‰ˆæœ¬é—®é¢˜çš„ä¸å®Œæ•´æ–¹æ¡ˆ. å®ƒåªæä¾›å¯é‡å¤æ€§æ„å»º. å®ƒæ²¡æœ‰å¸®åŠ©ç†è§£è½¯ä»¶åŒ…ç‰ˆæœ¬å¹¶å†³å®šä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„è½¯ä»¶åŒ…. è½¯ä»¶åŒ…ç®¡ç†å™¨å¦‚ glide å’Œ dep å°†ç‰ˆæœ¬æ§åˆ¶çš„æ¦‚å¿µéšå¼åœ°æ·»åŠ åˆ° Go ä¸­, é€šè¿‡ä»¥æŸç§æ–¹å¼è®¾ç½® vendor ç›®å½•è€Œæ— éœ€ç›´æ¥çš„å·¥å…·é“¾æ”¯æŒ. å› æ­¤, Go ç”Ÿæ€ç³»ç»Ÿä¸­çš„è®¸å¤šå·¥å…·æ— æ³•æ­£ç¡®è¯†åˆ«ç‰ˆæœ¬. å¾ˆæ˜æ˜¾, Go éœ€è¦å¯¹è½¯ä»¶åŒ…ç‰ˆæœ¬æä¾›ç›´æ¥çš„å·¥å…·é“¾æ”¯æŒ.</p><h3 id="å®˜æ–¹åŒ…ç®¡ç†å®éªŒ"><a href="#å®˜æ–¹åŒ…ç®¡ç†å®éªŒ" class="headerlink" title="å®˜æ–¹åŒ…ç®¡ç†å®éªŒ"></a>å®˜æ–¹åŒ…ç®¡ç†å®éªŒ</h3><p>åœ¨ 2016 å¹´ GopherCon å¤§ä¼šä¸Š, ä¸€ç¾¤æœ‰è¶£çš„ gophers åœ¨ Hack Day (ç°åœ¨æ˜¯ Community Day) èšåœ¨ä¸€èµ·, <a href="https://docs.google.com/document/d/1xMJ0c-YxvcgNglzjbALzncs5_Acr0MST29oMf9TkgQI/edit" target="_blank" rel="noopener">å›´ç»• Go åŒ…ç®¡ç†è¿›è¡Œå¹¿æ³›çš„è®¨è®º</a>. å…¶ä¸­ä¸€ä¸ªæˆæœæ˜¯æˆç«‹äº†<a href="https://groups.google.com/d/msg/go-package-management/P8TehVoFLjg/Ni6VRyOjEAAJ" target="_blank" rel="noopener">ä¸€ä¸ªå§”å‘˜ä¼šå’Œä¸€ä¸ªåŒ…ç®¡ç†å·¥ä½œå’¨è¯¢å°ç»„</a>, ç›®æ ‡æ˜¯ä¸º Go åŒ…ç®¡ç†åˆ›å»ºä¸€ä¸ªæ–°å·¥å…·. æ„¿æ™¯æ˜¯ä¸ºäº†ç»Ÿä¸€å’Œå–ä»£ç°æœ‰çš„å·¥å…·, ä½†å®ƒä»ç„¶åœ¨ç›´æ¥å·¥å…·é“¾ä¹‹å¤–ä½¿ç”¨ vendor ç›®å½•æ¥å®ç°.<br>ç”± Peter Bourgon ç»„ç»‡çš„å§”å‘˜ä¼š Andrew Gerrand, Ed Muller, Jessie Frazelle å’Œ Sam Boyer èµ·è‰äº†ä¸€ä»½<a href="https://docs.google.com/document/d/1qnmjwfMmvSCDaY4jxPmLAccaaUI5FfySNE90gB0pTKQ/edit" target="_blank" rel="noopener">è§„èŒƒ</a>, ç„¶åç”± Sam é¢†å¯¼, å°†å…¶<a href="https://github.com/golang/dep" target="_blank" rel="noopener">å®æ–½ä¸º dep</a>. æœ‰å…³èƒŒæ™¯ä¿¡æ¯, è¯·å‚é˜… Sam çš„ 2016 å¹´ 2 æœˆå‘å¸ƒçš„æ–‡ç« : â€œ<a href="https://medium.com/@sdboyer/so-you-want-to-write-a-package-manager-4ae9c17d9527" target="_blank" rel="noopener">æ‰€ä»¥ä½ æƒ³å†™ä¸€ä¸ªåŒ…ç®¡ç†å™¨</a>â€œ, ä»– 2016 å¹´ 12 æœˆå‘å¸ƒçš„ â€œ<a href="https://blog.gopheracademy.com/advent-2016/saga-go-dependency-management/" target="_blank" rel="noopener">Go çš„ä¾èµ–ç®¡ç†ä¼ å¥‡</a>â€œ å’Œä»– 2017 å¹´ 7 æœˆçš„ GopherCon æ¼”è®² â€œ<a href="https://www.youtube.com/watch?v=5LtMb090AZI" target="_blank" rel="noopener">GoåŒ…ç®¡ç†çš„æ–°æ—¶ä»£</a>â€œ.</p><p>Dep æœ‰è®¸å¤šç”¨é€”: å®ƒæ˜¯å¯¹å½“å‰å¯ç”¨çš„å®è·µçš„é‡è¦æ”¹è¿›, å®ƒæ˜¯æœç€è§£å†³æ–¹æ¡ˆè¿ˆå‡ºçš„é‡è¦ä¸€æ­¥, ä¹Ÿæ˜¯ä¸€ä¸ªå®éªŒ - æˆ‘ä»¬ç§°ä¹‹ä¸º â€œå®˜æ–¹å®éªŒâ€ - å¸®åŠ©æˆ‘ä»¬æ›´å¤šåœ°äº†è§£ä»€ä¹ˆæ˜¯å¯¹ Go å¼€å‘è€…å‹å¥½çš„ä»¥åŠå“ªäº›ä¸æ˜¯. ä½† dep ä¸æ˜¯æœ€ç»ˆé›†æˆäº†åŒ…ç‰ˆæœ¬æ§åˆ¶çš„ go å‘½ä»¤çš„ç›´æ¥åŸå‹. å®ƒæ˜¯ä¸€ç§å¼ºå¤§çš„, å‡ ä¹ä»»æ„çµæ´»çš„æ–¹å¼æ¥æ¢ç´¢è®¾è®¡ç©ºé—´, åœ¨æ„å»º Go ç¨‹åºæ—¶æ‰®æ¼”åƒ makefiles ä¸€æ ·çš„è§’è‰². ä½†æ˜¯, ä¸€æ—¦æˆ‘ä»¬æ›´å¥½åœ°ç†è§£è®¾è®¡ç©ºé—´å¹¶å°†å…¶ç¼©å°åˆ°å¿…é¡»æ”¯æŒçš„å‡ ä¸ªå…³é”®ç‰¹æ€§, å®ƒå°†å¸®åŠ© Go ç”Ÿæ€ç³»ç»Ÿç§»é™¤å…¶ä»–ç‰¹æ€§, é™ä½è¡¨ç°åŠ›, é‡‡ç”¨å¼ºåˆ¶æ€§çº¦å®š, ä½¿ Go ä»£ç åº“æ›´åŠ å‡åŒ€å¹¶ä¸”æ›´å®¹æ˜“ç†è§£å¹¶ä½¿å·¥å…·æ›´æ˜“äºæ„å»º.</p><p>è¿™ç¯‡æ–‡ç« æ˜¯ dep ä¹‹åä¸‹ä¸€æ­¥çš„å¼€å§‹: æœ€ç»ˆ go å‘½ä»¤é›†æˆåŸå‹çš„åˆç¨¿, å³ goinstall çš„åŒ…ç®¡ç†çš„ç­‰ä»·ç‰©. åŸå‹æ˜¯æˆ‘ä»¬æ‰€ç§°çš„ç‹¬ç«‹å‘½ä»¤ vgo. å®ƒæ˜¯ go å‘½ä»¤çš„ç›´æ¥æ›¿ä»£å“, ä½†å®ƒå¢åŠ äº†å¯¹è½¯ä»¶åŒ…ç‰ˆæœ¬æ§åˆ¶çš„æ”¯æŒ. è¿™æ˜¯ä¸€ä¸ªæ–°çš„å®éªŒ, æˆ‘ä»¬å°†çœ‹åˆ°æˆ‘ä»¬å¯ä»¥ä»ä¸­å­¦åˆ°ä»€ä¹ˆ. å°±åƒæˆ‘ä»¬ä»‹ç» goinstall çš„é‚£æ ·, å½“å‰ä¸€äº›ä»£ç å’Œé¡¹ç›®å·²ç»å¯ä»¥ä½¿ç”¨ vgo, å…¶ä»–é¡¹ç›®éœ€è¦è¿›è¡Œæ›´æ”¹æ‰èƒ½å…¼å®¹. æˆ‘ä»¬å°†æ‹¿èµ°ä¸€äº›æ§åˆ¶å’Œè¡¨ç°åŠ›, å°±åƒæˆ‘ä»¬æ‹¿èµ°äº† makefile ä¸€æ ·, ä¸ºç®€åŒ–ç³»ç»Ÿå’Œæ¶ˆé™¤ç”¨æˆ·å¤æ‚æ€§æœåŠ¡. é€šå¸¸ï¼Œæˆ‘ä»¬æ­£åœ¨å¯»æ‰¾æ—©æœŸé‡‡ç”¨è€…æ¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œå®éªŒ vgo, ä»¥ä¾¿æˆ‘ä»¬å°½å¯èƒ½åœ°ä»ç”¨æˆ·é‚£é‡Œå­¦ä¹ .</p><p>å¼€å§‹å°è¯• vgo å¹¶ä¸æ„å‘³ç€ç»“æŸå¯¹ dep çš„æ”¯æŒ. æˆ‘ä»¬å°†ä¿æŒ dep å¯ç”¨, ç›´åˆ°å®Œæˆ go å‘½ä»¤é›†æˆçš„è·¯å¾„è¢«ç¡®å®š, å®æ–½å¹¶ä¸”å¤§ä½“ä¸Šå¯ç”¨. æˆ‘ä»¬ä¹Ÿå°†å°½å¯èƒ½é¡ºåˆ©åœ°å®Œæˆä»æœ€ç»ˆè¿‡æ¸¡ dep åˆ° go å‘½ä»¤é›†æˆçš„å„ç§å½¢å¼. å°šæœªè½¬åŒ–åˆ° dep çš„é¡¹ç›®ä»ç„¶å¯ä»¥ä»ä¸­è·ç›Š. (æ³¨æ„, <a href="https://github.com/tools/godep" target="_blank" rel="noopener">godep</a> å’Œ <a href="https://github.com/Masterminds/glide" target="_blank" rel="noopener">glide</a> å·²ç»ç»“æŸäº†æ´»è·ƒçš„å¼€å‘, é¼“åŠ±è¿ç§»åˆ° dep). å…¶ä»–é¡¹ç›®ä¸å¦¨ç›´æ¥è¿ç§»åˆ° vgo, å¦‚æœå®ƒå·²æ»¡è¶³éœ€æ±‚.</p><h2 id="ææ¡ˆ"><a href="#ææ¡ˆ" class="headerlink" title="ææ¡ˆ"></a>ææ¡ˆ</h2><p>æ·»åŠ ç‰ˆæœ¬åˆ° go å‘½ä»¤çš„ææ¡ˆæœ‰å››ä¸ªæ­¥éª¤. é¦–å…ˆ, é‡‡ç”¨ Go FAQ å’Œ gopkg.in æš—ç¤ºçš„å¯¼å…¥å…¼å®¹æ€§è§„åˆ™; ä¹Ÿå°±æ˜¯è¯´, å»ºç«‹ä¸€ä¸ªé¢„æœŸ, å³å…·æœ‰ç»™å®šå¯¼å…¥è·¯å¾„çš„è½¯ä»¶åŒ…çš„æ–°ç‰ˆæœ¬åº”è¯¥ä¸æ—§ç‰ˆæœ¬å‘åå…¼å®¹. å…¶æ¬¡, ä½¿ç”¨ç®€å•çš„æ–°ç®—æ³•(ç§°ä¸ºæœ€å°ç‰ˆæœ¬é€‰æ‹©)æ¥é€‰æ‹©åœ¨ç»™å®šæ„å»ºä¸­ä½¿ç”¨å“ªäº›ç‰ˆæœ¬. ç¬¬ä¸‰, å¼•å…¥ Go module çš„æ¦‚å¿µ, Go module æ˜¯ä¸€ç»„ç‰ˆæœ¬ä¸ºå•ä¸ªç‰ˆæœ¬çš„è½¯ä»¶åŒ…, å¹¶å£°æ˜äº†å®ƒä»¬çš„ä¾èµ–å…³ç³»å¿…é¡»æ»¡è¶³çš„æœ€ä½è¦æ±‚. ç¬¬å››, å®šä¹‰å¦‚ä½•å°†æ‰€æœ‰è¿™äº›æ”¹é€ æˆç°æœ‰çš„ go å‘½ä»¤, ä»¥ä¾¿åŸºæœ¬çš„å·¥ä½œæµç¨‹ä»ä»Šå¤©ä¸å†å‘ç”Ÿæ˜¾è‘—å˜åŒ–. æœ¬èŠ‚çš„å…¶ä½™éƒ¨åˆ†å°†ä»‹ç»è¿™äº›æ­¥éª¤ä¸­çš„æ¯ä¸€ä¸ª. æœ¬å‘¨å…¶ä»–åšå®¢æ–‡ç« å°†æ›´è¯¦ç»†åœ°ä»‹ç».</p><h3 id="å¯¼å…¥-Import-å…¼å®¹æ€§è§„åˆ™"><a href="#å¯¼å…¥-Import-å…¼å®¹æ€§è§„åˆ™" class="headerlink" title="å¯¼å…¥ (Import) å…¼å®¹æ€§è§„åˆ™"></a>å¯¼å…¥ (Import) å…¼å®¹æ€§è§„åˆ™</h3><p>åŒ…è£…ç®¡ç†ç³»ç»Ÿä¸­å‡ ä¹æ‰€æœ‰çš„ç—›è‹¦éƒ½æ˜¯ç”±äºè¯•å›¾é©¯æœä¸å…¼å®¹è€Œå¯¼è‡´çš„. ä¾‹å¦‚, å¤§å¤šæ•°ç³»ç»Ÿå…è®¸ç¨‹åºåŒ… B å£°æ˜å®ƒéœ€è¦ç¨‹åºåŒ… D 6 æˆ–æ›´é«˜ç‰ˆæœ¬, ç„¶åå…è®¸ç¨‹åºåŒ… C å£°æ˜å®ƒéœ€è¦D 2, 3 æˆ– 4, ä½†ä¸æ˜¯ 5 æˆ–æ›´é«˜ç‰ˆæœ¬. å¦‚æœä½ æ­£åœ¨ç¼–å†™è½¯ä»¶åŒ… A, å¹¶ä¸”ä½ æƒ³åŒæ—¶ä½¿ç”¨ B å’Œ C, é‚£ä¹ˆä½ è¿æ°”ä¸å¥½: æ²¡æœ‰ä¸€ä¸ª D ç‰ˆæœ¬å¯ä»¥é€‰æ‹©å°† B å’Œ C ä¸€èµ·æ„å»ºåˆ° A ä¸­. ä½ ä»€ä¹ˆä¹Ÿåšä¸äº†: è¿™äº›ç³»ç»Ÿè¯´ B å’Œ C è¿™æ ·åšæ˜¯å¯ä»¥æ¥å—çš„ - ä»–ä»¬æœ‰æ•ˆåœ°é¼“åŠ±å®ƒ - æ‰€ä»¥å°±è¿™æ ·ä½ è¢«å¡ä½äº†.</p><p>è¿™ä¸ªææ¡ˆè¦æ±‚åŒ…ä½œè€…éµå¾ªå¯¼å…¥å…¼å®¹æ€§è§„åˆ™, è€Œä¸æ˜¯è®¾è®¡ä¸€ä¸ªä¸å¯é¿å…å¯¼è‡´å¤§å‹ç¨‹åºæ— æ³•æ„å»ºçš„ç³»ç»Ÿ:</p><blockquote><p>å¦‚æœæ—§è½¯ä»¶åŒ…å’Œæ–°è½¯ä»¶åŒ…å…·æœ‰ç›¸åŒçš„å¯¼å…¥è·¯å¾„, åˆ™æ–°è½¯ä»¶åŒ…å¿…é¡»ä¸æ—§è½¯ä»¶åŒ…å‘åå…¼å®¹.</p></blockquote><p>è¿™æ¡è§„åˆ™æ˜¯å¯¹å‰é¢å¼•ç”¨çš„ Go FAQ ä¸­çš„å»ºè®®çš„é‡ç”³. å¸¸è§é—®é¢˜å¼•æ–‡æœ€åè¯´åˆ°: â€œå¦‚æœéœ€è¦å®Œå…¨çš„ç ´åå…¼å®¹æ€§, è¯·ä½¿ç”¨æ–°çš„å¯¼å…¥è·¯å¾„åˆ›å»ºä¸€ä¸ªæ–°åŒ…â€. ä»Šå¤©çš„å¼€å‘äººå‘˜å¸Œæœ›ä½¿ç”¨è¯­ä¹‰ç‰ˆæœ¬æ¥è¡¨è¾¾è¿™æ ·ä¸€ä¸ªç ´å, æ‰€ä»¥æˆ‘ä»¬å°†è¯­ä¹‰ç‰ˆæœ¬é›†æˆåˆ°äº†æˆ‘ä»¬çš„ææ¡ˆä¸­. å…·ä½“æ¥è¯´, ä¸»ç‰ˆæœ¬ 2 å’Œæ›´é«˜ç‰ˆæœ¬å¯ä»¥é€šè¿‡åœ¨è·¯å¾„ä¸­åŒ…å«ç‰ˆæœ¬æ¥ä½¿ç”¨, å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import &quot;github.com/go-yaml/yaml/v2&quot;</span><br></pre></td></tr></table></figure><p>åˆ›å»º v2.0.0, åœ¨è¯­ä¹‰ç‰ˆæœ¬åŒ–ä¸­è¡¨ç¤ºä¸€ä¸ªé‡å¤§ç ´å, å› æ­¤æŒ‰ç…§å¯¼å…¥å…¼å®¹æ€§çš„è¦æ±‚, åˆ›å»ºå…·æœ‰æ–°å¯¼å…¥è·¯å¾„çš„æ–°åŒ…. ç”±äºæ¯ä¸ªä¸»è¦ç‰ˆæœ¬éƒ½æœ‰ä¸åŒçš„å¯¼å…¥è·¯å¾„, å› æ­¤ç»™å®šçš„ Go å¯æ‰§è¡Œæ–‡ä»¶å¯èƒ½åŒ…å«æ¯ä¸ªä¸»è¦ç‰ˆæœ¬ä¸­çš„ä¸€ä¸ª. è¿™æ˜¯é¢„æœŸçš„å’Œå¯å–çš„. å®ƒä¿æŒç¨‹åºçš„æ„å»º, å¹¶å…è®¸ä¸€ä¸ªéå¸¸å¤§çš„ç¨‹åºéƒ¨åˆ†ç‹¬ç«‹åœ°ä» v1 æ›´æ–°åˆ° v2.</p><p>æœŸæœ›åŒ…ä½œè€…éµå¾ªå¯¼å…¥å…¼å®¹æ€§è§„åˆ™, å¯ä»¥é¿å…å°è¯•é©¯æœä¸å…¼å®¹æ€§, ä½¿æ•´ä¸ªç³»ç»ŸæŒ‡æ•°çº§æ›´ç®€å•, å¹¶ä¸”è½¯ä»¶åŒ…ç”Ÿæ€ç³»ç»Ÿæ›´å°‘ç¢ç‰‡åŒ–. å½“ç„¶, å®é™…ä¸Š, å°½ç®¡ä½œè€…åšå‡ºäº†æœ€å¤§çš„åŠªåŠ›, ä½†åœ¨åŒä¸€ä¸ªä¸»è¦ç‰ˆæœ¬ä¸­çš„æ›´æ–°å¶å°”ä¼šç ´åç”¨æˆ·ä½¿ç”¨. å› æ­¤, ä½¿ç”¨å‡çº§é€Ÿåº¦ä¸å¤ªå¿«çš„å‡çº§æœºåˆ¶å¾ˆé‡è¦. è¿™å°†å¼•é¢†æˆ‘ä»¬åˆ°ä¸‹ä¸€æ­¥.</p><h3 id="æœ€å°ç‰ˆæœ¬é€‰æ‹©"><a href="#æœ€å°ç‰ˆæœ¬é€‰æ‹©" class="headerlink" title="æœ€å°ç‰ˆæœ¬é€‰æ‹©"></a>æœ€å°ç‰ˆæœ¬é€‰æ‹©</h3><p>ä»Šå¤©å‡ ä¹æ‰€æœ‰çš„è½¯ä»¶åŒ…ç®¡ç†å™¨, åŒ…æ‹¬ dep å’Œ cargo, ä½¿ç”¨<a href="https://research.swtch.com/cargo-newest.html" target="_blank" rel="noopener">æœ€æ–°å…è®¸çš„ç‰ˆæœ¬</a>å‚ä¸æ„å»ºåŒ…. æˆ‘è®¤ä¸ºè¿™æ˜¯é”™è¯¯çš„è¿çº¦, æœ‰ä¸¤ä¸ªé‡è¦åŸå› . é¦–å…ˆ, â€œæœ€æ–°å…è®¸ç‰ˆæœ¬â€çš„å«ä¹‰å¯èƒ½å› å¤–éƒ¨äº‹ä»¶è€Œæ”¹å˜, å³æ–°ç‰ˆæœ¬æ­£åœ¨å‘å¸ƒ. ä¹Ÿè®¸ä»Šæ™šæœ‰äººä¼šæ¨å‡ºä¸€äº›æ–°ç‰ˆæœ¬çš„ä¾èµ–é¡¹, ç„¶åæ˜å¤©ä½ å†è¿è¡Œä»Šå¤©çš„ç›¸åŒå‘½ä»¤åºåˆ—ä¼šäº§ç”Ÿä¸åŒçš„ç»“æœ. å…¶æ¬¡ï¼Œä¸ºäº†è¦†ç›–è¿™ä¸ªé»˜è®¤å€¼, å¼€å‘äººå‘˜èŠ±æ—¶é—´å‘Šè¯‰åŒ…ç®¡ç†å™¨ â€œä¸, ä¸è¦ä½¿ç”¨ Xâ€, ç„¶ååŒ…ç®¡ç†å™¨èŠ±æ—¶é—´<a href="https://research.swtch.com/version-sat" target="_blank" rel="noopener">å¯»æ‰¾ä¸€ç§ä¸ä½¿ç”¨ X çš„æ–¹æ³•</a>.</p><p>è¿™ä¸ªææ¡ˆé‡‡å–äº†ä¸åŒçš„æ–¹æ³•, æˆ‘ç§°ä¹‹ä¸ºæœ€å°ç‰ˆæœ¬é€‰æ‹©. å®ƒé»˜è®¤ä½¿ç”¨æ„å»ºä¸­æ¶‰åŠçš„æ¯ä¸ªåŒ…çš„æœ€æ—§å…è®¸ç‰ˆæœ¬. è¿™ä¸ªå†³å®šä»ä»Šå¤©åˆ°æ˜å¤©ä¸ä¼šæ”¹å˜, å› ä¸ºä¸ä¼šå‘å¸ƒæ—§ç‰ˆæœ¬. æ›´å¥½çš„æ˜¯, ä¸ºäº†è¦†ç›–è¿™ä¸ªé»˜è®¤å€¼ï¼Œå¼€å‘äººå‘˜èŠ±æ—¶é—´å‘Šè¯‰åŒ…ç®¡ç†å™¨, â€œä¸, è‡³å°‘ä½¿ç”¨ Yâ€, ç„¶ååŒ…ç®¡ç†å™¨å¯ä»¥è½»æ¾åœ°å†³å®šä½¿ç”¨å“ªä¸ªç‰ˆæœ¬. æˆ‘ç§°ä¹‹ä¸ºæœ€å°ç‰ˆæœ¬é€‰æ‹©, å› ä¸ºæ‰€é€‰æ‹©çš„ç‰ˆæœ¬æ˜¯æœ€å°çš„, ä¹Ÿå› ä¸ºæ•´ä¸ªç³»ç»Ÿä¹Ÿå¯èƒ½æ˜¯æœ€å°çš„, é¿å…äº†ç°æœ‰ç³»ç»Ÿçš„å‡ ä¹æ‰€æœ‰å¤æ‚æ€§.</p><p>æœ€å°ç‰ˆæœ¬é€‰æ‹©å…è®¸æ¨¡å—ä»…æŒ‡å®šå…¶ä¾èµ–æ¨¡å—çš„æœ€ä½éœ€æ±‚. å®ƒä¸ºå‡çº§å’Œé™çº§æ“ä½œæä¾›äº†å®šä¹‰æ˜ç¡®çš„ç‹¬ç‰¹ç­”æ¡ˆ, å¹¶ä¸”è¿™äº›æ“ä½œçš„å®æ–½æ•ˆç‡å¾ˆé«˜. å®ƒè¿˜å…è®¸æ­£åœ¨æ„å»ºçš„æ•´ä¸ªæ¨¡å—çš„ä½œè€…æŒ‡å®šè¦æ’é™¤çš„ä¾èµ–é¡¹ç‰ˆæœ¬, æˆ–è€…æŒ‡å®šå°†ç‰¹å®šçš„ä¾èµ–é¡¹ç‰ˆæœ¬æ›¿æ¢ä¸ºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­çš„ forked å‰¯æœ¬æˆ–ä½œä¸ºå…¶è‡ªå·±çš„æ¨¡å—å‘å¸ƒ. å½“æ¨¡å—è¢«æ„å»ºä¸ºå…¶ä»–æ¨¡å—çš„ä¾èµ–é¡¹æ—¶, è¿™äº›æ’é™¤å’Œæ›¿æ¢ä¸é€‚ç”¨. è¿™ä½¿ç”¨æˆ·å¯ä»¥å®Œå…¨æ§åˆ¶è‡ªå·±çš„ç¨‹åºçš„æ„å»ºæ–¹å¼, è€Œä¸æ˜¯å…¶ä»–äººçš„ç¨‹åºæ„å»ºæ–¹å¼.</p><p>æœ€å°ç‰ˆæœ¬é€‰æ‹©é»˜è®¤æä¾›å¯é‡å¤çš„ç‰ˆæœ¬, æ— éœ€é”å®šæ–‡ä»¶.</p><p>å¯¼å…¥å…¼å®¹æ€§æ˜¯ç®€åŒ–ç‰ˆæœ¬é€‰æ‹©çš„å…³é”®. ç”¨æˆ·ä¸ä¼šè¯´ â€œä¸, è¿™å¤ªæ–°äº†â€, ä»–ä»¬åªä¼šè¯´ â€œä¸, è¿™å¤ªæ—§äº†â€. åœ¨è¿™ç§æƒ…å†µä¸‹, è§£å†³æ–¹æ¡ˆå¾ˆæ˜ç¡®: ä½¿ç”¨(æœ€ä½é™åº¦)æ›´æ–°çš„ç‰ˆæœ¬. æ–°ç‰ˆæœ¬åŒæ„æˆä¸ºè€ç‰ˆæœ¬çš„å¯æ¥å—æ›¿ä»£å“.</p><h3 id="å®šä¹‰-Go-æ¨¡å—"><a href="#å®šä¹‰-Go-æ¨¡å—" class="headerlink" title="å®šä¹‰ Go æ¨¡å—"></a>å®šä¹‰ Go æ¨¡å—</h3><p>Go æ¨¡å—æ˜¯ä¸€ç»„å…±äº«å…¬å…±å¯¼å…¥è·¯å¾„å‰ç¼€çš„è½¯ä»¶åŒ…, ç§°ä¸ºæ¨¡å—è·¯å¾„. è¯¥æ¨¡å—æ˜¯ç‰ˆæœ¬æ§åˆ¶çš„å•å…ƒ, æ¨¡å—ç‰ˆæœ¬è¢«ç¼–å†™ä¸ºè¯­ä¹‰ç‰ˆæœ¬å­—ç¬¦ä¸². åœ¨å¼€å‘ä½¿ç”¨ Git æ—¶, å¼€å‘äººå‘˜å°†é€šè¿‡å‘æ¨¡å—çš„ Git ä»“åº“æ·»åŠ æ ‡ç­¾(tag)æ¥å®šä¹‰æ¨¡å—çš„æ–°è¯­ä¹‰ç‰ˆæœ¬. å°½ç®¡å¼ºçƒˆæ¨èä½¿ç”¨è¯­ä¹‰ç‰ˆæœ¬, ä½†ä¹Ÿæ”¯æŒå¼•ç”¨ç‰¹å®šçš„æäº¤(commits).</p><p>ä¸€ä¸ªæ¨¡å—åœ¨ä¸€ä¸ªç§°ä½œ go.mod çš„æ–°æ–‡ä»¶ä¸­å®šä¹‰äº†å®ƒæ‰€ä¾èµ–çš„å…¶ä»–æ¨¡å—çš„æœ€ä½ç‰ˆæœ¬è¦æ±‚. ä¾‹å¦‚, è¿™é‡Œæ˜¯ä¸€ä¸ªç®€å•çš„ go.mod æ–‡ä»¶:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// My hello, world.</span><br><span class="line"></span><br><span class="line">module &quot;rsc.io/hello&quot;</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">&quot;golang.org/x/text&quot; v0.0.0-20180208041248-4e4a3210bb54</span><br><span class="line">&quot;rsc.io/quote&quot; v1.5.2</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>è¯¥æ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªç”±è·¯å¾„æ ‡è¯†çš„æ¨¡å—, è¯¥æ¨¡å— rsc.io/hello æœ¬èº«ä¾èµ–äºå¦å¤–ä¸¤ä¸ªæ¨¡å—: golang.org/x/text å’Œ rsc.io/quote. æ¨¡å—æœ¬èº«çš„æ„å»ºå°†å§‹ç»ˆä½¿ç”¨ go.mod æ–‡ä»¶ä¸­åˆ—å‡ºçš„ç‰¹å®šç‰ˆæœ¬çš„å¿…éœ€ä¾èµ–é¡¹. ä½œä¸ºæ›´å¤§æ„å»ºçš„ä¸€éƒ¨åˆ†, å¦‚æœæ„å»ºä¸­çš„å…¶ä»–åœ°æ–¹éœ€è¦å®ƒ, å®ƒå°†åªä½¿ç”¨æ›´æ–°çš„ç‰ˆæœ¬.</p><p>æœŸæœ›åŒ…ä½œè€…ä½¿ç”¨è¯­ä¹‰ç‰ˆæœ¬æ ‡è®°(tag)å‘å¸ƒ, vgo é¼“åŠ±ä½¿ç”¨æ ‡è®°ç‰ˆæœ¬, è€Œä¸æ˜¯ä»»æ„æäº¤. rsc.io/quote æ¨¡å—æœåŠ¡äº github.com/rsc/quote, å·²ç»æ ‡è®°äº†ç‰ˆæœ¬, åŒ…æ‹¬ v1.5.2. ä½†æ˜¯ golang.org/x/text æ¨¡å—å°šæœªæä¾›æ ‡ç­¾ç‰ˆæœ¬. è¦å‘½åæœªæ ‡è®°çš„æäº¤, ä¼ªç‰ˆæœ¬ v0.0.0-yyyymmddhhmmss-commit æ ‡è¯†åœ¨ç»™å®šæ—¥æœŸè¿›è¡Œçš„ç‰¹å®šæäº¤. åœ¨è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶ä¸­, è¿™ä¸ªå­—ç¬¦ä¸²å¯¹åº”äºä¸€ä¸ª v0.0.0 é¢„å‘è¡Œç‰ˆ, é¢„å‘è¡Œç‰ˆæ ‡è¯†ç¬¦ä¸º yyyymmddhhmmss - commit. è¯­ä¹‰ç‰ˆæœ¬ä¼˜å…ˆè§„åˆ™åœ¨ v0.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬ä¹‹å‰æ’åºæ­¤ç±»é¢„å‘å¸ƒ, å¹¶ä¸”å®ƒä»¬é€šè¿‡å­—ç¬¦ä¸²æ¯”è¾ƒæ¥æ’åºé¢„å‘å¸ƒ. åœ¨ä¼ªç‰ˆæœ¬è¯­æ³•ä¸­æ”¾ç½®æ—¥æœŸåœ¨å‰å¯ç¡®ä¿å­—ç¬¦ä¸²æ¯”è¾ƒåŒ¹é…æ—¥æœŸæ¯”è¾ƒ.</p><p>é™¤äº† requirements ä¹‹å¤–, go.mod æ–‡ä»¶è¿˜å¯ä»¥æŒ‡å®šä¸Šä¸€èŠ‚ä¸­æåˆ°çš„æ’é™¤ (exclusions) å’Œæ›¿æ¢ (replacements), ä½†è¿™äº›ä»…åœ¨ç›´æ¥æ„å»ºæ¨¡å—æ—¶æ‰åº”ç”¨, è€Œä¸æ˜¯åœ¨ä½œä¸ºè¾ƒå¤§ç¨‹åºçš„ä¸€éƒ¨åˆ†æ„å»ºæ¨¡å—æ—¶åº”ç”¨. è¿™äº›<a href="https://research.swtch.com/vgo-tour" target="_blank" rel="noopener">ä¾‹å­</a>æ¼”ç¤ºäº†æ‰€æœ‰è¿™äº›.</p><p>Goinstall å’Œæ—§çš„ go get ç›´æ¥è°ƒç”¨ç‰ˆæœ¬æ§åˆ¶å·¥å…·, å¦‚ git å’Œ hg ç›´æ¥ä¸‹è½½ä»£ç , å¯¼è‡´è®¸å¤šé—®é¢˜, å…¶ä¸­åŒ…æ‹¬ç¢ç‰‡åŒ–. ä¾‹å¦‚, ç”¨æˆ·æ²¡æœ‰ bzr æ— æ³•ä¸‹è½½å­˜å‚¨åœ¨ Bazaar ä»“åº“ä¸­çš„ä»£ç . ç›¸æ¯”ä¹‹ä¸‹, æ¨¡å—å§‹ç»ˆä¸‹è½½é€šè¿‡ HTTP æä¾›çš„ zip å½’æ¡£æ–‡ä»¶. ä¹‹å‰, go get æœ‰ç‰¹æ®Šå¤–å£³ä¸ºæµè¡Œä»£ç æ‰˜ç®¡ç«™ç‚¹é€‰æ‹©ç‰ˆæœ¬æ§åˆ¶å‘½ä»¤. ç°åœ¨, vgo æœ‰ç‰¹æ®Šå¤–å£³å¯ä»¥ä½¿ç”¨è¿™äº›æ‰˜ç®¡ç«™ç‚¹çš„ API æ¥è·å–æ¡£æ¡ˆ.</p><p>å°†æ¨¡å—ç»Ÿä¸€è¡¨ç¤ºä¸º zip å‹ç¼©æ–‡ä»¶å¯ä»¥å®ç°æ¨¡å—ä¸‹è½½ä»£ç†çš„ç®€å•åè®®å’Œå®ç°. å…¬å¸æˆ–ä¸ªäººå¯ä»¥å‡ºäºä»»ä½•åŸå› è¿è¡Œä»£ç†, åŒ…æ‹¬å®‰å…¨æ€§, å¹¶å¸Œæœ›èƒ½å¤Ÿåœ¨åˆ é™¤åŸå§‹æ–‡ä»¶çš„æƒ…å†µä¸‹ä»ç¼“å­˜å‰¯æœ¬è¿›è¡Œå·¥ä½œ. é€šè¿‡ä½¿ç”¨ä»£ç†æ¥ç¡®ä¿å¯ç”¨æ€§, åœ¨ go.mod ä¸­å®šä¹‰è¦ä½¿ç”¨çš„ä»£ç , vendor ç›®å½•ä¸å†éœ€è¦.</p><h3 id="go-å‘½ä»¤"><a href="#go-å‘½ä»¤" class="headerlink" title="go å‘½ä»¤"></a>go å‘½ä»¤</h3><p>go å‘½ä»¤å¿…é¡»æ›´æ–°ä»¥ä½¿ç”¨æ¨¡å—. ä¸€ä¸ªæ˜¾è‘—çš„å˜åŒ–æ˜¯, æ™®é€šçš„æ„å»ºå‘½ä»¤, å¦‚ go build, go install, go run å’Œ go test, å°†æŒ‰éœ€è§£å†³æ–°ä¾èµ–, åªéœ€è¦ä½¿ç”¨ golang.org/x/text å…¨æ–°çš„æ¨¡å—å¢åŠ å¯¼å…¥åˆ° Go æºä»£ç å¹¶ä¸”æ„å»ºä»£ç .</p><p>ä½†æ˜¯, æœ€é‡è¦çš„å˜åŒ–æ˜¯ GOPATH ä½œä¸º Go ä»£ç å·¥ä½œçš„å¿…éœ€ä½ç½®çš„ç»“æŸ. å› ä¸ºè¯¥ go.mod æ–‡ä»¶åŒ…å«å®Œæ•´çš„æ¨¡å—è·¯å¾„, å¹¶ä¸”è¿˜å®šä¹‰äº†æ­£åœ¨ä½¿ç”¨çš„æ¯ä¸ªä¾èµ–é¡¹çš„ç‰ˆæœ¬, æ‰€ä»¥å¸¦æœ‰ go.mod æ–‡ä»¶çš„ç›®å½•ä¼šå°†ç›®å½•æ ‘çš„æ ¹æ ‡è®°ä¸ºç‹¬ç«‹çš„å·¥ä½œç©ºé—´, ä¸å…¶ä»–ä»»ä½•æ­¤ç±»ç›®å½•åˆ†å¼€. ç°åœ¨ä½ åªæ˜¯ git clone, cd, å¼€å§‹å†™. æ— å¤„ä¸å¯. ä¸éœ€è¦ GOPATH.</p><h2 id="æ¥ä¸‹æ¥"><a href="#æ¥ä¸‹æ¥" class="headerlink" title="æ¥ä¸‹æ¥"></a>æ¥ä¸‹æ¥</h2><p>æˆ‘è¿˜å‘å¸ƒäº† â€œ<a href="https://research.swtch.com/vgo" target="_blank" rel="noopener">A Tour of Versioned Go</a>â€œ æ¥å±•ç¤º vgo çš„ä½¿ç”¨æ–¹å¼. çœ‹è¿™ç¯‡æ–‡ç« , äº†è§£å¦‚ä½•ä¸‹è½½å’Œå®éªŒ vgo. æˆ‘ä¼šåœ¨æ•´ä¸ªä¸€å‘¨å‘å¸ƒæ›´å¤šä¿¡æ¯, ä»¥æ·»åŠ æˆ‘åœ¨æœ¬æ–‡ä¸­è·³è¿‡çš„è¯¦ç»†ä¿¡æ¯. æˆ‘é¼“åŠ±å¯¹è¿™ä¸ªå¸–å­å’Œå…¶ä»–äººçš„è¯„è®ºå‘è¡¨æ„è§, æˆ‘ä¹Ÿä¼šè¯•ç€å»çœ‹çœ‹ Go subreddit å’Œ golang-nuts é‚®ä»¶åˆ—è¡¨. å‘¨äº”, æˆ‘å°†å‘å¸ƒ FAQ ä½œä¸ºç³»åˆ—æ–‡ç« çš„æœ€åä¸€ç¯‡åšæ–‡(è‡³å°‘ç°åœ¨). ä¸‹å‘¨æˆ‘ä¼šæäº¤ä¸€ä»½æ­£å¼çš„ Go ææ¡ˆ.</p><p>è¯·å°è¯• <a href="https://research.swtch.com/vgo-tour" target="_blank" rel="noopener">vgo</a>. åœ¨å­˜å‚¨åº“ä¸­å¼€å§‹æ ‡è®°ç‰ˆæœ¬. åˆ›å»ºå¹¶ç­¾å…¥ go.mod æ–‡ä»¶. è¯·æ³¨æ„, å¦‚æœè¿è¡Œçš„æ˜¯ä¸€ä¸ªåŒ…å«ç©ºçš„ go.mod çš„ä»“åº“, ä½†æ˜¯, å®ƒæœ‰ä¸€ä¸ªç°æˆçš„ dep, glide, glock, godep, godeps, govend, govendor æˆ– gvt é…ç½®æ–‡ä»¶, vgo å°†ç”¨å®ƒæ¥å¡«å…… go.mod æ–‡ä»¶.</p><p>æˆ‘ä¸º Go æ·»åŠ ç‰ˆæœ¬åˆ°å®ƒçš„å·¥ä½œè¯æ±‡ä¸­è¿™ä¸€å§—å§—æ¥è¿Ÿçš„ä¸€æ­¥æ„Ÿåˆ°å…´å¥‹. å¼€å‘è€…åœ¨ä½¿ç”¨ Go æ—¶é‡åˆ°çš„ä¸€äº›æœ€å¸¸è§çš„é—®é¢˜æ˜¯ç¼ºä¹å¯é‡å¤çš„æ„å»º, go get å®Œå…¨å¿½ç•¥å‘å¸ƒæ ‡ç­¾, GOPATH æ— æ³•ç†è§£åŒ…çš„å¤šä¸ªç‰ˆæœ¬ä»¥åŠæƒ³è¦æˆ–éœ€è¦åœ¨ GOPATH ä¹‹å¤–çš„æºç›®å½•ä¸­å·¥ä½œ. è¿™é‡Œæå‡ºçš„è®¾è®¡æ¶ˆé™¤äº†æ‰€æœ‰è¿™äº›é—®é¢˜, ä»¥åŠæ›´å¤š.</p><p>å³ä¾¿å¦‚æ­¤, æˆ‘ç¡®å®šæœ‰äº›ç»†èŠ‚æ˜¯é”™è¯¯çš„. æˆ‘å¸Œæœ›æˆ‘ä»¬çš„ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡å°è¯•æ–°çš„ vgo åŸå‹å¹¶å‚ä¸å¯Œæœ‰æˆæ•ˆçš„è®¨è®ºæ¥å¸®åŠ©æˆ‘ä»¬å®ç°è¿™ä¸€è®¾è®¡. æˆ‘å¸Œæœ› Go 1.11 ä¸º Go æ¨¡å—æä¾›åˆæ­¥æ”¯æŒ, ä½œä¸ºä¸€ç§æŠ€æœ¯é¢„è§ˆ, ç„¶åæˆ‘å¸Œæœ› Go 1.12 èƒ½å¤Ÿæä¾›å®˜æ–¹æ”¯æŒ. åœ¨ç¨åçš„ä¸€äº›ç‰ˆæœ¬ä¸­, æˆ‘ä»¬å°†åˆ é™¤å¯¹æ—§çš„æ— ç‰ˆæœ¬çš„ go get æ”¯æŒ. ä¸è¿‡, è¿™æ˜¯ä¸€ä¸ªæ¿€è¿›çš„æ—¶é—´è¡¨, å¦‚æœè·å¾—æ­£ç¡®çš„åŠŸèƒ½æ„å‘³ç€ç­‰å¾…ä»¥åçš„å‘å¸ƒ, æˆ‘ä»¬ä¼š.</p><p>æˆ‘éå¸¸å…³å¿ƒä»æ—§çš„ go get å’Œæ— æ•°çš„ vendoring å·¥å…·åˆ°æ–°çš„æ¨¡å—ç³»ç»Ÿçš„è¿‡æ¸¡. å¯¹äºæˆ‘æ¥è¯´, è¿™ä¸ªè¿‡ç¨‹å°±å’Œè·å¾—æ­£ç¡®çš„åŠŸèƒ½åŒæ ·é‡è¦. å¦‚æœæˆåŠŸçš„è½¬æ¢æ„å‘³ç€ç­‰å¾…ä»¥åçš„å‘å¸ƒ, æˆ‘ä»¬ä¼š.</p><p>æ„Ÿè°¢ Peter Bourgon, Jess Frazelle, Andrew Gerrand å’Œ Ed Mueller ä»¥åŠ Sam Boyer åœ¨åŒ…ç®¡ç†å§”å‘˜ä¼šçš„å·¥ä½œä»¥åŠå»å¹´çš„è®¸å¤šæœ‰ç›Šè®¨è®º. è¿˜è¦æ„Ÿè°¢ Dave Cheney, Gustavo Niemeyer, Keith Rarick å’Œ Daniel Theophanes å¯¹ Go å’ŒåŒ…ç‰ˆæœ¬çš„å…³é”®è´¡çŒ®. å†æ¬¡æ„Ÿè°¢ Sam Boyer åˆ›é€  dep, å¹¶æ„Ÿè°¢ä»–å’Œ dep çš„æ‰€æœ‰è´¡çŒ®è€…. æ„Ÿè°¢æ‰€æœ‰æ›¾ç»åœ¨è®¸å¤šæ—©æœŸçš„ vendoring å·¥å…·ä¸Šåˆ›å»ºæˆ–å·¥ä½œè¿‡çš„äºº. æœ€å, æ„Ÿè°¢æ‰€æœ‰èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ¨è¿›æ­¤ææ¡ˆçš„äºº, æ‰¾åˆ°å¹¶è§£å†³é—®é¢˜, å¹¶å°½å¯èƒ½é¡ºåˆ©åœ°å°†è½¯ä»¶åŒ…ç‰ˆæœ¬æ§åˆ¶æ·»åŠ åˆ° Go.</p>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> go </tag>
            
            <tag> vgo </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å¼€å‘è€…å…³ç³»æƒåˆ©æ³•æ¡ˆ</title>
      <link href="/post/a-developer-relations-bill-of-rights.html"/>
      <url>/post/a-developer-relations-bill-of-rights.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ª <a href="https://medium.com/glitch/a-developer-relations-bill-of-rights-21381920e273" target="_blank" rel="noopener">A Developer Relations Bill of Rights</a> ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰.<br><a id="more"></a></p><p>å¼€å‘è€…å…³ç³»æ˜¯ä»»ä½•å¸Œæœ›å»ºç«‹æˆåŠŸçš„æŠ€æœ¯å¹³å°çš„å…¬å¸ä¸­æœ€å…·æˆ˜ç•¥æ„ä¹‰çš„è§’è‰²ä¹‹ä¸€. ç„¶è€Œ, å¤§å¤šæ•°å…¬å¸ç¼©çŸ­äº†ä»–ä»¬çš„ Dev Rel (è¯‘æ³¨: å¼€å‘è€…å…³ç³») å›¢é˜Ÿ, å¹¶å±åŠä»–ä»¬åœ¨è¿™é¡¹å…³é”®å·¥ä½œä¸­çš„æŠ•èµ„.</p><p><img src="/static/images/1_-GNpo5PEhPm-1Ns4F76t9w.png" width="1000" height="523"></p><p>åä¸ƒå¹´å‰, Joel Spolsky å†™äº† <a href="https://www.joelonsoftware.com/2000/08/09/the-joel-test-12-steps-to-better-code/" target="_blank" rel="noopener">Joel Test</a>, è¿™ä¸ªå¹¿æ³›çš„æ¡†æ¶ä¸»å¼ èµ‹äºˆå¼€å‘è€…æƒåŠ›å¹¶æŠ•èµ„äºä»–ä»¬çš„å·¥ä½œ. å³ä½¿è¿™äº›æƒ³æ³•å·²ç»æ¼”å˜æˆ–è€…å…·ä½“è§„åˆ™å˜å¾—æœ‰ç‚¹è¿‡æ—¶, åŸºæœ¬åŸåˆ™å·²ç»ç›¸å½“æˆç†Ÿ, å¹¶ä¸”å¸®åŠ©ç§‘æŠ€è¡Œä¸šæé«˜äº†ç”Ÿäº§åŠ›. Joel Test æ˜¯ä»£è¡¨åˆ¶é€ è½¯ä»¶çš„äººæ‰€æå€¡çš„æœ€æœ‰æ•ˆçš„åŠªåŠ›ä¹‹ä¸€.</p><p>æœ¬ç€åŒæ ·çš„ç²¾ç¥, æˆ‘ä»¬æå‡ºäº†å¦ä¸€ä¸ªå¼€å§‹ç‚¹æ¥è®¨è®ºå¦‚ä½•æ”¯æŒä¸€ä¸ªè¾ƒæ–°çš„, è¾ƒå°‘æ‰¿è®¤çš„, ä½†åŒæ ·é‡è¦çš„ç¤¾åŒº: å¼€å‘è€…å…³ç³». æ— è®ºå®ƒè¢«ç§°ä¸ºå¼€å‘è€…ç¦éŸ³ä¸»ä¹‰, å¼€å‘è€…ä½“éªŒ, Dev Rel, è¿˜æ˜¯å…¶ä»–ä»»ä½•åå­—, è¯¥é¢†åŸŸéƒ½åŒ…å«ä¸€ç³»åˆ—ç›¸å…³çš„æˆ˜ç•¥æ€§å…³é”®è§’è‰². ç¤¾åŒºåŒ…æ‹¬å…·æœ‰å®é™…å¼€å‘è€…å…³ç³»å¤´è¡”çš„äººå‘˜, ä»¥åŠå¼€å‘è€…ä¸»å¼ è€…, å¹³å°æˆ–äº§å“å¸ƒé“è€…æˆ–å¼€å‘è€…æ”¯æŒç­‰å¤´è¡”.</p><blockquote><p>æ— è®ºæˆ‘ä»¬å¦‚ä½•æè¿°è‡ªå·±, Dev Rel çš„å·¥ä½œå¯¹äºä»»ä½•ä¸ºå…¶ç”Ÿæ€ç³»ç»Ÿæä¾›æŠ€æœ¯å¹³å°çš„å…¬å¸éƒ½æ˜¯è‡³å…³é‡è¦çš„.</p></blockquote><p>ç„¶è€Œ, å°½ç®¡ Dev Rel å¦‚æ­¤é‡è¦, æ­£å¦‚æˆ‘ä»¬åœ¨ <a href="https://medium.com/glitch/its-time-to-get-serious-about-developer-relations-af238c002b31" target="_blank" rel="noopener">æ˜¯æ—¶å€™è®¤çœŸå¯¹å¾…å¼€å‘è€…å…³ç³»</a> ä¸­æ‰€è¯´çš„é‚£æ ·, <strong>ä½†å¤§å¤šæ•°å…¬å¸ä»æ ¹æœ¬ä¸Šæ²¡æœ‰å‘ Dev Rel å±•ç¤ºå®ƒåº”æœ‰çš„å°Šé‡</strong>. æˆ‘ä»¬å·²ç»çœ‹åˆ°æ¥è‡ªç¤¾åŒºäººå£«çš„æœ‰ä»·å€¼çš„åŠªåŠ›, å¦‚ Ashley McNamara å¼€å§‹ç¼–çº‚åº”æ”¯æŒæœ‰æ•ˆçš„å¼€å‘è€…å…³ç³»çš„<a href="https://hackernoon.com/the-best-career-advice-ive-received-so-far-is-never-turn-down-an-interview-7586ca5b7ef8" target="_blank" rel="noopener">åŸåˆ™</a>. å½“ç„¶, å°±æˆ‘ä»¬è‡ªå·±è€Œè¨€, æˆ‘ä»¬å·²ç»å»ºç«‹äº†åƒ Glitch è¿™æ ·çš„ç¤¾åŒº, å…¶å…·ä½“ç›®æ ‡æ˜¯æˆä¸º <a href="https://glitch.com/forplatforms" target="_blank" rel="noopener">Dev Rel çš„é‡è¦å·¥å…·</a>.</p><p>åœ¨è¿™é¡¹å·¥ä½œçš„åŸºç¡€ä¸Š, å¹¶å¸Œæœ›å¼€å§‹æ”¹å˜å¤§å¤šæ•°å…¬å¸ä¸æ”¯æŒ Dev Rel çš„ç°å®, ä¸‹é¢æ˜¯ Dev Rel æƒåˆ©æ³•æ¡ˆçš„ç¬¬ä¸€ç¨¿. æˆ‘ä»¬æ¸´æœ›å¬åˆ°æ‚¨å¯¹å…¶å˜æ›´å’Œæ”¹è¿›çš„å»ºè®®.</p><h3 id="Dev-Rel-æƒåˆ©æ³•æ¡ˆ"><a href="#Dev-Rel-æƒåˆ©æ³•æ¡ˆ" class="headerlink" title="Dev Rel æƒåˆ©æ³•æ¡ˆ"></a>Dev Rel æƒåˆ©æ³•æ¡ˆ</h3><p>ä¸ºå¼€å‘è€…å…³ç³»å·¥ä½œçš„æ¯ä¸ªäººéƒ½åº”è¯¥å¾—åˆ°éµå¾ªè¿™ 10 æ¡åŸåˆ™çš„ç¯å¢ƒçš„æ”¯æŒ:</p><ol><li><p><a href="https://medium.com/glitch/every-dev-rel-professional-deserves-a-clear-set-of-business-goals-f91e1a558046" target="_blank" rel="noopener">ä¸€å¥—æ˜ç¡®çš„å•†ä¸šç›®æ ‡</a></p></li><li><p><a href="https://medium.com/glitch/dev-rel-requires-a-well-defined-place-in-the-organization-288ee75b8b1e" target="_blank" rel="noopener">ç»„ç»‡ä¸­ä¸€ä¸ªæ˜ç¡®çš„åœ°æ–¹</a></p></li><li><p><a href="https://medium.com/glitch/a-structured-way-to-impact-product-or-platform-f5a7c5648ac4" target="_blank" rel="noopener">å½±å“äº§å“æˆ–å¹³å°çš„ç»“æ„åŒ–æ–¹å¼</a></p></li><li><p><a href="https://medium.com/glitch/dev-rel-needs-open-lines-of-communication-to-marketing-960faf2c0023" target="_blank" rel="noopener">å‘å¸‚åœºå¼€æ”¾æ²Ÿé€šæ¸ é“</a></p></li><li><p><a href="https://medium.com/glitch/dev-rel-needs-the-right-tools-specifically-designed-for-the-job-af858d770b8a" target="_blank" rel="noopener">ä¸“ä¸ºè¿™é¡¹å·¥ä½œè®¾è®¡çš„æ­£ç¡®å·¥å…·</a></p></li><li><p><a href="https://medium.com/glitch/dev-rel-requires-explicit-ethical-and-social-guidelines-9c67b3d2356c" target="_blank" rel="noopener">æ˜ç¡®çš„é“å¾·å’Œç¤¾ä¼šå‡†åˆ™</a></p></li><li><p><a href="https://medium.com/glitch/dev-rel-deserves-support-for-building-inclusive-communities-5a7779543cd" target="_blank" rel="noopener">æ”¯æŒå»ºè®¾åŒ…å®¹æ€§ç¤¾åŒº</a></p></li><li><p><a href="https://medium.com/glitch/dev-rel-must-be-provided-with-a-clear-distinction-from-sales-engineering-3ba17a4cda4f" target="_blank" rel="noopener"><strong>ä¸é”€å”®å·¥ç¨‹çš„æ˜æ˜¾åŒºåˆ«</strong></a></p></li><li><p><a href="https://medium.com/glitch/dev-rel-must-be-supported-with-ongoing-investment-in-professional-development-19ba90326b7a" target="_blank" rel="noopener">æŒç»­çš„ä¸“ä¸šå‘å±•èµ„æº</a></p></li><li><p><a href="https://medium.com/glitch/dev-rel-success-requires-an-ongoing-connection-to-a-community-of-peers-ed660b40b62" target="_blank" rel="noopener">è¿æ¥åˆ°åŒè¡Œç¤¾åŒº</a></p></li></ol><p>æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨è¿™äº›å…³é”®æ¦‚å¿µçš„æ„¿æ™¯, è¿™äº›æ¦‚å¿µä½¿ Dev Rel è·å¾—æˆåŠŸ, <strong>ä½†æˆ‘ä»¬å¸Œæœ›å¬åˆ°ç¤¾åŒºä¸­å…³å¿ƒå¼€å‘è€…å…³ç³»çš„æœªæ¥çš„æ¯ä¸ªäººçš„æ„è§</strong>. æˆ‘ä»¬ç¡®ä¿¡ Dev Rel ä¸­çš„æ¯ä¸ªäººéƒ½å¯ä»¥æƒ³åˆ°æˆ‘ä»¬é”™è¿‡çš„ä¸€ä¸ªåŒºåŸŸ, æˆ–è€…æ‚¨åœ¨èŒä¸šç”Ÿæ¶¯ä¸­é‡åˆ°çš„ä¸€ä¸ªç‰¹åˆ«çš„ç—›ç‚¹.</p><p>æˆ‘ä»¬ç›¸ä¿¡, æˆ‘ä»¬æœ‰ä¿¡å¿ƒèƒ½å¤Ÿäº‰å–ä¸º Dev Rel è·å¾—æŠ•èµ„, èµ„æº, æ”¯æŒå’Œæˆ˜ç•¥é‡ç‚¹, ä»è€Œæ¨åŠ¨è¡Œä¸šå‘å‰å‘å±•.</p>]]></content>
      
      
        <tags>
            
            <tag> software development </tag>
            
            <tag> translation </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Go JSON æŠ€å·§</title>
      <link href="/post/json-tips-in-go.html"/>
      <url>/post/json-tips-in-go.html</url>
      <content type="html"><![CDATA[<p>ç›¸å¯¹äºå¾ˆå¤šçš„è¯­è¨€æ¥è¯´, Go çš„ JSON è§£æå¯è°“ç®€å•è‡³æ.<br><a id="more"></a></p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>é€šå¸¸æƒ…å†µä¸‹, æˆ‘ä»¬åœ¨ Go ä¸­ç»å¸¸è¿™æ ·è¿›è¡Œ JSON çš„è§£ç :</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"encoding/json"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// jsonText comes from http://json.org/example.html</span></span><br><span class="line"><span class="keyword">var</span> jsonText = []<span class="keyword">byte</span>(<span class="string">`</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">   "glossary":&#123;</span></span><br><span class="line"><span class="string">      "title":"example glossary",</span></span><br><span class="line"><span class="string">      "GlossDiv":&#123;</span></span><br><span class="line"><span class="string">         "title":"S",</span></span><br><span class="line"><span class="string">         "GlossList":&#123;</span></span><br><span class="line"><span class="string">            "GlossEntry":&#123;</span></span><br><span class="line"><span class="string">               "ID":"SGML",</span></span><br><span class="line"><span class="string">               "SortAs":"SGML",</span></span><br><span class="line"><span class="string">               "GlossTerm":"Standard Generalized Markup Language",</span></span><br><span class="line"><span class="string">               "Acronym":"SGML",</span></span><br><span class="line"><span class="string">               "Abbrev":"ISO 8879:1986",</span></span><br><span class="line"><span class="string">               "GlossDef":&#123;</span></span><br><span class="line"><span class="string">                  "para":"A meta-markup language, used to create markup languages such as DocBook.",</span></span><br><span class="line"><span class="string">                  "GlossSeeAlso":[</span></span><br><span class="line"><span class="string">                     "GML",</span></span><br><span class="line"><span class="string">                     "XML"</span></span><br><span class="line"><span class="string">                  ]</span></span><br><span class="line"><span class="string">               &#125;,</span></span><br><span class="line"><span class="string">               "GlossSee":"markup"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">         &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string">&#125;`</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> glossary <span class="keyword">struct</span> &#123;</span><br><span class="line">Glossary <span class="keyword">struct</span> &#123;</span><br><span class="line">Title    <span class="keyword">string</span> <span class="string">`json:"title"`</span></span><br><span class="line">GlossDiv <span class="keyword">struct</span> &#123;</span><br><span class="line">Title     <span class="keyword">string</span> <span class="string">`json:"title"`</span></span><br><span class="line">GlossList <span class="keyword">struct</span> &#123;</span><br><span class="line">GlossEntry <span class="keyword">struct</span> &#123;</span><br><span class="line">ID        <span class="keyword">string</span> <span class="string">`json:"ID"`</span></span><br><span class="line">SortAs    <span class="keyword">string</span> <span class="string">`json:"SortAs"`</span></span><br><span class="line">GlossTerm <span class="keyword">string</span> <span class="string">`json:"GlossTerm"`</span></span><br><span class="line">Acronym   <span class="keyword">string</span> <span class="string">`json:"Acronym"`</span></span><br><span class="line">Abbrev    <span class="keyword">string</span> <span class="string">`json:"Abbrev"`</span></span><br><span class="line">GlossDef  <span class="keyword">struct</span> &#123;</span><br><span class="line">Para         <span class="keyword">string</span>   <span class="string">`json:"para"`</span></span><br><span class="line">GlossSeeAlso []<span class="keyword">string</span> <span class="string">`json:"GlossSeeAlso"`</span></span><br><span class="line">&#125; <span class="string">`json:"GlossDef"`</span></span><br><span class="line">GlossSee <span class="keyword">string</span> <span class="string">`json:"GlossSee"`</span></span><br><span class="line">&#125; <span class="string">`json:"GlossEntry"`</span></span><br><span class="line">&#125; <span class="string">`json:"GlossList"`</span></span><br><span class="line">&#125; <span class="string">`json:"GlossDiv"`</span></span><br><span class="line">&#125; <span class="string">`json:"glossary"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> g glossary</span><br><span class="line">json.Unmarshal(jsonText, &amp;g)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„è§£ç å¯¹äºæˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨å¥½åƒä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜, èµ·ç èƒ½ç”¨ ? å¯¹äºä¸€æ®µ JSON, æˆ‘ä»¬è§£ç çš„æ—¶å€™æœªå¿…éœ€è¦ç«‹å³è§£ç æ‰€æœ‰çš„éƒ¨åˆ†, ä»€ä¹ˆæ„æ€å‘¢ ?</p><p>æ‹¿ä¸Šé¢çš„ä¾‹å­ä»£ç æ¥è¯´, æˆ‘ä»¬è§£ç  jsonText , å¯èƒ½ä»…éœ€è¦é©¬ä¸Šä½¿ç”¨ Title å’Œ GlossDiv.Title . é‚£ä¹ˆå¯¹äºè¿™ç§æƒ…å†µæˆ‘ä»¬æ€ä¹ˆåšåˆé€‚å‘¢ ?</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"encoding/json"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// jsonText comes from http://json.org/example.html</span></span><br><span class="line"><span class="keyword">var</span> jsonText = []<span class="keyword">byte</span>(<span class="string">`</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">   ... // æ­¤å¤„çœç•¥, åŒä¸Š</span></span><br><span class="line"><span class="string">&#125;`</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> glossarySectional <span class="keyword">struct</span> &#123;</span><br><span class="line">Glossary <span class="keyword">struct</span> &#123;</span><br><span class="line">Title    <span class="keyword">string</span> <span class="string">`json:"title"`</span></span><br><span class="line">GlossDiv <span class="keyword">struct</span> &#123;</span><br><span class="line">Title     <span class="keyword">string</span>          <span class="string">`json:"title"`</span></span><br><span class="line">GlossList json.RawMessage <span class="string">`json:"GlossList"`</span> <span class="comment">// diff: delay JSON decoding</span></span><br><span class="line">&#125; <span class="string">`json:"GlossDiv"`</span></span><br><span class="line">&#125; <span class="string">`json:"glossary"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> g glossarySectional</span><br><span class="line">json.Unmarshal(jsonText, &amp;g)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡é”™, é­”æ³•å°±åœ¨ GlossList json.RawMessage . æˆ‘ä»¬çœ‹ç›¸å…³<a href="https://golang.org/pkg/encoding/json/#RawMessage" target="_blank" rel="noopener">æ–‡æ¡£</a>æ€ä¹ˆè¯´:</p><blockquote><p>RawMessage is a raw encoded JSON value. It implements Marshaler and Unmarshaler and can be used to delay JSON decoding or precompute a JSON encoding.</p></blockquote><p>ä¸€ç›®äº†ç„¶, RawMessage èµ·åˆ°äº†å»¶è¿Ÿè§£ç ä¸€ä¸ª JSON å€¼çš„ä½œç”¨. é‚£ä¹ˆä½ å¯èƒ½ä¼šè¯´, è¿™æœ‰å•¥ç”¨å‘¢ ?</p><p>è¿™å¯¹äºæ™®é€šçš„è§£ç å¯èƒ½é—®é¢˜ä¸å¤§, ä½†æ˜¯å¯¹äºä¸€äº›åƒæ¶ˆæ¯ä¼ é€’(Kafka è¿™ç§), ç»†å¾®çš„å»¶è¿Ÿå¯èƒ½ä¼šé€ æˆå¾ˆå¤§çš„å½±å“. æˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€å•çš„ benchmark æµ‹è¯•ä¸€ä¸‹è¿™ç»†å¾®çš„å·®åˆ«:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å…¶ä»–ä»£ç ç•¥ ... å®Œæ•´ä»£ç å‚è§: http://bit.ly/2skxY9L .</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">benchmarkJSONUnmarshal</span><span class="params">(f <span class="keyword">func</span>()</span>, <span class="title">b</span> *<span class="title">testing</span>.<span class="title">B</span>)</span> &#123;</span><br><span class="line"><span class="keyword">for</span> n := <span class="number">0</span>; n &lt; b.N; n++ &#123;</span><br><span class="line">f()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkJSONUnmarshal_0</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">benchmarkJSONUnmarshal(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> g glossary</span><br><span class="line">json.Unmarshal(jsonText, &amp;g)</span><br><span class="line">&#125;, b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkJSONUnmarshal_1</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">benchmarkJSONUnmarshal(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> g glossarySectional</span><br><span class="line">json.Unmarshal(jsonText, &amp;g)</span><br><span class="line">&#125;, b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡è¿è¡Œ go test -run=NONE -bench=. ./â€¦ å¯ä»¥å¾—å‡º(ä¸åŒç¯å¢ƒæœ‰ç•¥å¾®å·®åˆ«):</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">BenchmarkJSONUnmarshal_0-8     200000     10565 ns/op</span><br><span class="line">BenchmarkJSONUnmarshal_1-8     200000      7699 ns/op</span><br></pre></td></tr></table></figure><p>å·®åˆ«å¹…åº¦:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">benchmark                    old ns/op     new ns/op     delta</span><br><span class="line">BenchmarkJSONUnmarshal-8     10298         7591          -26.29%</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å¾—å‡ºè¿™ä¸ªå·®åˆ«è¿˜æ˜¯å¾ˆå¤§çš„, ç‰¹åˆ«æ˜¯å½“ JSON æœ¬èº«ä½“é‡å¾ˆå¤§çš„æ—¶å€™.</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>å¯¹äºä¸€äº›å…³ä¹æ€§èƒ½çš„ JSON è§£æçš„å¤„ç†, æˆ‘ä»¬å¯ä»¥é€šè¿‡ json.RawMessage è¿›è¡Œæ€§èƒ½çš„æå‡.</p>]]></content>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Go å‡½æ•°é€‰é¡¹æ¨¡å¼</title>
      <link href="/post/functional-options-pattern-in-go.html"/>
      <url>/post/functional-options-pattern-in-go.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ª <a href="https://halls-of-valhalla.org/beta/articles/functional-options-pattern-in-go,54/" target="_blank" rel="noopener">Functional Options Pattern in Go</a> ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰.<br><a id="more"></a></p><p>Golang å¼€å‘è€…é‡åˆ°çš„è®¸å¤šé—®é¢˜ä¹‹ä¸€æ˜¯å°è¯•å°†ä¸€ä¸ªå‡½æ•°çš„å‚æ•°è®¾ç½®ä¸ºå¯é€‰. è¿™æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„ç”¨ä¾‹, æœ‰äº›å¯¹è±¡åº”è¯¥ä½¿ç”¨ä¸€äº›åŸºæœ¬çš„é»˜è®¤è®¾ç½®æ¥å¼€ç®±å³ç”¨, å¹¶ä¸”ä½ å¶å°”å¯èƒ½éœ€è¦æä¾›ä¸€äº›æ›´è¯¦ç»†çš„é…ç½®.</p><p>åœ¨å¾ˆå¤šè¯­è¨€ä¸­è¿™å¾ˆå®¹æ˜“; åœ¨ C æ—è¯­è¨€ä¸­, å¯ä»¥ä½¿ç”¨ä¸åŒæ•°é‡çš„å‚æ•°æä¾›ç›¸åŒå‡½æ•°çš„å¤šä¸ªç‰ˆæœ¬; åœ¨åƒ PHP è¿™æ ·çš„è¯­è¨€ä¸­, å¯ä»¥ç»™å‚æ•°ä¸€ä¸ªé»˜è®¤å€¼ï¼Œå¹¶åœ¨è°ƒç”¨æ–¹æ³•æ—¶å¿½ç•¥å®ƒä»¬. ä½†æ˜¯åœ¨ Golang ä¸­, è¿™ä¸¤ç§æ–¹å¼ä½ å“ªä¸ªä¹Ÿç”¨ä¸äº†. é‚£ä¹ˆä½ å¦‚ä½•åˆ›å»ºä¸€ä¸ªå‡½æ•°, ç”¨æˆ·å¯ä»¥æŒ‡å®šä¸€äº›é¢å¤–çš„é…ç½®?</p><p>æœ‰å¾ˆå¤šå¯èƒ½çš„æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹, ä½†æ˜¯å¤§å¤šæ•°éƒ½ä¸èƒ½æ»¡è¶³è¦æ±‚, æˆ–è€…éœ€è¦åœ¨æœåŠ¡ç«¯çš„ä»£ç ä¸­è¿›è¡Œé¢å¤–çš„æ£€æŸ¥å’ŒéªŒè¯, æˆ–è€…é€šè¿‡ä¼ é€’é¢å¤–çš„å®¢æˆ·ç«¯ä¸å…³å¿ƒçš„å‚æ•°æ¥ä¸ºå®¢æˆ·ç«¯åšé¢å¤–çš„å·¥ä½œ.</p><p>æˆ‘å°†ä»‹ç»ä¸€äº›ä¸åŒçš„æ–¹æ¡ˆ, å¹¶è¯´æ˜ä¸ºä»€ä¹ˆæ¯ä¸ªéƒ½ä¸æ˜¯æœ€ç†æƒ³çš„, ç„¶åæˆ‘ä»¬å°†å»ºç«‹æˆ‘ä»¬è‡ªå·±çš„æ–¹å¼æ¥ä½œä¸ºæœ€ç»ˆå¹²å‡€çš„è§£å†³æ–¹æ¡ˆ: å‡½æ•°å¼é€‰é¡¹æ¨¡å¼ (Functional Options Pattern).</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­. æ¯”æ–¹è¯´, æˆ‘ä»¬æœ‰ä¸€äº›åä¸º StuffClient çš„æœåŠ¡, å®ƒæœ‰ä¸€äº›ä¸œè¥¿, å¹¶æœ‰ä¸¤ä¸ªé…ç½®é€‰é¡¹(timeout å’Œ retries):</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> StuffClient <span class="keyword">interface</span> &#123;</span><br><span class="line">    DoStuff() error</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> stuffClient <span class="keyword">struct</span> &#123;</span><br><span class="line">    conn    Connection</span><br><span class="line">    timeout <span class="keyword">int</span></span><br><span class="line">    retries <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æ„ä½“ stuffClient æ˜¯ç§æœ‰çš„, æ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä¸ºå®ƒæä¾›ä¸€äº›æ„é€ å™¨:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStuffClient</span><span class="params">(conn Connection, timeout, retries <span class="keyword">int</span>)</span> <span class="title">StuffClient</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;stuffClient&#123;</span><br><span class="line">        conn:    conn,</span><br><span class="line">        timeout: timeout,</span><br><span class="line">        retries: retries,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å—¯, ä½†æ˜¯ç°åœ¨æˆ‘ä»¬æ¯æ¬¡è°ƒç”¨ NewStuffClient æ—¶éƒ½è¦æä¾› timeout å’Œ retries. è€Œå¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬åªæƒ³ä½¿ç”¨é»˜è®¤å€¼. æˆ‘ä»¬ä¸èƒ½ç”¨ä¸åŒçš„å‚æ•°æ•°é‡æ¥å®šä¹‰å¤šä¸ªç‰ˆæœ¬çš„ NewStuffClient, å¦åˆ™æˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªç±»ä¼¼ â€œNewStuffClient redeclared in this blocktâ€ çš„ç¼–è¯‘é”™è¯¯.</p><p>ä¸€ä¸ªæ–¹æ¡ˆæ˜¯åˆ›å»ºå¦ä¸€ä¸ªä¸åŒåç§°çš„æ„é€ å™¨:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStuffClient</span><span class="params">(conn Connection)</span> <span class="title">StuffClient</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;stuffClient&#123;</span><br><span class="line">        conn:    conn,</span><br><span class="line">        timeout: DEFAULT_TIMEOUT,</span><br><span class="line">        retries: DEFAULT_RETRIES,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStuffClientWithOptions</span><span class="params">(conn Connection, timeout, retries <span class="keyword">int</span>)</span> <span class="title">StuffClient</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;stuffClient&#123;</span><br><span class="line">        conn:    conn,</span><br><span class="line">        timeout: timeout,</span><br><span class="line">        retries: retries,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯, è¿™æœ‰ç‚¹è¹©è„š. æˆ‘ä»¬å¯ä»¥åšå¾—æ¯”è¿™æ›´å¥½. å¦‚æœæˆ‘ä»¬ä¼ å…¥äº†ä¸€ä¸ªé…ç½®å¯¹è±¡å‘¢:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> StuffClientOptions <span class="keyword">struct</span> &#123;</span><br><span class="line">    Retries <span class="keyword">int</span> <span class="comment">//number of times to retry the request before giving up</span></span><br><span class="line">    Timeout <span class="keyword">int</span> <span class="comment">//connection timeout in seconds</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStuffClient</span><span class="params">(conn Connection, options StuffClientOptions)</span> <span class="title">StuffClient</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;stuffClient&#123;</span><br><span class="line">        conn:    conn,</span><br><span class="line">        timeout: options.Timeout,</span><br><span class="line">        retries: options.Retries,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯, è¿™ä¹Ÿä¸æ˜¯å¾ˆå¥½. ç°åœ¨æˆ‘ä»¬æ€»æ˜¯éœ€è¦åˆ›å»º StuffClientOptions, å¹¶ä¸”å³ä½¿æˆ‘ä»¬ä¸æƒ³æŒ‡å®šä»»ä½•é€‰é¡¹ä¹Ÿè¦ä¼ é€’å®ƒ. è€Œä¸”æˆ‘ä»¬ä¹Ÿæ²¡æœ‰è‡ªåŠ¨å¡«å……é»˜è®¤å€¼, é™¤éæˆ‘ä»¬åœ¨ä»£ç ä¸­æ·»åŠ äº†ä¸€å †æ£€æŸ¥, æˆ–è€…æˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ª DefaultStuffClientOptions å˜é‡ (ä¹Ÿä¸å¥½, å› ä¸ºå®ƒå¯ä»¥åœ¨ä¸€ä¸ªåœ°æ–¹ä¿®æ”¹å¯¼è‡´å…¶ä»–åœ°æ–¹æœ‰é—®é¢˜).</p><p>é‚£ä¹ˆè§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ? è§£å†³è¿™ä¸ªéš¾é¢˜æœ€å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨å‡½æ•°å¼é€‰é¡¹æ¨¡å¼, åˆ©ç”¨ Go å¯¹é—­åŒ…çš„æ–¹ä¾¿æ”¯æŒ. è®©æˆ‘ä»¬ç»§ç»­æˆ‘ä»¬ä¸Šé¢å®šä¹‰çš„ StuffClientOptions, ä½†æ˜¯æˆ‘ä»¬ä¼šæ·»åŠ ä¸€äº›ä¸œè¥¿:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> StuffClientOption <span class="function"><span class="keyword">func</span><span class="params">(*StuffClientOptions)</span></span></span><br><span class="line"><span class="function"><span class="title">type</span> <span class="title">StuffClientOptions</span> <span class="title">struct</span></span> &#123;</span><br><span class="line">    Retries <span class="keyword">int</span> <span class="comment">//number of times to retry the request before giving up</span></span><br><span class="line">    Timeout <span class="keyword">int</span> <span class="comment">//connection timeout in seconds</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithRetries</span><span class="params">(r <span class="keyword">int</span>)</span> <span class="title">StuffClientOption</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(o *StuffClientOptions)</span></span> &#123;</span><br><span class="line">        o.Retries = r</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithTimeout</span><span class="params">(t <span class="keyword">int</span>)</span> <span class="title">StuffClientOption</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(o *StuffClientOptions)</span></span> &#123;</span><br><span class="line">        o.Timeout = t</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¥åœŸèˆ¬èŠ¬èŠ³, å¯¹å§? ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆ? åŸºæœ¬ä¸Šæˆ‘ä»¬æœ‰æˆ‘ä»¬çš„ç»“æ„å®šä¹‰æˆ‘ä»¬çš„ StuffClient çš„å¯ç”¨é€‰é¡¹. å¦å¤–ç°åœ¨æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º StuffClientOption çš„ä¸œä¸œ(è¿™æ¬¡æ˜¯å•æ•°), å®ƒåªæ˜¯ä¸€ä¸ªæ¥å—æˆ‘ä»¬çš„é€‰é¡¹ struct ä½œä¸ºå‚æ•°çš„å‡½æ•°. æˆ‘ä»¬å·²ç»å®šä¹‰äº†å¦å¤–ä¸€äº›å‡½æ•° WithRetries å’Œ WithTimeout, å®ƒä»¬è¿”å›ä¸€ä¸ªé—­åŒ…. ç°åœ¨é­”æ³•é™ä¸´:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> defaultStuffClientOptions = StuffClientOptions&#123;</span><br><span class="line">    Retries: <span class="number">3</span>,</span><br><span class="line">    Timeout: <span class="number">2</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStuffClient</span><span class="params">(conn Connection, opts ...StuffClientOption)</span> <span class="title">StuffClient</span></span> &#123;</span><br><span class="line">    options := defaultStuffClientOptions</span><br><span class="line">    <span class="keyword">for</span> _, o := <span class="keyword">range</span> opts &#123;</span><br><span class="line">        o(&amp;options)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &amp;stuffClient&#123;</span><br><span class="line">        conn:    conn,</span><br><span class="line">        timeout: options.Timeout,</span><br><span class="line">        retries: options.Retries,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å·²ç»å®šä¹‰äº†ä¸€ä¸ªé¢å¤–çš„æœªå¯¼å‡º(unexposed)å˜é‡, åŒ…å«æˆ‘ä»¬çš„é»˜è®¤é€‰é¡¹, æˆ‘ä»¬ç°åœ¨è°ƒæ•´äº†æˆ‘ä»¬çš„æ„é€ å‡½æ•°, è€Œä¸æ˜¯æ¥å—ä¸€ä¸ªå¯å˜å‚æ•°. ç„¶å, æˆ‘ä»¬éå† StuffClientOption (å•æ•°) åˆ—è¡¨, å¹¶å¯¹æ¯ä¸€é¡¹åº”ç”¨è¿”å›çš„é—­åŒ…åˆ°æˆ‘ä»¬çš„é€‰é¡¹å˜é‡.</p><p>ç°åœ¨æˆ‘ä»¬è¦åšçš„å°±æ˜¯è¿™æ ·:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">x := NewStuffClient(Connection&#123;&#125;)</span><br><span class="line">fmt.Println(x) <span class="comment">// prints &amp;&#123;&#123;&#125; 2 3&#125;</span></span><br><span class="line">x = NewStuffClient(</span><br><span class="line">    Connection&#123;&#125;,</span><br><span class="line">    WithRetries(<span class="number">1</span>),</span><br><span class="line">)</span><br><span class="line">fmt.Println(x) <span class="comment">// prints &amp;&#123;&#123;&#125; 2 1&#125;</span></span><br><span class="line">x = NewStuffClient(</span><br><span class="line">    Connection&#123;&#125;,</span><br><span class="line">    WithRetries(<span class="number">1</span>),</span><br><span class="line">    WithTimeout(<span class="number">1</span>),</span><br><span class="line">)</span><br><span class="line">fmt.Println(x) <span class="comment">// prints &amp;&#123;&#123;&#125; 1 1&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™çœ‹èµ·æ¥ç›¸å½“ä¸é”™è€Œä¸”å¯ç”¨. è€Œå…³äºå®ƒçš„å¥½çš„éƒ¨åˆ†æ˜¯, æˆ‘ä»¬å¯ä»¥éšæ—¶æ·»åŠ æ–°çš„é€‰é¡¹, åªéœ€è¦å¯¹ä»£ç è¿›è¡Œéå¸¸å°‘é‡çš„æ›´æ”¹. æŠŠè¿™äº›éƒ½ç»„åˆèµ·æ¥å°±æ˜¯è¿™æ ·:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> defaultStuffClientOptions = StuffClientOptions&#123;</span><br><span class="line">    Retries: <span class="number">3</span>,</span><br><span class="line">    Timeout: <span class="number">2</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> StuffClientOption <span class="function"><span class="keyword">func</span><span class="params">(*StuffClientOptions)</span></span></span><br><span class="line"><span class="function"><span class="title">type</span> <span class="title">StuffClientOptions</span> <span class="title">struct</span></span> &#123;</span><br><span class="line">    Retries <span class="keyword">int</span> <span class="comment">//number of times to retry the request before giving up</span></span><br><span class="line">    Timeout <span class="keyword">int</span> <span class="comment">//connection timeout in seconds</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithRetries</span><span class="params">(r <span class="keyword">int</span>)</span> <span class="title">StuffClientOption</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(o *StuffClientOptions)</span></span> &#123;</span><br><span class="line">        o.Retries = r</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithTimeout</span><span class="params">(t <span class="keyword">int</span>)</span> <span class="title">StuffClientOption</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(o *StuffClientOptions)</span></span> &#123;</span><br><span class="line">        o.Timeout = t</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> StuffClient <span class="keyword">interface</span> &#123;</span><br><span class="line">    DoStuff() error</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> stuffClient <span class="keyword">struct</span> &#123;</span><br><span class="line">    conn    Connection</span><br><span class="line">    timeout <span class="keyword">int</span></span><br><span class="line">    retries <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Connection <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStuffClient</span><span class="params">(conn Connection, opts ...StuffClientOption)</span> <span class="title">StuffClient</span></span> &#123;</span><br><span class="line">    options := defaultStuffClientOptions</span><br><span class="line">    <span class="keyword">for</span> _, o := <span class="keyword">range</span> opts &#123;</span><br><span class="line">        o(&amp;options)</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">return</span> &amp;stuffClient&#123;</span><br><span class="line">            conn:    conn,</span><br><span class="line">            timeout: options.Timeout,</span><br><span class="line">            retries: options.Retries,</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c stuffClient)</span> <span class="title">DoStuff</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ æƒ³è‡ªå·±å°è¯•ä¸€ä¸‹, å» <a href="https://play.golang.org/p/VcWqWcAEyz" target="_blank" rel="noopener">Go Playground</a> å§.</p><p>ä½†æ˜¯å¯ä»¥é€šè¿‡åˆ é™¤ StuffClientOptions ç»“æ„å¹¶ç›´æ¥å°†é€‰é¡¹åº”ç”¨åˆ°æˆ‘ä»¬çš„ StuffClient æ¥è¿›ä¸€æ­¥ç®€åŒ–.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> defaultStuffClient = stuffClient&#123;</span><br><span class="line">    retries: <span class="number">3</span>,</span><br><span class="line">    timeout: <span class="number">2</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> StuffClientOption <span class="function"><span class="keyword">func</span><span class="params">(*stuffClient)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">WithRetries</span><span class="params">(r <span class="keyword">int</span>)</span> <span class="title">StuffClientOption</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(o *stuffClient)</span></span> &#123;</span><br><span class="line">        o.retries = r</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithTimeout</span><span class="params">(t <span class="keyword">int</span>)</span> <span class="title">StuffClientOption</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(o *stuffClient)</span></span> &#123;</span><br><span class="line">        o.timeout = t</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> StuffClient <span class="keyword">interface</span> &#123;</span><br><span class="line">    DoStuff() error</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> stuffClient <span class="keyword">struct</span> &#123;</span><br><span class="line">    conn    Connection</span><br><span class="line">    timeout <span class="keyword">int</span></span><br><span class="line">    retries <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Connection <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStuffClient</span><span class="params">(conn Connection, opts ...StuffClientOption)</span> <span class="title">StuffClient</span></span> &#123;</span><br><span class="line">    client := defaultStuffClient</span><br><span class="line">    <span class="keyword">for</span> _, o := <span class="keyword">range</span> opts &#123;</span><br><span class="line">        o(&amp;client)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    client.conn = conn</span><br><span class="line">    <span class="keyword">return</span> client</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c stuffClient)</span> <span class="title">DoStuff</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥åœ¨<a href="https://play.golang.org/p/Z5P5Om4KDL" target="_blank" rel="noopener">è¿™é‡Œ</a>å°è¯•ä¸€ä¸‹. åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­, æˆ‘ä»¬åªæ˜¯ç›´æ¥å°†é…ç½®åº”ç”¨åˆ°æˆ‘ä»¬çš„ç»“æ„ä¸­, åœ¨ä¸­é—´æœ‰ä¸€ä¸ªé¢å¤–çš„é…ç½®ç»“æ„æ˜¯æ²¡æœ‰æ„ä¹‰çš„. ä½†æ˜¯è¯·æ³¨æ„, åœ¨è®¸å¤šæƒ…å†µä¸‹, æ‚¨å¯èƒ½ä»ç„¶æƒ³ä½¿ç”¨å‰é¢ç¤ºä¾‹ä¸­çš„ config ç»“æ„ä½“; ä¾‹å¦‚, å¦‚æœä½ çš„æ„é€ å™¨ä½¿ç”¨é…ç½®é€‰é¡¹æ¥æ‰§è¡Œä¸€äº›æ“ä½œ, ä½†ä¸æŠŠå®ƒä»¬å­˜å‚¨åˆ°ç»“æ„ä¸­, æˆ–è€…ä¼ é€’åˆ°å…¶ä»–åœ°æ–¹. é…ç½®ç»“æ„å˜ä½“æ˜¯æ›´é€šç”¨çš„å®ç°.</p><p>æ„Ÿè°¢ Rob Pike å’Œ Dave Cheney æ¨å¹¿è¿™ç§è®¾è®¡æ¨¡å¼.</p>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Go work-stealing è°ƒåº¦å™¨</title>
      <link href="/post/gos-work-stealing-scheduler.html"/>
      <url>/post/gos-work-stealing-scheduler.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ª Rakyll çš„ <a href="https://rakyll.org/scheduler/" target="_blank" rel="noopener">scheduler</a> ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰.<br><a id="more"></a></p><p>Go è°ƒåº¦å™¨çš„å·¥ä½œæ˜¯å°†å¯è¿è¡Œçš„ goroutine åˆ†å‘åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªå¤„ç†å™¨ä¸Šè¿è¡Œçš„å¤šä¸ªæ“ä½œç³»ç»Ÿå·¥ä½œçº¿ç¨‹. åœ¨å¤šçº¿ç¨‹è®¡ç®—é‡Œ, è°ƒåº¦å‡ºç°äº†ä¸¤ç§æ¨¡å¼: work-sharing (å·¥ä½œå…±äº«) å’Œ work-stealing (å·¥ä½œçªƒå–).</p><ul><li><strong>work-sharing</strong> å½“ä¸€ä¸ªå¤„ç†å™¨äº§ç”Ÿæ–°çš„çº¿ç¨‹æ—¶, å®ƒè¯•å›¾å°†å…¶ä¸­çš„ä¸€äº›è¿ç§»åˆ°å…¶ä»–å¤„ç†å™¨ä¸Š, å¸Œæœ›å®ƒä»¬èƒ½è¢«ç©ºé—²æˆ–æœªå……åˆ†åˆ©ç”¨çš„å¤„ç†å™¨æ‰€åˆ©ç”¨.</li><li><strong>work-stealing</strong> æœªå……åˆ†åˆ©ç”¨çš„å¤„ç†å™¨ä¼šä¸»åŠ¨å»å¯»æ‰¾å…¶ä»–å¤„ç†å™¨çš„çº¿ç¨‹å¹¶çªƒå–ä¸€äº›.</li></ul><p>work-stealing ä¸­çº¿ç¨‹è¿ç§»çš„é¢‘ç‡å°‘äº work-sharing. å½“æ‰€æœ‰å¤„ç†å™¨éƒ½æœ‰å·¥ä½œè¦è¿è¡Œæ—¶, æ²¡æœ‰çº¿ç¨‹ä¼šè¢«è¿ç§». è€Œä¸€æ—¦æœ‰ç©ºé—²çš„å¤„ç†å™¨, å°±ä¼šè€ƒè™‘è¿ç§».</p><p>Go ä» 1.1 å¼€å§‹å°±æœ‰ä¸€ä¸ª work-stealing çš„è°ƒåº¦å™¨, ç”± <a href="https://github.com/dvyukov" target="_blank" rel="noopener">Dmitry Vyukov</a> è´¡çŒ®. æœ¬æ–‡å°†æ·±å…¥è§£é‡Šä»€ä¹ˆæ˜¯ work-stealing è°ƒåº¦å™¨, ä»¥åŠ Go å¦‚ä½•å®ç°å®ƒ.</p><h2 id="è°ƒåº¦åŸºç¡€"><a href="#è°ƒåº¦åŸºç¡€" class="headerlink" title="è°ƒåº¦åŸºç¡€"></a>è°ƒåº¦åŸºç¡€</h2><p>Go æœ‰ä¸€ä¸ªå¯ä»¥åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨çš„ M:N è°ƒåº¦å™¨. ä»»ä½•æ—¶å€™, M ä¸ª goroutine éƒ½éœ€è¦åœ¨ N ä¸ª OS çº¿ç¨‹ä¸Šè¿›è¡Œè°ƒåº¦, è¿™äº›çº¿ç¨‹è¿è¡Œåœ¨æœ€å¤š GOMAXPROCS æ•°é‡çš„å¤„ç†å™¨ä¸Š. Go è°ƒåº¦å™¨ä½¿ç”¨ä»¥ä¸‹æœ¯è¯­è§£é‡Š goroutine, çº¿ç¨‹ä»¥åŠå¤„ç†å™¨:</p><ul><li>G: goroutine</li><li>M: OS çº¿ç¨‹ (æœºå™¨)</li><li>P: å¤„ç†å™¨ (è¯‘è€…: æ­¤å¤„ä¸æ˜¯æŒ‡ CPU, å¯ä»¥è®¤ä¸ºæ˜¯ Go è°ƒåº¦ä¸Šä¸‹æ–‡æˆ–è°ƒåº¦å¤„ç†å™¨, æ‰€ä»¥ä¸‹æ–‡çš„å¤„ç†å™¨å¦‚æ— ç‰¹åˆ«è¯´æ˜éƒ½æ˜¯æŒ‡ P)</li></ul><p>æœ‰ä¸€ä¸ª P ç›¸å…³çš„æœ¬åœ°å’Œå…¨å±€ goroutine é˜Ÿåˆ—. æ¯ä¸ª M åº”è¯¥è¢«åˆ†é…ç»™ä¸€ä¸ª P. å¦‚æœè¢«é˜»å¡æˆ–è€…åœ¨ç³»ç»Ÿè°ƒç”¨ä¸­, P (ä»¬) å¯èƒ½æ²¡æœ‰ M (ä»¬). ä»»ä½•æ—¶å€™ï¼Œæœ€å¤šåªæœ‰ GOMAXPROCS æ•°é‡çš„ P. ä»»ä½•æ—¶å€™, æ¯ä¸ª P åªèƒ½æœ‰ä¸€ä¸ª M è¿è¡Œ. å¦‚æœéœ€è¦, æ›´å¤šçš„ M (ä»¬) å¯ä»¥ç”±è°ƒåº¦å™¨åˆ›å»º.</p><p><img src="/static/images/scheduler-concepts.png" width="782" height="358"></p><p>æ¯è½®è°ƒåº¦åªæ˜¯ç®€å•æ‰¾åˆ°ä¸€ä¸ªå¯è¿è¡Œçš„ goroutine å¹¶æ‰§è¡Œå®ƒ. åœ¨æ¯è½®è°ƒåº¦ä¸­, æœç´¢æŒ‰ä»¥ä¸‹é¡ºåºè¿›è¡Œ:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">runtime.schedule() &#123;</span><br><span class="line">    <span class="comment">// only 1/61 of the time, check the global runnable queue for a G. ä»… 1/61 çš„æ—¶é—´, æ£€æŸ¥å…¨å±€è¿è¡Œé˜Ÿåˆ—é‡Œé¢çš„ G.</span></span><br><span class="line">    <span class="comment">// if not found, check the local queue. å¦‚æœæ²¡æ‰¾åˆ°, æ£€æŸ¥æœ¬åœ°é˜Ÿåˆ—.</span></span><br><span class="line">    <span class="comment">// if not found, è¿˜æ˜¯æ²¡æ‰¾åˆ° ?</span></span><br><span class="line">    <span class="comment">//     try to steal from other Ps. å°è¯•ä»å…¶ä»– P å·.</span></span><br><span class="line">    <span class="comment">//     if not, check the global runnable queue. è¿˜æ˜¯æ²¡æœ‰, æ£€æŸ¥å…¨å±€è¿è¡Œé˜Ÿåˆ—.</span></span><br><span class="line">    <span class="comment">//     if not found, poll network. è¿˜æ˜¯æ²¡æœ‰, è½®è¯¢ç½‘ç»œ.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€æ—¦æ‰¾åˆ°å¯è¿è¡Œçš„ G, å®ƒä¼šä¸€ç›´æ‰§è¡Œç›´åˆ°è¢«é˜»å¡.</p><p><strong>æ³¨æ„</strong> çœ‹èµ·æ¥å¥½åƒå…¨å±€é˜Ÿåˆ—æ¯”æœ¬åœ°é˜Ÿåˆ—æœ‰ä¼˜åŠ¿, ä½†æ˜¯å¶å°”æ£€æŸ¥å…¨å±€é˜Ÿåˆ—æ˜¯è‡³å…³é‡è¦çš„, ä»¥é¿å… M åªæ˜¯ä»æœ¬åœ°é˜Ÿåˆ—è°ƒåº¦, ç›´åˆ°æ²¡æœ‰æœ¬åœ°æ’é˜Ÿçš„ goroutine ç•™ä¸‹.</p><h2 id="Stealing-çªƒå–"><a href="#Stealing-çªƒå–" class="headerlink" title="Stealing (çªƒå–)"></a>Stealing (çªƒå–)</h2><p>å½“ä¸€ä¸ªæ–°çš„ G è¢«åˆ›å»ºæˆ–è€…ä¸€ä¸ªç°æœ‰çš„ G å˜æˆå¯è¿è¡Œçš„æ—¶å€™, å®ƒè¢«å‹å…¥å½“å‰ P çš„å¯è¿è¡Œçš„ goroutine åˆ—è¡¨. å½“ P å®Œæˆ G æ—¶, å®ƒä¼šå°è¯•ä»è‡ªå·±çš„å¯è¿è¡Œ goroutine åˆ—è¡¨ä¸­å¼¹å‡ºä¸€ä¸ª G. å¦‚æœåˆ—è¡¨ç°åœ¨æ˜¯ç©ºçš„, P ä¼šéšæœºçš„é€‰æ‹©å…¶ä»–çš„ P, å¹¶å°è¯•ä»å…¶é˜Ÿåˆ—ä¸­å·å–ä¸€åŠå¯è¿è¡Œçš„ goroutine(s).</p><p><img src="/static/images/scheduler-stealing.png" width="782" height="409"></p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, P2 æ‰¾ä¸åˆ°ä»»ä½•å¯è¿è¡Œçš„ goroutine. å› æ­¤, å®ƒéšæœºé€‰æ‹©å¦ä¸€ä¸ª P1, å¹¶å°†å…¶ä¸‰ä¸ª goroutine(s) çªƒå–åˆ°è‡ªå·±çš„æœ¬åœ°é˜Ÿåˆ—ä¸­. P2 å°†èƒ½å¤Ÿè¿è¡Œè¿™äº› goroutine, å¹¶ä¸”è°ƒåº¦å™¨çš„å·¥ä½œä¼šåœ¨å¤šä¸ªå¤„ç†å™¨ä¹‹é—´æ›´åŠ å…¬å¹³åœ°åˆ†é….</p><h2 id="è‡ªæ—‹çº¿ç¨‹-Spinning-threads"><a href="#è‡ªæ—‹çº¿ç¨‹-Spinning-threads" class="headerlink" title="è‡ªæ—‹çº¿ç¨‹ (Spinning threads)"></a>è‡ªæ—‹çº¿ç¨‹ (Spinning threads)</h2><p>è°ƒåº¦å™¨æ€»æ˜¯å¸Œæœ›å°†å°½å¯èƒ½å¤šçš„å¯è¿è¡Œçš„ goroutine(s) åˆ†é…ç»™ M (ä»¬) æ¥åˆ©ç”¨å¤„ç†å™¨, ä½†æ˜¯åŒæ—¶æˆ‘ä»¬éœ€è¦åœç•™è¿‡å¤šçš„å·¥ä½œæ¥èŠ‚çœ CPU å’Œç”µåŠ›. ä¸æ­¤ç›¸çŸ›ç›¾çš„æ˜¯, è°ƒåº¦å™¨è¿˜éœ€è¦èƒ½å¤Ÿæ‰©å±•åˆ°é«˜ååé‡å’Œ CPU å¯†é›†å‹çš„ç¨‹åº. å¦‚æœæ€§èƒ½æ˜¯è‡³å…³é‡è¦çš„, é‚£ä¹ˆå¯¹é«˜ååé‡ç¨‹åºæ¥è¯´æŒç»­æŠ¢å æ—¢æ˜¯æ˜‚è´µåˆæ˜¯æœ‰é—®é¢˜çš„. æ“ä½œç³»ç»Ÿçº¿ç¨‹ä¸åº”è¯¥é¢‘ç¹åœ°åœ¨ goroutine(s) ä¹‹é—´åˆ‡æ¢, å› ä¸ºè¿™ä¼šå¢åŠ å»¶è¿Ÿ. é™¤æ­¤ä¹‹å¤–, åœ¨å‘ç”Ÿç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™, æ“ä½œç³»ç»Ÿçº¿ç¨‹éœ€è¦ä¸æ–­åœ°è¢«é˜»å¡å’Œè§£é™¤é˜»å¡. è¿™æ˜¯æ˜‚è´µçš„, å¹¶å¢åŠ äº†å¾ˆå¤šå¼€é”€.</p><p>ä¸ºäº†å°½é‡å‡å°‘åˆ‡æ¢, Go è°ƒåº¦å™¨å®ç°äº†è‡ªæ—‹çº¿ç¨‹. è‡ªæ—‹çº¿ç¨‹æ¶ˆè€—ä¸€ç‚¹é¢å¤–çš„ CPU, ä½†æ˜¯å®ƒä»¬æœ€å°åŒ–äº† OS çº¿ç¨‹çš„æŠ¢å . ä¸€ä¸ªçº¿ç¨‹æ˜¯è‡ªæ—‹çš„, å¦‚æœ:</p><ul><li>åˆ†é…äº† P çš„ M æ­£åœ¨å¯»æ‰¾ä¸€ä¸ªå¯æ‰§è¡Œ goroutine;</li><li>æ²¡æœ‰åˆ†é… P çš„ M æ­£åœ¨å¯»æ‰¾å¯ç”¨çš„ P;</li><li>è°ƒåº¦å™¨è¿˜ä¼šé‡Šæ”¾ä¸€ä¸ªé™„åŠ çš„çº¿ç¨‹, å½“å®ƒæ­£å‡†å¤‡ä¸€ä¸ª goroutine å¹¶ä¸”æ²¡æœ‰ç©ºé—²çš„ P ä¹Ÿæ²¡æœ‰å…¶ä»–è‡ªæ—‹çº¿ç¨‹çš„æ—¶å€™è®©å®ƒè‡ªæ—‹.</li></ul><p>ä»»ä½•æ—¶å€™æœ€å¤šæœ‰ GOMAXPROCS ä¸ªè‡ªæ—‹çš„ M (ä»¬). å½“ä¸€ä¸ªè‡ªæ—‹çš„çº¿ç¨‹æ‰¾åˆ°å·¥ä½œ, å®ƒå°±è„±ç¦»äº†è‡ªæ—‹çŠ¶æ€.</p><p>å¦‚æœæœ‰ç©ºé—²çš„ M æ²¡æœ‰è¢«èµ‹äºˆ P, é‚£ä¹ˆè¢«èµ‹äºˆ P çš„ç©ºé—²çº¿ç¨‹ä¸ä¼šè¢«é˜»å¡. å½“æ–°çš„ goroutine(s) è¢«åˆ›å»ºæˆ– M è¢«é˜»å¡æ—¶, è°ƒåº¦å™¨ç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ªè‡ªæ—‹ M. è¿™ç¡®ä¿äº†æ²¡æœ‰å¯è¿è¡Œçš„ goroutine(s) ä¸è¢«è¿è¡Œ; å¹¶ä¸”é¿å…è¿‡å¤šçš„ M é˜»å¡æˆ–è€…è§£é™¤é˜»å¡.</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>Go è°ƒåº¦å™¨åšäº†å¾ˆå¤šäº‹æƒ…æ¥é¿å…è¿‡å¤šçš„æ“ä½œç³»ç»Ÿçº¿ç¨‹æŠ¢å , é€šè¿‡çªƒå–(stealing)è°ƒåº¦å®ƒä»¬åˆ°æ­£ç¡®å’Œæœªå……åˆ†åˆ©ç”¨çš„å¤„ç†å™¨, ä»¥åŠå®ç°è‡ªæ—‹çº¿ç¨‹ä»¥é¿å…è¿‡é«˜é˜»å¡æˆ–è€…è§£é™¤é˜»å¡åˆ‡æ¢çš„å‘ç”Ÿ.</p><p>è°ƒåº¦äº‹ä»¶å¯ä»¥ç”¨æ‰§è¡Œè¿½è¸ªå™¨(<a href="https://golang.org/cmd/trace/" target="_blank" rel="noopener">execution tracer</a>)è¿½è¸ª. å¦‚æœä½ ç¢°å·§è®¤ä¸ºè‡ªå·±çš„å¤„ç†å™¨åˆ©ç”¨ç‡å¾ˆå·®, åˆ™å¯ä»¥ç”¨å®ƒæ¢ç©¶å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ….</p><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul><li><a href="https://github.com/golang/go/blob/master/src/runtime/proc.go" target="_blank" rel="noopener">Go è¿è¡Œæ—¶è°ƒåº¦å™¨æºç </a></li><li><a href="https://golang.org/s/go11sched" target="_blank" rel="noopener">å¯æ‰©å±• Go è°ƒåº¦å™¨è®¾è®¡æ–‡æ¡£</a></li><li><a href="https://morsmachine.dk/go-scheduler" target="_blank" rel="noopener">Daniel Morsing: Go è°ƒåº¦å™¨</a></li></ul>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Go è°šè¯­</title>
      <link href="/post/go-proverbs.html"/>
      <url>/post/go-proverbs.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ª<a href="http://go-proverbs.github.io/" target="_blank" rel="noopener">go-proverbs</a>, è„±èƒäº Rob Pike æŒ¯å¥‹äººå¿ƒçš„æ¼”è®²è§†é¢‘ <a href="https://www.youtube.com/watch?v=PAAkCSZUG1c" target="_blank" rel="noopener">talk at Gopherfest SV 2015</a> (<a href="https://www.bilibili.com/video/av18889438/" target="_blank" rel="noopener">bilibili</a>).</p><h3 id="ä¸è¦é€šè¿‡å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡-é€šè¿‡é€šä¿¡å…±äº«å†…å­˜-Donâ€™t-communicate-by-sharing-memory-share-memory-by-communicating"><a href="#ä¸è¦é€šè¿‡å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡-é€šè¿‡é€šä¿¡å…±äº«å†…å­˜-Donâ€™t-communicate-by-sharing-memory-share-memory-by-communicating" class="headerlink" title="ä¸è¦é€šè¿‡å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡, é€šè¿‡é€šä¿¡å…±äº«å†…å­˜ (Donâ€™t communicate by sharing memory, share memory by communicating)"></a>ä¸è¦é€šè¿‡å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡, é€šè¿‡é€šä¿¡å…±äº«å†…å­˜ (<a href="https://www.bilibili.com/video/av18889438/?t=2m48s" target="_blank" rel="noopener">Donâ€™t communicate by sharing memory, share memory by communicating</a>)</h3><p>ä¼ ç»Ÿçš„çº¿ç¨‹æ¨¡å‹ï¼ˆé€šå¸¸åœ¨ç¼–å†™ Java, C++ å’Œ Python ç¨‹åºæ—¶ä½¿ç”¨ï¼‰è¦æ±‚ç¨‹åºå‘˜ä½¿ç”¨å…±äº«å†…å­˜åœ¨çº¿ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡. é€šå¸¸, å…±äº«æ•°æ®ç»“æ„å—é”ä¿æŠ¤, çº¿ç¨‹å°†äº‰å¤ºè¿™äº›é”è®¿é—®æ•°æ®, åœ¨æŸäº›æƒ…å†µä¸‹, é€šè¿‡ä½¿ç”¨ Python çš„ Queue ç­‰çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„å¯ä»¥ä½¿è¿™å˜å¾—æ›´å®¹æ˜“.</p><p>Go çš„å¹¶å‘åŸè¯­ (goroutines å’Œ channels) ä¸ºæ„é€ å¹¶å‘è½¯ä»¶æä¾›äº†ä¸€ç§ä¼˜é›…è€Œç‹¬ç‰¹çš„æ‰‹æ®µ. (è¿™äº›æ¦‚å¿µæœ‰ä¸€ä¸ªæœ‰è¶£çš„å†å², è¦ä» C.A.R.Hoare çš„é€šä¿¡é¡ºåºè¿›ç¨‹è¯´èµ·.) Go é¼“åŠ±ä½¿ç”¨ channels åœ¨ goroutines ä¹‹é—´ä¼ é€’å¯¹æ•°æ®çš„å¼•ç”¨, è€Œä¸æ˜¯æ˜¾å¼åœ°ä½¿ç”¨é”æ¥è°ƒè§£å¯¹å…±äº«æ•°æ®çš„è®¿é—®. è¿™ç§æ–¹æ³•ç¡®ä¿åªæœ‰ä¸€ä¸ª goroutine å¯ä»¥åœ¨ç»™å®šçš„æ—¶é—´è®¿é—®æ•°æ®. è¿™ä¸ªæ¦‚å¿µæ€»ç»“åœ¨ Effective Go æ–‡æ¡£ä¸­ (ä»»ä½• Go ç¨‹åºå‘˜éƒ½å¿…é¡»é˜…è¯»).</p><p>Go å®˜æ–¹åšå®¢ä¸­æœ‰ä¸€ç¯‡æ–‡ç« å¯¹è¯¥è°šè¯­è§£è¯», å¯ä»¥å‚è§<a href="https://blog.golang.org/share-memory-by-communicating" target="_blank" rel="noopener">åŸæ–‡</a>.</p><h3 id="å¹¶å‘ä¸æ˜¯å¹¶è¡Œ-Concurrency-is-not-parallelism"><a href="#å¹¶å‘ä¸æ˜¯å¹¶è¡Œ-Concurrency-is-not-parallelism" class="headerlink" title="å¹¶å‘ä¸æ˜¯å¹¶è¡Œ (Concurrency is not parallelism)"></a>å¹¶å‘ä¸æ˜¯å¹¶è¡Œ (<a href="https://www.bilibili.com/video/av18889438/?t=3m42s" target="_blank" rel="noopener">Concurrency is not parallelism</a>)</h3><p>å½“äººä»¬å¬åˆ° <em>å¹¶å‘</em> è¿™ä¸ªè¯çš„æ—¶å€™, ä»–ä»¬ç»å¸¸ä¼šæƒ³åˆ°å¹¶è¡Œ, è¿™æ˜¯ä¸€ä¸ªç›¸å…³çš„, ä½†éå¸¸ç‹¬ç‰¹çš„æ¦‚å¿µ. åœ¨ç¼–ç¨‹ä¸­, å¹¶å‘æ˜¯ç‹¬ç«‹æ‰§è¡Œçš„è¿›ç¨‹çš„ç»„æˆ, è€Œå¹¶è¡Œåˆ™æ˜¯ (å¯èƒ½ç›¸å…³çš„) è®¡ç®—çš„åŒæ—¶æ‰§è¡Œ. å¹¶å‘æ˜¯ä¸€æ¬¡å¤„ç†å¾ˆå¤šäº‹æƒ…. å¹¶è¡Œæ˜¯ä¸€æ¬¡åšå¾ˆå¤šäº‹æƒ….</p><h3 id="Channels-é‡æ’åº-äº’æ–¥é‡ä¸²è¡ŒåŒ–-Channels-orchestrate-mutexes-serialize"><a href="#Channels-é‡æ’åº-äº’æ–¥é‡ä¸²è¡ŒåŒ–-Channels-orchestrate-mutexes-serialize" class="headerlink" title="Channels é‡æ’åº; äº’æ–¥é‡ä¸²è¡ŒåŒ– (Channels orchestrate; mutexes serialize)"></a>Channels é‡æ’åº; äº’æ–¥é‡ä¸²è¡ŒåŒ– (<a href="https://www.bilibili.com/video/av18889438/?t=4m20s" target="_blank" rel="noopener">Channels orchestrate; mutexes serialize</a>)</h3><p>è¿™ä¸ªçœ‹ä¸­æ–‡ï¼ˆç¿»è¯‘å¾…å•†æ¦·ï¼‰æ˜¯ä¸æ˜¯ä¸€è„¸æ‡µ (è™½ç„¶è‹±æ–‡ä¹Ÿçœ‹ä¸æ‡‚) ? å…¶å®åˆ†å·å‰åè¯´çš„æ˜¯ä¸€ä¸ªæ„æ€, è¯¥è°šè¯­æŒ‰æˆ‘çš„ä¸ªäººç†è§£å¯ä»¥ç”¨ go ç¨‹åº (æ¥è‡ª <a href="https://github.com/golang/tour/blob/master/content/concurrency/channels.go" target="_blank" rel="noopener">go tour</a>) è§£é‡Šæˆå¦‚ä¸‹:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(s []<span class="keyword">int</span>, c <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">sum := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> s &#123;</span><br><span class="line">sum += v</span><br><span class="line">&#125;</span><br><span class="line">c &lt;- sum <span class="comment">// æ­¤å¤„å¦‚æœæ”¹æˆäº’æ–¥é‡ä¸€æ ·å¯ä»¥åšåˆ°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := []<span class="keyword">int</span>&#123;<span class="number">7</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">-9</span>, <span class="number">4</span>, <span class="number">0</span>&#125;</span><br><span class="line"></span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"><span class="keyword">go</span> sum(s[:<span class="built_in">len</span>(s)/<span class="number">2</span>], c)</span><br><span class="line"><span class="keyword">go</span> sum(s[<span class="built_in">len</span>(s)/<span class="number">2</span>:], c)</span><br><span class="line">x, y := &lt;-c, &lt;-c</span><br><span class="line"></span><br><span class="line">fmt.Println(x, y, x+y)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¥å£è¶Šå¤§-æŠ½è±¡è¶Šå¼±-The-bigger-the-interface-the-weaker-the-abstraction"><a href="#æ¥å£è¶Šå¤§-æŠ½è±¡è¶Šå¼±-The-bigger-the-interface-the-weaker-the-abstraction" class="headerlink" title="æ¥å£è¶Šå¤§, æŠ½è±¡è¶Šå¼± (The bigger the interface, the weaker the abstraction)"></a>æ¥å£è¶Šå¤§, æŠ½è±¡è¶Šå¼± (<a href="https://www.bilibili.com/video/av18889438/?t=5m17s" target="_blank" rel="noopener">The bigger the interface, the weaker the abstraction</a>)</h3><p>æ¥å£èƒŒåçš„æ¦‚å¿µæ˜¯é€šè¿‡å°†å¯¹è±¡çš„è¡Œä¸ºæŠ½è±¡ä¸ºç®€å•çš„å¥‘çº¦æ¥å…è®¸é‡ç”¨æ€§. è™½ç„¶æ¥å£ä¸æ˜¯ Go ä¸“æœ‰çš„, ä½†ç”±äº Go æ¥å£é€šå¸¸è¶‹å‘äºå°å‹åŒ–, Go ç¨‹åºå‘˜æ‰å¹¿æ³›ä½¿ç”¨å®ƒä»¬. é€šå¸¸æƒ…å†µä¸‹, ä¸€ä¸ªæ¥å£åªé™äºä¸€åˆ°ä¸¤ä¸ªæ–¹æ³•.</p><p>Go io åŒ…æ¥å£å°±æ˜¯å…¸å‹çš„ä¾‹å­.</p><h3 id="å……åˆ†åˆ©ç”¨é›¶å€¼-Make-the-zero-value-useful"><a href="#å……åˆ†åˆ©ç”¨é›¶å€¼-Make-the-zero-value-useful" class="headerlink" title="å……åˆ†åˆ©ç”¨é›¶å€¼ (Make the zero value useful)"></a>å……åˆ†åˆ©ç”¨é›¶å€¼ (<a href="https://www.bilibili.com/video/av18889438/?t=6m25s" target="_blank" rel="noopener">Make the zero value useful</a>)</h3><p>é›¶å€¼çš„å…¸å‹ä¾‹å­å¦‚ bytes.Buffer å’Œ sync.Mutex:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> buf bytes.Buffer</span><br><span class="line">buf.Write([]<span class="keyword">byte</span>(<span class="string">"hello"</span>))</span><br><span class="line">fmt.Println(buf.String())</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mu sync.Mutex</span><br><span class="line">mu.Lock()</span><br><span class="line">mu.Unlock()</span><br></pre></td></tr></table></figure><p>è¿™æ ·çœ‹èµ·æ¥æ˜¯ä¸æ˜¯æ„Ÿè§‰ä¸€ç‚¹ç”¨æ²¡æœ‰ ? å¦‚æœè¿™æ ·å‘¢ ?</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Map <span class="keyword">struct</span> &#123;</span><br><span class="line">mu sync.RWMutex</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Map)</span> <span class="title">Set</span><span class="params">(k, v <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">m.mu.Lock()</span><br><span class="line"><span class="keyword">defer</span> m.mu.Unlock()</span><br><span class="line"><span class="keyword">if</span> m.m == <span class="literal">nil</span> &#123;</span><br><span class="line">m.m = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">interface</span>&#123;&#125;]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line">m.m[k] = v</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="interface-è¨€ä¹‹æ— ç‰©-interface-says-nothing"><a href="#interface-è¨€ä¹‹æ— ç‰©-interface-says-nothing" class="headerlink" title="interface{} è¨€ä¹‹æ— ç‰© (interface{} says nothing)"></a>interface{} è¨€ä¹‹æ— ç‰© (<a href="https://www.bilibili.com/video/av18889438/?t=7m36s" target="_blank" rel="noopener">interface{} says nothing</a>)</h3><p>è¯¥è°šè¯­ä¸æ˜¯è¯´ interface {} ä¸ä»£è¡¨ä»»ä½•ä¸œè¥¿, è€Œæ˜¯è¯´è¯¥ç±»å‹æ— é™æ€æ£€æŸ¥ä»¥åŠè°ƒç”¨æ—¶ä¿è¯, æ¯”å¦‚ä½ çš„ func æ¥æ”¶ä¸€ä¸ª interface{} ç±»å‹, ä½ å†™çš„æ—¶å€™æ˜¯å¯ç”¨çš„, ä½†æ˜¯æŸä¸ªæ—¶é—´ä½ è¿›è¡Œäº†ä»£ç é‡æ„å¯èƒ½åæ‰äº†.</p><h3 id="Gofmt-çš„é£æ ¼æ²¡æœ‰äººå–œæ¬¢-ä½†æ˜¯-gofmt-æ˜¯æ¯ä¸ªäººçš„æœ€çˆ±-Gofmtâ€™s-style-is-no-oneâ€™s-favorite-yet-gofmt-is-everyoneâ€™s-favorite"><a href="#Gofmt-çš„é£æ ¼æ²¡æœ‰äººå–œæ¬¢-ä½†æ˜¯-gofmt-æ˜¯æ¯ä¸ªäººçš„æœ€çˆ±-Gofmtâ€™s-style-is-no-oneâ€™s-favorite-yet-gofmt-is-everyoneâ€™s-favorite" class="headerlink" title="Gofmt çš„é£æ ¼æ²¡æœ‰äººå–œæ¬¢, ä½†æ˜¯ gofmt æ˜¯æ¯ä¸ªäººçš„æœ€çˆ± (Gofmtâ€™s style is no oneâ€™s favorite, yet gofmt is everyoneâ€™s favorite)"></a>Gofmt çš„é£æ ¼æ²¡æœ‰äººå–œæ¬¢, ä½†æ˜¯ gofmt æ˜¯æ¯ä¸ªäººçš„æœ€çˆ± (<a href="https://www.bilibili.com/video/av18889438/?t=8m43s" target="_blank" rel="noopener">Gofmtâ€™s style is no oneâ€™s favorite, yet gofmt is everyoneâ€™s favorite</a>)</h3><p>è¯¥è°šè¯­å‘Šè¯‰æˆ‘ä»¬å°‘äº›é£æ ¼ä¹‹äº‰, ç”¨è¿™äº›æ—¶é—´å¤šå†™ä»£ç .</p><h3 id="å°å¤åˆ¶å¥½è¿‡å°ä¾èµ–-A-little-copying-is-better-than-a-little-dependency"><a href="#å°å¤åˆ¶å¥½è¿‡å°ä¾èµ–-A-little-copying-is-better-than-a-little-dependency" class="headerlink" title="å°å¤åˆ¶å¥½è¿‡å°ä¾èµ– (A little copying is better than a little dependency)"></a>å°å¤åˆ¶å¥½è¿‡å°ä¾èµ– (<a href="https://www.bilibili.com/video/av18889438/?t=9m28s" target="_blank" rel="noopener">A little copying is better than a little dependency</a>)</h3><p>ç®€å•è¯´å°±æ˜¯å¦‚æœä½ å¯ä»¥æ‰‹åŠ¨æ’¸å°å¿«ä»£ç å°±ä¸è¦å¯¼å…¥ä¸€ä¸ªåº“å»åš, æ¯”å¦‚ UUID:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// see: https://groups.google.com/d/msg/golang-nuts/d0nF_k4dSx4/rPGgfXv6QCoJ</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">f, _ := os.Open(<span class="string">"/dev/urandom"</span>) <span class="comment">// æ¼”ç¤ºç”¨å¿½ç•¥ errcheck</span></span><br><span class="line">b := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">16</span>)</span><br><span class="line">f.Read(b)</span><br><span class="line">f.Close()</span><br><span class="line">uuid := fmt.Sprintf(<span class="string">"%x-%x-%x-%x-%x"</span>, b[<span class="number">0</span>:<span class="number">4</span>], b[<span class="number">4</span>:<span class="number">6</span>], b[<span class="number">6</span>:<span class="number">8</span>], b[<span class="number">8</span>:<span class="number">10</span>], b[<span class="number">10</span>:])</span><br><span class="line">fmt.Println(uuid)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶æœ‰ä¸€å †å†™å¥½çš„ UUID åº“, å½“ä½ ä»…ä»…éœ€è¦ä¸€ä¸ª UUID v4 å®ç°.</p><h3 id="ç³»ç»Ÿè°ƒç”¨å¿…é¡»å§‹ç»ˆä½¿ç”¨æ„å»ºæ ‡ç­¾ä¿è¯-Syscall-must-always-be-guarded-with-build-tags"><a href="#ç³»ç»Ÿè°ƒç”¨å¿…é¡»å§‹ç»ˆä½¿ç”¨æ„å»ºæ ‡ç­¾ä¿è¯-Syscall-must-always-be-guarded-with-build-tags" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨å¿…é¡»å§‹ç»ˆä½¿ç”¨æ„å»ºæ ‡ç­¾ä¿è¯ (Syscall must always be guarded with build tags)"></a>ç³»ç»Ÿè°ƒç”¨å¿…é¡»å§‹ç»ˆä½¿ç”¨æ„å»ºæ ‡ç­¾ä¿è¯ (<a href="https://www.bilibili.com/video/av18889438/?t=11m10s" target="_blank" rel="noopener">Syscall must always be guarded with build tags</a>)</h3><p>ä¸åŒçš„ç³»ç»Ÿ (*NIX, Windows) è°ƒç”¨å¯¼è‡´ä½ åŒä¸€ä¸ª func (å®ç°å¹¶ä¸ä¸€æ ·) å¯èƒ½éœ€è¦åœ¨ä¸åŒçš„ç³»ç»Ÿä¸Šæ„å»ºæ‰èƒ½å¾—åˆ°ä½ æƒ³è¦çš„ç»“æœ. ç®€å•è¯´å°±æ˜¯ç³»ç»Ÿè°ƒç”¨ä¸å¯ç§»æ¤æ‰è¿™ä¹ˆå¹². ç¤ºä¾‹å¯å‚è§ Go æ ‡å‡†åº“ syscall.</p><h3 id="Cgo-å¿…é¡»å§‹ç»ˆä½¿ç”¨æ„å»ºæ ‡ç­¾ä¿è¯-Cgo-must-always-be-guarded-with-build-tags"><a href="#Cgo-å¿…é¡»å§‹ç»ˆä½¿ç”¨æ„å»ºæ ‡ç­¾ä¿è¯-Cgo-must-always-be-guarded-with-build-tags" class="headerlink" title="Cgo å¿…é¡»å§‹ç»ˆä½¿ç”¨æ„å»ºæ ‡ç­¾ä¿è¯ (Cgo must always be guarded with build tags)"></a>Cgo å¿…é¡»å§‹ç»ˆä½¿ç”¨æ„å»ºæ ‡ç­¾ä¿è¯ (<a href="https://www.bilibili.com/video/av18889438/?t=11m53s" target="_blank" rel="noopener">Cgo must always be guarded with build tags</a>)</h3><p>åŸºæœ¬ä¸ŠåŸå› åŒä¸Šä¸€æ¡.</p><h3 id="Cgo-ä¸æ˜¯-Go-Cgo-is-not-Go"><a href="#Cgo-ä¸æ˜¯-Go-Cgo-is-not-Go" class="headerlink" title="Cgo ä¸æ˜¯ Go (Cgo is not Go)"></a>Cgo ä¸æ˜¯ Go (<a href="https://www.bilibili.com/video/av18889438/?t=12m37s" target="_blank" rel="noopener">Cgo is not Go</a>)</h3><p>å¦‚æœå¯èƒ½ä¸è¦ç”¨ Cgo. è¿™é‡Œæœ‰ç¯‡<a href="https://dave.cheney.net/2016/01/18/cgo-is-not-go" target="_blank" rel="noopener">æ–‡ç« </a>è¯´æ˜äº†ä¸ºä»€ä¹ˆ.</p><h3 id="unsafe-åŒ…æ— ä¿è¯-With-the-unsafe-package-there-are-no-guarantees"><a href="#unsafe-åŒ…æ— ä¿è¯-With-the-unsafe-package-there-are-no-guarantees" class="headerlink" title="unsafe åŒ…æ— ä¿è¯ (With the unsafe package there are no guarantees)"></a>unsafe åŒ…æ— ä¿è¯ (With the unsafe package there are no guarantees)</h3><p>åŒ…å¦‚å…¶å, ä¸å®‰å…¨. ä½ å¯ä»¥ä½¿ç”¨ unsafe åŒ…å¦‚æœä½ å‡†å¤‡å¥½äº†æœ‰ä¸€å¤©å®ƒä¼šåæ‰.</p><h3 id="æ¸…æ™°å¥½è¿‡èªæ˜-Clear-is-better-than-clever"><a href="#æ¸…æ™°å¥½è¿‡èªæ˜-Clear-is-better-than-clever" class="headerlink" title="æ¸…æ™°å¥½è¿‡èªæ˜ (Clear is better than clever)"></a>æ¸…æ™°å¥½è¿‡èªæ˜ (<a href="https://www.bilibili.com/video/av18889438/?t=14m35s" target="_blank" rel="noopener">Clear is better than clever</a>)</h3><p>Rob Pike åœ¨ä»–ä¸åˆ«äººåˆè‘—çš„ &lt;<a href="https://item.jd.com/11836053.html" target="_blank" rel="noopener">ç¨‹åºè®¾è®¡å®è·µ</a>&gt; ä¸­å†™åˆ°: â€œå†™æ¸…æ™°çš„ä»£ç , ä¸è¦å†™èªæ˜çš„ä»£ç â€.</p><h3 id="åå°„æ°¸è¿œä¸æ˜¯æ¸…æ™°çš„-Reflection-is-never-clear"><a href="#åå°„æ°¸è¿œä¸æ˜¯æ¸…æ™°çš„-Reflection-is-never-clear" class="headerlink" title="åå°„æ°¸è¿œä¸æ˜¯æ¸…æ™°çš„ (Reflection is never clear)"></a>åå°„æ°¸è¿œä¸æ˜¯æ¸…æ™°çš„ (<a href="https://www.bilibili.com/video/av18889438/?t=15m22s" target="_blank" rel="noopener">Reflection is never clear</a>)</h3><p>å¾ˆå¤šäººåœ¨ Stackoverflow ä¸ŠæŠ±æ€¨ Go çš„åå°„ä¸å·¥ä½œ, å› ä¸ºé‚£ä¸æ˜¯ä¸ºä½ å‡†å¤‡çš„ğŸ˜‚! åªæœ‰å¾ˆå°‘å¾ˆå°‘çš„äººåº”è¯¥ç”¨åå°„è¿™ä¸ªéå¸¸å¼ºå¤§è€Œåˆéå¸¸éš¾çš„ç‰¹æ€§. æ–°æ‰‹åº”è¯¥è¿œç¦»åå°„å’Œ interface{}.</p><h3 id="é”™è¯¯ä¹Ÿæ˜¯ä¸€ç§å€¼-Errors-are-values"><a href="#é”™è¯¯ä¹Ÿæ˜¯ä¸€ç§å€¼-Errors-are-values" class="headerlink" title="é”™è¯¯ä¹Ÿæ˜¯ä¸€ç§å€¼ (Errors are values)"></a>é”™è¯¯ä¹Ÿæ˜¯ä¸€ç§å€¼ (<a href="https://www.bilibili.com/video/av18889438/?t=16m13s" target="_blank" rel="noopener">Errors are values</a>)</h3><p>å€¼å¯ä»¥è¢«ç¼–ç¨‹, å¹¶ä¸”ç”±äºé”™è¯¯æ˜¯å€¼, æ‰€ä»¥é”™è¯¯å¯ä»¥è¢«ç¼–ç¨‹. Go å®˜æ–¹åšå®¢æœ‰å¯¹æ­¤çš„<a href="https://blog.golang.org/errors-are-values" target="_blank" rel="noopener">è§£è¯»</a>.</p><h3 id="ä¸è¦æ­¢æ­¥äºæ£€æŸ¥é”™è¯¯è€Œè¦ä¼˜é›…çš„å¤„ç†-Donâ€™t-just-check-errors-handle-them-gracefully"><a href="#ä¸è¦æ­¢æ­¥äºæ£€æŸ¥é”™è¯¯è€Œè¦ä¼˜é›…çš„å¤„ç†-Donâ€™t-just-check-errors-handle-them-gracefully" class="headerlink" title="ä¸è¦æ­¢æ­¥äºæ£€æŸ¥é”™è¯¯è€Œè¦ä¼˜é›…çš„å¤„ç† (Donâ€™t just check errors, handle them gracefully)"></a>ä¸è¦æ­¢æ­¥äºæ£€æŸ¥é”™è¯¯è€Œè¦ä¼˜é›…çš„å¤„ç† (<a href="https://www.bilibili.com/video/av18889438/?t=17m25s" target="_blank" rel="noopener">Donâ€™t just check errors, handle them gracefully</a>)</h3><p>Dave Cheney æœ‰ç¯‡<a href="https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully" target="_blank" rel="noopener">åšå®¢</a>è¯¦ç»†è§£è¯»äº†è¯¥è°šè¯­.</p><h3 id="è®¾è®¡æ¶æ„-å‘½åç»„ä»¶-è®°å½•ç»†èŠ‚-Design-the-architecture-name-the-components-document-the-details"><a href="#è®¾è®¡æ¶æ„-å‘½åç»„ä»¶-è®°å½•ç»†èŠ‚-Design-the-architecture-name-the-components-document-the-details" class="headerlink" title="è®¾è®¡æ¶æ„, å‘½åç»„ä»¶, è®°å½•ç»†èŠ‚ (Design the architecture, name the components, document the details)"></a>è®¾è®¡æ¶æ„, å‘½åç»„ä»¶, è®°å½•ç»†èŠ‚ (<a href="https://www.bilibili.com/video/av18889438/?t=18m09s" target="_blank" rel="noopener">Design the architecture, name the components, document the details</a>)</h3><p>å½“ä½ å†™ä¸€ä¸ªå¤§å‹ç³»ç»Ÿçš„æ—¶å€™, ä½ æŠŠå®ƒè®¾è®¡æˆä¸€ç§ç»“æ„åŒ–çš„ä¸œè¥¿. æƒ³è±¡ç»„ä»¶çš„æ¯ä¸€ä¸ªéƒ¨åˆ†å¹¶è¡Œå·¥ä½œ, ä¸ºä¸åŒçš„ç»„ä»¶èµ·å¥½çš„åå­—, å› ä¸ºè¿™äº›åå­—ä¼šå‡ºç°åœ¨ç¨¿çº¸ä¸Š.</p><p>æ‹¿ Go ç¨‹åºæ¥è¯´, å¦‚æœåå­—ä¸é”™, ç»„ä»¶å°±å¥½ç†è§£, é‚£ä¹ˆç¨‹åºçš„ç»“æ„è®¾è®¡å°±ä¼šæ¸…æ™°, ç¨‹åºä¼šæ„Ÿè§‰å¾ˆè‡ªç„¶.</p><p>ä½†æ˜¯è¿˜æœ‰å¾ˆå¤šä¸œè¥¿ä½ éœ€è¦è§£é‡Š, æ‰€ä»¥è¿™äº›æ˜¯ä½ éœ€è¦è§£é‡Šçš„ç»†èŠ‚. ä½†æ˜¯å‘½åä¼šå¸®åŠ©ä½ è§£é‡Šå¾ˆå¤§ä¸€éƒ¨åˆ†è®¾è®¡. ç»†èŠ‚åªæ˜¯å¡«è¡¥ææ–™çš„ç¼ºå£å¯èƒ½ç”¨æ¥ä¸ºç”¨æˆ·æ‰“å°å·¥ç¨‹å›¾è§£æ–‡æ¡£.</p><h3 id="æ–‡æ¡£æ˜¯é’ˆå¯¹ç”¨æˆ·çš„-Documentation-is-for-users"><a href="#æ–‡æ¡£æ˜¯é’ˆå¯¹ç”¨æˆ·çš„-Documentation-is-for-users" class="headerlink" title="æ–‡æ¡£æ˜¯é’ˆå¯¹ç”¨æˆ·çš„ (Documentation is for users)"></a>æ–‡æ¡£æ˜¯é’ˆå¯¹ç”¨æˆ·çš„ (<a href="https://www.bilibili.com/video/av18889438/?t=19m07s" target="_blank" rel="noopener">Documentation is for users</a>)</h3><p>å¾ˆå¤šäººå†™æ–‡æ¡£è¡¨æ˜æŸä¸ª func æ˜¯åšä»€ä¹ˆçš„, ä½†æ˜¯ä»–ä»¬ä¸æƒ³æƒ³è¿™ä¸ª func æ˜¯ä¸ºè°è€Œå†™. è¿™æœ‰å¾ˆå¤§çš„ä¸åŒ. ä½ çŸ¥é“è¿™ä¸ª func è¿”å›ä»€ä¹ˆæ˜¯å¯¹çš„, ä½†æ˜¯å®ƒä¸ºä»€ä¹ˆè¿”å›äº†ä½ ä½¿ç”¨çš„æ—¶å€™ä¸ä¸€æ ·çš„ç»“æœ?</p><p>æŠŠè‡ªå·±å½“æˆä½¿ç”¨è€…è€Œä¸æ˜¯å†™å®ƒçš„äºº, é‚£ä¹ˆ godoc ä¸Šçš„æ–‡æ¡£å°±æ˜¯å¯¹ç”¨æˆ·æœ‰ç”¨çš„. è¿™å¯¹äºå…¶ä»–è¯­è¨€ä¸€æ ·é€‚ç”¨.</p><h3 id="ä¸è¦æ…Œ-Donâ€™t-panic"><a href="#ä¸è¦æ…Œ-Donâ€™t-panic" class="headerlink" title="ä¸è¦æ…Œ (Donâ€™t panic)"></a>ä¸è¦æ…Œ (<a href="https://github.com/golang/go/wiki/CodeReviewComments#dont-panic" target="_blank" rel="noopener">Donâ€™t panic</a>)</h3><p>ä¸è¦ä½¿ç”¨ panic è¿›è¡Œæ­£å¸¸çš„é”™è¯¯å¤„ç†. ä½¿ç”¨é”™è¯¯ (error) å’Œå¤šä¸ªè¿”å›å€¼.</p>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Go è°ƒåº¦å·¥ä½œæœºåˆ¶</title>
      <link href="/post/how-does-the-golang-scheduler-work.html"/>
      <url>/post/how-does-the-golang-scheduler-work.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯æ¥è‡ª Quora ä¸Šé¢ä¸€ä¸ª Go ç›¸å…³çš„<a href="https://www.quora.com/How-does-the-golang-scheduler-work/answer/Ian-Lance-Taylor?share=508736a1&amp;srid=imO0" target="_blank" rel="noopener">é—®é¢˜</a>.<br><a id="more"></a></p><p>ä¸‹é¢æ˜¯ Ian Lance Taylor (Go æ ¸å¿ƒå¼€å‘è€…å…¼èµ„æ·±å…ƒè€) ç»™å‡ºçš„ç­”æ¡ˆ:</p><p>æˆ‘å°†ç»™å‡ºä» Go 1.7 å¼€å§‹ä½¿ç”¨çš„è°ƒåº¦å™¨çš„æ¦‚è¿°.</p><p>è°ƒåº¦å™¨æœ‰ä¸‰ä¸ªåŸºæœ¬ç»“æ„, ç§°ä¸º G, M å’Œ P. ä¸€ä¸ª G æ˜¯ä¸€ä¸ª goroutine, ä¸€ä¸ª M æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹, ä¸€ä¸ª P æ˜¯ä¸€ä¸ª(é€»è¾‘)å¤„ç†å™¨.</p><p>è°ƒåº¦å™¨æœ‰ç¡®åˆ‡çš„ GOMAXPROCS æ•°é‡çš„ P (GOMAXPROCSæ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡å’Œè¿è¡Œæ—¶å‡½æ•°, ç”¨æ¥è®¾ç½®ç¨‹åºä¸­çš„å¹¶å‘åº¦). ä¸ºäº†è®© M æ‰§è¡Œä¸€ä¸ª G, å®ƒå¿…é¡»è·å¾—ä¸€ä¸ªP, ç„¶åè¿è¡Œ G ç›´åˆ°åœæ­¢. G é€šè¿‡è¿›è¡Œè¯¸å¦‚ I/O æ“ä½œçš„ç³»ç»Ÿè°ƒç”¨, é˜»å¡ä¸€ä¸ª channel æ“ä½œ, è°ƒç”¨ C å‡½æ•°, æ­£åœ¨è¢«é¢„æŠ¢å (pre-emption)æˆ–å…¶ä»–ä¸€äº›å°çš„æƒ…å†µæ¥åœæ­¢. ä¸€ä¸ª G åªèƒ½åœ¨ä¸€ä¸ªå®‰å…¨çš„åœ°æ–¹è¢«é¢„æŠ¢å , åœ¨å½“å‰çš„å®ç°ä¸­åªèƒ½åœ¨ä»£ç å‘ç”Ÿå‡½æ•°è°ƒç”¨çš„æ—¶å€™å‘ç”Ÿ.</p><p>å½“ä¸€ä¸ª G è¢«ç±»ä¼¼äºä¸€ä¸ª channel æ“ä½œé‚£æ ·é˜»å¡æ—¶, å®ƒå°†è¢«æ”¾ç½®åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­, M å°†å¯»æ‰¾å¦ä¸€ä¸ªå¯è¿è¡Œçš„ G . å¦‚æœæ²¡æœ‰å¯è¿è¡Œçš„ G, åˆ™ M å°†é‡Šæ”¾ P å¹¶è¿›å…¥ç¡çœ çŠ¶æ€.</p><p>å½“ G å®Œæˆç³»ç»Ÿè°ƒç”¨æ—¶, å¿…é¡»é‡æ–°è·å– P. å¦‚æœæ²¡æœ‰ P å¯ç”¨, å®ƒå°†è¢«æ ‡è®°ä¸ºå¯è¿è¡Œ, M å°†è¿›å…¥ç¡çœ çŠ¶æ€.</p><p>å½“ channel æ“ä½œæˆåŠŸæ—¶, å®ƒä¼šå”¤é†’å¦ä¸€ä¸ª goroutine, å°†å…¶æ ‡è®°ä¸ºå¯è¿è¡Œ, å¹¶ä¸”å¦‚æœæœ‰å¯ç”¨çš„ P, åˆ™å”¤é†’ M æ¥è¿è¡Œå®ƒ.</p><p>è™½ç„¶åƒåœ¾æ”¶é›†å™¨å¤§å¤šæ˜¯å¹¶å‘çš„, ä½†æœ‰å‡ ç‚¹è¦æš‚æ—¶åœæ­¢æ‰€æœ‰çš„çº¿ç¨‹æ‰èƒ½å®‰å…¨åœ°è½¬ç§»åˆ°ä¸‹ä¸€ä¸ªæ”¶é›†é˜¶æ®µ. å®ƒé€šè¿‡æ ‡è®°æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ goroutine æ¥é¢„æŠ¢å . å½“ä»–ä»¬åˆ°è¾¾å®‰å…¨ç‚¹æ—¶, G å’Œ M å°†è¿›å…¥ç¡çœ . å½“åƒåœ¾æ”¶é›†å™¨æ˜¯å”¯ä¸€å‰©ä¸‹çš„æ­£åœ¨è¿è¡Œçš„ G æ—¶, å®ƒå°†ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µ, ç„¶åå”¤é†’ GOMAXPROC æ•°é‡çš„ M, å®ƒä»¬å°†å„è‡ªæ‰¾åˆ°å¯è¿è¡Œçš„ G, å¹¶ç»§ç»­ä¸‹å».</p><p>runtime.Gosched å‡½æ•°ä¿ƒä½¿ M å°†å½“å‰çš„ G æ”¾åœ¨å¯è¿è¡Œçš„ goroutine åˆ—è¡¨ä¸­, å¹¶ä»è¯¥åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªæ–°çš„ G å¼€å§‹è¿è¡Œ.</p>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MySQL Order By æŒ‰ç‰¹å®šçš„å­—æ®µå€¼æ’åº</title>
      <link href="/post/ordering-by-specific-field-values-with-mysql.html"/>
      <url>/post/ordering-by-specific-field-values-with-mysql.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ª(<a href="https://www.electrictoolbox.com/mysql-order-specific-field-values/" target="_blank" rel="noopener">Ordering by specific field values with MySQL</a>)ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰</p><p>åœ¨ SQL æŸ¥è¯¢ä¸­å¯èƒ½æœ‰æ—¶éœ€è¦ä½¿ç”¨ ASC æˆ– DESC æˆ–ä½¿ç”¨ç‰¹æ®Šæ’åºå­—æ®µæ‰èƒ½å®Œæˆçš„ç‰¹å®šé¡ºåº. MySQL æœ‰ä¸€ä¸ª ORDER BY FIELD å‡½æ•°å¯ä»¥ç”¨æ¥åšè¿™ä¸ª.<br><a id="more"></a></p><h2 id="æµ‹è¯•æ•°æ®"><a href="#æµ‹è¯•æ•°æ®" class="headerlink" title="æµ‹è¯•æ•°æ®"></a>æµ‹è¯•æ•°æ®</h2><p>æœ¬æ–‡ä¸­çš„ç¤ºä¾‹æ•°æ®ä½¿ç”¨æˆ‘çš„ç¤ºä¾‹ <a href="https://www.electrictoolbox.com/mysql-example-table/" target="_blank" rel="noopener">fruit</a> è¡¨. è¿™æ˜¯ä¸€ä¸ªæœ‰ç‚¹ç®€å•çš„è¡¨, ä½†å®ƒå¯ä»¥ç”¨æ¥å¾ˆå¥½åœ°è¯´æ˜è¿™ç¯‡æ–‡ç« ä¸­çš„è§‚ç‚¹.</p><h2 id="æŒ‰ç‰¹å®šå­—æ®µå€¼æ’åº"><a href="#æŒ‰ç‰¹å®šå­—æ®µå€¼æ’åº" class="headerlink" title="æŒ‰ç‰¹å®šå­—æ®µå€¼æ’åº"></a>æŒ‰ç‰¹å®šå­—æ®µå€¼æ’åº</h2><p>fruit è¡¨æœ‰ä¸€ä¸ª name å­—æ®µ, å…·æœ‰ä»¥ä¸‹ç‰¹å®šçš„å€¼: è‹¹æœ(Apple), é¦™è•‰(Banana), æ©˜å­(Orange), æ¢¨(Pear). æ¯ä¸ªç‰¹å®šçš„å€¼éƒ½æœ‰ä¸€ç³»åˆ—çš„å“ç§.</p><p>æ¯”æ–¹è¯´, ä¸ºäº†è®ºè¯çš„ç¼˜æ•…, æˆ‘ä»¬è¦æŒ‰é¦™è•‰, è‹¹æœ, æ¢¨, æ©˜å­ç­‰ç‰¹å®šçš„é¡ºåºæ’åˆ—æ•°æ®, ç„¶åå†æŒ‰å“ç§æ’åº. ä½¿ç”¨æ™®é€šçš„ ORDER BY å­å¥ä¸å¯èƒ½è¿™æ ·åš, å› ä¸ºè¿™ä¸ªå­—æ®µçš„å‡åºæˆ–é™åºæ’åºä¸èµ·ä½œç”¨. æˆ‘ä»¬è¦ä¹ˆéœ€è¦æŸç§å½¢å¼çš„æ’åºåˆ—æˆ–è¿›è¡Œå…¶ä»–é€‰æ‹©.</p><p>åœ¨ ORDER BY å­å¥ä¸­ä½¿ç”¨ FIELD å‡½æ•°å¯ä»¥å®ç°è¿™ä¸€ç‚¹. å®ƒçš„å·¥ä½œæ–¹å¼æ˜¯æŒ‡å®šè¦æ’åºçš„åˆ—, ç„¶åæŒ‰é¡ºåºæ’åºå®ƒä»¬çš„å€¼. ä¾‹å¦‚:</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fruit</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">FIELD</span>(<span class="keyword">name</span>, <span class="string">'Banana'</span>, <span class="string">'Apple'</span>, <span class="string">'Pear'</span>, <span class="string">'Orange'</span>), variety;</span><br></pre></td></tr></table></figure><p>æ¥è‡ªç¤ºä¾‹è¡¨çš„ç»“æœæ•°æ®å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+----------+--------+---------------------+</span><br><span class="line">| fruit_id | name   | variety             |</span><br><span class="line">+----------+--------+---------------------+</span><br><span class="line">|       11 | Banana | Burro               |</span><br><span class="line">|       12 | Banana | Cavendish           |</span><br><span class="line">|       10 | Banana | Plantain            |</span><br><span class="line">|        6 | Apple  | Cox&apos;s Orange Pippin |</span><br><span class="line">|        7 | Apple  | Granny Smith        |</span><br><span class="line">|        1 | Apple  | Red Delicious       |</span><br><span class="line">|        8 | Pear   | Anjou               |</span><br><span class="line">|        4 | Pear   | Bartlett            |</span><br><span class="line">|        2 | Pear   | Comice              |</span><br><span class="line">|        5 | Orange | Blood               |</span><br><span class="line">|        3 | Orange | Navel               |</span><br><span class="line">|        9 | Orange | Valencia            |</span><br><span class="line">+----------+--------+---------------------+</span><br></pre></td></tr></table></figure><h2 id="ç–‘éš¾æ‚ç—‡"><a href="#ç–‘éš¾æ‚ç—‡" class="headerlink" title="ç–‘éš¾æ‚ç—‡"></a>ç–‘éš¾æ‚ç—‡</h2><p>ä½¿ç”¨æ­¤åŠŸèƒ½æ—¶æœ‰ä¸€ä¸ªå°å°çš„ç–‘éš¾æ‚ç—‡. åˆ—ä¸­ä¸åœ¨ FIELD å‡½æ•°ä¸­çš„ä»»ä½•å€¼å°†åœ¨æŒ‡å®šçš„å€¼ä¹‹å‰æˆ–å¤šæˆ–å°‘éšæœºå‡ºç°. ä¾‹å¦‚, åªæŒ‡å®šè‹¹æœå’Œé¦™è•‰:</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fruit</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">FIELD</span>(<span class="keyword">name</span>, <span class="string">'Banana'</span>, <span class="string">'Apple'</span>) <span class="keyword">DESC</span>, variety;</span><br></pre></td></tr></table></figure><p>è¿™å¯¼è‡´:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+----------+--------+---------------------+</span><br><span class="line">| fruit_id | name   | variety             |</span><br><span class="line">+----------+--------+---------------------+</span><br><span class="line">|        6 | Apple  | Cox&apos;s Orange Pippin |</span><br><span class="line">|        7 | Apple  | Granny Smith        |</span><br><span class="line">|        1 | Apple  | Red Delicious       |</span><br><span class="line">|       11 | Banana | Burro               |</span><br><span class="line">|       12 | Banana | Cavendish           |</span><br><span class="line">|       10 | Banana | Plantain            |</span><br><span class="line">|        8 | Pear   | Anjou               |</span><br><span class="line">|        4 | Pear   | Bartlett            |</span><br><span class="line">|        5 | Orange | Blood               |</span><br><span class="line">|        2 | Pear   | Comice              |</span><br><span class="line">|        3 | Orange | Navel               |</span><br><span class="line">|        9 | Orange | Valencia            |</span><br><span class="line">+----------+--------+---------------------+</span><br></pre></td></tr></table></figure><h2 id="è§£å†³é—®é¢˜çš„æ–¹æ³•"><a href="#è§£å†³é—®é¢˜çš„æ–¹æ³•" class="headerlink" title="è§£å†³é—®é¢˜çš„æ–¹æ³•"></a>è§£å†³é—®é¢˜çš„æ–¹æ³•</h2><p>è™½ç„¶é€šå¸¸åªæœ‰åœ¨ç¡®åˆ‡çš„åˆ—å·²çŸ¥çš„æƒ…å†µä¸‹æ‰ä½¿ç”¨æ­¤å‡½æ•°, ä½†è§£å†³æ–¹æ³•æ˜¯é¢ å€’æŒ‡å®šå­—æ®µçš„é¡ºåºå¹¶æŒ‰é™åºå¯¹å…¶æ’åº, ç„¶ååœ¨åŒä¸€ä¸ªå­—æ®µä¸Šè¿›è¡Œç¬¬äºŒæ¬¡æ’åº.</p><p>ä¸‹é¢çš„ä¾‹å­, ä¸ç®¡å®ƒçœ‹èµ·æ¥å¦‚ä½•ï¼Œå®é™…ä¸ŠæŒ‰ç…§é¦™è•‰, è‹¹æœ, ç„¶åæŒ‰ç…§å‡åºæ’åˆ—:</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fruit</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">FIELD</span>(<span class="keyword">name</span>, <span class="string">'Apple'</span>, <span class="string">'Banana'</span>) <span class="keyword">DESC</span>, <span class="keyword">name</span>, variety;</span><br></pre></td></tr></table></figure><p>è¿™å¯¼è‡´:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+----------+--------+---------------------+</span><br><span class="line">| fruit_id | name   | variety             |</span><br><span class="line">+----------+--------+---------------------+</span><br><span class="line">|       11 | Banana | Burro               |</span><br><span class="line">|       12 | Banana | Cavendish           |</span><br><span class="line">|       10 | Banana | Plantain            |</span><br><span class="line">|        6 | Apple  | Cox&apos;s Orange Pippin |</span><br><span class="line">|        7 | Apple  | Granny Smith        |</span><br><span class="line">|        1 | Apple  | Red Delicious       |</span><br><span class="line">|        5 | Orange | Blood               |</span><br><span class="line">|        3 | Orange | Navel               |</span><br><span class="line">|        9 | Orange | Valencia            |</span><br><span class="line">|        8 | Pear   | Anjou               |</span><br><span class="line">|        4 | Pear   | Bartlett            |</span><br><span class="line">|        2 | Pear   | Comice              |</span><br><span class="line">+----------+--------+---------------------+</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€ç»„ç‰¹å®šçš„è¡Œéœ€è¦æ˜¾ç¤ºåœ¨ç»“æœé›†ä¸­çš„å…¶ä»–è¡Œä¹‹å‰, è¿™å¯èƒ½æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„è§£å†³æ–¹æ¡ˆ, ä½†æ˜¯å½“ä½¿ç”¨ ASC æˆ– DESC æ’åºé¡ºåºæ—¶, é€šå¸¸ä¸ä¼šå‡ºç°åœ¨ç¬¬ä¸€è¡Œ.</p>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Go å‘½åè¿”å›å€¼çš„å¥½å¤„</title>
      <link href="/post/golang-internals-part-2-nice-benefits-of-named-return-values.html"/>
      <url>/post/golang-internals-part-2-nice-benefits-of-named-return-values.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ª(<a href="https://blog.minio.io/golang-internals-part-2-nice-benefits-of-named-return-values-1e95305c8687" target="_blank" rel="noopener">Golang å†…å¹•ç¬¬ 2 éƒ¨åˆ†: å‘½åè¿”å›å€¼çš„å¥½å¤„</a>)ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰</p><p>ä½ å¯èƒ½çŸ¥é“ Golang æä¾›äº†å‘½åè¿”å›å€¼çš„èƒ½åŠ›. åˆ°ç›®å‰ä¸ºæ­¢åœ¨ <a href="https://github.com/minio/minio" target="_blank" rel="noopener">minio</a> ä¸­æˆ‘ä»¬è¿˜æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½, ä½†æ˜¯è¿™å°†ä¼šæ”¹å˜, å› ä¸ºæˆ‘ä»¬å°†åœ¨è¿™ä¸ªåšå®¢æ–‡ç« ä¸­è§£é‡Šä¸€äº›éšè—çš„å¥½å¤„.<br><a id="more"></a></p><p>å¦‚æœä½ åƒæˆ‘ä»¬ä¸€æ ·, ä½ å¯èƒ½ä¼šæœ‰ç›¸å½“æ•°é‡çš„ä»£ç , å¦‚ä¸‹æ‰€ç¤º, å¯¹äºæ¯ä¸€ä¸ª return è¯­å¥ä½ éƒ½å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„å¯¹è±¡, ä»¥ä¾¿è¿”å›ä¸€ä¸ªâ€™é»˜è®¤â€™å€¼:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> objectInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">arg1 <span class="keyword">int64</span></span><br><span class="line">arg2 <span class="keyword">uint64</span></span><br><span class="line">arg3 <span class="keyword">string</span></span><br><span class="line">arg4 []<span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NoNamedReturnParams</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="params">(objectInfo)</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i == <span class="number">1</span> &#123;</span><br><span class="line"><span class="comment">// Do one thing</span></span><br><span class="line"><span class="keyword">return</span> objectInfo&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i == <span class="number">2</span> &#123;</span><br><span class="line"><span class="comment">// Do another thing</span></span><br><span class="line"><span class="keyword">return</span> objectInfo&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i == <span class="number">3</span> &#123;</span><br><span class="line"><span class="comment">// Do one more thing still</span></span><br><span class="line"><span class="keyword">return</span> objectInfo&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Normal return</span></span><br><span class="line"><span class="keyword">return</span> objectInfo&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ çœ‹ä¸€ä¸‹ Golang ç¼–è¯‘å™¨ç”Ÿæˆçš„å®é™…ä»£ç , ä½ å°†ä¼šå¾—åˆ°å¦‚ä¸‹çš„ç»“æœ:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&quot;.NoNamedReturnParams t=1 size=243 args=0x40 locals=0x0</span><br><span class="line">0x0000 TEXT&quot;&quot;.NoNamedReturnParams(SB), $0-64</span><br><span class="line">0x0000 MOVQ$0, &quot;&quot;.~r1+16(FP)</span><br><span class="line">0x0009 LEAQ&quot;&quot;.~r1+24(FP), DI</span><br><span class="line">0x000e XORPSX0, X0</span><br><span class="line">0x0011 ADDQ$-16, DI</span><br><span class="line">0x0015 DUFFZERO$288</span><br><span class="line">0x0028 MOVQ&quot;&quot;.i+8(FP), AX</span><br><span class="line">0x002d CMPQAX, $1</span><br><span class="line">0x0031 JEQ$0, 199</span><br><span class="line">0x0037 CMPQAX, $2</span><br><span class="line">0x003b JEQ$0, 155</span><br><span class="line">0x003d CMPQAX, $3</span><br><span class="line">0x0041 JNE111</span><br><span class="line">0x0043 MOVQ&quot;&quot;.statictmp_2(SB), AX</span><br><span class="line">0x004a MOVQAX, &quot;&quot;.~r1+16(FP)</span><br><span class="line">0x004f LEAQ&quot;&quot;.~r1+24(FP), DI</span><br><span class="line">0x0054 LEAQ&quot;&quot;.statictmp_2+8(SB), SI</span><br><span class="line">0x005b DUFFCOPY$854</span><br><span class="line">0x006e RET</span><br><span class="line">0x006f MOVQ&quot;&quot;.statictmp_3(SB), AX</span><br><span class="line">0x0076 MOVQAX, &quot;&quot;.~r1+16(FP)</span><br><span class="line">0x007b LEAQ&quot;&quot;.~r1+24(FP), DI</span><br><span class="line">0x0080 LEAQ&quot;&quot;.statictmp_3+8(SB), SI</span><br><span class="line">0x0087 DUFFCOPY$854</span><br><span class="line">0x009a RET</span><br><span class="line">0x009b MOVQ&quot;&quot;.statictmp_1(SB), AX</span><br><span class="line">0x00a2 MOVQAX, &quot;&quot;.~r1+16(FP)</span><br><span class="line">0x00a7 LEAQ&quot;&quot;.~r1+24(FP), DI</span><br><span class="line">0x00ac LEAQ&quot;&quot;.statictmp_1+8(SB), SI</span><br><span class="line">0x00b3 DUFFCOPY$854</span><br><span class="line">0x00c6 RET</span><br><span class="line">0x00c7 MOVQ&quot;&quot;.statictmp_0(SB), AX</span><br><span class="line">0x00ce MOVQAX, &quot;&quot;.~r1+16(FP)</span><br><span class="line">0x00d3 LEAQ&quot;&quot;.~r1+24(FP), DI</span><br><span class="line">0x00d8 LEAQ&quot;&quot;.statictmp_0+8(SB), SI</span><br><span class="line">0x00df DUFFCOPY$854</span><br><span class="line">0x00f2 RET</span><br></pre></td></tr></table></figure><p>ä¸€åˆ‡éƒ½å¾ˆå¥½, ä½†è¿™çœ‹èµ·æ¥æ˜¯å¦æœ‰ç‚¹é‡å¤? ä½ æ˜¯å¯¹çš„. å®è´¨ä¸Š, å¯¹äºæ¯ä¸ª return è¯­å¥, è¦è¿”å›çš„å¯¹è±¡æˆ–å¤šæˆ–å°‘è¢«åˆ†é…/åˆå§‹åŒ–(æˆ–è€…é€šè¿‡ DUFFCOPY å®æ›´ç²¾ç¡®åœ°å¤åˆ¶).</p><p>æ¯•ç«Ÿè¿™æ˜¯æˆ‘ä»¬é€šè¿‡åœ¨æ¯ç§æƒ…å†µä¸‹éƒ½è¿”å› objectInfo {} çš„ç»“æœ.</p><h3 id="å‘½åè¿”å›å€¼"><a href="#å‘½åè¿”å›å€¼" class="headerlink" title="å‘½åè¿”å›å€¼"></a>å‘½åè¿”å›å€¼</h3><p>ç°åœ¨çœ‹çœ‹å¦‚æœæˆ‘ä»¬åšä¸€ä¸ªéå¸¸ç®€å•çš„æ”¹å˜ä¼šå‘ç”Ÿä»€ä¹ˆ, æœ¬è´¨ä¸Šåªæ˜¯ç»™è¿”å›å€¼ä¸€ä¸ªåå­— (oi) å’Œä½¿ç”¨ Golang çš„â€™è£¸ä½“â€™è¿”å›ç‰¹æ€§(ä¸ºè¿”å›è¯­å¥æ”¾å¼ƒå‚æ•°, è™½ç„¶è¿™ä¸æ˜¯ä¸¥æ ¼è¦æ±‚, ç¨åæ›´å¤š):</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NamedReturnParams</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="params">(oi objectInfo)</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i == <span class="number">1</span> &#123;</span><br><span class="line"><span class="comment">// Do one thing</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i == <span class="number">2</span> &#123;</span><br><span class="line"><span class="comment">// Do another thing</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i == <span class="number">3</span> &#123;</span><br><span class="line"><span class="comment">// Do one more thing still</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Normal return</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†çœ‹çœ‹ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç , æˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹ç»“æœ:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&quot;.NamedReturnParams t=1 size=67 args=0x40 locals=0x0</span><br><span class="line">0x0000 TEXT&quot;&quot;.NamedReturnParams(SB), $0-64</span><br><span class="line">0x0000 MOVQ$0, &quot;&quot;.oi+16(FP)</span><br><span class="line">0x0009 LEAQ&quot;&quot;.oi+24(FP), DI</span><br><span class="line">0x000e XORPSX0, X0</span><br><span class="line">0x0011 ADDQ$-16, DI</span><br><span class="line">0x0015 DUFFZERO$288</span><br><span class="line">0x0028 MOVQ&quot;&quot;.i+8(FP), AX</span><br><span class="line">0x002d CMPQAX, $1</span><br><span class="line">0x0031 JEQ$0, 66</span><br><span class="line">0x0033 CMPQAX, $2</span><br><span class="line">0x0037 JEQ$0, 65</span><br><span class="line">0x0039 CMPQAX, $3</span><br><span class="line">0x003d JNE64</span><br><span class="line">0x003f RET</span><br><span class="line">0x0040 RET</span><br><span class="line">0x0041 RET</span><br><span class="line">0x0042 RET</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„å·®å¼‚, æ‰€æœ‰å››ä¸ªå¯¹è±¡åˆå§‹åŒ–å’Œ DUFFCOPY è¿™äº›ä¸œè¥¿æ¶ˆå¤±(ç”šè‡³å¯¹äºè¿™ä¸ªå¾®ä¸è¶³é“çš„æƒ…å†µ)äº†. å®ƒå°†å‡½æ•°çš„å¤§å°ä» 243 å‡å°åˆ° 67 å­—èŠ‚. å¦å¤–ä½œä¸ºä¸€ä¸ªé¢å¤–çš„å¥½å¤„, ä½ å°†çœå»ä¸€äº› CPU å‘¨æœŸé€€å‡º, å› ä¸ºä¸éœ€è¦åšä»»ä½•äº‹æƒ…æ¥è®¾ç½®è¿”å›å€¼.</p><p>è¯·æ³¨æ„, å¦‚æœæ‚¨ä¸å–œæ¬¢æˆ–åå¥½ Golang æä¾›çš„è£¸è¿”å›, åˆ™å¯ä»¥ä½¿ç”¨ return oi, åŒæ—¶è¿˜å¯ä»¥è·å¾—ç›¸åŒçš„å¥½å¤„, å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> i == <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> oi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="minio-æœåŠ¡å™¨ä¸­çœŸå®ä¸–ç•Œçš„ä¾‹å­"><a href="#minio-æœåŠ¡å™¨ä¸­çœŸå®ä¸–ç•Œçš„ä¾‹å­" class="headerlink" title="minio æœåŠ¡å™¨ä¸­çœŸå®ä¸–ç•Œçš„ä¾‹å­"></a>minio æœåŠ¡å™¨ä¸­çœŸå®ä¸–ç•Œçš„ä¾‹å­</h3><p>æˆ‘ä»¬æ‹¿ minio server çš„ä¾‹å­æ›´è¿›ä¸€æ­¥:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// parse credentialHeader string into its structured form.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">parseCredentialHeader</span><span class="params">(credElement <span class="keyword">string</span>)</span> <span class="title">credentialHeader</span></span> &#123;</span><br><span class="line">creds := strings.Split(strings.TrimSpace(credElement), <span class="string">"="</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(creds) != <span class="number">2</span> &#123;</span><br><span class="line"><span class="keyword">return</span> credentialHeader&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> creds[<span class="number">0</span>] != <span class="string">"Credential"</span> &#123;</span><br><span class="line"><span class="keyword">return</span> credentialHeader&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">credElements := strings.Split(strings.TrimSpace(creds[<span class="number">1</span>]), <span class="string">"/"</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(credElements) != <span class="number">5</span> &#123;</span><br><span class="line"><span class="keyword">return</span> credentialHeader&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> <span class="literal">false</span> <span class="comment">/*!isAccessKeyValid(credElements[0])*/</span> &#123;</span><br><span class="line"><span class="keyword">return</span> credentialHeader&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Save access key id.</span></span><br><span class="line">cred := credentialHeader&#123;</span><br><span class="line">accessKey: credElements[<span class="number">0</span>],</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> e error</span><br><span class="line">cred.scope.date, e = time.Parse(yyyymmdd, credElements[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">if</span> e != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> credentialHeader&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">cred.scope.region = credElements[<span class="number">2</span>]</span><br><span class="line"><span class="keyword">if</span> credElements[<span class="number">3</span>] != <span class="string">"s3"</span> &#123;</span><br><span class="line"><span class="keyword">return</span> credentialHeader&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">cred.scope.service = credElements[<span class="number">3</span>]</span><br><span class="line"><span class="keyword">if</span> credElements[<span class="number">4</span>] != <span class="string">"aws4_request"</span> &#123;</span><br><span class="line"><span class="keyword">return</span> credentialHeader&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">cred.scope.request = credElements[<span class="number">4</span>]</span><br><span class="line"><span class="keyword">return</span> cred</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ·±å…¥æ±‡ç¼–æˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹çš„å‡½æ•°å¤´:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&quot;.parseCredentialHeader t=1 size=1157 args=0x68 locals=0xb8</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬ä¿®æ”¹ä»£ç æ¥ä½¿ç”¨ä¸€ä¸ªå‘½åè¿”å›å‚æ•°(ä¸‹é¢çš„ç¬¬äºŒä¸ªæºä»£ç å—), è¯·æ£€æŸ¥å‡½æ•°çš„å¤§å°:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&quot;.parseCredentialHeader t=1 size=863 args=0x68 locals=0xb8</span><br></pre></td></tr></table></figure><p>å®ƒä»æ€»å…± 1150 ä¸ªå­—èŠ‚ä¸­åˆ é™¤äº† 300 ä¸ªå­—èŠ‚, è¿™å¯¹äºæºä»£ç è¿™æ ·ä¸€ä¸ªæœ€å°çš„æ”¹å˜è¿˜ä¸é”™. å–å†³äºä½ ä»å“ªé‡Œæ¥ï¼Œä½ ä¹Ÿå¯èƒ½æ›´å–œæ¬¢æºä»£ç çš„æ›´å¹²å‡€çš„å¤–è§‚:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// parse credentialHeader string into its structured form.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">parseCredentialHeader</span><span class="params">(credElement <span class="keyword">string</span>)</span> <span class="params">(ch credentialHeader)</span></span> &#123;</span><br><span class="line">creds := strings.Split(strings.TrimSpace(credElement), <span class="string">"="</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(creds) != <span class="number">2</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> creds[<span class="number">0</span>] != <span class="string">"Credential"</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">credElements := strings.Split(strings.TrimSpace(creds[<span class="number">1</span>]), <span class="string">"/"</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(credElements) != <span class="number">5</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> <span class="literal">false</span> <span class="comment">/*!isAccessKeyValid(credElements[0])*/</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Save access key id.</span></span><br><span class="line">cred := credentialHeader&#123;</span><br><span class="line">accessKey: credElements[<span class="number">0</span>],</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> e error</span><br><span class="line">cred.scope.date, e = time.Parse(yyyymmdd, credElements[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">if</span> e != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">cred.scope.region = credElements[<span class="number">2</span>]</span><br><span class="line"><span class="keyword">if</span> credElements[<span class="number">3</span>] != <span class="string">"s3"</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">cred.scope.service = credElements[<span class="number">3</span>]</span><br><span class="line"><span class="keyword">if</span> credElements[<span class="number">4</span>] != <span class="string">"aws4_request"</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">cred.scope.request = credElements[<span class="number">4</span>]</span><br><span class="line"><span class="keyword">return</span> cred</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„, å®é™…ä¸Š ch å˜é‡æ˜¯ä¸€ä¸ªæ­£å¸¸çš„å±€éƒ¨å˜é‡, å°±åƒåœ¨å‡½æ•°ä¸­å®šä¹‰çš„ä»»ä½•å…¶ä»–å±€éƒ¨å˜é‡ä¸€æ ·. å› æ­¤, æ‚¨å¯ä»¥å°†å…¶å€¼ä»é»˜è®¤çš„â€™é›¶â€™çŠ¶æ€æ›´æ”¹(å½“ç„¶, ä¿®æ”¹åçš„ç‰ˆæœ¬å°†åœ¨é€€å‡ºæ—¶è¿”å›).</p><h3 id="å‘½åè¿”å›å€¼çš„å…¶ä»–ç”¨æ³•"><a href="#å‘½åè¿”å›å€¼çš„å…¶ä»–ç”¨æ³•" class="headerlink" title="å‘½åè¿”å›å€¼çš„å…¶ä»–ç”¨æ³•"></a>å‘½åè¿”å›å€¼çš„å…¶ä»–ç”¨æ³•</h3><p>æ­£å¦‚å‡ ä½äººå£«æŒ‡å‡ºçš„é‚£æ ·, æŒ‡å®šè¿”å›å€¼çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥åœ¨é—­åŒ…ä¸­ä½¿ç”¨(å³ defer è¯­å¥). å› æ­¤, å¯ä»¥åœ¨ä½œä¸º defer è¯­å¥çš„ç»“æœè°ƒç”¨çš„å‡½æ•°ä¸­è®¿é—®æŒ‡å®šçš„è¿”å›å€¼, å¹¶ç›¸åº”åœ°è¿›è¡Œæ“ä½œ.</p><h3 id="å…³äºè¿™ä¸ªç³»åˆ—"><a href="#å…³äºè¿™ä¸ªç³»åˆ—" class="headerlink" title="å…³äºè¿™ä¸ªç³»åˆ—"></a>å…³äºè¿™ä¸ªç³»åˆ—</h3><p>å¦‚æœä½ é”™è¿‡äº†æœ¬ç³»åˆ—çš„ç¬¬ä¸€éƒ¨åˆ†, è¿™é‡Œæ˜¯ä¸€ä¸ªé“¾æ¥:</p><ul><li>å…³äº <a href="https://blog.minio.io/golang-internals-part-1-autogenerated-functions-and-how-to-get-rid-of-them-6ca4749cc236" target="_blank" rel="noopener">autogenerated</a> å‡½æ•°</li></ul><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>æ‰€ä»¥æˆ‘ä»¬å°†é€æ¸é‡‡ç”¨å‘½åçš„è¿”å›å€¼, æ— è®ºæ˜¯æ–°ä»£ç è¿˜æ˜¯ç°æœ‰ä»£ç .</p><p>äº‹å®ä¸Š, æˆ‘ä»¬ä¹Ÿåœ¨ç ”ç©¶æ˜¯å¦å¯ä»¥å¼€å‘ä¸€äº›å°å·¥å…·æ¥å¸®åŠ©æˆ–è‡ªåŠ¨åŒ–è¿™ä¸ªè¿‡ç¨‹. æŒ‰ç…§ gofmt çš„æ€è·¯æ€è€ƒ, ç„¶åè‡ªåŠ¨ä¿®æ”¹æºä»£ç ä»¥è¿›è¡Œä¸Šé¢æ‰€è¿°çš„æ›´æ”¹. ç‰¹åˆ«æ˜¯åœ¨è¿”å›å€¼è¿˜æ²¡æœ‰è¢«å‘½åçš„æƒ…å†µä¸‹(å› æ­¤å®ç”¨ç¨‹åºå¿…é¡»ç»™å®ƒä¸€ä¸ªåå­—), è¿™ä¸ªè¿”å›å˜é‡åœ¨ç°æœ‰çš„æºä»£ç ä¸­ä»¥ä»»ä½•æ–¹å¼æ”¹å˜éƒ½æ˜¯ä¸å¯èƒ½çš„, ch (åœ¨ä¸Šé¢åˆ—è¡¨çš„æƒ…å†µä¸‹)ä¸ä¼šå¯¼è‡´ç¨‹åºçš„ä»»ä½•åŠŸèƒ½å˜åŒ–.</p><p>æ‰€ä»¥è¯·ç»§ç»­å…³æ³¨.</p><p>æˆ‘ä»¬å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©, å¹¶æä¾›ä¸€äº›å…³äº Go å¦‚ä½•åœ¨å†…éƒ¨è¿è¡Œä»¥åŠå¦‚ä½•æ”¹è¿› Golang ä»£ç çš„æ–°è§è§£.</p><h3 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h3><p>å·²ç»æœ‰ä¸€ä¸ª Golang <a href="https://github.com/golang/go/issues/20859" target="_blank" rel="noopener">issue</a> æ¥ä¼˜åŒ–ç¼–è¯‘å™¨ä¸ºä¸Šè¿°æƒ…å†µç”Ÿæˆç›¸åŒçš„ä»£ç , è¿™å°†æ˜¯ä¸€ä»¶å¥½äº‹.</p>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Go æ²¡æœ‰ä¼ å¼•ç”¨</title>
      <link href="/post/there-is-no-pass-by-reference-in-go.html"/>
      <url>/post/there-is-no-pass-by-reference-in-go.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ª(<a href="https://dave.cheney.net/2017/04/29/there-is-no-pass-by-reference-in-go" target="_blank" rel="noopener">Go æ²¡æœ‰ä¼ å¼•ç”¨</a>)ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰.<br><a id="more"></a></p><p>è¦æ¸…æ¥šçš„æ˜¯, Go æ²¡æœ‰å¼•ç”¨å˜é‡, æ‰€ä»¥ Go æ²¡æœ‰ä¼ é€’å¼•ç”¨å‡½æ•°çš„è°ƒç”¨è¯­ä¹‰.</p><h3 id="ä»€ä¹ˆæ˜¯å¼•ç”¨å˜é‡-reference-variable"><a href="#ä»€ä¹ˆæ˜¯å¼•ç”¨å˜é‡-reference-variable" class="headerlink" title="ä»€ä¹ˆæ˜¯å¼•ç”¨å˜é‡(reference variable) ?"></a>ä»€ä¹ˆæ˜¯å¼•ç”¨å˜é‡(reference variable) ?</h3><p>åœ¨åƒ C++ è¿™æ ·çš„è¯­è¨€ä¸­, ä½ å¯ä»¥å£°æ˜ä¸€ä¸ªåˆ«å, æˆ–è€…ä¸€ä¸ªç°æœ‰å˜é‡çš„æ›¿ä»£åç§°. è¿™è¢«ç§°ä¸ºå¼•ç”¨å˜é‡.</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">int</span> &amp;b = a;</span><br><span class="line">        <span class="keyword">int</span> &amp;c = b;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%p %p %p\n"</span>, &amp;a, &amp;b, &amp;c); <span class="comment">// 0x7ffe114f0b14 0x7ffe114f0b14 0x7ffe114f0b14</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥çœ‹åˆ° a, b å’Œ c éƒ½æŒ‡å‘ç›¸åŒçš„å†…å­˜ä½ç½®. å†™å…¥ a ä¼šæ”¹å˜ b å’Œ c çš„å†…å®¹. å½“ä½ æƒ³åœ¨å‡½æ•°è°ƒç”¨ä¸åŒçš„ä½œç”¨åŸŸå£°æ˜å¼•ç”¨å˜é‡æ—¶, è¿™æ˜¯å¾ˆæœ‰ç”¨çš„.</p><h3 id="Go-æ²¡æœ‰å¼•ç”¨å˜é‡"><a href="#Go-æ²¡æœ‰å¼•ç”¨å˜é‡" class="headerlink" title="Go æ²¡æœ‰å¼•ç”¨å˜é‡"></a>Go æ²¡æœ‰å¼•ç”¨å˜é‡</h3><p>ä¸ C++ ä¸åŒ, Go ç¨‹åºä¸­å®šä¹‰çš„æ¯ä¸ªå˜é‡éƒ½å ç”¨ä¸€ä¸ªå”¯ä¸€çš„å†…å­˜ä½ç½®.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">var</span> a, b, c <span class="keyword">int</span></span><br><span class="line">        fmt.Println(&amp;a, &amp;b, &amp;c) <span class="comment">// 0x1040a124 0x1040a128 0x1040a12c</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªä¸¤ä¸ªå˜é‡åœ¨å†…å­˜ä¸­å…±äº«ç›¸åŒçš„å­˜å‚¨ä½ç½®çš„ Go ç¨‹åºæ˜¯ä¸å¯èƒ½çš„. å¯ä»¥åˆ›å»ºä¸¤ä¸ªå˜é‡, å…¶å†…å®¹æŒ‡å‘ç›¸åŒçš„å­˜å‚¨ä½ç½®, ä½†ä¸å…±äº«ç›¸åŒå­˜å‚¨ä½ç½®çš„ä¸¤ä¸ªå˜é‡ä¸åŒ.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">var</span> a <span class="keyword">int</span></span><br><span class="line">        <span class="keyword">var</span> b, c = &amp;a, &amp;a</span><br><span class="line">        fmt.Println(b, c)   <span class="comment">// 0x1040a124 0x1040a124</span></span><br><span class="line">        fmt.Println(&amp;b, &amp;c) <span class="comment">// 0x1040c108 0x1040c110</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, b å’Œ c ä¿æŒç›¸åŒçš„å€¼, å³ a çš„åœ°å€. ä½†æ˜¯, b å’Œ c æœ¬èº«å­˜å‚¨åœ¨ä¸åŒçš„ä½ç½®. æ›´æ–° b çš„å†…å®¹å¯¹ c æ²¡æœ‰å½±å“.</p><h3 id="ä½†æ˜¯-map-å’Œ-channel-æ˜¯å¼•ç”¨å—"><a href="#ä½†æ˜¯-map-å’Œ-channel-æ˜¯å¼•ç”¨å—" class="headerlink" title="ä½†æ˜¯ map å’Œ channel æ˜¯å¼•ç”¨å— ?"></a>ä½†æ˜¯ map å’Œ channel æ˜¯å¼•ç”¨å— ?</h3><p>é”™, map å’Œ channel ä¸æ˜¯å¼•ç”¨. å¦‚æœä»–ä»¬æ˜¯, é‚£ä¹ˆä¸‹é¢è¿™ä¸ªç¨‹åºå°†æ‰“å° false .</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span><span class="params">(m <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">        m = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">var</span> m <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span></span><br><span class="line">        fn(m)</span><br><span class="line">        fmt.Println(m == <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœmap m æ˜¯ä¸€ä¸ª C++ é£æ ¼çš„å¼•ç”¨å˜é‡, åˆ™åœ¨ main ä¸­å£°æ˜çš„ m å’Œ åœ¨ fn ä¸­å£°æ˜çš„ m å°†åœ¨å†…å­˜ä¸­å æ®ç›¸åŒçš„å­˜å‚¨ä½ç½®. ä½†æ˜¯, å› ä¸ºå¯¹ fn å†…çš„ m çš„èµ‹å€¼å¯¹ m çš„å€¼æ²¡æœ‰å½±å“, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ° m ä¸æ˜¯å¼•ç”¨å˜é‡.</p><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>Go æ²¡æœ‰ä¼ é€’å¼•ç”¨è¯­ä¹‰, å› ä¸º Go æ²¡æœ‰å¼•ç”¨å˜é‡.</p>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä¸ºä»€ä¹ˆ Go ä¸å®ç°åˆ†ä»£å’Œç´§å‡‘ gc</title>
      <link href="/post/why-golang-garbage-collector-not-implement-generational-and-compact-gc.html"/>
      <url>/post/why-golang-garbage-collector-not-implement-generational-and-compact-gc.html</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ª Google è®ºå›(<a href="https://groups.google.com/forum/#!msg/golang-nuts/KJiyv2mV2pU/wdBUH1mHCAAJ" target="_blank" rel="noopener">golang-nuts</a>)ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰.</p><p>æœ‰äººåœ¨è®ºå›é‡Œé¢é—®: ä¸ºä»€ä¹ˆ Golang åƒåœ¾å›æ”¶å™¨ä¸å®ç°åˆ†ä»£å’Œç´§å‡‘ gc ?<br><a id="more"></a></p><p>Ian Lance Taylor çš„å›å¤:</p><p>è¿™å·²ç»åœ¨è¿‡å»è®¨è®ºè¿‡äº†.</p><p>å¿½ç•¥ç»†èŠ‚, ç´§å‡‘(compacting) GC çš„åŸºæœ¬ä¼˜ç‚¹æ˜¯:</p><ul><li>é¿å…ç¢ç‰‡, ä»¥åŠ;</li><li>å…è®¸ä½¿ç”¨ç®€å•è€Œæœ‰æ•ˆçš„å‡¹å‡¸åˆ†é…å™¨(bump allocator).</li></ul><p>ä½†æ˜¯, ç°ä»£çš„å†…å­˜åˆ†é…ç®—æ³•, è±¡ Go è¿è¡Œæ—¶ä½¿ç”¨çš„åŸºäº tcmalloc çš„æ–¹æ¡ˆåŸºæœ¬ä¸Šæ²¡æœ‰ç¢ç‰‡é—®é¢˜. è€Œå‡¹å‡¸åˆ†é…å™¨å¯¹äº Go è¿™æ ·éœ€è¦é”çš„å¤šçº¿ç¨‹ç¨‹åºä¸­çš„å•çº¿ç¨‹ç¨‹åºæ˜¯ç®€å•æœ‰æ•ˆçš„. ä¸€èˆ¬æ¥è¯´, è¿™å¯èƒ½æ›´å¤šæœ‰æ•ˆåœ°ä½¿ç”¨ä¸€ç»„æ¯ä¸ªçº¿ç¨‹ç¼“å­˜æ¥åˆ†é…å†…å­˜, è€Œåœ¨è¿™ä¸€ç‚¹ä¸Šä½ å·²ç»å¤±å»äº†å‡¹å‡¸åˆ†é…å™¨çš„ä¼˜åŠ¿. æ‰€ä»¥æˆ‘ä¼šæ–­è¨€, ä¸€èˆ¬æ¥è¯´æœ‰å¾ˆå¤šæ³¨æ„äº‹é¡¹å¯¼è‡´ä»Šå¤©æ²¡æœ‰çœŸæ­£çš„ä¼˜åŠ¿ä¸ºä¸€ä¸ªå¤šçº¿ç¨‹ç¨‹åºä½¿ç”¨å‹ç¼©å†…å­˜åˆ†é…å™¨. æˆ‘ä¸æ˜¯è¯´ä½¿ç”¨å‹ç¼©åˆ†é…å™¨æœ‰ä»€ä¹ˆé—®é¢˜, æˆ‘åªæ˜¯è®¤ä¸ºå®ƒç›¸å¯¹äºéå‹ç¼©çš„æ¥è¯´æ²¡æœ‰å¸¦æ¥ä»»ä½•å¤§çš„ä¼˜åŠ¿.</p><p>ç°åœ¨æˆ‘ä»¬æ¥è€ƒè™‘ä¸€ä¸‹åˆ†ä»£ GC. åˆ†ä»£ GC çš„å…³é”®ä¾èµ–äºä¸–ä»£çš„å‡è®¾: åˆ†é…åœ¨ä¸€ä¸ªç¨‹åºä¸­çš„å¤§éƒ¨åˆ†å€¼å¾ˆå¿«å˜å¾—ä¸ä¼šç”¨åˆ°, æ‰€ä»¥åˆ†ä»£ GC æœ‰ä¸€ä¸ªä¼˜åŠ¿å°±æ˜¯å¯ä»¥èŠ±æ›´å¤šçš„æ—¶é—´æŸ¥çœ‹æœ€è¿‘åˆ†é…çš„å¯¹è±¡. è¿™é‡Œ Go ä¸åŒäºè®¸å¤šåƒåœ¾æ”¶é›†è¯­è¨€, å› ä¸ºè®¸å¤šå¯¹è±¡æ˜¯ç›´æ¥åœ¨ç¨‹åºæ ˆ(stack)ä¸Šåˆ†é…çš„. Go ç¼–è¯‘å™¨ä½¿ç”¨é€ƒé€¸åˆ†æ(escape analysis)æ¥æŸ¥æ‰¾é‚£äº›åœ¨ç¼–è¯‘æ—¶ç”Ÿå‘½å‘¨æœŸå°±å·²çŸ¥çš„å¯¹è±¡, å°†å®ƒä»¬åˆ†é…åˆ°å †æ ˆè€Œä¸æ˜¯åƒåœ¾æ”¶é›†çš„å†…å­˜ä¸­. æ‰€ä»¥ä¸€èˆ¬æ¥è¯´, åœ¨ Go ä¸­, ä¸å…¶ä»–è¯­è¨€ç›¸æ¯”, æœ‰å¾ˆå¤§æ¯”ä¾‹çš„åˆ†ä»£ GC è¦æ‰¾çš„å¾ˆå¿«ä¸ä¼šç”¨åˆ°çš„(quickly-unused)å€¼ä¸ä¼šåˆ†é…åœ¨ GC å†…å­˜çš„é¦–è¦ä½ç½®. æ‰€ä»¥åˆ†ä»£ GC èƒ½ç»™ Go å¸¦æ¥çš„ä¼˜åŠ¿ç›¸å¯¹äºå…¶ä»–è¯­è¨€è¦å°.</p><p>æ›´å¾®å¦™çš„æ˜¯, å¤§å¤šæ•°ä¸–ä»£ GC å®ç°çš„éšè—ç‚¹æ˜¯å‡å°‘åƒåœ¾æ”¶é›†å¸¦æ¥çš„ç¨‹åºæš‚åœçš„æ—¶é—´. æš‚åœæœŸé—´åªçœ‹æœ€å¹´è½»çš„ä¸€ä»£, æš‚åœæ—¶é—´å¾ˆçŸ­. ç„¶è€Œ, Go ä½¿ç”¨äº†ä¸€ä¸ªå¹¶å‘åƒåœ¾æ”¶é›†å™¨, å¹¶ä¸”åœ¨ Go ä¸­ç¨‹åºæš‚åœæ—¶é—´ä¸å¹´è½»ä»£æˆ–è€…ä»»æ„ä»£çš„å¤§å°æ— å…³. Go åŸºæœ¬ä¸Šå‡è®¾, åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­, é€šè¿‡åœ¨ä¸åŒçš„æ ¸ä¸Šå¹¶è¡Œè¿è¡Œ GC, ä¸æ˜¯ä¸ºäº†æœ€å°åŒ– GC æ—¶é—´å»æš‚åœå¯¼è‡´ç¨‹åºè¿è¡Œæ›´é•¿çš„æ—¶é—´, è€Œæ˜¯æ€»ä½“ä¸ŠèŠ±æ›´å¤šçš„æ€» CPU æ—¶é—´åœ¨ GC ä¸Š.</p><p>æ€»ä¹‹, åˆ†ä»£ GC å¯èƒ½ä»ç„¶å¯ä»¥ä¸º Go å¸¦æ¥æ˜¾è‘—çš„ä»·å€¼, å³å‡å°‘å¹¶è¡Œ GC æ—¶çš„å·¥ä½œé‡. è¿™æ˜¯ä¸€ä¸ªéœ€è¦æµ‹è¯•çš„å‡è®¾. Go å½“å‰çš„ GC å·¥ä½œå®é™…ä¸Šæ­£åœ¨å¯†åˆ‡å…³æ³¨ä¸€ä¸ªç›¸å…³ä½†ä¸åŒçš„å‡è®¾: Go ç¨‹åºå¯èƒ½å€¾å‘äºæŒ‰è¯·æ±‚åˆ†é…å†…å­˜. <a href="https://docs.google.com/document/d/1gCsFxXamW8RRvOe5hECz98Ftk-tcRRJcDFANj2VwCB0/view" target="_blank" rel="noopener">è¿™é‡Œ</a>æœ‰ä¸€ä¸ªæè¿°. è¿™é¡¹å·¥ä½œæ­£åœ¨è¿›è¡Œä¸­, ç°å®æƒ…å†µæ˜¯å¦æœ‰åˆ©è¿˜æœ‰å¾…è§‚å¯Ÿ.</p>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> go </tag>
            
            <tag> gc </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Go Range å¾ªç¯å†…å¹•</title>
      <link href="/post/go-range-loop-internals.html"/>
      <url>/post/go-range-loop-internals.html</url>
      <content type="html"><![CDATA[<p><a href="https://garbagecollected.org/2017/02/22/go-range-loop-internals/" target="_blank" rel="noopener">è¯‘æ–‡</a>ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰.</p><p>è™½ç„¶ä»–ä»¬éå¸¸æ–¹ä¾¿, ä½†æˆ‘æ€»æ˜¯å‘ç° Go çš„ Range å¾ªç¯æœ‰ç‚¹ç¥ç§˜. æˆ‘å¹¶ä¸æ˜¯ç¬¬ä¸€ä¸ª:<br><a id="more"></a></p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// http://bit.ly/2CXC1Ob æ¥è‡ª Dave Cheney.</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">v := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> v &#123;</span><br><span class="line">v = <span class="built_in">append</span>(v, i)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘å¯ä»¥æŠŠè¿™äº›äº‹å®è®°å½•ä¸‹æ¥, ä½†æ˜¯æˆ‘å¾ˆå¯èƒ½ä¼šå¿˜è®°. ä¸ºäº†æœ‰æ›´å¥½çš„æœºä¼šè®°ä½è¿™ä¸ª, æˆ‘éœ€è¦æ‰¾å‡ºä¸ºä»€ä¹ˆ range å¾ªç¯ä¼šè¿™æ ·. æ‰€ä»¥æˆ‘å†™äº†è¿™ç¯‡æ–‡ç« .</p><h2 id="Step-1-è¯»æ‰‹å†Œ-RTFM"><a href="#Step-1-è¯»æ‰‹å†Œ-RTFM" class="headerlink" title="Step 1: è¯»æ‰‹å†Œ(RTFM)"></a>Step 1: è¯»æ‰‹å†Œ(RTFM)</h2><p>æˆ‘ä»¬é¦–å…ˆåº”è¯¥å»è¯» range å¾ªç¯æ–‡æ¡£. Goè¯­è¨€è§„èŒƒæ–‡æ¡£åœ¨ <a href="https://golang.org/ref/spec#For_statements" target="_blank" rel="noopener">for è¯­å¥</a>éƒ¨åˆ†çš„ <em>For è¯­å¥å’Œ range å­å¥</em>æè¿°äº† range å¾ªç¯. æˆ‘ä¸ä¼šåœ¨è¿™é‡Œå¤åˆ¶æ•´ä¸ªè§„èŒƒï¼Œæˆ‘ä¼šæ€»ç»“ä¸€äº›æœ‰è¶£çš„éƒ¨åˆ†.</p><p>é¦–å…ˆ, è®©æˆ‘ä»¬æé†’è‡ªå·±æˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°ä»€ä¹ˆ:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> a &#123;</span><br><span class="line">fmt.Println(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Range-å˜é‡"><a href="#Range-å˜é‡" class="headerlink" title="Range å˜é‡"></a>Range å˜é‡</h3><p>ä½ ä»¬ä¸­çš„å¤§å¤šæ•°äººä¼šçŸ¥é“, åœ¨ Range å­å¥çš„å·¦è¾¹(ä¸Šé¢çš„ä¾‹å­ä¸­çš„ i), ä½ å¯ä»¥è¿™æ ·åˆ†é…å¾ªç¯å˜é‡:</p><ul><li>åˆ†é… (=)</li><li>çŸ­å˜é‡å£°æ˜ (:=)</li></ul><p>æ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©å®Œå…¨å¿½ç•¥å¾ªç¯å˜é‡.</p><p>å¦‚æœä½¿ç”¨çŸ­å˜é‡å£°æ˜æ ·å¼åˆ†é…(:=), åˆ™ Go å°†åœ¨å¾ªç¯çš„æ¯ä¸ªè¿­ä»£ä¸­é‡ç”¨å˜é‡(ä»…åœ¨å¾ªç¯å†…çš„èŒƒå›´å†…).</p><h3 id="Range-è¡¨è¾¾å¼"><a href="#Range-è¡¨è¾¾å¼" class="headerlink" title="Range è¡¨è¾¾å¼"></a>Range è¡¨è¾¾å¼</h3><p>åœ¨ Range å­å¥çš„å³è¾¹(ä¸Šé¢çš„ä¾‹å­ä¸­çš„ a), ä½ å¯ä»¥æ‰¾åˆ°ä»–ä»¬ç§°ä¹‹ä¸º Range è¡¨è¾¾å¼çš„ä¸œè¥¿. å®ƒå¯ä»¥åŒ…å«ä»»ä½•è¡¨è¾¾å¼, å…¶è®¡ç®—ç»“æœå¦‚ä¸‹:</p><ul><li>æ•°ç»„(array)</li><li>æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆ</li><li>åˆ‡ç‰‡(slice)</li><li>å­—ç¬¦ä¸²(string)</li><li>å­—å…¸(map)</li><li>å…è®¸æ¥æ”¶çš„ç®¡é“(channel), å¦‚: chan int æˆ–è€… chan&lt;- int</li></ul><p><strong>Range è¡¨è¾¾å¼åœ¨å¼€å§‹å¾ªç¯ä¹‹å‰åªè®¡ç®—ä¸€æ¬¡</strong>. è¯·æ³¨æ„, è¿™ä¸ªè§„åˆ™æœ‰ä¸€ä¸ªä¾‹å¤–: å¦‚æœ Range ä¸€ä¸ªæ•°ç»„(æˆ–æŒ‡å‘å®ƒçš„æŒ‡é’ˆ), ä½ åªèƒ½åˆ†é…ç´¢å¼•ï¼šé‚£ä¹ˆåªæœ‰ len(a) è¢«è®¡ç®—. ä»…è®¡ç®— len(a) æ„å‘³ç€å¯ä»¥åœ¨ç¼–è¯‘æ—¶è®¡ç®—è¡¨è¾¾å¼ a, å¹¶ç”±ç¼–è¯‘å™¨ç”¨å¸¸é‡æ›¿æ¢. <a href="https://golang.org/ref/spec#Length_and_capacity" target="_blank" rel="noopener">len å‡½æ•°è§„èŒƒ</a>è§£é‡Šå¦‚ä¸‹:</p><blockquote><p>å¦‚æœsçš„ç±»å‹æ˜¯æ•°ç»„æˆ–æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆå¹¶ä¸”è¡¨è¾¾å¼ s ä¸åŒ…å«é€šé“æ¥æ”¶(channel receives) æˆ–(é å¸¸é‡) å‡½æ•°è°ƒç”¨, åˆ™è¡¨è¾¾å¼ len(s) å’Œ cap(s) æ˜¯å¸¸é‡. åœ¨è¿™ç§æƒ…å†µä¸‹ s ä¸è¢«è®¡ç®—. å¦åˆ™, len å’Œ cap çš„è°ƒç”¨ä¸æ˜¯å¸¸é‡, è€Œæ˜¯è¢«è®¡ç®—.</p></blockquote><p>é‚£ä¹ˆ â€œè®¡ç®—(evaluated)â€ ç©¶ç«Ÿæ„å‘³ç€ä»€ä¹ˆå‘¢? ä¸å¹¸çš„æ˜¯æˆ‘ä¸èƒ½åœ¨è§„èŒƒä¸­æ‰¾åˆ°è¿™ä¸ªä¿¡æ¯. å½“ç„¶, æˆ‘å¯ä»¥çŒœæµ‹, è¿™æ„å‘³ç€å®Œå…¨æ‰§è¡Œè¡¨è¾¾å¼, ç›´åˆ°å®ƒä¸èƒ½è¿›ä¸€æ­¥å‡å°‘. åœ¨ä»»ä½•æƒ…å†µä¸‹, è¿™é‡Œçš„é«˜ä½æ˜¯ Range è¡¨è¾¾å¼åœ¨å¾ªç¯å¼€å§‹ä¹‹å‰è®¡ç®—ä¸€æ¬¡. ä½ å¦‚ä½•åªè¯„ä¼°ä¸€ä¸ªè¡¨è¾¾å¼ä»…ä¸€æ¬¡? é€šè¿‡å°†å…¶åˆ†é…ç»™ä¸€ä¸ªå˜é‡! è¿™å¯èƒ½æ˜¯è¿™é‡Œå‘ç”Ÿçš„äº‹æƒ…å—?</p><p>æœ‰è¶£çš„æ˜¯, è¿™ä¸ªè§„èŒƒæåˆ°äº†ä¸€äº›å…³äºä» map ä¸­æ·»åŠ å’Œåˆ é™¤çš„ç‰¹æ®Šçš„ä¸œè¥¿(æ²¡æœ‰æåˆ°åˆ‡ç‰‡):</p><blockquote><p>å¦‚æœåœ¨è¿­ä»£è¿‡ç¨‹ä¸­ç§»é™¤å°šæœªåˆ°è¾¾çš„ map é¡¹, åˆ™ä¸ä¼šç”Ÿæˆç›¸åº”çš„è¿­ä»£å€¼. å¦‚æœè¿­ä»£è¿‡ç¨‹ä¸­åˆ›å»º map é¡¹, é‚£ä¹ˆå¯èƒ½ä¼šåœ¨è¿­ä»£è¿‡ç¨‹ä¸­ç”Ÿæˆè¯¥é¡¹, æˆ–è€…å¯èƒ½ä¼šè·³è¿‡è¯¥é¡¹.</p></blockquote><p>æˆ‘ç¨åä¼šå›åˆ° map.</p><h2 id="Step-2-Range-æ”¯æŒçš„æ•°æ®ç±»å‹"><a href="#Step-2-Range-æ”¯æŒçš„æ•°æ®ç±»å‹" class="headerlink" title="Step 2: Range æ”¯æŒçš„æ•°æ®ç±»å‹"></a>Step 2: Range æ”¯æŒçš„æ•°æ®ç±»å‹</h2><p>å¦‚æœæˆ‘ä»¬å‡è®¾ Range è¡¨è¾¾å¼åœ¨å¾ªç¯å¼€å§‹ä¹‹å‰è¢«èµ‹å€¼äº†ä¸€æ¬¡, é‚£ä¹ˆè¿™æ˜¯ä»€ä¹ˆæ„æ€? ç­”æ¡ˆæ˜¯å®ƒå–å†³äºæ•°æ®ç±»å‹, æ‰€ä»¥è®©æˆ‘ä»¬ä»”ç»†çœ‹ä¸€ä¸‹ Range æ‰€æ”¯æŒçš„æ•°æ®ç±»å‹.</p><p>åœ¨æˆ‘ä»¬è¿™æ ·åšä¹‹å‰, è¯·è®°ä½è¿™ä¸€ç‚¹: <strong>åœ¨ Go ä¸­, æ‚¨åˆ†é…çš„æ‰€æœ‰ä¸œè¥¿éƒ½è¢«å¤åˆ¶</strong>. å¦‚æœæ‚¨åˆ†é…ä¸€ä¸ªæŒ‡é’ˆ, åˆ™å¤åˆ¶æŒ‡é’ˆ.å¦‚æœä½ åˆ†é…ä¸€ä¸ªç»“æ„ä½“, åˆ™å¤åˆ¶ç»“æ„.å°†å‚æ•°ä¼ é€’ç»™å‡½æ•°æ—¶ä¹Ÿæ˜¯å¦‚æ­¤. æ— è®ºå¦‚ä½•, è¿™é‡Œæ˜¯:</p><p>// TODO</p><p>è¯·å‚é˜…æœ¬æ–‡åº•éƒ¨çš„å‚è€ƒèµ„æ–™, äº†è§£æ›´å¤šå…³äºè¿™äº›æ•°æ®ç±»å‹çš„å†…éƒ¨ç»“æ„.</p><p>é‚£ä¹ˆè¿™æ˜¯ä»€ä¹ˆæ„æ€? è¿™äº›ä¾‹å­çªå‡ºäº†ä¸€äº›å·®å¼‚:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// copies the entire array</span></span><br><span class="line"><span class="keyword">var</span> a [<span class="number">10</span>]<span class="keyword">int</span></span><br><span class="line">acopy := a</span><br><span class="line"></span><br><span class="line"><span class="comment">// copies the slice header struct only, NOT the backing array</span></span><br><span class="line">s := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line">scopy := s</span><br><span class="line"></span><br><span class="line"><span class="comment">// copies the map pointer only</span></span><br><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)</span><br><span class="line">mcopy := m</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å¦‚æœåœ¨ä¸€ä¸ª Range å¾ªç¯çš„å¼€å§‹å¤„, ä½ å¯ä»¥å°†ä¸€ä¸ªæ•°ç»„è¡¨è¾¾å¼èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡(ä»¥ç¡®ä¿å®ƒåªèƒ½è®¡ç®—ä¸€æ¬¡), é‚£ä¹ˆä½ å°†å¤åˆ¶æ•´ä¸ªæ•°ç»„.</p><h2 id="Step-3-Go-ç¼–è¯‘å™¨æºç "><a href="#Step-3-Go-ç¼–è¯‘å™¨æºç " class="headerlink" title="Step 3: Go ç¼–è¯‘å™¨æºç "></a>Step 3: Go ç¼–è¯‘å™¨æºç </h2><p>(æœªå®Œå¾…ç»­)</p>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>2017 å·²é€</title>
      <link href="/post/2017-has-passed.html"/>
      <url>/post/2017-has-passed.html</url>
      <content type="html"><![CDATA[<h3 id="2017-çš„ç›®æ ‡å®ç°äº†å—"><a href="#2017-çš„ç›®æ ‡å®ç°äº†å—" class="headerlink" title="2017 çš„ç›®æ ‡å®ç°äº†å—"></a>2017 çš„ç›®æ ‡å®ç°äº†å—</h3><a id="more"></a><p>å…ˆå›é¡¾ä¸€ä¸‹ 2017 å¹´çš„ç›®æ ‡:</p><ul><li><p><em>Go</em> è¯­è¨€ç»§ç»­è¶æ‰‹</p></li><li><p><em>Kotlin</em> ä¿®ç‚¼, æå¸¦ <em>Java 8</em></p></li><li><p><em>Python 3.6</em> ç‰¹æ€§åŠ æŒ</p></li><li><p><em>OCaml</em> æŠŠç©</p></li></ul><p>é™¤äº† Go è¯­è¨€ç»§ç»­è¶æ‰‹, å…¶ä»–çš„çœŸçš„æ²¡æ‰€è°“äº†.</p><h3 id="ç°å®ä¼šç»™ä½ ä»¥æ•™è®­"><a href="#ç°å®ä¼šç»™ä½ ä»¥æ•™è®­" class="headerlink" title="ç°å®ä¼šç»™ä½ ä»¥æ•™è®­"></a>ç°å®ä¼šç»™ä½ ä»¥æ•™è®­</h3><p>2017 å¹´ä¸ç®¡å¯¹äºå·¥ä½œè¿˜æ˜¯ç”Ÿæ´»çœŸçš„è®©æˆ‘æ¶¨è§è¯†äº†;</p><ul><li><p>å¥½å¥½æ´»ç€;</p></li><li><p>èµ°å‡ºèˆ’é€‚åŒº;</p></li><li><p>é‡å¿ƒéœ€è¦æŠ€èƒ½åŒ¹é…;</p></li></ul><h3 id="2018-å¹´åšå¥½è‡ªå·±"><a href="#2018-å¹´åšå¥½è‡ªå·±" class="headerlink" title="2018 å¹´åšå¥½è‡ªå·±"></a>2018 å¹´åšå¥½è‡ªå·±</h3><ul><li><p>ç®€å•ä¸ä¼˜é›…æ­£äº¤, å†™æ¸…æ™°çš„ä»£ç , åšç®€å•çš„äº‹, Go ç»§ç»­è¶æ‰‹;</p></li><li><p>è®¤å‡†çš„äº‹æƒ…å°±å¹², ä¸éª„ä¸èº;</p></li><li><p>é€¼ä¸€ä¸‹è‡ªå·±;</p></li></ul>]]></content>
      
      
        <tags>
            
            <tag> note </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Go æœåŠ¡ä¼˜é›…é‡å¯</title>
      <link href="/post/golang-graceful-restart-server.html"/>
      <url>/post/golang-graceful-restart-server.html</url>
      <content type="html"><![CDATA[<p>å¾ˆå¤šæ—¶å€™å¯¹äºæœåŠ¡å‡çº§çš„åšæ³•ç®€å•ç²—æš´, å°±ç®€å•çš„æ€è¿›ç¨‹å¯åŠ¨æ–°çš„è¿›ç¨‹.<br><a id="more"></a></p><p>è¿˜æœ‰çš„å¥½ä¸€ç‚¹å°±æ˜¯å¤šä¸ªç›¸åŒçš„æœåŠ¡ä¾æ¬¡å‡çº§, ä¿è¯æœ‰æœåŠ¡å¯ç”¨. ä½†æ˜¯å…¬å¹³çš„è¯´è¿™ä¸¤ç§éƒ½ä¼šä¸¢å¤±è¯·æ±‚ä¸­çš„è¿æ¥. é‰´äºè¿™ç§æƒ…å†µ, åœ¨ç°å®ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¼˜é›…é‡å¯æ¥æå®šè¿™ä¸ªé—®é¢˜. Golang å®ç°ä¼˜é›…é‡å¯çš„åŸç†ä¹Ÿå¾ˆç®€å•:</p><ul><li><p>ç›‘å¬ USR2 ä¿¡å·;</p></li><li><p>æ”¶åˆ°ä¿¡å·åå°†æœåŠ¡ç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦ä¼ é€’ç»™æ–°çš„å­è¿›ç¨‹;</p></li><li><p>æ­¤æ—¶æ–°è€è¿›ç¨‹åŒæ—¶æ¥æ”¶è¯·æ±‚;</p></li><li><p>çˆ¶è¿›ç¨‹åœæ­¢æ¥æ”¶æ–°è¯·æ±‚, ç­‰å¾…æ—§è¯·æ±‚å®Œæˆ(æˆ–è¶…æ—¶);</p></li><li><p>çˆ¶è¿›ç¨‹é€€å‡º.</p></li></ul><p>å¯¹äºä¸Šé¢çš„åŸç†çœ‹ä¼¼ç®€å•, å…¶å®æ˜¯åˆ†æˆäº†ä¸¤ä¸ªå¤§çš„è¦ç‚¹:</p><ul><li><p>æ–°è€è¿›ç¨‹åŒæ—¶ç›‘å¬åŒä¸€ç«¯å£, è¿™ä¸ªå¾ˆç®€å•, Go å¾ˆæ—©å°±æ”¯æŒ;</p></li><li><p>å¦‚ä½•ç­‰å¾…æ—§çš„è¯·æ±‚å®Œæˆ, è¿™ä¸ªåœ¨ Go 1.8 (æ–°å¢äº†Server.Shutdown) ä¹‹å‰æ˜¯éœ€è¦è´¹ä¸€ç•ªåŠŸå¤«çš„.</p></li></ul><p>æˆ‘ä»¬æå®šäº†ä¸Šé¢çš„åŸç†ä¹‹å, åŠ ä¸Š Go 1.8 çš„å®Œç¾ç­‰å¾…æ—§è¯·æ±‚çš„å®ç°, æˆ‘å®ç°äº†ä¸€ä¸ªç®€å•çš„ä¼˜é›…é‡å¯åº“: <a href="https://github.com/douglarek/zerodown" target="_blank" rel="noopener">https://github.com/douglarek/zerodown</a>.</p><p>zerodown å®Œç¾å…¼å®¹åŸºäº Go æ ‡å‡†åº“ Server ç›‘å¬æœåŠ¡. å¯¹äºæ ‡å‡†åº“çš„ä½¿ç”¨, æˆ‘ä»¬å¯ä»¥è±¡ä¸‹é¢ä¸€æ ·ä½¿ç”¨:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"log"</span></span><br><span class="line"><span class="string">"net/http"</span></span><br><span class="line"><span class="string">"time"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"github.com/douglarek/zerodown"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">http.HandleFunc(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">time.Sleep(<span class="number">5</span> * time.Second)</span><br><span class="line">fmt.Fprintln(w, <span class="string">"Hello, World!"</span>)</span><br><span class="line">&#125;)</span><br><span class="line">log.Fatalln(zerodown.ListenAndServe(<span class="string">":8080"</span>, <span class="literal">nil</span>))</span><br></pre></td></tr></table></figure><p>å¯¹äºç¬¬ä¸‰æ–¹åº“ Gin æˆ‘ä»¬å¯ä»¥:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"log"</span></span><br><span class="line"><span class="string">"net/http"</span></span><br><span class="line"><span class="string">"time"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"github.com/douglarek/zerodown"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">router := gin.Default()</span><br><span class="line">router.GET(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">time.Sleep(<span class="number">5</span> * time.Second)</span><br><span class="line">c.String(http.StatusOK, <span class="string">"Hello, World!"</span>)</span><br><span class="line">&#125;)</span><br><span class="line">log.Fatalln(zerodown.ListenAndServe(<span class="string">":8080"</span>, router))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> go </tag>
            
            <tag> http </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Gin-Gonic æ¡†æ¶ä¸­é—´ä»¶åŸç†ä¸åº”ç”¨</title>
      <link href="/post/gin-gonic-middleware-theory-and-apply.html"/>
      <url>/post/gin-gonic-middleware-theory-and-apply.html</url>
      <content type="html"><![CDATA[<p>åœ¨ Go çš„ä¸–ç•Œé‡Œ, web æ¡†æ¶ç®€ç›´å¤šå¦‚ç‰›æ¯›.</p><p>å‰æœ‰è‡ªå¸¦ç”µæ± çš„æ ‡å‡†åº“(net/http), åæœ‰ç®€æ´ä¼˜é›…çš„ Gin-Gonic(ä»¥ä¸‹ç®€ç§° Gin), å†æœ‰å…¨æ ˆå¼€å‘ä¸€æèŠ± Beego, ç­‰ç­‰ä¸å¯èƒœæ•°.</p><p>ä½¿ç”¨ Go æœ‰ä¸€æ®µæ—¶é—´äº†, web å¼€å‘ä¸€ç›´ç”¨çš„ Gin. Gin çš„æ€æƒ³å’Œ Python æ¡†æ¶ Flask æœ‰é¢‡å¤šç›¸ä¼¼ä¹‹å¤„, å¯ä»¥ç§°ä½œ <em>å¾®æ¡†æ¶</em> .<br><a id="more"></a></p><p>Gin åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªä¸»è¦çš„éƒ¨åˆ†:</p><ul><li>è®¾è®¡ç²¾å·§çš„è·¯ç”±/ä¸­é—´ä»¶ç³»ç»Ÿ;</li><li>ç®€å•å¥½ç”¨çš„æ ¸å¿ƒä¸Šä¸‹æ–‡ Context;</li><li>é™„èµ å·¥å…·é›†(JSON/XML å“åº”, æ•°æ®ç»‘å®šä¸æ ¡éªŒç­‰).</li></ul><p>æœ¬æ–‡æ„åœ¨æ¢ç©¶ Gin ä¸­é—´ä»¶çš„æ‰§è¡ŒåŸç†. æˆ‘ä»¬å…ˆçœ‹å¦‚ä¸‹çš„ Hello World ç‰ˆ Gin ç¨‹åºï¼š</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"log"</span></span><br><span class="line"><span class="string">"net/http"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line"></span><br><span class="line">r.GET(<span class="string">"/ping"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.String(http.StatusOK, <span class="string">"%s"</span>, <span class="string">"pong!"</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err := r.Run(<span class="string">"0.0.0.0:8080"</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalln(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç®€å•çš„ Gin ç¨‹åºé»˜è®¤å¯ç”¨äº†ä¸¤ä¸ªä¸­é—´ä»¶, åˆ†åˆ«æ˜¯ Logger() å’Œ Recovery().æˆ‘ä»¬ä¹‹å‰è¯´è¿‡, Context æ˜¯ Gin çš„æ ¸å¿ƒ, å®ƒçš„æ„é€ å¦‚ä¸‹:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span> &#123;</span><br><span class="line">writermem responseWriter</span><br><span class="line">Request   *http.Request</span><br><span class="line">Writer    ResponseWriter</span><br><span class="line"></span><br><span class="line">Params   Params</span><br><span class="line">handlers HandlersChain</span><br><span class="line">index    <span class="keyword">int8</span></span><br><span class="line"></span><br><span class="line">engine   *Engine</span><br><span class="line">Keys     <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">Errors   errorMsgs</span><br><span class="line">Accepted []<span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ handlers æˆ‘ä»¬é€šè¿‡æºç å¯ä»¥çŸ¥é“å°±æ˜¯ []HandlerFunc. è€Œå®ƒçš„ç­¾åæ­£æ˜¯:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> HandlerFunc <span class="function"><span class="keyword">func</span><span class="params">(*Context)</span></span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ä¸­é—´ä»¶å’Œæˆ‘ä»¬æ™®é€šçš„ HandlerFunc æ²¡æœ‰ä»»ä½•åŒºåˆ«å¯¹å§, æˆ‘ä»¬æ€ä¹ˆå†™ HandlerFunc å°±å¯ä»¥æ€ä¹ˆå†™ä¸€ä¸ªä¸­é—´ä»¶. é‚£ä¹ˆé—®é¢˜æ¥äº†, æˆ‘ä»¬æ€ä¹ˆè§£å†³ä¸€ä¸ªè¯·æ±‚å’Œä¸€ä¸ªå“åº”ç»è¿‡æˆ‘ä»¬çš„ä¸­é—´ä»¶å‘¢? æˆ‘ä»¬æ¥å†™ä¸ªç®€å•çš„ä¸­é—´ä»¶åˆ†æä¸€ä¸‹:</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">r.Use(<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">log.Println(<span class="string">"Request in"</span>) <span class="comment">// â‘ </span></span><br><span class="line">c.Next() <span class="comment">// next handler func</span></span><br><span class="line">log.Println(<span class="string">"Response out"</span>) <span class="comment">// â‘¡</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç¥å¥‡çš„è¯­å¥å‡ºç°äº†, æ²¡é”™å°±æ˜¯ c.Next(), æ‰€æœ‰ä¸­é—´ä»¶éƒ½æœ‰ Request å’Œ Response çš„åˆ†æ°´å²­, å°±æ˜¯è¿™ä¸ª c.Next(), å¦åˆ™æ²¡æœ‰åŠæ³•ä¼ é€’ä¸­é—´ä»¶. æˆ‘ä»¬æ¥çœ‹æºç :</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">Next</span><span class="params">()</span></span> &#123;</span><br><span class="line">c.index++</span><br><span class="line">s := <span class="keyword">int8</span>(<span class="built_in">len</span>(c.handlers))</span><br><span class="line"><span class="keyword">for</span> ; c.index &lt; s; c.index++ &#123;</span><br><span class="line">c.handlers[c.index](c)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªè¯·æ±‚è¿‡æ¥, Gin ä¼šä¸»åŠ¨è°ƒç”¨ c.Next() ä¸€æ¬¡. å› ä¸º handlers æ˜¯ slice , æ‰€ä»¥åæ¥è€…ä¸­é—´ä»¶ä¼šè¿½åŠ åˆ°å°¾éƒ¨. è¿™æ ·å°±å½¢æˆäº†å½¢å¦‚ m1(m2(f())) çš„è°ƒç”¨é“¾. æ­£å¦‚ä¸Šé¢æ•°å­—â‘  â‘¡ æ ‡æ³¨çš„ä¸€æ ·, æˆ‘ä»¬ä¼šä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹çš„è°ƒç”¨:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">m1â‘  -&gt; m2â‘  -&gt; f -&gt; m2â‘¡ -&gt; m1â‘¡</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç”¨ä¸‹é¢ä¸€å¼ å›¾æ¥æ¥æ€»ç»“è¿™ç§å…³ç³»:</p><p><img src="/static/images/gin-middleware.png" alt="middleware stream"></p>]]></content>
      
      
        <tags>
            
            <tag> go </tag>
            
            <tag> gin </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>PostgreSQL 10 JSON å…¨æ–‡æ£€ç´¢</title>
      <link href="/post/postgresql-10-full-text-search-support-for-json-and-jsonb.html"/>
      <url>/post/postgresql-10-full-text-search-support-for-json-and-jsonb.html</url>
      <content type="html"><![CDATA[<p><a href="https://www.depesz.com/2017/04/04/waiting-for-postgresql-10-full-text-search-support-for-json-and-jsonb/" target="_blank" rel="noopener">è¯‘æ–‡</a>ç‰ˆæƒ@å½’åŸæ–‡æ‰€æœ‰.</p><p>è¿™æ˜¯å¯¹ JSON æ•°æ®çš„åˆä¸€ä¸ªå¾ˆé…·çš„è¡¥å……. ç°åœ¨æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æ·»åŠ  json å€¼çš„å…¨æ–‡æœç´¢.<br><a id="more"></a></p><p>ä¸€ä¸ªå®ƒå¦‚ä½•è¿ä½œçš„å¿«é€Ÿä¾‹å­:</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$ <span class="keyword">select</span> <span class="keyword">id</span>, jsonb_pretty(payload) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line">id |                                                jsonb_pretty</span><br><span class="line"><span class="comment">----+-------------------------------------------------------------------------------------------------------------</span></span><br><span class="line">  1 | &#123;                                                                                                          +</span><br><span class="line">    |     "glossary": &#123;                                                                                          +</span><br><span class="line">    |         "title": "example glossary",                                                                       +</span><br><span class="line">    |         "GlossDiv": &#123;                                                                                      +</span><br><span class="line">    |             "title": "S",                                                                                  +</span><br><span class="line">    |             "GlossList": &#123;                                                                                 +</span><br><span class="line">    |                 "GlossEntry": &#123;                                                                            +</span><br><span class="line">    |                     "ID": "SGML",                                                                          +</span><br><span class="line">    |                     "Abbrev": "ISO 8879:1986",                                                             +</span><br><span class="line">    |                     "SortAs": "SGML",                                                                      +</span><br><span class="line">    |                     "Acronym": "SGML",                                                                     +</span><br><span class="line">    |                     "GlossDef": &#123;                                                                          +</span><br><span class="line">    |                         "para": "A meta-markup language, used to <span class="keyword">create</span> markup languages such <span class="keyword">as</span> DocBook.<span class="string">",+</span></span><br><span class="line"><span class="string">    |                         "</span>GlossSeeAlso<span class="string">": [                                                                  +</span></span><br><span class="line"><span class="string">    |                             "</span>GML<span class="string">",                                                                         +</span></span><br><span class="line"><span class="string">    |                             "</span><span class="keyword">XML</span><span class="string">"                                                                          +</span></span><br><span class="line"><span class="string">    |                         ]                                                                                  +</span></span><br><span class="line"><span class="string">    |                     &#125;,                                                                                     +</span></span><br><span class="line"><span class="string">    |                     "</span>GlossSee<span class="string">": "</span>markup<span class="string">",                                                                  +</span></span><br><span class="line"><span class="string">    |                     "</span>GlossTerm<span class="string">": "</span>Standard Generalized Markup <span class="keyword">Language</span><span class="string">"                                    +</span></span><br><span class="line"><span class="string">    |                 &#125;                                                                                          +</span></span><br><span class="line"><span class="string">    |             &#125;                                                                                              +</span></span><br><span class="line"><span class="string">    |         &#125;                                                                                                  +</span></span><br><span class="line"><span class="string">    |     &#125;                                                                                                      +</span></span><br><span class="line"><span class="string">    | &#125;</span></span><br><span class="line"><span class="string">(1 row)</span></span><br></pre></td></tr></table></figure><p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„, æˆ‘æœ‰ä¸€ä¸ªç›¸å½“åµŒå¥—çš„ json ç»“æ„. ç°åœ¨æˆ‘ä»¬éœ€è¦ tsvector æ•°æ®æ¥æ„å»ºä¸€ä¸ªç´¢å¼•. æˆ‘ä»¬å¯ä»¥è¿™æ ·:</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$ <span class="keyword">select</span> to_tsvector(<span class="string">'english'</span>, payload) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line">                                  to_tsvector</span><br><span class="line"><span class="comment">--------------------------------------------------------------------------------</span></span><br><span class="line"> '1986':8 '8879':7 'creat':21 'docbook':26 'exampl':1 'general':35 'glossari':2.</span><br><span class="line">. 'gml':28 'iso':6 'languag':18,23,37 'markup':17,22,32,36 'meta':16 'meta-mark.</span><br><span class="line">.up':15 'sgml':4,10,12 'standard':34 '<span class="keyword">use</span><span class="string">':19 '</span><span class="keyword">xml</span><span class="string">':30</span></span><br><span class="line"><span class="string">(1 row)</span></span><br></pre></td></tr></table></figure><p>å¾ˆå¥½. å®ƒæ‰¾åˆ°äº† json æ•°æ®å€¼ä¸­çš„æ‰€æœ‰å•è¯(å®ƒæ²¡æœ‰ç´¢å¼•å¯¹è±¡çš„é”®).</p><p>è¿˜æœ‰ä¸ä¹‹åŒ¹é…çš„ ts_headline å‡½æ•°.</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$ <span class="keyword">select</span> jsonb_pretty(ts_headline(payload, <span class="string">'sgml'</span>::tsquery)) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line">                                                jsonb_pretty</span><br><span class="line"><span class="comment">-------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"> &#123;                                                                                                          +</span><br><span class="line">     "glossary": &#123;                                                                                          +</span><br><span class="line">         "title": "example glossary",                                                                       +</span><br><span class="line">         "GlossDiv": &#123;                                                                                      +</span><br><span class="line">             "title": "S",                                                                                  +</span><br><span class="line">             "GlossList": &#123;                                                                                 +</span><br><span class="line">                 "GlossEntry": &#123;                                                                            +</span><br><span class="line">                     "ID": "&lt;b&gt;SGML&lt;/b&gt;",                                                                   +</span><br><span class="line">                     "Abbrev": "ISO 8879:1986",                                                             +</span><br><span class="line">                     "SortAs": "&lt;b&gt;SGML&lt;/b&gt;",                                                               +</span><br><span class="line">                     "Acronym": "&lt;b&gt;SGML&lt;/b&gt;",                                                              +</span><br><span class="line">                     "GlossDef": &#123;                                                                          +</span><br><span class="line">                         "para": "A meta-markup language, used to <span class="keyword">create</span> markup languages such <span class="keyword">as</span> DocBook.<span class="string">",+</span></span><br><span class="line"><span class="string">                         "</span>GlossSeeAlso<span class="string">": [                                                                  +</span></span><br><span class="line"><span class="string">                             "</span>GML<span class="string">",                                                                         +</span></span><br><span class="line"><span class="string">                             "</span><span class="keyword">XML</span><span class="string">"                                                                          +</span></span><br><span class="line"><span class="string">                         ]                                                                                  +</span></span><br><span class="line"><span class="string">                     &#125;,                                                                                     +</span></span><br><span class="line"><span class="string">                     "</span>GlossSee<span class="string">": "</span>markup<span class="string">",                                                                  +</span></span><br><span class="line"><span class="string">                     "</span>GlossTerm<span class="string">": "</span>Standard Generalized Markup <span class="keyword">Language</span><span class="string">"                                    +</span></span><br><span class="line"><span class="string">                 &#125;                                                                                          +</span></span><br><span class="line"><span class="string">             &#125;                                                                                              +</span></span><br><span class="line"><span class="string">         &#125;                                                                                                  +</span></span><br><span class="line"><span class="string">     &#125;                                                                                                      +</span></span><br><span class="line"><span class="string"> &#125;</span></span><br><span class="line"><span class="string">(1 row)</span></span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ä¸Šé¢ SGML å­—ç¬¦ä¸²ä¸¤è¾¹çš„ <b>.</b></p><p>è®²çœŸ - æˆ‘è®¤ä¸º JSON è¢«åº”ç”¨ç¨‹åºå¼€å‘è€…æ»¥ç”¨äº†å¾ˆå¤š, ä½†æ˜¯è¿™ç»å¯¹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è¡¥å……, éå¸¸æ„Ÿè°¢ Dmitry å’Œ Andrew.</p>]]></content>
      
      
        <tags>
            
            <tag> translation </tag>
            
            <tag> database </tag>
            
            <tag> postgresql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>é€å»çš„ 2016</title>
      <link href="/post/the-past-2016.html"/>
      <url>/post/the-past-2016.html</url>
      <content type="html"><![CDATA[<p>2016 å¹´è½¬çœ¼é—´è¿‡å»äº†, ä¸çŸ¥ä¸è§‰, åŒ†åŒ†å¿™å¿™;<br><a id="more"></a></p><h3 id="å­¦ä¹ ä¸€é—¨æ–°è¯­è¨€"><a href="#å­¦ä¹ ä¸€é—¨æ–°è¯­è¨€" class="headerlink" title="å­¦ä¹ ä¸€é—¨æ–°è¯­è¨€"></a>å­¦ä¹ ä¸€é—¨æ–°è¯­è¨€</h3><p><em>Kotlin 1.0</em> æ­£å¼å‘å¸ƒ, ç®€æ´, å®ç”¨, ä¸å¤±ä¼˜é›…;</p><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> hello</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    println(<span class="string">"Hello, world!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>Kotlin 1.0.x</em> å¯ä»¥çœ‹ä½œæ˜¯ <em>Scala</em> ç®€ç‰ˆ; <em>Kotlin 1.1</em> å°†æ˜¯å¤§æ”¾å¼‚å½©çš„ç‰ˆæœ¬, å±Šæ—¶å°†è¿æ¥ <em>Coroutines</em>, <em>Type aliases</em> ç­‰é‡å¤§ç‰¹æ€§;</p><h3 id="å­¦ä¹ ä¸€é—¨æ–°æ¡†æ¶"><a href="#å­¦ä¹ ä¸€é—¨æ–°æ¡†æ¶" class="headerlink" title="å­¦ä¹ ä¸€é—¨æ–°æ¡†æ¶"></a>å­¦ä¹ ä¸€é—¨æ–°æ¡†æ¶</h3><p>éš <em>Kotlin</em> å†æ¬¡å›åˆ° <em>JVM</em> ä¸–ç•Œ, å­¦ä¹  <em>Spring Boot</em>(ä»¥ä¸‹ç®€ç§° <em>SB</em>) æ¡†æ¶;</p><p><em>SB</em> æ˜¯ <em>Spring</em> ç¤¾åŒºæ¨å‡ºçš„å¾®æœåŠ¡æ¡†æ¶, åœ¨ <em>Spring</em> çš„åŸºç¡€ä¸Šå°è£…äº†å¾®æœåŠ¡çš„è¦ç´ , æ˜¯ä¸€ä¸ªå€¼å¾—å­¦ä¹ çš„å¾®æœåŠ¡æ¡†æ¶;</p><p><em>Spring</em> çš„ä¾èµ–æ³¨å…¥åˆ°è¾¾å´­æ–°çš„é«˜åº¦, é…ç½®å¼ºå¤§, çµæ´», ç¤¾åŒºæ´»è·ƒ, 2017 <em>SB</em> å°†ç»§ç»­æ”»åŸç•¥åœ°;</p><h3 id="æ”¾å¼ƒçš„è¯­è¨€"><a href="#æ”¾å¼ƒçš„è¯­è¨€" class="headerlink" title="æ”¾å¼ƒçš„è¯­è¨€"></a>æ”¾å¼ƒçš„è¯­è¨€</h3><p>æœ¬æ‰“ç®—æ·±å…¥ <em>Rust</em> è¯­è¨€, ä¸€æ–¹é¢è‡ªå·±æ²¡æœ‰åç³»ç»Ÿåº•å±‚çš„å·¥ä½œ; å…¶æ¬¡æ˜¯è¿™é—¨è¯­è¨€çš„è¯­æ³•å™ªéŸ³å¤ªé«˜äº†;</p><p><em>Perl</em> è¢«æˆç§°ä¸ºè‡ªå¸¦åŠ å¯†çš„è¯­è¨€, äºæˆ‘è€Œè¨€ <em>Rust</em> åœ¨è¿™æ–¹é¢å¯ä¸ <em>Perl</em> åŒ¹æ•Œäº†.</p><p>ä¸€é—¨è¯­è¨€å¦‚æœåœ¨è¯­æ³•å™ªéŸ³æ–¹é¢æ— æ³•èŠ‚åˆ¶, æˆ‘æƒ³æˆ‘æ˜¯æ— ç¼˜äº†.</p><h3 id="2017"><a href="#2017" class="headerlink" title="2017"></a>2017</h3><ul><li><p><em>Go</em> è¯­è¨€ç»§ç»­è¶æ‰‹</p></li><li><p><em>Kotlin</em> ä¿®ç‚¼, æå¸¦ <em>Java 8</em></p></li><li><p><em>Python 3.6</em> ç‰¹æ€§åŠ æŒ</p></li><li><p><em>OCaml</em> æŠŠç©</p></li></ul>]]></content>
      
      
        <tags>
            
            <tag> note </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Python dynamic class</title>
      <link href="/post/make-a-dynamic-class-in-python.html"/>
      <url>/post/make-a-dynamic-class-in-python.html</url>
      <content type="html"><![CDATA[<p>Sometimes, we hope a class can be dynamicly created in python runtime.<br><a id="more"></a></p><p>Take this scenario, we have two Django model classes:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Musician</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    first_name = models.CharField(max_length=<span class="number">50</span>)</span><br><span class="line">    last_name = models.CharField(max_length=<span class="number">50</span>)</span><br><span class="line">    sex = models.IntegerField()</span><br><span class="line">    instrument = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update_sex</span><span class="params">(cls, id, sex)</span>:</span></span><br><span class="line"><span class="keyword">if</span> cls.objects.filter(pk=id).update(sex=sex) &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="comment"># update Redis</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Album</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">30</span>)</span><br><span class="line">    release_date = models.DateField()</span><br><span class="line">    num_stars = models.IntegerField()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update_name</span><span class="params">(cls, id, name)</span>:</span></span><br><span class="line"><span class="keyword">if</span> cls.objects.filter(pk=id).update(name=name) &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="comment"># update Redis</span></span><br></pre></td></tr></table></figure><p>Ok, what if we just need Redis key-value cache, how can we design our Redis class ? Most of all, we think about two same like classes like this:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RMusician</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_sex</span><span class="params">(cls, key, sex)</span>:</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_sex</span><span class="params">(cls, key)</span>:</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RAlbum</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_sex</span><span class="params">(cls, key, sex)</span>:</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_sex</span><span class="params">(cls, key)</span>:</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>This may be very ugly ! But we can make things better in Python:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_class</span><span class="params">(cls, *fields)</span>:</span></span><br><span class="line">    RedisFactory = type(<span class="string">'RedisFactory'</span>, (), &#123;<span class="string">'r'</span>: redis.Redis()&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_x</span><span class="params">(key, x)</span>:</span></span><br><span class="line">Redisfactory.r.set(key, x)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_x</span><span class="params">(field, key)</span>:</span></span><br><span class="line">x = Redisfactory.r.get(key)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> x:</span><br><span class="line">    obj = globals()[cls].objects.filter(id=key).first()</span><br><span class="line">    <span class="keyword">if</span> obj:</span><br><span class="line">x = getattr(obj, field)</span><br><span class="line">set_x(key, x)</span><br><span class="line"><span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> fields:</span><br><span class="line"><span class="comment"># setattr(RedisFactory, 'get_&#123;0&#125;'.format(f), classmethod(lambda kls, key: get_x(f, key)))</span></span><br><span class="line"><span class="comment"># setattr(Redisfactory, 'set_&#123;0&#125;'.format(f), classmethod(lambda kls, key, x: set_x(key, x)))</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> RedisFactory</span><br><span class="line"></span><br><span class="line">RMusician = make_class(<span class="string">'Musician'</span>, <span class="string">'sex'</span>)</span><br><span class="line">RAlbum = make_class(<span class="string">'Album'</span>, <span class="string">'name'</span>)</span><br></pre></td></tr></table></figure><p>Thatâ€™s it.</p>]]></content>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Emacs is a habit</title>
      <link href="/post/emacs-is-a-habit.html"/>
      <url>/post/emacs-is-a-habit.html</url>
      <content type="html"><![CDATA[<h3 id="What-is-Emacs"><a href="#What-is-Emacs" class="headerlink" title="What is Emacs"></a>What is Emacs</h3><p>EMACS may stand for <em>Editing MACroS</em>, but it has some more creative <a href="https://www.gnu.org/fun/jokes/gnuemacs.acro.exp.html" target="_blank" rel="noopener">definitions</a>. Here they are.</p><ul><li><em>Emacs Makes A Computer Slow</em></li><li>Emacs May Annihilate Command Structures</li><li>Evenings, Mornings, And a Couple of Saturdays</li><li>Ever Made A Control-key Setup?</li><li>Elephantine Memory Absolutely Considered Sine que non</li><li>Emacs Makers Are Crazy Sickos</li><li>â€¦</li></ul><h3 id="My-road-to-mutiny"><a href="#My-road-to-mutiny" class="headerlink" title="My road to mutiny"></a>My road to mutiny</h3><h4 id="Interactive-Mode"><a href="#Interactive-Mode" class="headerlink" title="Interactive Mode"></a>Interactive Mode</h4><p>Before Emacs, I used Vim for three more years, so I think Iâ€™m very familiar with it.</p><p>For Vim users (including me), a small detail is they often restart vim. they open a file, edit it , exit vim; then another, and so on. One reason may be Vim really starts very quickly, but the most important is that Vim lacks interactive mode.</p><p>Compared with Emacsâ€™s super-charging completion engine and Ido Mode, Vim is a bullshit in doing things interactively.</p><p>Of course, Ido Mode in Emacs is off by default, you can enable it like this:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(setq ido-enable-flex-matching t)</span><br><span class="line">(setq ido-everywhere t)</span><br><span class="line">(ido-mode 1)</span><br></pre></td></tr></table></figure><p>Itâ€™ll enable basic Ido support for files and buffers and the very useful <em>flex matching</em> as well.</p><h4 id="Package-management"><a href="#Package-management" class="headerlink" title="Package management"></a>Package management</h4><p><a href="http://wikemacs.org/wiki/Package.el" target="_blank" rel="noopener">Since Emacs 24</a> (2012), It (package.el) became part of Emacs. But util now, <a href="https://github.com/gmarik/Vundle.vim" target="_blank" rel="noopener">Vundle</a> is still a plug-in manager for Vim.</p><p>What does it mean ? It means Emacs has an official maintained package repository (<a href="http://elpa.gnu.org/packages/" target="_blank" rel="noopener">GNU ELPA Packages</a>) while Vim not. So What Vim missing ? It is Software Reuse.</p><p>Ok, You maybe justify that Vim is just an editor not an OS; so package is meaningless for Vim; and Emacs is an OS that a package can be installed in it. For me it is a meaningless excuses.</p><p>Either Emacs or Vim, They both have a runtime environment to ensure that plugins or packages run. But on top of Emacs runtime, there is a library layer. Maybe it is the important difference between Emacs and Vim runtime environment.</p><p>End result, in Emacs, either a library or plug-in like package, they are treated equally; and a plug-in like package can reuse a library package.</p><p>Relative to Vim, Iâ€™m more optimistic about <a href="https://github.com/neovim" target="_blank" rel="noopener">Neovim</a>, I hope it can be better than Vim in plugin system, and I donated <em>$15</em> to it.</p><p>Emacs package interface is very good, you can not only use <em>GNU ELPA Packages</em> but also third ones.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(require &apos;package)</span><br><span class="line"></span><br><span class="line">(add-to-list &apos;package-archives &apos;(&quot;melpa&quot; . &quot;http://melpa.org/packages/&quot;) t)</span><br><span class="line"></span><br><span class="line">(when (&lt; emacs-major-version 24)</span><br><span class="line">  ;; For important compatibility libraries like cl-lib</span><br><span class="line">  (add-to-list &apos;package-archives &apos;(&quot;gnu&quot; . &quot;http://elpa.gnu.org/packages/&quot;)))</span><br><span class="line"></span><br><span class="line">(package-initialize)</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> emacs </tag>
            
            <tag> editor </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>PostgreSQL Aggregate Functions</title>
      <link href="/post/postgresql-aggregate-functions.html"/>
      <url>/post/postgresql-aggregate-functions.html</url>
      <content type="html"><![CDATA[<p>Sometimes, when we use <code>SQL</code> aggregate functions, we hope to collect all primary keys in each column group.<br><a id="more"></a></p><p>Take below for example:</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> date_trunc(<span class="string">'day'</span>, create_time) <span class="keyword">AS</span> <span class="built_in">date</span>,</span><br><span class="line">       <span class="keyword">count</span>(<span class="keyword">id</span>)</span><br><span class="line"><span class="keyword">FROM</span> s_table</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="built_in">date</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="built_in">date</span>;</span><br></pre></td></tr></table></figure><p>In this sql code, we can just get columns grouped by or aggregate results; we can not get id columns (or others) in each row.</p><p>But how can we get that ? We can use <a href="http://www.postgresql.org/docs/9.3/static/functions-aggregate.html" title="Aggregate Functions" target="_blank" rel="noopener"><code>string_agg</code></a>:</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> date_trunc(<span class="string">'day'</span>, create_time) <span class="keyword">AS</span> <span class="built_in">date</span>,</span><br><span class="line">       <span class="keyword">count</span>(<span class="keyword">id</span>),</span><br><span class="line">       string_agg(<span class="keyword">cast</span>(<span class="keyword">id</span> <span class="keyword">as</span> <span class="built_in">text</span>), <span class="string">','</span>)</span><br><span class="line"><span class="keyword">FROM</span> s_table</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="built_in">date</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="built_in">date</span>;</span><br></pre></td></tr></table></figure><p>Maybe you have noticed a comma <code>,</code> as <code>sting_agg</code>â€˜s second parameter, It is just a delimiter, you can use any one you would like.</p><p>So you maybe get some records as below:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2015-01-17 00:00:00+08 | 5 | 1461491,1461508,1461482,1461483,1461509</span><br></pre></td></tr></table></figure><p>It is very Excited !</p>]]></content>
      
      
        <tags>
            
            <tag> postgresql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>PostgreSQL æ¡ä»¶è¡¨è¾¾å¼</title>
      <link href="/post/conditional-expressions-in-postgres.html"/>
      <url>/post/conditional-expressions-in-postgres.html</url>
      <content type="html"><![CDATA[<p>A simple example from Postgres offical documents:<br><a id="more"></a></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">test</span>;</span><br><span class="line"></span><br><span class="line"> a</span><br><span class="line"><span class="comment">---</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> a,</span><br><span class="line">       <span class="keyword">CASE</span> <span class="keyword">WHEN</span> a=<span class="number">1</span> <span class="keyword">THEN</span> <span class="string">'one'</span></span><br><span class="line">    <span class="keyword">WHEN</span> a=<span class="number">2</span> <span class="keyword">THEN</span> <span class="string">'two'</span></span><br><span class="line">    <span class="keyword">ELSE</span> <span class="string">'other'</span></span><br><span class="line">       <span class="keyword">END</span></span><br><span class="line">    <span class="keyword">FROM</span> <span class="keyword">test</span>;</span><br><span class="line"></span><br><span class="line"> a | case</span><br><span class="line"><span class="comment">---+-------</span></span><br><span class="line"> 1 | one</span><br><span class="line"> 2 | two</span><br><span class="line"> 3 | other</span><br></pre></td></tr></table></figure><p>It is based on this form:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CASE WHEN condition THEN result</span><br><span class="line">     [WHEN ...]</span><br><span class="line">     [ELSE result]</span><br><span class="line">END</span><br></pre></td></tr></table></figure><p>It is very convenient in aggregation functions, just think table <em>foo</em> below:</p><table><thead><tr><th>id</th><th>sex</th></tr></thead><tbody><tr><td>pk</td><td>0/1</td></tr></tbody></table><p><em>id</em> is tableâ€™s primary key, <em>sex</em> is 0 or 1, it stands for male and female.</p><p>Now, how can we lookup how many males and females at the same time ?</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">sum</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> sex=<span class="number">0</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">AS</span> total_male,</span><br><span class="line">       <span class="keyword">sum</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> sex=<span class="number">1</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">AS</span> total_female</span><br><span class="line"><span class="keyword">FROM</span> foo;</span><br></pre></td></tr></table></figure><p>Thatâ€™s it.</p>]]></content>
      
      
        <tags>
            
            <tag> database </tag>
            
            <tag> postgres </tag>
            
            <tag> sql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Coleslaw, A Lisp static blog generator</title>
      <link href="/post/rock-with-coleslaw.html"/>
      <url>/post/rock-with-coleslaw.html</url>
      <content type="html"><![CDATA[<p>A long time, I used <code>jekyll</code> as my static site generator. But now I will play some lisp, so Coleslaw comes.</p>]]></content>
      
      
        <tags>
            
            <tag> lisp </tag>
            
            <tag> coleslaw </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
